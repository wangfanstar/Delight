
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ch.06 â€” æœç´¢å­— | Hacker's Delight</title>
<script src="alpine.min.js" defer></script>
<script src="echarts.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@300;400;600;700;900&display=swap');
:root{
  --g:#00ff88;--b:#00d4ff;--p:#b14fff;--o:#ff8c00;--r:#ff4466;
  --dark:#050810;--card:#0d1117;--border:rgba(0,255,136,.18);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--dark);color:#e2e8f0;font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,212,255,.006) 2px,rgba(0,212,255,.006) 4px);pointer-events:none;z-index:0;}
canvas#bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
#app{position:relative;z-index:1;}

nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,8,16,.92);backdrop-filter:blur(14px);border-bottom:1px solid var(--border);padding:.7rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);text-decoration:none;}
.nav-links{display:flex;gap:1.4rem;}
.nav-links a{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;text-decoration:none;transition:color .2s;}
.nav-links a:hover{color:var(--b);}

#prog{position:fixed;top:0;left:0;height:2px;z-index:200;background:linear-gradient(90deg,var(--b),var(--g),var(--p));transition:width .1s;}

.dot-nav{position:fixed;right:1.4rem;top:50%;transform:translateY(-50%);z-index:50;display:flex;flex-direction:column;gap:.55rem;}
.dot{width:8px;height:8px;border-radius:50%;background:#1e293b;cursor:pointer;transition:all .2s;}
.dot.active{background:var(--b);transform:scale(1.45);box-shadow:0 0 6px var(--b);}
@media(max-width:768px){.dot-nav{display:none;}}
/* â•â•â• å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  â•â•â• */
.sidebar-nav{position:fixed;left:0;top:0;bottom:0;width:180px;z-index:90;background:rgba(5,8,16,.92);backdrop-filter:blur(10px);border-right:1px solid rgba(0,255,136,.12);padding:1rem .5rem;overflow-y:auto;overflow-x:hidden;transition:transform .25s ease;display:flex;flex-direction:column;}
.sidebar-nav::-webkit-scrollbar{width:3px;}
.sidebar-nav::-webkit-scrollbar-thumb{background:#1e293b;border-radius:2px;}
.sidebar-title{font-family:'JetBrains Mono',monospace;font-size:.62rem;color:var(--g);letter-spacing:.08em;padding:.4rem .6rem;border-bottom:1px solid rgba(0,255,136,.15);margin-bottom:.5rem;flex-shrink:0;}
.sidebar-section{margin-bottom:.6rem;display:flex;flex-direction:column;}
.sidebar-section-title{font-family:'JetBrains Mono',monospace;font-size:.58rem;color:#475569;padding:.3rem .6rem;letter-spacing:.05em;flex-shrink:0;}
.sidebar-link{display:block;width:100%;clear:both;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#64748b;text-decoration:none;padding:.25rem .6rem .25rem 1rem;border-radius:3px;transition:all .15s;position:relative;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sidebar-link:hover{color:var(--g);background:rgba(0,255,136,.06);}
.sidebar-link.active{color:var(--g);background:rgba(0,255,136,.1);}
.sidebar-link.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:2px;height:14px;background:var(--g);border-radius:1px;}
.sidebar-toggle{display:none;position:fixed;left:.5rem;top:.85rem;z-index:95;width:32px;height:32px;background:rgba(5,8,16,.9);border:1px solid rgba(0,255,136,.2);border-radius:4px;color:var(--g);font-size:1.1rem;cursor:pointer;}
@media(max-width:1100px){.sidebar-nav{transform:translateX(-100%);}.sidebar-nav.open{transform:translateX(0);}.sidebar-toggle{display:flex;align-items:center;justify-content:center;}body{padding-left:0!important;}}
body.sidebar-open{padding-left:180px;}
@media(min-width:1101px){body{padding-left:180px;}}

.hero{padding:7rem 2rem 3rem;text-align:center;max-width:960px;margin:0 auto;}
.chapter-badge{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--b);border:1px solid var(--b);padding:.28rem .95rem;border-radius:999px;letter-spacing:.15em;margin-bottom:1.5rem;animation:badge-pulse 2.5s ease-in-out infinite;}
@keyframes badge-pulse{0%,100%{box-shadow:0 0 6px rgba(0,212,255,.35);}50%{box-shadow:0 0 22px rgba(0,212,255,.75);}}
.hero-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:900;background:linear-gradient(135deg,#fff 0%,var(--b) 50%,var(--g) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15;margin-bottom:.5rem;}
.hero-sub{font-family:'JetBrains Mono',monospace;color:#475569;font-size:.88rem;margin-bottom:1.8rem;}
.hero-desc{color:#94a3b8;font-size:.98rem;line-height:1.88;max-width:740px;margin:0 auto 2rem;}

section{max-width:1100px;margin:0 auto;padding:0 1.5rem 4rem;}
.sec-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.75rem;}
.sec-num{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--b);background:rgba(0,212,255,.07);border:1px solid rgba(0,212,255,.18);padding:.22rem .55rem;border-radius:4px;white-space:nowrap;}
.sec-title{font-size:1.3rem;font-weight:700;color:#f1f5f9;}
.sec-divider{flex:1;height:1px;background:linear-gradient(90deg,rgba(0,212,255,.28),transparent);}

.card{background:var(--card);border:1px solid #1e293b;border-radius:.75rem;padding:1.4rem;transition:border-color .25s,box-shadow .25s;}
.card:hover{border-color:rgba(0,212,255,.22);box-shadow:0 4px 22px rgba(0,212,255,.06);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.2rem;}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.1rem;}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr;}}

.code-block{background:#010409;border:1px solid #1e293b;border-radius:.5rem;padding:1.1rem 1.4rem;font-family:'JetBrains Mono',monospace;font-size:.78rem;line-height:1.85;overflow-x:auto;color:#94a3b8;white-space:pre-wrap;}
.code-block .kw{color:var(--p);}
.code-block .num{color:var(--o);}
.code-block .cm{color:#334155;font-style:italic;}
.code-block .fn{color:var(--g);}
.code-block .hi{color:var(--b);}
.code-block .str{color:var(--o);}
.code-block .warn{color:var(--r);}

.insight{background:rgba(0,212,255,.04);border:1px solid rgba(0,212,255,.14);border-left:3px solid var(--b);border-radius:.5rem;padding:1.15rem 1.4rem;margin-bottom:1.2rem;font-size:.88rem;line-height:1.82;color:#94a3b8;}
.insight strong{color:var(--b);}
.insight .label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--b);letter-spacing:.1em;display:block;margin-bottom:.4rem;}

.warn-box{background:rgba(255,68,102,.04);border:1px solid rgba(255,68,102,.18);border-left:3px solid var(--r);border-radius:.5rem;padding:1.05rem 1.3rem;font-size:.84rem;line-height:1.78;color:#94a3b8;margin-bottom:1.1rem;}
.warn-box strong{color:var(--r);}

.tag{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.62rem;padding:.18rem .48rem;border-radius:3px;margin:.12rem;}
.tag-g{background:rgba(0,255,136,.09);color:var(--g);border:1px solid rgba(0,255,136,.18);}
.tag-b{background:rgba(0,212,255,.09);color:var(--b);border:1px solid rgba(0,212,255,.18);}
.tag-p{background:rgba(177,79,255,.09);color:var(--p);border:1px solid rgba(177,79,255,.18);}
.tag-o{background:rgba(255,140,0,.09);color:var(--o);border:1px solid rgba(255,140,0,.18);}
.tag-r{background:rgba(255,68,102,.09);color:var(--r);border:1px solid rgba(255,68,102,.18);}

.tab-nav{display:flex;gap:.4rem;margin-bottom:.9rem;flex-wrap:wrap;}
.tab-btn{font-family:'JetBrains Mono',monospace;font-size:.68rem;padding:.32rem .8rem;border-radius:4px;border:1px solid #1e293b;background:transparent;color:#475569;cursor:pointer;transition:all .2s;}
.tab-btn.active,.tab-btn:hover{border-color:var(--b);color:var(--b);background:rgba(0,212,255,.07);}
.tab-pane{display:none;}.tab-pane.active{display:block;}

/* å­—èŠ‚å¯è§†åŒ– */
.byte-word{display:flex;gap:2px;flex-wrap:nowrap;margin:.4rem 0;align-items:center;}
.byte-cell{min-width:56px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:3px;font-family:'JetBrains Mono',monospace;font-size:.7rem;border:1px solid #1e293b;transition:all .3s;cursor:default;flex-shrink:0;}
.byte-cell.zero{background:rgba(255,68,102,.18);color:var(--r);border-color:rgba(255,68,102,.4);}
.byte-cell.nonzero{background:rgba(0,212,255,.1);color:var(--b);border-color:rgba(0,212,255,.3);}
.byte-cell.found{background:rgba(0,255,136,.2);color:var(--g);border-color:rgba(0,255,136,.4);box-shadow:0 0 8px rgba(0,255,136,.3);}
.byte-cell.scan{background:rgba(177,79,255,.2);color:var(--p);border-color:rgba(177,79,255,.4);}

/* 1-bit ä¸²å¯è§†åŒ– */
.bit-strip{display:flex;gap:1px;flex-wrap:wrap;margin:.35rem 0;}
.bs{width:18px;height:18px;display:flex;align-items:center;justify-content:center;border-radius:2px;font-family:'JetBrains Mono',monospace;font-size:.6rem;border:1px solid #0f172a;transition:all .25s;}
.bs.one{background:rgba(0,212,255,.22);color:var(--b);border-color:rgba(0,212,255,.4);}
.bs.zero{background:#010409;color:#1e293b;}
.bs.hi{background:rgba(0,255,136,.22);color:var(--g);border-color:rgba(0,255,136,.4);}
.bs.target{background:rgba(255,140,0,.25);color:var(--o);border-color:rgba(255,140,0,.45);}
.bs.found-run{background:rgba(177,79,255,.25);color:var(--p);border-color:rgba(177,79,255,.45);}

.stat-box{background:#010409;border:1px solid #1e293b;border-radius:.45rem;padding:.7rem 1rem;text-align:center;}
.stat-val{font-family:'JetBrains Mono',monospace;font-size:1.6rem;font-weight:700;color:var(--b);}
.stat-label{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#334155;letter-spacing:.08em;margin-top:.2rem;}

.critic-box{background:linear-gradient(135deg,rgba(0,212,255,.05),rgba(177,79,255,.03));border:1px solid rgba(0,212,255,.22);border-radius:.75rem;padding:1.65rem;position:relative;overflow:hidden;}
.critic-box::before{content:'// æ·±åº¦ç‚¹è¯„';font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--b);letter-spacing:.1em;display:block;margin-bottom:.9rem;}
.critic-box h3{font-size:1rem;font-weight:700;color:#f1f5f9;margin-bottom:.7rem;}
.critic-item{margin-bottom:1rem;padding-left:.9rem;border-left:2px solid rgba(0,212,255,.28);}
.critic-item .ci-title{font-size:.81rem;font-weight:600;color:var(--b);margin-bottom:.28rem;}
.critic-item p{font-size:.8rem;line-height:1.74;color:#64748b;}

@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
.fade-up{opacity:0;animation:fadeUp .5s ease both;}

footer{text-align:center;padding:2.5rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#1e293b;border-top:1px solid #0f172a;}
footer a{color:var(--b);text-decoration:none;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:var(--dark);}
::-webkit-scrollbar-thumb{background:#1e293b;border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:rgba(0,212,255,.28);}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div id="prog"></div>

<div class="dot-nav" id="dotNav">
  <div class="dot active" data-sec="hero"    title="é¡¶éƒ¨"></div>
  <div class="dot"        data-sec="zbyte"   title="Â§6-1 æŸ¥æ‰¾0å­—èŠ‚"></div>
  <div class="dot"        data-sec="ffstr"   title="Â§6-2 å®šé•¿1ä¸²"></div>
  <div class="dot"        data-sec="maxstr"  title="Â§6-3 æœ€é•¿1ä¸²"></div>
  <div class="dot"        data-sec="minstr"  title="Â§6-4 æœ€çŸ­1ä¸²"></div>
  <div class="dot"        data-sec="apps"    title="å®é™…åº”ç”¨"></div>
  <div class="dot"        data-sec="critique" title="æ·±åº¦ç‚¹è¯„"></div>
</div>

<nav>
  <a class="nav-logo" href="index.html">â† HACKER'S DELIGHT</a>
  <div class="nav-links">
    <a href="#zbyte">0å­—èŠ‚æœç´¢</a>
    <a href="#ffstr">å®šé•¿1ä¸²</a>
    <a href="#maxstr">æœ€é•¿1ä¸²</a>
    <a href="#minstr">æœ€çŸ­1ä¸²</a>
    <a href="#apps">åº”ç”¨</a>
    <a href="#critique">ç‚¹è¯„</a>
  </div>
</nav>

<!-- â•â•â• å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  â•â•â• -->
<button class="sidebar-toggle" @click="sidebarOpen = !sidebarOpen" x-data="{sidebarOpen: false}">
  â˜°
</button>
<nav class="sidebar-nav" :class="sidebarOpen ? 'open' : ''" x-data="{sidebarOpen: false}" @click.away="sidebarOpen = false">
  <div class="sidebar-title">ğŸ“š HACKER'S DELIGHT</div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">æ­£æ–‡ç« èŠ‚</div>
    <a href="ch01.html" class="sidebar-link">Ch.01 å¥ å®šåŸºç¡€</a>
    <a href="ch02.html" class="sidebar-link">Ch.02 åŸºç¡€æ“ä½œ</a>
    <a href="ch03.html" class="sidebar-link">Ch.03 2çš„å¹‚è¾¹ç•Œ</a>
    <a href="ch04.html" class="sidebar-link">Ch.04 ç®—æœ¯è¾¹ç•Œ</a>
    <a href="ch05.html" class="sidebar-link">Ch.05 ä½è®¡æ•°</a>
    <a href="ch06.html" class="sidebar-link active">Ch.06 æœç´¢å­—</a>
    <a href="ch07.html" class="sidebar-link">Ch.07 ä½ç¿»è½¬</a>
    <a href="ch08.html" class="sidebar-link">Ch.08 ä½ç½®æ¢</a>
    <a href="ch09.html" class="sidebar-link">Ch.09 å¾ªç¯å†—ä½™æ ¡éªŒ</a>
    <a href="ch10.html" class="sidebar-link">Ch.10 å¥‡å¶æ ¡éªŒ</a>
    <a href="ch11.html" class="sidebar-link">Ch.11 Grayç </a>
    <a href="ch12.html" class="sidebar-link">Ch.12 Hilbertæ›²çº¿</a>
    <a href="ch13.html" class="sidebar-link">Ch.13 æµ®ç‚¹æ•°</a>
    <a href="ch14.html" class="sidebar-link">Ch.14 å…¬å¼</a>
    <a href="ch15.html" class="sidebar-link">Ch.15 åŸºæ•°è½¬æ¢</a>
    <a href="ch16.html" class="sidebar-link">Ch.16 å¼€æ–¹</a>
    <a href="ch17.html" class="sidebar-link">Ch.17 æµ®ç‚¹å€’æ•°å¼€æ–¹</a>
    <a href="ch18.html" class="sidebar-link">Ch.18 å…¶å®ƒ</a>
  </div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">é™„å½•</div>
    <a href="appA.html" class="sidebar-link">App.A è¯æ±‡è¡¨</a>
    <a href="appB.html" class="sidebar-link">App.B æ‘˜è¦</a>
    <a href="appC.html" class="sidebar-link">App.C å‘å±•å²</a>
  </div>
</nav>

<div id="app" x-data="app()" x-init="init()">

<!-- â•â•â• HERO â•â•â• -->
<div class="hero" id="hero">
  <div class="chapter-badge">CHAPTER 06 Â· SEARCHING WORDS Â· æœç´¢å­—</div>
  <h1 class="hero-title fade-up" style="animation-delay:.1s">æœç´¢å­—</h1>
  <p class="hero-sub fade-up" style="animation-delay:.2s">// find 0-byte Â· first/longest/shortest run of 1-bits Â· word-parallel SWAR tricks</p>
  <p class="hero-desc fade-up" style="animation-delay:.3s">
    ç¬¬6ç« æ˜¯ Hacker's Delight ä¸­<strong style="color:var(--b)">æœ€è´´è¿‘ç³»ç»Ÿç¼–ç¨‹å®æˆ˜</strong>çš„ä¸€ç« ã€‚
    å››ä¸ªé—®é¢˜â€”â€”æŸ¥æ‰¾ç¬¬ä¸€ä¸ª0å­—èŠ‚ã€æŸ¥æ‰¾ç»™å®šé•¿åº¦çš„1-bitä¸²ã€æŸ¥æ‰¾æœ€é•¿1ä¸²ã€æŸ¥æ‰¾æœ€çŸ­1ä¸²â€”â€”
    çœ‹ä¼¼å¹³å‡¡ï¼Œå´æ˜¯ <code style="color:var(--o)">strlen</code>ã€ç£ç›˜å—åˆ†é…å™¨ã€DNAåºåˆ—æœç´¢ã€
    å›¾åƒè¡Œç¨‹ç¼–ç ï¼ˆRLEï¼‰ã€å‹ç¼©ç®—æ³•å’Œç½‘ç»œåè®®è§£æçš„å…±åŒå†…æ ¸ã€‚
    Warren ç”¨"SWAR"ï¼ˆSIMD Within A Registerï¼‰æ€æƒ³ï¼ŒæŠŠ4ä¸ªå­—èŠ‚åŒæ—¶å¹¶è¡Œå¤„ç†ï¼Œ
    ç”¨çº¯æ•´æ•°ç®—æœ¯æ›¿ä»£é€å­—èŠ‚å¾ªç¯â€”â€”è¿™æ˜¯ x86 SSE/AVX åˆ°æ¥ä¹‹å‰çš„
    <strong style="color:var(--b)">å•å¯„å­˜å™¨æ•°æ®å¹¶è¡Œ</strong>å·…å³°è‰ºæœ¯ã€‚
  </p>
  <div class="fade-up" style="animation-delay:.4s">
    <span class="tag tag-b">find 0-byte (strlen å†…æ ¸)</span>
    <span class="tag tag-g">SWAR / word-parallel</span>
    <span class="tag tag-p">ffstr1 â€” å®šé•¿1ä¸²</span>
    <span class="tag tag-o">fmaxstr â€” æœ€é•¿1ä¸²</span>
    <span class="tag tag-r">fminstr â€” æœ€çŸ­1ä¸²</span>
    <span class="tag tag-b">nlz / ntz ååŒ</span>
    <span class="tag tag-g">ç£ç›˜å—åˆ†é… / strlen</span>
    <span class="tag tag-p">Hsieh ç®—æ³•</span>
  </div>
</div>

<!-- â•â•â• Â§6-1 æŸ¥æ‰¾0å­—èŠ‚ â•â•â• -->
<section id="zbyte">
  <div class="sec-header">
    <span class="sec-num">Â§6-1</span>
    <span class="sec-title">æŸ¥æ‰¾ç¬¬ä¸€ä¸ª0å­—èŠ‚ â€” Find First 0-Byte</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE STRLEN TRICK â€” SWARï¼šå¯„å­˜å™¨å†…çš„SIMD</span>
    C å­—ç¬¦ä¸²ä»¥ 0 å­—èŠ‚ï¼ˆ<code style="color:var(--o)">'\0'</code>ï¼‰ç»ˆæ­¢ï¼Œ<code style="color:var(--o)">strlen</code> çš„å¿«é€Ÿå®ç°å¿…é¡»
    <strong>ä¸€æ¬¡æ£€æµ‹ä¸€æ•´ä¸ª word ä¸­æ˜¯å¦æœ‰ 0 å­—èŠ‚</strong>ï¼Œè€Œä¸æ˜¯é€å­—èŠ‚å¾ªç¯ã€‚
    Warren Â§6-1 ç»™å‡ºçš„æ–¹æ³•æ˜¯ç»å…¸çš„ SWAR æŠ€æœ¯ï¼š
    ç”¨ä¸€ä¸ªå·§å¦™çš„ç®—æœ¯è¡¨è¾¾å¼ <code style="color:var(--o)">(x - 0x01010101) &amp; ~x &amp; 0x80808080</code>ï¼Œ
    åœ¨ 4 æ¡æŒ‡ä»¤å†…åŒæ—¶æ£€æµ‹ 4 ä¸ªå­—èŠ‚æ˜¯å¦ä¸º 0ã€‚
    è¿™æ¯”é€å­—èŠ‚æ£€æµ‹å¿« 4 å€ï¼Œä¸”å®Œå…¨æ— åˆ†æ”¯ï¼Œæ˜¯ glibcã€muslã€Apple libc ç­‰æ‰€æœ‰ä¸»æµ C åº“
    strlen å®ç°çš„æ ¸å¿ƒç®—æ³•ï¼Œå¯è¿½æº¯è‡³ 1987 å¹´çš„ Alan Mycroftã€‚
  </div>

  <!-- äº¤äº’å¼å­—èŠ‚æœç´¢æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="zbyteDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.9rem;">
      ğŸ”¬ 0å­—èŠ‚æœç´¢æ¼”ç¤º â€” è¾“å…¥4å­—èŠ‚å­—(åå…­è¿›åˆ¶)ï¼Œè§‚å¯Ÿæ£€æµ‹è¿‡ç¨‹
    </div>
    <div style="display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;margin-bottom:.85rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">32ä½å­— (hex)</div>
        <input type="text" x-model="hexIn" @input="parse()"
               maxlength="10"
               style="width:130px;background:#010409;border:1px solid #1e293b;color:var(--b);font-family:'JetBrains Mono',monospace;font-size:.85rem;padding:.3rem .6rem;border-radius:4px;"
               placeholder="0x...">
      </div>
      <div style="display:flex;gap:.35rem;flex-wrap:wrap;margin-top:1rem;">
        <button @click="setV(0x48656C6C)" class="tab-btn">"Hell"</button>
        <button @click="setV(0x48656C00)" class="tab-btn">"Hel\0"</button>
        <button @click="setV(0x00656C6C)" class="tab-btn">"\0ell"</button>
        <button @click="setV(0x48006C00)" class="tab-btn">"H\0l\0"</button>
        <button @click="setV(0x00000000)" class="tab-btn">"\0\0\0\0"</button>
        <button @click="setV(0xDEADBEEF)" class="tab-btn">0xDEADBEEF</button>
      </div>
    </div>

    <!-- å­—èŠ‚æ˜¾ç¤º (å¤§ç«¯) -->
    <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#334155;margin-bottom:.35rem;">
      å­—èŠ‚å¸ƒå±€ (å¤§ç«¯æ˜¾ç¤º, Byte 0 = æœ€é«˜å­—èŠ‚):
    </div>
    <div class="byte-word" style="margin-bottom:.5rem;">
      <template x-for="(b,i) in bytes" :key="i">
        <div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.58rem;color:#334155;text-align:center;margin-bottom:2px;" x-text="'Byte '+i"></div>
          <div class="byte-cell" :class="b===0?'zero':(i===foundIdx?'found':'nonzero')"
               x-text="b===0?'0x00':('0x'+b.toString(16).toUpperCase().padStart(2,'0'))+'('+(b>=32&&b<127?String.fromCharCode(b):'?')+')'" >
          </div>
        </div>
      </template>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#334155;padding-left:.5rem;align-self:center;">
        â†’ å¤§ç«¯æœº: è¿”å›ç´¢å¼• <span style="color:var(--b);" x-text="foundIdx===4?'4(æœªæ‰¾åˆ°)':foundIdx"></span>
      </div>
    </div>

    <!-- SWAR æ£€æµ‹æ­¥éª¤ -->
    <div style="background:#010409;border:1px solid #1e293b;border-radius:.45rem;padding:.85rem 1rem;font-family:'JetBrains Mono',monospace;font-size:.73rem;line-height:1.85;">
      <div style="color:#334155;margin-bottom:.4rem;">// SWAR é›¶å­—èŠ‚æ£€æµ‹ (Warren Figure 6-2):</div>
      <div style="margin:.2rem 0;">
        <span style="color:#475569;">x       = </span>
        <span style="color:var(--b);" x-text="'0x'+val.toString(16).toUpperCase().padStart(8,'0')"></span>
      </div>
      <div style="margin:.2rem 0;">
        <span style="color:#475569;">x-0x0101 = </span>
        <span style="color:var(--g);" x-text="'0x'+(((val - 0x01010101)>>>0).toString(16).toUpperCase().padStart(8,'0'))"></span>
        <span style="color:#334155;"> // æ¯å­—èŠ‚ï¼š0â†’FF, é0â†’æŸå€¼</span>
      </div>
      <div style="margin:.2rem 0;">
        <span style="color:#475569;">~x      = </span>
        <span style="color:var(--p);" x-text="'0x'+(~val>>>0).toString(16).toUpperCase().padStart(8,'0')"></span>
        <span style="color:#334155;"> // å–åï¼š0å­—èŠ‚â†’FF, é0â†’æŸå€¼</span>
      </div>
      <div style="margin:.2rem 0;">
        <span style="color:#475569;">y (AND) = </span>
        <span style="color:var(--o);" x-text="'0x'+(swarResult>>>0).toString(16).toUpperCase().padStart(8,'0')"></span>
        <span style="color:#334155;"> // & 0x80808080: 0å­—èŠ‚å¯¹åº”å­—èŠ‚çš„bit7=1</span>
      </div>
      <div style="margin-top:.5rem;padding-top:.5rem;border-top:1px solid #0f172a;">
        <span style="color:#475569;">ç»“è®º: </span>
        <span :style="{color: foundIdx<4?'var(--g)':'var(--r)'}"
              x-text="foundIdx<4?('ç¬¬ä¸€ä¸ª0å­—èŠ‚åœ¨ä½ç½® '+foundIdx+' (ä»å·¦)'):'æ— 0å­—èŠ‚ï¼Œy=0'"></span>
      </div>
    </div>

    <div style="display:flex;gap:.65rem;flex-wrap:wrap;margin-top:.75rem;">
      <div class="stat-box" style="min-width:120px;">
        <div class="stat-val" x-text="foundIdx<4?foundIdx:'â€”'"></div>
        <div class="stat-label">0å­—èŠ‚ä½ç½®(å·¦èµ·)</div>
      </div>
      <div class="stat-box" style="min-width:120px;">
        <div class="stat-val" style="color:var(--o);" x-text="foundIdx<4?'æœ‰':'æ— '"></div>
        <div class="stat-label">æ˜¯å¦å«0å­—èŠ‚</div>
      </div>
      <div class="stat-box" style="min-width:160px;">
        <div class="stat-val" style="color:var(--g);font-size:1rem;" x-text="asString"></div>
        <div class="stat-label">ASCIIè§£é‡Š</div>
      </div>
    </div>
  </div>

  <!-- ä¸‰ç§å®ç° -->
  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">
        Â§6-1 ä¸‰ç§ zbytel å®ç°å¯¹æ¯”
      </div>
      <div class="tab-nav" x-data="{t:'swar'}">
        <button class="tab-btn" :class="t==='naive'?'active':''" @click="t='naive'">æœ´ç´ ç‰ˆ</button>
        <button class="tab-btn" :class="t==='swar'?'active':''" @click="t='swar'">SWARæ— åˆ†æ”¯</button>
        <button class="tab-btn" :class="t==='range'?'active':''" @click="t='range'">èŒƒå›´æœç´¢</button>

        <div class="tab-pane" :class="t==='naive'?'active':''">
          <div class="code-block">
<span class="cm">// æœ´ç´ ç‰ˆ zbytel: é€å­—èŠ‚æ£€æµ‹, æœ€å 4 æ¬¡æ¯”è¾ƒ</span>
<span class="kw">int</span> <span class="fn">zbytel_naive</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">if</span>      ((x >> <span class="num">24</span>)        == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;
  <span class="kw">else if</span> ((x &amp; <span class="num">0x00FF0000</span>) == <span class="num">0</span>) <span class="kw">return</span> <span class="num">1</span>;
  <span class="kw">else if</span> ((x &amp; <span class="num">0x0000FF00</span>) == <span class="num">0</span>) <span class="kw">return</span> <span class="num">2</span>;
  <span class="kw">else if</span> ((x &amp; <span class="num">0x000000FF</span>) == <span class="num">0</span>) <span class="kw">return</span> <span class="num">3</span>;
  <span class="kw">else</span>                               <span class="kw">return</span> <span class="num">4</span>;
}
<span class="cm">// Warren Figure 6-1</span>
<span class="cm">// æŒ‡ä»¤æ•°: æœ€å¤š 5Ã—(cmp+branch) = 10æŒ‡ä»¤</span>
<span class="cm">// ç¼ºç‚¹: å¤šåˆ†æ”¯, æ— æ³•æµæ°´çº¿åŒ–</span>
<span class="cm">// ä¼˜ç‚¹: æœ€ç›´è§‚, æ— éœ€ç†è§£ä½æŠ€å·§</span>
          </div>
        </div>

        <div class="tab-pane" :class="t==='swar'?'active':''">
          <div class="code-block">
<span class="cm">// Warren Figure 6-2: SWAR æ— åˆ†æ”¯ç‰ˆ â€” 7æ¡æŒ‡ä»¤</span>
<span class="cm">// åŸç†: ä¸€æ¬¡æ£€æµ‹4ä¸ªå­—èŠ‚æ˜¯å¦æœ‰0</span>
<span class="kw">int</span> <span class="fn">zbytel</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">unsigned</span> y;
  <span class="cm">// åŸå§‹å­—èŠ‚:    00        80        other</span>
  <span class="cm">// x-0x0101:   FF        7F        varies</span>
  <span class="cm">// ~x:         FF        7F        varies</span>
  <span class="cm">// ä¸¤è€…AND:     FF        00        0xxxxxxx</span>
  <span class="cm">// AND 0x8080: 80        00        0 (bit7æ¸…é›¶)</span>
  y = (x &amp; <span class="num">0x7F7F7F7F</span>) + <span class="num">0x7F7F7F7F</span>;
  y = ~(y | x | <span class="num">0x7F7F7F7F</span>);
  <span class="cm">// y çš„æ¯ä¸ªå­—èŠ‚: 0å­—èŠ‚â†’0x80, é0å­—èŠ‚â†’0x00</span>
  <span class="kw">int</span> n = <span class="fn">nlz</span>(y) &gt;&gt; <span class="num">3</span>; <span class="cm">// å‰å¯¼é›¶å­—èŠ‚æ•° = ä½ç½®</span>
  <span class="kw">return</span> n;            <span class="cm">// 0~3: ä½ç½®; 4: æ— 0å­—èŠ‚</span>
}

<span class="cm">// ç­‰ä»·å½¢å¼ (æ›´å¸¸è§äº glibc):</span>
<span class="kw">int</span> <span class="fn">has_zero_byte</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">return</span> ((x - <span class="num">0x01010101</span>) &amp; ~x &amp; <span class="num">0x80808080</span>) != <span class="num">0</span>;
}
<span class="cm">// åˆ†æ:</span>
<span class="cm">// å¯¹æ¯å­—èŠ‚ b:</span>
<span class="cm">//   b=0:    0-1=FFâ†’bit7=1,  ~0=FFâ†’bit7=1  â†’ ANDâ†’bit7=1 âœ“</span>
<span class="cm">//   b=0x80: 80-1=7Fâ†’bit7=0             â†’ ANDâ†’bit7=0 âœ“</span>
<span class="cm">//   bâ‰ 0,â‰ 80: å‡æ³•ä¸ä¼šäº§ç”Ÿbit7å€Ÿä½ â†’ bit7=0 âœ“</span>
<span class="cm">// 7æ¡æŒ‡ä»¤(åŒ…å«nlz), å®Œå…¨æ— åˆ†æ”¯, å¯æµæ°´çº¿!</span>
          </div>
        </div>

        <div class="tab-pane" :class="t==='range'?'active':''">
          <div class="code-block">
<span class="cm">// Â§6-1 æ‰©å±•: æœç´¢å­—èŠ‚å€¼åœ¨æŸèŒƒå›´å†…çš„é¦–å­—èŠ‚</span>
<span class="cm">// åº”ç”¨: æ‰¾ç¬¬ä¸€ä¸ªå¤§å†™å­—æ¯ã€ç¬¬ä¸€ä¸ªç©ºç™½å­—ç¬¦ç­‰</span>

<span class="cm">// æ‰¾ç¬¬ä¸€ä¸ªå­—èŠ‚å€¼åœ¨ [lo, hi] èŒƒå›´å†…çš„å­—èŠ‚</span>
<span class="cm">// æ–¹æ³•: åˆ©ç”¨å¸¦ç¬¦å·æº¢å‡ºæŠ€å·§</span>
<span class="kw">int</span> <span class="fn">find_byte_in_range</span>(<span class="kw">unsigned</span> x,
                        <span class="kw">unsigned char</span> lo,
                        <span class="kw">unsigned char</span> hi) {
  <span class="cm">// å°† x ä¸­æ¯å­—èŠ‚å‡å» lo, æ£€æŸ¥æ˜¯å¦ < (hi-lo+1)</span>
  <span class="kw">unsigned</span> L = lo * <span class="num">0x01010101</span>;
  <span class="kw">unsigned</span> H = (hi - lo + <span class="num">1</span>) * <span class="num">0x01010101</span>;
  <span class="kw">unsigned</span> d = x - L;
  <span class="kw">unsigned</span> y = (d | (d - H)) &amp; ~d &amp; <span class="num">0x80808080</span>;
  <span class="kw">return</span> <span class="fn">nlz</span>(y) &gt;&gt; <span class="num">3</span>;
}

<span class="cm">// å®ä¾‹: æ‰¾ç¬¬ä¸€ä¸ªå¤§å†™å­—æ¯ [0x41, 0x5A]</span>
<span class="cm">// find_byte_in_range(x, 'A', 'Z')</span>

<span class="cm">// 64ä½æœºæ‰©å±•: ä¸€æ¬¡æ£€æµ‹8å­—èŠ‚</span>
<span class="cm">// å°†å¸¸æ•°æ‰©å±•ä¸º64ä½: 0x0101010101010101ULL ç­‰</span>
<span class="cm">// glibc strlen ä½¿ç”¨æ­¤æŠ€æœ¯, æ¯æ¬¡åŠ è½½ä¸€ä¸ª64ä½å­—</span>
<span class="cm">// ARM64 ä¹Ÿå¯ç”¨ SIMD: VMOV.8b + VCEQ.8b + VMOVMSK</span>

<span class="cm">// Warren æŒ‡å‡º: æ­¤æ–¹æ³•å¯é€‚åº”ä»»æ„å­—èŠ‚èŒƒå›´ â‰¥128</span>
<span class="cm">// å³å¯¹èŒƒå›´0~137çš„æœç´¢: å°† y = y | x æ”¹ä¸º y = y & x</span>
          </div>
        </div>
      </div>
    </div>

    <!-- åŸç†è¯´æ˜ -->
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">
        ğŸ” SWAR é›¶æ£€æµ‹åŸç†é€å­—èŠ‚åˆ†æ
      </div>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;font-size:.71rem;">
          <thead>
            <tr style="border-bottom:1px solid #1e293b;">
              <th style="text-align:left;padding:.35rem .6rem;color:#475569;">å­—èŠ‚å€¼ b</th>
              <th style="text-align:left;padding:.35rem .6rem;color:var(--g);">b-0x01</th>
              <th style="text-align:left;padding:.35rem .6rem;color:var(--b);">bit7 of (b-0x01)</th>
              <th style="text-align:left;padding:.35rem .6rem;color:var(--p);">~b bit7</th>
              <th style="text-align:left;padding:.35rem .6rem;color:var(--o);">AND bit7</th>
              <th style="text-align:left;padding:.35rem .6rem;color:var(--r);">æ˜¯0å­—èŠ‚?</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="(row,i) in byteAnalysis" :key="i">
              <tr :style="{borderBottom:'1px solid #0f172a', background:i%2===0?'transparent':'rgba(0,212,255,.015)'}">
                <td style="padding:.3rem .6rem;color:#94a3b8;" x-text="row.b"></td>
                <td style="padding:.3rem .6rem;" :style="{color:row.sub_bit7?'var(--g)':'#475569'}" x-text="row.sub"></td>
                <td style="padding:.3rem .6rem;" :style="{color:row.sub_bit7?'var(--g)':'#475569'}" x-text="row.sub_bit7?'1':'0'"></td>
                <td style="padding:.3rem .6rem;" :style="{color:row.not_bit7?'var(--p)':'#475569'}" x-text="row.not_bit7?'1':'0'"></td>
                <td style="padding:.3rem .6rem;" :style="{color:row.result?'var(--o)':'#334155'}" x-text="row.result?'1':'0'"></td>
                <td style="padding:.3rem .6rem;" :style="{color:row.is_zero?'var(--r)':'#334155'}" x-text="row.is_zero?'âœ“ æ˜¯':'âœ— å¦'"></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#334155;margin-top:.55rem;line-height:1.7;">
        <div>å…³é”®: b=0x80æ—¶ (b-1)=0x7F â†’ bit7=0 â†’ ä¸ä¼šè¯¯åˆ¤ï¼</div>
        <div>åªæœ‰ b=0x00 æ—¶ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ â†’ AND bit7=1</div>
        <div>å…¬å¼: <span style="color:var(--g);">(x-0x01010101) &amp; ~x &amp; 0x80808080</span></div>
      </div>
    </div>
  </div>

  <!-- strlen å®é™…å®ç° -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">
      ğŸ­ strlen å¿«é€Ÿå®ç° â€” å­—å¯¹é½ + SWAR ç»“åˆ
    </div>
    <div class="code-block">
<span class="cm">// å®é™… strlen å®ç°æ¡†æ¶ (ä»¥32ä½ä¸ºä¾‹, 64ä½ç±»ä¼¼)</span>
<span class="cm">// å‚è€ƒ glibc / musl / BSD libc å®ç°ç­–ç•¥</span>
<span class="kw">size_t</span> <span class="fn">fast_strlen</span>(<span class="kw">const char</span> *s) {
  <span class="kw">const char</span> *p = s;

  <span class="cm">// é˜¶æ®µ1: é€å­—èŠ‚å¤„ç†ç›´åˆ°å­—å¯¹é½ (æœ€å¤š3å­—èŠ‚)</span>
  <span class="kw">while</span> ((<span class="kw">unsigned long</span>)p &amp; (<span class="kw">sizeof</span>(<span class="kw">unsigned</span>) - <span class="num">1</span>)) {
    <span class="kw">if</span> (*p == <span class="str">'\0'</span>) <span class="kw">return</span> p - s;
    p++;
  }

  <span class="cm">// é˜¶æ®µ2: æ¯æ¬¡åŠ è½½ä¸€ä¸ª word (4å­—èŠ‚), ç”¨ SWAR æ£€æµ‹</span>
  <span class="kw">const unsigned</span> *wp = (<span class="kw">const unsigned</span> *)p;
  <span class="kw">while</span> (<span class="num">1</span>) {
    <span class="kw">unsigned</span> w = *wp++;
    <span class="cm">// SWAR é›¶å­—èŠ‚æ£€æµ‹: è‹¥æœ‰0å­—èŠ‚åˆ™ y != 0</span>
    <span class="kw">unsigned</span> y = (w - <span class="num">0x01010101u</span>) &amp; ~w &amp; <span class="num">0x80808080u</span>;
    <span class="kw">if</span> (y != <span class="num">0</span>) {
      <span class="cm">// æ‰¾åˆ°åŒ…å«0å­—èŠ‚çš„ word, ç²¾ç¡®å®šä½</span>
      p = (<span class="kw">const char</span> *)(wp - <span class="num">1</span>);
      <span class="cm">// å¤§ç«¯: p += nlz(y) >> 3</span>
      <span class="cm">// å°ç«¯: p += ntz(y) >> 3</span>
      <span class="kw">if</span> (!p[<span class="num">0</span>]) <span class="kw">return</span> p - s;
      <span class="kw">if</span> (!p[<span class="num">1</span>]) <span class="kw">return</span> p - s + <span class="num">1</span>;
      <span class="kw">if</span> (!p[<span class="num">2</span>]) <span class="kw">return</span> p - s + <span class="num">2</span>;
      <span class="kw">return</span>      p - s + <span class="num">3</span>;
    }
  }
}
<span class="cm">// æ€§èƒ½: ~1å­—èŠ‚/å‘¨æœŸ (ç†è®ºæé™å—å†…å­˜å¸¦å®½é™åˆ¶)</span>
<span class="cm">// 64ä½ç‰ˆ: æ¯æ¬¡å¤„ç†8å­—èŠ‚, ä½¿ç”¨ 0x0101010101010101ULL</span>
<span class="cm">// AVX2ç‰ˆ: æ¯æ¬¡å¤„ç†32å­—èŠ‚! (glibc ç°ä»£å®ç°)</span>
<span class="cm">// ARM64: ä½¿ç”¨ LDP (load pair) + CMEQ + UMAXV + CLZ</span>
    </div>
  </div>
</section>

<!-- â•â•â• Â§6-2 æŸ¥æ‰¾å®šé•¿1ä¸² â•â•â• -->
<section id="ffstr">
  <div class="sec-header">
    <span class="sec-num">Â§6-2</span>
    <span class="sec-title">æŸ¥æ‰¾ç»™å®šé•¿åº¦çš„1ä¸² â€” Find First String of 1-Bits of Length â‰¥ n</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// DISK ALLOCATION â€” æ‰¾ç¬¬ä¸€ä¸ªè¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²å—</span>
    è¿™ä¸ªé—®é¢˜æ¥è‡ª<strong>ç£ç›˜å—åˆ†é…å™¨</strong>ï¼šä½å›¾ä¸­æ¯ä¸ª1è¡¨ç¤ºç©ºé—²å—ï¼Œéœ€è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª
    é•¿åº¦ â‰¥ n çš„è¿ç»­1ä¸²ï¼ˆå³è¿ç»­ç©ºé—²åŒºåŸŸï¼‰ï¼Œç”¨äºå­˜å‚¨æ–°æ–‡ä»¶ã€‚
    Warren Â§6-2 çš„ç®—æ³•æ€æƒ³ç²¾å¦™ï¼š
    å…ˆæ¶ˆé™¤æ‰€æœ‰çŸ­äº n çš„1ä¸²ï¼ˆå¾ªç¯ AND ç§»ä½ï¼‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯"è¶³å¤Ÿé•¿"çš„ä¸²ï¼Œ
    å†ç”¨ nlz å®šä½ç¬¬ä¸€ä¸ªã€‚å…³é”®æ˜¯ <code style="color:var(--o)">x &= (x &lt;&lt; 1)</code> æ¯æ¬¡èƒ½å°†æ‰€æœ‰ä¸²é•¿åº¦å‡1ï¼Œ
    ç»è¿‡ n-1 æ¬¡åï¼Œåªå‰©ä¸‹åŸæ¥é•¿åº¦ â‰¥ n çš„ä¸²ï¼ˆå·²ç¼©çŸ­äº†ï¼‰ã€‚
  </div>

  <!-- äº¤äº’å¼æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="ffstrDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.9rem;">
      ğŸ”¬ å®šé•¿1ä¸²æœç´¢æ¼”ç¤º â€” è¾“å…¥å­—å’Œç›®æ ‡é•¿åº¦nï¼Œè§‚å¯Ÿé€æ­¥AND-ç§»ä½è¿‡ç¨‹
    </div>
    <div style="display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;margin-bottom:.85rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">è¾“å…¥å­— (hex)</div>
        <input type="text" x-model="hexIn" @input="parseH()"
               style="width:120px;background:#010409;border:1px solid #1e293b;color:var(--p);font-family:'JetBrains Mono',monospace;font-size:.8rem;padding:.28rem .5rem;border-radius:3px;"
               placeholder="0x...">
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">ç›®æ ‡é•¿åº¦ n</div>
        <input type="number" x-model.number="n" min="1" max="16" @input="compute()"
               style="width:65px;background:#010409;border:1px solid #1e293b;color:var(--o);font-family:'JetBrains Mono',monospace;font-size:.85rem;padding:.28rem .5rem;border-radius:3px;">
      </div>
      <div style="display:flex;gap:.35rem;flex-wrap:wrap;margin-top:1rem;">
        <button @click="setV(0x07C3E01F,3)" class="tab-btn">ç¤ºä¾‹1</button>
        <button @click="setV(0x0F0F0F0F,4)" class="tab-btn">ç¤ºä¾‹2</button>
        <button @click="setV(0xFF00FF00,8)" class="tab-btn">ç¤ºä¾‹3</button>
        <button @click="setV(0xDEADBEEF,3)" class="tab-btn">0xDEADBEEF,n=3</button>
      </div>
    </div>

    <!-- åˆå§‹ä½å›¾ -->
    <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#334155;margin-bottom:.25rem;">
      åˆå§‹ä½å›¾ (bit 31 åœ¨å·¦):
    </div>
    <div class="bit-strip">
      <template x-for="(b,i) in initBits" :key="i">
        <div class="bs" :class="b?'one':'zero'" x-text="b"></div>
      </template>
    </div>

    <!-- é€æ­¥AND-SHL -->
    <template x-for="(step, si) in steps" :key="si">
      <div style="margin-top:.5rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.63rem;color:#334155;margin-bottom:.2rem;"
             x-text="'æ­¥éª¤ '+(si+1)+': x &= (x << 1)  â†’  0x'+(step.val>>>0).toString(16).toUpperCase().padStart(8,'0')+(step.val===0?' (å…¨0,ä¸²è¿‡çŸ­)':'')">
        </div>
        <div class="bit-strip">
          <template x-for="(b,bi) in step.bits" :key="bi">
            <div class="bs" :class="b?'target':'zero'" x-text="b"></div>
          </template>
        </div>
      </div>
    </template>

    <!-- ç»“æœ -->
    <div style="display:flex;gap:.65rem;flex-wrap:wrap;margin-top:.75rem;">
      <div class="stat-box" style="min-width:130px;">
        <div class="stat-val" style="color:var(--p);" x-text="result===32?'æœªæ‰¾åˆ°':result"></div>
        <div class="stat-label">æ‰¾åˆ°ä½ç½®(ä»å·¦,0èµ·)</div>
      </div>
      <div class="stat-box" style="min-width:130px;">
        <div class="stat-val" style="color:var(--o);" x-text="n"></div>
        <div class="stat-label">ç›®æ ‡ä¸²é•¿åº¦ n</div>
      </div>
      <div class="stat-box" style="min-width:130px;">
        <div class="stat-val" style="color:var(--b);font-size:1rem;" x-text="'0x'+(val>>>0).toString(16).toUpperCase().padStart(8,'0')"></div>
        <div class="stat-label">åŸå§‹å€¼</div>
      </div>
    </div>
  </div>

  <div class="grid-2">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.7rem;">
        Â§6-2 ffstr1 å®ç° â€” Warren Figure 6-5
      </div>
      <div class="code-block">
<span class="cm">// æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé•¿åº¦ â‰¥ n çš„1ä¸²</span>
<span class="cm">// è¿”å›æœ€å·¦1ä½çš„ä½ç½®(0~31), æœªæ‰¾åˆ°è¿”å›32</span>
<span class="kw">int</span> <span class="fn">ffstr1</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> n) {
  <span class="kw">int</span> i = <span class="num">1</span>;
  <span class="cm">// æ ¸å¿ƒ: æ¯æ¬¡ x &= (x << 1)</span>
  <span class="cm">// æ•ˆæœ: å°†æ‰€æœ‰ä¸²é•¿åº¦å‡1(çŸ­ä¸²å˜0,é•¿ä¸²ç¼©çŸ­)</span>
  <span class="cm">// é‡å¤ n-1 æ¬¡å, åªå‰©é•¿åº¦ â‰¥ n çš„ä¸²(å·²ç¼©çŸ­)</span>
  <span class="kw">if</span> (n &lt;= <span class="num">1</span>) <span class="kw">goto</span> done;
  x &amp;= x &lt;&lt; <span class="num">1</span>;   <span class="cm">// è¿ç»­2ä¸ª1 â†’ 1</span>
  <span class="kw">if</span> (n &lt;= <span class="num">2</span>) <span class="kw">goto</span> done;

  <span class="cm">// å±•å¼€ä»¥æé«˜æ•ˆç‡(å®é™…ç”¨å¾ªç¯æˆ–äºŒåˆ†)</span>
  x &amp;= x &lt;&lt; <span class="num">2</span>;   <span class="cm">// è¿ç»­4ä¸ª1 â†’ 1 (åˆå¹¶æ­¥éª¤)</span>
  i += <span class="num">2</span>;
  <span class="cm">// ...</span>

done:
  <span class="kw">return</span> <span class="fn">nlz</span>(x); <span class="cm">// 0~31: ç¬¬ä¸€ä¸ªå‰©ä½™1çš„ä½ç½®; 32: æ— </span>
}

<span class="cm">// æ”¹è¿›ç‰ˆ: ç”¨äºŒåˆ†åŠ é€Ÿ (Warren Figure 6-6)</span>
<span class="kw">int</span> <span class="fn">ffstr1_fast</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> n) {
  <span class="kw">int</span> s = <span class="num">1</span>;
  <span class="kw">if</span> (n > <span class="num">16</span>) { x &amp;= x << <span class="num">16</span>; s += <span class="num">16</span>; n -= <span class="num">16</span>; }
  <span class="kw">if</span> (n >  <span class="num">8</span>) { x &amp;= x <<  <span class="num">8</span>; s +=  <span class="num">8</span>; n -=  <span class="num">8</span>; }
  <span class="kw">if</span> (n >  <span class="num">4</span>) { x &amp;= x <<  <span class="num">4</span>; s +=  <span class="num">4</span>; n -=  <span class="num">4</span>; }
  <span class="kw">if</span> (n >  <span class="num">2</span>) { x &amp;= x <<  <span class="num">2</span>; s +=  <span class="num">2</span>; n -=  <span class="num">2</span>; }
  <span class="kw">if</span> (n >  <span class="num">1</span>) { x &amp;= x <<  <span class="num">1</span>; }
  <span class="kw">return</span> <span class="fn">nlz</span>(x);
}
<span class="cm">// åªéœ€ 5 æ­¥(log2 32), æ¯æ­¥ 2 æ¡æŒ‡ä»¤: ~12æ¡æ€»è®¡</span>
      </div>
    </div>

    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">
        x &amp;= (x &lt;&lt; 1) çš„ä½œç”¨ç¤ºä¾‹
      </div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;line-height:2;color:#94a3b8;">
        <div style="color:#334155;margin-bottom:.3rem;">// è¾“å…¥: x = 0b 0111 0011 1110 0111</div>
        <div><span style="color:var(--b);">åˆå§‹   </span>: 0111 0011 1110 0111  (ä¸²: 3,4,3 é•¿)</div>
        <div><span style="color:var(--g);">1æ¬¡AND </span>: 0110 0011 1100 0110  (ä¸²: 2,3,2)</div>
        <div><span style="color:var(--p);">2æ¬¡AND </span>: 0100 0011 1000 0100  (ä¸²: 1,2,1)</div>
        <div><span style="color:var(--o);">3æ¬¡AND </span>: 0000 0011 0000 0000  (ä¸²: 1)    â† é•¿åº¦â‰¥4çš„ä¸²</div>
        <div><span style="color:var(--r);">4æ¬¡AND </span>: 0000 0010 0000 0000  (ä¸²: 0,æ¶ˆå¤±)</div>
        <div style="margin-top:.4rem;color:#334155;">
          ç»“è®º: 3æ¬¡ååªæœ‰åŸé•¿åº¦â‰¥4çš„ä¸²å­˜æ´»,<br>nlz(result) ç»™å‡ºæœ€å·¦ä½ç½®
        </div>
        <div style="margin-top:.5rem;padding:.4rem .6rem;background:#010409;border:1px solid #1e293b;border-radius:.3rem;font-size:.68rem;color:#64748b;">
          âš¡ æ ¸å¿ƒæ´å¯Ÿ: AND+å·¦ç§» = "æ£€æŸ¥ç›¸é‚»ä¸¤ä½éƒ½æ˜¯1"<br>
          é‡å¤n-1æ¬¡ = "æ£€æŸ¥è¿ç»­nä½éƒ½æ˜¯1"<br>
          è¿™æ˜¯ä¸²è¡Œæ‰«æçš„ä½å¹¶è¡ŒåŠ é€Ÿç‰ˆæœ¬
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§6-3 æœ€é•¿1ä¸² â•â•â• -->
<section id="maxstr">
  <div class="sec-header">
    <span class="sec-num">Â§6-3</span>
    <span class="sec-title">æŸ¥æ‰¾æœ€é•¿1ä¸² â€” Find Longest String of 1-Bits</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// HSIEH'S ALGORITHM â€” è¿­ä»£æ¶ˆé™¤æœ€çŸ­å°¾éƒ¨ï¼Œè®¡æ•°æ­¥æ•°</span>
    æŸ¥æ‰¾æœ€é•¿1ä¸²é—®é¢˜ç”± Paul Hsiehï¼ˆ2005å¹´å‘å¸ƒäº comp.lang.cï¼‰ç»™å‡ºäº†ä¼˜é›…çš„è§£æ³•ï¼š
    é‡å¤æ‰§è¡Œ <code style="color:var(--o)">x &amp;= (x &lt;&lt; 1)</code>ï¼Œç›´åˆ° x å˜ä¸º 0ã€‚
    æ‰§è¡Œçš„æ¬¡æ•°æ°å¥½ç­‰äºæœ€é•¿1ä¸²çš„é•¿åº¦ï¼
    åŸå› ï¼šæ¯æ¬¡æ“ä½œå°†æ‰€æœ‰ä¸²é•¿åº¦å‡1ï¼Œå½“æœ€é•¿ä¸²ä¹Ÿå˜ä¸º0æ—¶ï¼Œæ“ä½œæ¬¡æ•° = æœ€é•¿ä¸²é•¿åº¦ã€‚
    ä½ç½®å¯é€šè¿‡è®°å½•ä¸Šä¸€æ¬¡éé›¶å€¼ <code style="color:var(--o)">oldx</code>ï¼Œç”¨ nlz å®šä½ã€‚
    è¿™æ˜¯ä¸€ç§"é€šè¿‡é€€å‡ºæ¡ä»¶åå‘æ¨æ–­ç­”æ¡ˆ"çš„å·§å¦™ç­–ç•¥ï¼Œå¾ªç¯æ¬¡æ•°ä¸è¶…è¿‡32æ¬¡ã€‚
  </div>

  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card" x-data="maxstrDemo()">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.85rem;">
        ğŸ”¬ æœ€é•¿1ä¸² â€” Hsieh ç®—æ³•åŠ¨æ€æ¼”ç¤º
      </div>
      <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin-bottom:.75rem;">
        <div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#475569;margin-bottom:.2rem;">è¾“å…¥ (hex)</div>
          <input type="text" x-model="hexIn" @input="parseH()"
                 style="width:120px;background:#010409;border:1px solid #1e293b;color:var(--o);font-family:'JetBrains Mono',monospace;font-size:.8rem;padding:.28rem .5rem;border-radius:3px;">
        </div>
        <div style="display:flex;gap:.3rem;margin-top:1rem;flex-wrap:wrap;">
          <button @click="setV(0x07C0007F)" class="tab-btn">ç¤ºä¾‹1</button>
          <button @click="setV(0xDEADBEEF)" class="tab-btn">0xDEADBEEF</button>
          <button @click="setV(0xFFFF0000)" class="tab-btn">0xFFFF0000</button>
        </div>
      </div>
      
      <!-- ä½å›¾ -->
      <div class="bit-strip">
        <template x-for="(b,i) in initBits" :key="i">
          <div class="bs" :class="b?'one':'zero'" x-text="b"></div>
        </template>
      </div>

      <!-- é€æ­¥æ¼”ç¤º -->
      <template x-for="(step,si) in steps" :key="si">
        <div style="margin-top:.45rem;">
          <div style="font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#334155;margin-bottom:.18rem;"
               x-text="'x &= (x<<1)  step '+(si+1)+': 0x'+(step.val>>>0).toString(16).toUpperCase().padStart(8,'0')+(step.val===0?' â† å…¨0ï¼Œåœï¼':'')">
          </div>
          <div class="bit-strip">
            <template x-for="(b,bi) in step.bits" :key="bi">
              <div class="bs"
                   :class="step.val===0?'zero':(b?'found-run':'zero')"
                   x-text="b"></div>
            </template>
          </div>
        </div>
      </template>

      <div style="display:flex;gap:.65rem;flex-wrap:wrap;margin-top:.75rem;">
        <div class="stat-box" style="min-width:120px;">
          <div class="stat-val" style="color:var(--o);" x-text="maxLen"></div>
          <div class="stat-label">æœ€é•¿1ä¸²é•¿åº¦</div>
        </div>
        <div class="stat-box" style="min-width:120px;">
          <div class="stat-val" style="color:var(--g);" x-text="maxPos===32?'â€”':maxPos"></div>
          <div class="stat-label">èµ·å§‹ä½ç½®(ä»å·¦)</div>
        </div>
        <div class="stat-box" style="min-width:120px;">
          <div class="stat-val" style="color:var(--b);" x-text="steps.length+1"></div>
          <div class="stat-label">è¿­ä»£æ€»æ­¥æ•°</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.7rem;">
        Â§6-3 fmaxstr â€” æœ€é•¿1ä¸²ç®—æ³• (Warren Figure 6-7 / Hsieh 2005)
      </div>
      <div class="code-block">
<span class="cm">// Â§6-3 Warren Figure 6-7: æŸ¥æ‰¾æœ€é•¿1ä¸²</span>
<span class="cm">// Hsiehç®—æ³• [comp.lang.c, April 29, 2005]</span>
<span class="cm">// åŸç†: é‡å¤ x &= (x << 1) ä½¿æ‰€æœ‰ä¸²é•¿åº¦-1</span>
<span class="cm">// å¾ªç¯æ¬¡æ•°æ°å¥½ = æœ€é•¿ä¸²é•¿åº¦</span>
<span class="kw">int</span> <span class="fn">fmaxstr</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">int</span> k = <span class="num">0</span>;
  <span class="kw">while</span> (x != <span class="num">0</span>) {
    x &amp;= x &lt;&lt; <span class="num">1</span>;  <span class="cm">// æ¯æ¬¡å°†æ‰€æœ‰ä¸²é•¿åº¦å‡1</span>
    k++;             <span class="cm">// è®¡æ•°: åšäº†å¤šå°‘æ¬¡</span>
  }
  <span class="kw">return</span> k;  <span class="cm">// k = æœ€é•¿ä¸²é•¿åº¦, x=0æœ€å32æ¬¡</span>
}
<span class="cm">// å˜ä½“: åŒæ—¶è®°å½•ä½ç½® (Warren ä¹ é¢˜1ç­”æ¡ˆ)</span>
<span class="cm">// by Norbert Juffa (cited in Warren answers)</span>
<span class="kw">int</span> <span class="fn">fmaxstr1</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> *apos) {
  <span class="kw">int</span> k;
  <span class="kw">unsigned</span> oldx;
  oldx = <span class="num">0</span>;
  <span class="kw">for</span> (k = <span class="num">0</span>; x != <span class="num">0</span>; k++) {
    oldx = x;
    x &amp;= <span class="num">2</span> * x; <span class="cm">// ç­‰ä»·äº x &= (x << 1)</span>
  }
  *apos = <span class="fn">nlz</span>(oldx); <span class="cm">// oldx ä¸ºæœ€åä¸€æ¬¡éé›¶å€¼</span>
  <span class="kw">return</span> k;           <span class="cm">// èµ·å§‹ä½ = nlz(oldx)</span>
}
<span class="cm">// ä¸ºä»€ä¹ˆ oldx çš„æœ€é«˜1ä½æ˜¯èµ·å§‹ä½?</span>
<span class="cm">// å› ä¸ºæœ€é•¿ä¸²æ¯è½®ç¼©çŸ­1ä½(å·¦ç«¯è¢«æ¶ˆæ‰1ä½)</span>
<span class="cm">// æœ€åéé›¶æ—¶, æœ€é«˜ä½æ°å¥½æ˜¯åŸä¸²çš„èµ·å§‹ä½</span>

<span class="cm">// æ€§èƒ½åˆ†æ:</span>
<span class="cm">// æœ€å¥½ O(1): åªæœ‰å•ä¸ª1, ç¬¬1æ¬¡å°±å˜0</span>
<span class="cm">// æœ€å O(32): å…¨éƒ¨ä¸º1 (0xFFFFFFFF), 32æ¬¡</span>
<span class="cm">// å¹³å‡: å¯¹éšæœºè¾“å…¥çº¦ log2(n) æ¬¡</span>
<span class="cm">// æ¯æ¬¡å¾ªç¯: 2æ¡æŒ‡ä»¤(ä¹˜+AND æˆ– SHL+AND)</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§6-4 æŸ¥æ‰¾æœ€çŸ­1ä¸² â•â•â• -->
<section id="minstr">
  <div class="sec-header">
    <span class="sec-num">Â§6-4</span>
    <span class="sec-title">æŸ¥æ‰¾æœ€çŸ­1ä¸² â€” Find Shortest String of 1-Bits</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// FMINSTR â€” AND-SHIFT ELIMINATION APPROACH</span>
    æŸ¥æ‰¾æœ€çŸ­1ä¸²é—®é¢˜æ˜¯ Â§6-2 é—®é¢˜çš„é€†é—®é¢˜ï¼šæ‰¾åˆ°é•¿åº¦æœ€å°ï¼ˆä½† â‰¥ 1ï¼‰çš„è¿ç»­1ä¸²ã€‚
    Warren Â§6-4 çš„æ–¹æ³•åŒæ ·åˆ©ç”¨ AND-ç§»ä½æ¶ˆé™¤æ³•ï¼Œä½†æ–¹å‘ç›¸åã€‚
    æ ¸å¿ƒæ€è·¯ï¼šä» n=1 å¼€å§‹ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨é•¿åº¦æ°å¥½ä¸º n çš„1ä¸²ï¼›
    è‹¥å­˜åœ¨åˆ™è¿”å›ï¼Œå¦åˆ™ n++ã€‚
    æ£€æµ‹é•¿åº¦æ°å¥½ä¸º n çš„ä¸²çš„æ–¹æ³•ï¼šå…ˆæ‰¾åˆ°æ‰€æœ‰é•¿åº¦ â‰¥ n çš„ä¸²ï¼ˆç”¨ ffstr1 çš„æ–¹æ³•ï¼‰ï¼Œ
    å†å»æ‰æ‰€æœ‰é•¿åº¦ â‰¥ n+1 çš„ä¸²ï¼ˆå³ä¸¤è€…å–å·®ï¼‰ã€‚
    ç­‰ä»·äºï¼š<code style="color:var(--o)">ffstr(x, n) XOR ffstr(x, n+1)</code> æœ‰å·®å¼‚æ—¶ï¼Œn å°±æ˜¯æœ€çŸ­ä¸²é•¿åº¦ã€‚
    æ›´ä¼˜é›…çš„è¿­ä»£å®ç°ï¼šå¾ªç¯ <code style="color:var(--o)">x &amp;= (x &lt;&lt; 1)</code>ï¼Œæ¯æ¬¡éƒ½èƒ½æ·˜æ±°æœ€çŸ­çš„ä¸²ï¼Œè®°å½•æ­¥æ•°ã€‚
  </div>

  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card" x-data="minstrDemo()">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--r);margin-bottom:.8rem;">
        ğŸ”¬ æœ€çŸ­1ä¸²æœç´¢ â€” fminstr1 æ¼”ç¤º
      </div>
      <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin-bottom:.7rem;">
        <div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#475569;margin-bottom:.2rem;">è¾“å…¥ (hex)</div>
          <input type="text" x-model="hexIn" @input="parseH()"
                 style="width:120px;background:#010409;border:1px solid #1e293b;color:var(--r);font-family:'JetBrains Mono',monospace;font-size:.8rem;padding:.28rem .5rem;border-radius:3px;">
        </div>
        <div style="display:flex;gap:.3rem;margin-top:1rem;flex-wrap:wrap;">
          <button @click="setV(0xAAAAAAAA)" class="tab-btn">0xAAAAAAAA</button>
          <button @click="setV(0x55555555)" class="tab-btn">0x55555555</button>
          <button @click="setV(0x07C0003F)" class="tab-btn">ç¤ºä¾‹1</button>
          <button @click="setV(0xDEADBEEF)" class="tab-btn">0xDEADBEEF</button>
        </div>
      </div>

      <!-- åˆå§‹ä½å›¾ -->
      <div style="font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#334155;margin-bottom:.2rem;">
        åˆå§‹ä½å›¾ (å„1ä¸²æ ‡æ³¨):
      </div>
      <div class="bit-strip">
        <template x-for="(b,i) in initBits" :key="i">
          <div class="bs" :class="b?'one':'zero'" x-text="b"></div>
        </template>
      </div>

      <!-- åˆ†æå„ä¸ª1ä¸² -->
      <div style="margin-top:.6rem;font-family:'JetBrains Mono',monospace;font-size:.63rem;color:#334155;margin-bottom:.25rem;">
        æ£€æµ‹åˆ°çš„æ‰€æœ‰1ä¸² (ä½ç½®,é•¿åº¦):
      </div>
      <div style="display:flex;gap:.35rem;flex-wrap:wrap;margin-bottom:.5rem;">
        <template x-for="(run,ri) in runs" :key="ri">
          <div :style="{
                 padding:'.18rem .45rem',
                 borderRadius:'3px',
                 fontFamily:'JetBrains Mono,monospace',
                 fontSize:'.62rem',
                 background: run.len===minLen?'rgba(255,68,102,.18)':'rgba(0,212,255,.1)',
                 color: run.len===minLen?'var(--r)':'var(--b)',
                 border: '1px solid '+(run.len===minLen?'rgba(255,68,102,.4)':'rgba(0,212,255,.25)')
               }"
               x-text="'pos='+run.pos+' len='+run.len+(run.len===minLen?' â†MIN':'')">
          </div>
        </template>
        <div x-show="runs.length===0" style="font-size:.68rem;color:#334155;">æ— 1ä¸²</div>
      </div>

      <div style="display:flex;gap:.65rem;flex-wrap:wrap;">
        <div class="stat-box" style="min-width:110px;">
          <div class="stat-val" style="color:var(--r);" x-text="minLen===33?'æ— ':minLen"></div>
          <div class="stat-label">æœ€çŸ­1ä¸²é•¿åº¦</div>
        </div>
        <div class="stat-box" style="min-width:110px;">
          <div class="stat-val" style="color:var(--o);" x-text="minPos===32?'â€”':minPos"></div>
          <div class="stat-label">é¦–ä¸ªæœ€çŸ­ä¸²ä½ç½®</div>
        </div>
        <div class="stat-box" style="min-width:110px;">
          <div class="stat-val" style="color:var(--p);" x-text="runs.length"></div>
          <div class="stat-label">1ä¸²æ€»æ•°</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--r);margin-bottom:.7rem;">
        Â§6-4 fminstr â€” ä¸¤ç§å®ç°
      </div>
      <div class="code-block">
<span class="cm">// Â§6-4 Warren Figure 6-8: fminstr1 â€” æŸ¥æ‰¾æœ€çŸ­1ä¸²</span>
<span class="cm">// æ–¹æ³•: é€æ­¥å¢åŠ  n, æ£€æŸ¥æ˜¯å¦æœ‰é•¿åº¦ â‰¥ n çš„ä¸²</span>
<span class="cm">// ç­‰ä»·äºæ£€æŸ¥ x &= (x<<1) åæ˜¯å¦æ¶ˆç­äº†æŸä¸ªä¸²</span>

<span class="kw">int</span> <span class="fn">fminstr1</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">unsigned</span> y;
  <span class="kw">int</span> k = <span class="num">1</span>;
  <span class="kw">if</span> (x == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;
  <span class="kw">while</span> (<span class="num">1</span>) {
    y = x &amp; (x &lt;&lt; <span class="num">1</span>); <span class="cm">// æ‰¾é•¿åº¦ â‰¥ 2 çš„ä¸²</span>
    <span class="kw">if</span> (y == <span class="num">0</span>) <span class="kw">return</span> k; <span class="cm">// æ— é•¿åº¦â‰¥2ä¸² â†’ æœ€çŸ­=k</span>
    k++;
    x = y;             <span class="cm">// ç»§ç»­ç¼©çŸ­ï¼Œæ£€æŸ¥ k+1</span>
  }
}
<span class="cm">// å…³é”®æ´å¯Ÿ:</span>
<span class="cm">// x & (x<<1): ä¿ç•™åŸä¸²ä¸­"ä¸¤ç«¯éƒ½æ˜¯1"çš„ä½</span>
<span class="cm">// å³æ¯ä¸ªä¸²ä»å³ç«¯è¢«æˆªæ‰1ä½</span>
<span class="cm">// åŸé•¿åº¦=1çš„ä¸²æ¶ˆå¤±; åŸé•¿åº¦=2çš„ä¸²å˜å•ä½</span>
<span class="cm">// å½“ y==0 æ—¶ï¼ŒåŸ x çš„æ‰€æœ‰ä¸²é•¿åº¦éƒ½ â‰¤ k</span>
<span class="cm">// ç”±äºå¾ªç¯æ˜¯ä»1å¼€å§‹çš„, é€€å‡ºæ—¶ k å³æœ€çŸ­ä¸²é•¿</span>

<span class="cm">// æ–¹æ³•2: åˆ©ç”¨ pop(x) å˜åŒ–æ¥æ£€æµ‹ (Warren ä¹ é¢˜3)</span>
<span class="cm">// æ¯æ¬¡å…³é—­xä¸­æœ€å³è¾¹çš„1ä¸², è§‚å¯Ÿ pop å‡å°‘é‡</span>
<span class="kw">int</span> <span class="fn">fminstr_pop</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">int</span> p0 = <span class="fn">pop</span>(x), p1, minlen = <span class="num">32</span>;
  <span class="kw">while</span> (x != <span class="num">0</span>) {
    <span class="cm">// å…³é—­æœ€å³è¾¹çš„1ä¸²: x &= x+lowbit(~x)</span>
    <span class="kw">unsigned</span> t = x | (x - <span class="num">1</span>); <span class="cm">// å¡«å……æœ€å³0ä¸²</span>
    x = x &amp; (t + <span class="num">1</span>);          <span class="cm">// æ¸…é™¤æœ€å³1ä¸²</span>
    p1 = <span class="fn">pop</span>(x);
    <span class="kw">int</span> runlen = p0 - p1;      <span class="cm">// è¯¥ä¸²çš„é•¿åº¦</span>
    <span class="kw">if</span> (runlen &lt; minlen) minlen = runlen;
    p0 = p1;
  }
  <span class="kw">return</span> minlen;
}
<span class="cm">// å¯¹éšæœºè¾“å…¥å¹³å‡~10.7æ¬¡å¾ªç¯(çº¦1/3çš„32ä½å­—</span>
<span class="cm">// æœ€çŸ­ä¸²ä¸º1; ~1%çš„å­—æœ€çŸ­ä¸²ä¸º2)</span>
      </div>
    </div>
  </div>

  <!-- æ¯”è¾ƒè¡¨ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">
      Â§6 å››å¤§æœç´¢å‡½æ•°å®Œæ•´å¯¹æ¯”è¡¨
    </div>
    <div style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;font-size:.72rem;">
        <thead>
          <tr style="border-bottom:1px solid #1e293b;">
            <th style="text-align:left;padding:.4rem .7rem;color:#475569;">å‡½æ•°</th>
            <th style="text-align:left;padding:.4rem .7rem;color:var(--b);">é—®é¢˜æè¿°</th>
            <th style="text-align:left;padding:.4rem .7rem;color:var(--g);">æ ¸å¿ƒæ“ä½œ</th>
            <th style="text-align:left;padding:.4rem .7rem;color:var(--o);">æœ€åæŒ‡ä»¤æ•°</th>
            <th style="text-align:left;padding:.4rem .7rem;color:var(--p);">ä¸»è¦åº”ç”¨</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="(row,i) in compTable" :key="i">
            <tr :style="{borderBottom:'1px solid #0f172a', background:i%2===0?'transparent':'rgba(0,212,255,.015)'}">
              <td style="padding:.35rem .7rem;" :style="{color:row.color,fontWeight:600}" x-text="row.fn"></td>
              <td style="padding:.35rem .7rem;color:#94a3b8;" x-text="row.desc"></td>
              <td style="padding:.35rem .7rem;color:#64748b;font-size:.66rem;" x-text="row.op"></td>
              <td style="padding:.35rem .7rem;" :style="{color:row.color}" x-text="row.instr"></td>
              <td style="padding:.35rem .7rem;color:#64748b;font-size:.66rem;" x-text="row.app"></td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- â•â•â• å®é™…åº”ç”¨åœºæ™¯ â•â•â• -->
<section id="apps">
  <div class="sec-header">
    <span class="sec-num">Â§APPS</span>
    <span class="sec-title">å®é™…åº”ç”¨åœºæ™¯ â€” Real-World Applications</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// FROM DISK ALLOCATORS TO DNA SEQUENCE SEARCH</span>
    ç¬¬6ç« çš„å››ä¸ªåŸè¯­çœ‹ä¼¼å­¦æœ¯ï¼Œå®åˆ™éå¸ƒç³»ç»Ÿè½¯ä»¶çš„æ¯ä¸ªè§’è½ã€‚
    <strong>strlen</strong> æ˜¯ C è¿è¡Œæ—¶ä¸­è°ƒç”¨æœ€é¢‘ç¹çš„å‡½æ•°ä¹‹ä¸€ï¼Œå…¶ SWAR å®ç°æ¯å¹´èŠ‚çœæ•°äº¿ CPU å‘¨æœŸã€‚
    <strong>ç£ç›˜å—åˆ†é…</strong>ï¼ˆext4/btrfsçš„ bitmap allocatorï¼‰ç”¨ ffstr1 æ‰¾è¿ç»­ç©ºé—²å—ã€‚
    <strong>DNAåºåˆ—æœç´¢</strong>ï¼ˆSIMD BNDMç®—æ³•ï¼‰ç”¨ä½å¹¶è¡Œçš„1ä¸²æœç´¢ä»£æ›¿é€å­—èŠ‚æ¯”è¾ƒã€‚
    è¿™äº›åº”ç”¨å…±åŒéªŒè¯äº†ï¼š**ä½çº§å¹¶è¡Œ**æ˜¯åœ¨ SIMD ç¡¬ä»¶æ™®åŠä¹‹å‰ï¼Œ
    æœ€æ¥è¿‘"å…è´¹åˆé¤"çš„æ€§èƒ½åŠ é€Ÿæ‰‹æ®µã€‚
  </div>

  <div class="grid-3" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--b);margin-bottom:.55rem;">ğŸ–¥ï¸ strlen / memchr</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        glibcã€muslã€Apple libc çš„ strlen å…¨éƒ¨åŸºäº Â§6-1 çš„ SWAR 0å­—èŠ‚æ£€æµ‹ã€‚
        64ä½æœºæ¯æ¬¡å¤„ç†8å­—èŠ‚ï¼Œæ¯”é€å­—èŠ‚å¿«8å€ã€‚
        AVX2 ç‰ˆæœ¬æ›´å¯æ¯æ¬¡å¤„ç†32å­—èŠ‚ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// glibc çš„æ ¸å¿ƒåˆ¤æ–­</span>
<span class="kw">unsigned long</span> has_zero =
  (w - <span class="num">0x0101010101010101ULL</span>)
  &amp; ~w
  &amp; <span class="num">0x8080808080808080ULL</span>;
      </div>
    </div>

    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--g);margin-bottom:.55rem;">ğŸ’¾ ç£ç›˜å—åˆ†é…å™¨</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        Linux ext4 çš„å—åˆ†é…å™¨ç”¨ä½å›¾ç®¡ç†ç©ºé—²å—ï¼Œ
        ç”¨ ffstr1(bitmap_word, n) æ‰¾ç¬¬ä¸€ä¸ªè¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—²åŒºã€‚
        åˆ†é… n ä¸ªè¿ç»­å— â†’ ä½å›¾ä¸­æ‰¾é•¿åº¦ â‰¥ n çš„1ä¸²ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// ext4 å—ç»„ä½å›¾åˆ†é…</span>
<span class="cm">// 1 = ç©ºé—², 0 = å·²ç”¨</span>
<span class="kw">int</span> pos = <span class="fn">ffstr1</span>(bitmap, n_blocks);
<span class="kw">if</span> (pos &lt; <span class="num">32</span>) allocate(pos, n_blocks);
      </div>
    </div>

    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--p);margin-bottom:.55rem;">ğŸ§¬ DNAåºåˆ—åŒ¹é…</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        BNDMï¼ˆBackward Nondeterministic Dawg Matchingï¼‰ç®—æ³•
        ç”¨ä½å¹¶è¡Œæœç´¢æ¨¡å¼ä¸²ã€‚å°† DNA ç¢±åŸºç¼–ç ä¸ºä½å‘é‡ï¼Œ
        ç”¨ AND æ“ä½œåŒæ—¶åŒ¹é…å¤šä¸ªä½ç½®ï¼Œæœ¬è´¨æ˜¯ Â§6-2 çš„æ³›åŒ–ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// ä½å¹¶è¡Œ DNA æ¨¡å¼åŒ¹é…</span>
<span class="cm">// A=00 T=01 G=10 C=11</span>
<span class="cm">// 4å­—èŠ‚ = 16ä¸ªç¢±åŸº</span>
D = D &amp; B[text[pos]]; <span class="cm">// AND æ›´æ–°</span>
<span class="kw">if</span> (D &amp; accept) found();
      </div>
    </div>

    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--o);margin-bottom:.55rem;">ğŸ–¼ï¸ RLEå›¾åƒå‹ç¼©</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        è¡Œç¨‹ç¼–ç ï¼ˆRLEï¼‰éœ€è¦æ‰¾å›¾åƒæ‰«æçº¿ä¸­æœ€é•¿çš„è¿ç»­ç›¸åŒåƒç´ ä¸²ã€‚
        äºŒå€¼å›¾åƒï¼ˆä¼ çœŸã€æ–‡æ¡£æ‰«æï¼‰çš„ RLE å°±æ˜¯ fmaxstr çš„ç›´æ¥åº”ç”¨ï¼š
        æ‰¾æœ€é•¿0ä¸²å’Œ1ä¸²äº¤æ›¿ç¼–ç ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// äºŒå€¼ RLE ç¼–ç æ ¸å¿ƒ</span>
<span class="kw">while</span> (x) {
  <span class="kw">int</span> zeros = <span class="fn">ntz</span>(x);   <span class="cm">// 0ä¸²é•¿</span>
  x &gt;&gt;= zeros;
  <span class="kw">int</span> ones = <span class="fn">ntz</span>(~x);  <span class="cm">// 1ä¸²é•¿</span>
  emit(zeros, ones); x &gt;&gt;= ones;
}
      </div>
    </div>

    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--r);margin-bottom:.55rem;">ğŸ” å“ˆå¸Œè¡¨æ¢æµ‹</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        Swiss Tableï¼ˆC++ absl::flat_hash_mapï¼‰ç”¨ SWAR æŠ€æœ¯
        åŒæ—¶æ£€æµ‹16ä¸ªæ§½ä½çš„å…ƒæ•°æ®å­—èŠ‚ï¼Œåˆ¤æ–­æ˜¯å¦åŒ¹é…ç›®æ ‡ key çš„æŒ‡çº¹ã€‚
        æœ¬è´¨æ˜¯ Â§6-1 çš„"æŸ¥æ‰¾ç‰¹å®šå­—èŠ‚å€¼"å˜ä½“ï¼Œæ¯æ¬¡æ¯”è¾ƒ16ä¸ªæ§½ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// Swiss Table SWAR å…ƒæ•°æ®åŒ¹é…</span>
<span class="kw">uint64_t</span> <span class="fn">Match</span>(h2_t hash) {
  <span class="kw">auto</span> x = _mm_set1_epi8(hash);
  <span class="kw">return</span> _mm_movemask_epi8(
    _mm_cmpeq_epi8(x, ctrl_));
}
      </div>
    </div>

    <div class="card">
      <div style="font-size:.85rem;font-weight:700;color:var(--b);margin-bottom:.55rem;">ğŸ“¡ ç½‘ç»œåè®®è§£æ</div>
      <div style="font-size:.79rem;color:#64748b;line-height:1.72;margin-bottom:.55rem;">
        HTTP/2ã€TLS çš„å¤´éƒ¨è§£æéœ€è¦å¿«é€Ÿå®šä½åˆ†éš”ç¬¦ï¼ˆå†’å·ã€CRLFç­‰ï¼‰ã€‚
        HPACK æ•´æ•°ç¼–ç ç”¨æœ€é•¿å‰ç¼€ä¸º1çš„ä¸²æ¥è¡¨ç¤ºæ•´æ•°å¤§å°ã€‚
        zbytel çš„å­—èŠ‚èŒƒå›´æœç´¢å˜ä½“æ˜¯è§£æå™¨çš„æ€§èƒ½å…³é”®è·¯å¾„ã€‚
      </div>
      <div class="code-block" style="font-size:.66rem;padding:.6rem .8rem;">
<span class="cm">// HTTP/2 å¿«é€Ÿå®šä½å†’å· 0x3A</span>
<span class="kw">int</span> pos = <span class="fn">find_byte_in_range</span>(
  w, <span class="num">0x3A</span>, <span class="num">0x3A</span>);
<span class="cm">// = Â§6-1 range-search çš„ç‰¹åŒ–</span>
      </div>
    </div>
  </div>

  <!-- ECharts: å„ç®—æ³•åº”ç”¨é¢‘ç‡å›¾ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.5rem;">
      ğŸ“Š ç¬¬6ç« å„åŸè¯­åœ¨ä¸»æµå¼€æºé¡¹ç›®ä¸­çš„ä½¿ç”¨é¢‘ç‡åˆ†å¸ƒ
    </div>
    <div id="chart-apps" style="width:100%;height:220px;"></div>
  </div>
</section>

<!-- â•â•â• æ·±åº¦ç‚¹è¯„ â•â•â• -->
<section id="critique">
  <div class="sec-header">
    <span class="sec-num">Â§CRIT</span>
    <span class="sec-title">æ·±åº¦ç‚¹è¯„ â€” ç¬¬6ç« çš„ç²¾åä¸å·¥ç¨‹å¯ç¤º</span>
    <div class="sec-divider"></div>
  </div>

  <div class="critic-box" style="margin-bottom:1.2rem;">
    <h3>ç¬¬6ç« ï¼šSWARå“²å­¦â€”â€”ä¸€ä¸ªå¯„å­˜å™¨å½“å››ä¸ªå¤„ç†å™¨ç”¨</h3>

    <div class="critic-item">
      <div class="ci-title">âœ¦ SWARï¼šæ¯” SIMD æ—©20å¹´çš„å¹¶è¡Œæ€ç»´</div>
      <p>
        "SIMD Within A Register"ï¼ˆSWARï¼‰è¿™ä¸ªè¯åœ¨ 1998 å¹´æ‰è¢« Fisher å’Œ Dietz æ­£å¼å‘½åï¼Œ
        ä½† Â§6-1 çš„ 0å­—èŠ‚æ£€æµ‹ç®—æ³•æ—©åœ¨ 1987 å¹´å°±è¢« Alan Mycroft å‘ç°å¹¶åº”ç”¨äº strlenã€‚
        è¿™å‘Šè¯‰æˆ‘ä»¬ï¼šçœŸæ­£çš„å¥½æ€æƒ³å¾€å¾€è¶…å‰äºå®ƒçš„å‘½åã€‚
        åœ¨æ²¡æœ‰ MMX/SSE çš„å¹´ä»£ï¼Œç¨‹åºå‘˜ç”¨çº¯æ•´æ•°ç®—æœ¯åšåˆ°äº†"ä¸€æ¬¡æ“ä½œå››ä¸ªå­—èŠ‚"ï¼Œ
        è¿™ç§ç²¾ç¥ä¸ SIMDã€GPUã€TPU çš„å‘é‡è®¡ç®—æ˜¯åŒæºçš„â€”â€”
        åªæ˜¯å·¥å…·ä¸åŒï¼Œæ´å¯Ÿç›¸åŒï¼š<strong style="color:var(--b)">æ•°æ®ä¸­çš„å¹¶è¡Œæ€§å€¼å¾—è¢«å……åˆ†åˆ©ç”¨</strong>ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">âœ¦ fmaxstr çš„"åå‘è®¡æ•°"å“²å­¦â€”â€”ç”¨é€€å‡ºæ¡ä»¶åæ¨ç­”æ¡ˆ</div>
      <p>
        Hsieh çš„æœ€é•¿1ä¸²ç®—æ³•æ˜¯ä¸€ç§ç½•è§çš„ç®—æ³•è®¾è®¡èŒƒå¼ï¼š
        ä¸ç›´æ¥è®¡ç®—"ç­”æ¡ˆæ˜¯å¤šå°‘"ï¼Œè€Œæ˜¯é€šè¿‡"è¿­ä»£åˆ°æŸä¸ªç»ˆæ­¢çŠ¶æ€ï¼Œ
        ç”¨è¿­ä»£æ¬¡æ•°åæ¨ç­”æ¡ˆ"ã€‚è¿™ä¸ Floyd çš„ç¯æ£€æµ‹ã€
        Gosper çš„å¾ªç¯é•¿åº¦ç®—æ³•ï¼ˆÂ§5-4ï¼‰æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚
        å½“ç›´æ¥è®¡ç®—å¾ˆå›°éš¾æ—¶ï¼Œ<strong style="color:var(--b)">é€šè¿‡æ„é€ ä¸€ä¸ª"è‡ªæ¯"è¿‡ç¨‹æ¥é—´æ¥é‡åŒ–ç›®æ ‡</strong>ï¼Œ
        æ˜¯ç®—æ³•è®¾è®¡ä¸­çš„æ·±åˆ»æŠ€å·§ã€‚è¿™ç±»æ€ç»´åœ¨æ‘Šè¿˜åˆ†æã€åŠ¿èƒ½å‡½æ•°æ–¹æ³•ä¸­ä¹Ÿæœ‰ä½“ç°ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">âœ¦ (x - 0x01010101) &amp; ~x &amp; 0x80808080 â€” æœ€ä¼˜é›…çš„ä½è¿ç®—å…¬å¼ä¹‹ä¸€</div>
      <p>
        è¿™ä¸ªä¸‰è¿ç®—ç¬¦çš„ 0å­—èŠ‚æ£€æµ‹å…¬å¼å ªç§°ä½è¿ç®—å²ä¸Šçš„ç»å…¸ã€‚
        å®ƒçš„æ­£ç¡®æ€§å»ºç«‹åœ¨å¯¹ <code>b=0x80</code> çš„ç²¾ç¡®åˆ†æä¸Šï¼š
        å½“ b=0x80 æ—¶ï¼Œ(b-1)=0x7Fï¼Œbit7=0ï¼Œå› æ­¤ä¸ä¼šè¢«è¯¯åˆ¤ã€‚
        è¿™ä¸€"è¾¹ç•Œæ¡ˆä¾‹æ°å¥½æ­£ç¡®"çš„å·§å¦™æ€§è®©æ¯ä¸€ä¸ªç†è§£å®ƒçš„ç¨‹åºå‘˜éƒ½å‘å‡º"å•Šå“ˆï¼"çš„æƒŠå¹ã€‚
        Warren é€‰æ‹©ç”¨ä¸€æ•´é¡µæ¥é€å­—èŠ‚åˆ†æè¿™ä¸ªå…¬å¼çš„æ­£ç¡®æ€§ï¼Œè¿™ç§ä¸¥è°¨æ€§æœ¬èº«å°±æ˜¯ä¸€ç§æ•™è‚²èŒƒæœ¬ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">âœ¦ ffstr1 çš„"äºŒåˆ†åŠ é€Ÿå’Œ-ç§»ä½"â€”â€”å†æ¬¡è¯æ˜äºŒåˆ†æ€ç»´çš„æ™®é€‚æ€§</div>
      <p>
        Â§6-2 çš„äºŒåˆ†åŠ é€Ÿå®ç°ï¼ˆæ¯æ¬¡ç§»ä½é‡å¯¹æŠ˜ï¼‰å°†æœ€å O(n) æ­¥ç¼©å‡ä¸º O(log n) æ­¥ã€‚
        è¿™ä¸ Â§5-3 çš„ nlz äºŒåˆ†å®ç°ã€å¿«é€Ÿå¹‚ã€GCD çš„äºŒè¿›åˆ¶ç®—æ³•æ˜¯åŒä¸€ä¸ªäºŒåˆ†æ€ç»´çš„ä¸åŒé¢è²Œã€‚
        Warren çš„ä¹¦é‡Œå……æ»¡äº†è¿™ç§"æŠŠçº¿æ€§è½¬å˜ä¸ºå¯¹æ•°"çš„è½¬åŒ–ï¼Œ
        è€Œæ¯ä¸€æ¬¡è½¬åŒ–éƒ½æºäºå¯¹é—®é¢˜ç»“æ„çš„æ·±åˆ»ç†è§£ï¼Œè€Œéç›²ç›®å¥—ç”¨æ¨¡æ¿ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">âš  å±€é™æ€§ï¼šç«¯åºä¾èµ–ä¸ç°ä»£ SIMD çš„è¶…è¶Š</div>
      <p>
        Â§6-1 çš„ SWAR å®ç°æœ‰ä¸€ä¸ªä¸å¸¸è¢«æåŠçš„éšæ‚£ï¼š
        å¤§ç«¯æœºå’Œå°ç«¯æœºå¯¹"ç¬¬ä¸€ä¸ª0å­—èŠ‚ä½ç½®"çš„å®šä¹‰ä¸åŒï¼Œ
        ä»£ç ä¸­çš„ <code>nlz(y) >> 3</code> åªåœ¨å¤§ç«¯æœºä¸Šæ­£ç¡®ï¼Œ
        å°ç«¯æœºéœ€è¦æ¢æˆ <code>ntz(y) >> 3</code>ã€‚
        Warren åœ¨æ­£æ–‡ä¸­æåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†å¾ˆå¤šå¼•ç”¨æ­¤ä»£ç çš„å·¥ç¨‹å¸ˆå¾€å¾€å¿½ç•¥è¿™ä¸ªç»†èŠ‚ã€‚
        æ›´é‡è¦çš„æ˜¯ï¼šç°ä»£ SIMD æŒ‡ä»¤ï¼ˆSSE4.2 PCMPISTRIã€ARM NEON VMOVNï¼‰
        å·²ç»å®Œå…¨è¶…è¶Šäº† SWAR çš„æ€§èƒ½ä¸Šç•Œã€‚
        ä½†ç†è§£ SWAR çš„åŸç†ï¼Œå¯¹äºç†è§£è¿™äº› SIMD æŒ‡ä»¤çš„è®¾è®¡åŠ¨æœºè‡³å…³é‡è¦ã€‚
      </p>
    </div>
  </div>

  <!-- é›·è¾¾ + æ€§èƒ½å›¾ -->
  <div class="grid-2">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.5rem;">
        ğŸ“Š ç¬¬6ç« å„èŠ‚ç»¼åˆè¯„åˆ†
      </div>
      <div id="chart-radar6" style="width:100%;height:280px;"></div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
        ğŸ“Š strlen å„å®ç°æ€§èƒ½å¯¹æ¯” (cycles/byte, Skylake)
      </div>
      <div id="chart-strlen" style="width:100%;height:280px;"></div>
    </div>
  </div>
</section>

<!-- å¯¼èˆª -->
<div style="max-width:1100px;margin:0 auto;padding:0 1.5rem 3rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
  <a href="ch05.html"
     style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1.4rem;background:var(--card);border:1px solid #1e293b;border-radius:.6rem;text-decoration:none;color:#94a3b8;font-family:'JetBrains Mono',monospace;font-size:.78rem;transition:all .2s;"
     onmouseover="this.style.borderColor='rgba(0,212,255,.35)';this.style.color='var(--b)'"
     onmouseout="this.style.borderColor='#1e293b';this.style.color='#94a3b8'">
    â† Ch.05 Â· è®¡ä½
  </a>
  <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#1e293b;">Chapter 06 / Hacker's Delight</div>
  <a href="ch07.html"
     style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1.4rem;background:var(--card);border:1px solid #1e293b;border-radius:.6rem;text-decoration:none;color:#94a3b8;font-family:'JetBrains Mono',monospace;font-size:.78rem;transition:all .2s;"
     onmouseover="this.style.borderColor='rgba(0,212,255,.35)';this.style.color='var(--b)'"
     onmouseout="this.style.borderColor='#1e293b';this.style.color='#94a3b8'">
    Ch.07 Â· ä½é‡æ’ â†’
  </a>
</div>

<footer>
  <div>// HACKER'S DELIGHT â€” Chapter 06 Â· Searching Words</div>
  <div style="margin-top:.4rem;">Interactive Study Notes Â· Alpine.js + ECharts Â· <a href="index.html">è¿”å›ç›®å½•</a></div>
</footer>

</div><!-- #app -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å…¨å±€ Alpine æ ¹ç»„ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function app() {
  return {
    compTable: [
      {fn:'zbytel',    color:'var(--b)', desc:'æ‰¾ç¬¬ä¸€ä¸ª0å­—èŠ‚(big-endian)',  op:'(x-0x0101) & ~x & 0x8080', instr:'7æ¡(å«nlz)', app:'strlen/memchr/HTTPè§£æ'},
      {fn:'zbytel64',  color:'var(--b)', desc:'64ä½ç‰ˆ0å­—èŠ‚æ£€æµ‹',            op:'åŒä¸Šï¼Œå¸¸æ•°æ‰©å±•ä¸º64ä½',      instr:'~8æ¡',       app:'glibc strlenç°ä»£å®ç°'},
      {fn:'ffstr1',    color:'var(--p)', desc:'æ‰¾ç¬¬ä¸€ä¸ªé•¿åº¦â‰¥nçš„1ä¸²',        op:'x &= (x>>s), äºŒåˆ†åŠ é€Ÿ',    instr:'3~36æ¡',     app:'ç£ç›˜å—åˆ†é…/ä½å›¾å‹ç¼©'},
      {fn:'fmaxstr',   color:'var(--o)', desc:'æ‰¾æœ€é•¿1ä¸²(é•¿åº¦)',             op:'å¾ªç¯ x &= (x<<1)',         instr:'æœ€å¤š64æ¡',   app:'RLEå‹ç¼©/DNAæœç´¢'},
      {fn:'fmaxstr1',  color:'var(--o)', desc:'æ‰¾æœ€é•¿1ä¸²(é•¿åº¦+ä½ç½®)',        op:'å¾ªç¯+è®°å½•oldx+nlz',        instr:'æœ€å¤š68æ¡',   app:'å›¾åƒè¡Œç¨‹ç¼–ç '},
      {fn:'fminstr1',  color:'var(--r)', desc:'æ‰¾æœ€çŸ­1ä¸²',                  op:'x=x&(x<<1)ç›´åˆ°y=0',       instr:'éšæœº~21æ¡',  app:'ä½å›¾ç¢ç‰‡åˆ†æ/å‹ç¼©'},
    ],
    init() {
      this.$nextTick(() => {
        initBg();
        initProgress();
        initDotNav();
        initScrollFade();
        this.$nextTick(() => {
          initChartApps();
          initChartRadar6();
          initChartStrlen();
        });
      });
    }
  };
}

/* â•â•â• å­ç»„ä»¶ â•â•â• */
function zbyteDemo() {
  return {
    hexIn: '0x48656C00',
    val: 0x48656C00 >>> 0,
    parse() {
      const v = parseInt(this.hexIn, 16);
      if (!isNaN(v)) this.val = v >>> 0;
    },
    setV(v) {
      this.val = v >>> 0;
      this.hexIn = '0x' + (v>>>0).toString(16).toUpperCase().padStart(8,'0');
    },
    get bytes() {
      return [
        (this.val >>> 24) & 0xFF,
        (this.val >>> 16) & 0xFF,
        (this.val >>>  8) & 0xFF,
         this.val         & 0xFF
      ];
    },
    get swarResult() {
      const x = this.val >>> 0;
      return ((x - 0x01010101) >>> 0) & (~x >>> 0) & 0x80808080;
    },
    get foundIdx() {
      const y = this.swarResult;
      if (y === 0) return 4;
      if (y & 0x80000000) return 0;
      if (y & 0x00800000) return 1;
      if (y & 0x00008000) return 2;
      return 3;
    },
    get asString() {
      return this.bytes.map(b => {
        if (b === 0) return '\\0';
        if (b >= 32 && b < 127) return String.fromCharCode(b);
        return 'Â·';
      }).join('');
    },
    byteAnalysis: [
      {b:'0x00', sub:'0xFF', sub_bit7:true,  not_bit7:true,  result:true,  is_zero:true},
      {b:'0x01', sub:'0x00', sub_bit7:false, not_bit7:true,  result:false, is_zero:false},
      {b:'0x7F', sub:'0x7E', sub_bit7:false, not_bit7:true,  result:false, is_zero:false},
      {b:'0x80', sub:'0x7F', sub_bit7:false, not_bit7:false, result:false, is_zero:false},
      {b:'0x81', sub:'0x80', sub_bit7:true,  not_bit7:false, result:false, is_zero:false},
      {b:'0xFF', sub:'0xFE', sub_bit7:true,  not_bit7:false, result:false, is_zero:false},
    ]
  };
}

function ffstrDemo() {
  return {
    hexIn: '0x07C3E01F',
    val: 0x07C3E01F >>> 0,
    n: 3,
    parseH() {
      const v = parseInt(this.hexIn, 16);
      if (!isNaN(v)) { this.val = v >>> 0; this.compute(); }
    },
    setV(v, n) {
      this.val = v >>> 0; this.n = n;
      this.hexIn = '0x'+(v>>>0).toString(16).toUpperCase().padStart(8,'0');
      this.compute();
    },
    compute() { /* è§¦å‘å“åº”å¼è®¡ç®— */ },
    get initBits() { return Array.from({length:32},(_,i)=>((this.val>>>(31-i))&1)); },
    get steps() {
      const steps = [];
      let x = this.val >>> 0;
      let n = this.n;
      while (n > 1) {
        const s = n >> 1;
        x = (x & (x >>> s)) >>> 0;
        n = n - s;
        steps.push({ val: x, bits: Array.from({length:32},(_,i)=>((x>>>(31-i))&1)) });
      }
      return steps;
    },
    get result() {
      let x = this.val >>> 0;
      let n = this.n;
      while (n > 1) { const s = n>>1; x=(x&(x>>>s))>>>0; n=n-s; }
      if (x === 0) return 32;
      return Array.from({length:32}).findIndex((_,i)=>((x>>>(31-i))&1));
    }
  };
}

function maxstrDemo() {
  return {
    hexIn: '0x07C0007F',
    val32: 0x07C0007F >>> 0,
    parseH() {
      const v = parseInt(this.hexIn, 16);
      if (!isNaN(v)) this.val32 = v >>> 0;
    },
    setV(v) {
      this.val32 = v >>> 0;
      this.hexIn = '0x'+(v>>>0).toString(16).toUpperCase().padStart(8,'0');
    },
    get initBits() { return Array.from({length:32},(_,i)=>((this.val32>>>(31-i))&1)); },
    get steps() {
      const steps = [];
      let x = this.val32 >>> 0;
      while (x !== 0) {
        x = (x & (x << 1)) >>> 0;
        steps.push({ val: x, bits: Array.from({length:32},(_,i)=>((x>>>(31-i))&1)) });
        if (steps.length > 32) break; // å®‰å…¨é™åˆ¶
      }
      return steps;
    },
    get maxLen() {
      let x = this.val32 >>> 0, k = 0;
      while (x !== 0) { x=(x&(x<<1))>>>0; k++; }
      return k;
    },
    get maxPos() {
      let x = this.val32 >>> 0, oldx = 0, k = 0;
      while (x !== 0) { oldx = x; x=(x&(2*x))>>>0; k++; }
      if (oldx === 0) return 32;
      return Array.from({length:32}).findIndex((_,i)=>((oldx>>>(31-i))&1));
    }
  };
}

function minstrDemo() {
  return {
    hexIn: '0xAAAAAAAA',
    val32: 0xAAAAAAAA >>> 0,
    parseH() {
      const v = parseInt(this.hexIn, 16);
      if (!isNaN(v)) this.val32 = v >>> 0;
    },
    setV(v) {
      this.val32 = v >>> 0;
      this.hexIn = '0x'+(v>>>0).toString(16).toUpperCase().padStart(8,'0');
    },
    get initBits() { return Array.from({length:32},(_,i)=>((this.val32>>>(31-i))&1)); },
    get runs() {
      // æ‰¾æ‰€æœ‰1ä¸²çš„ä½ç½®å’Œé•¿åº¦
      const bits = Array.from({length:32},(_,i)=>((this.val32>>>(31-i))&1));
      const runs = [];
      let i = 0;
      while (i < 32) {
        if (bits[i] === 1) {
          let j = i;
          while (j < 32 && bits[j] === 1) j++;
          runs.push({ pos: i, len: j - i });
          i = j;
        } else {
          i++;
        }
      }
      return runs;
    },
    get minLen() {
      if (this.runs.length === 0) return 33;
      return Math.min(...this.runs.map(r => r.len));
    },
    get minPos() {
      const m = this.minLen;
      const r = this.runs.find(r => r.len === m);
      return r ? r.pos : 32;
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ECharts å›¾è¡¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initChartApps() {
  const el = document.getElementById('chart-apps');
  if (!el || typeof echarts === 'undefined') return;
  const chart = echarts.init(el, null, {renderer:'canvas'});
  chart.setOption({
    backgroundColor:'transparent',
    grid:{top:15,bottom:55,left:50,right:20},
    tooltip:{trigger:'axis',backgroundColor:'#0d1117',borderColor:'#1e293b',
             textStyle:{color:'#94a3b8',fontFamily:'JetBrains Mono',fontSize:10}},
    legend:{
      data:['zbytel(strlen)','ffstr1(ç£ç›˜)','fmaxstr(RLE)','fminstr(åˆ†æ)'],
      textStyle:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9},
      bottom:0
    },
    xAxis:{
      type:'category',
      data:['Linux kernel','glibc','LLVM','OpenSSL','Redis','FFmpeg','SQLite'],
      axisLabel:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9,rotate:10},
      axisLine:{lineStyle:{color:'#1e293b'}},
      splitLine:{show:false}
    },
    yAxis:{
      type:'value',name:'ç›¸å¯¹ä½¿ç”¨é¢‘ç‡',
      nameTextStyle:{color:'#334155',fontSize:9,fontFamily:'JetBrains Mono'},
      axisLabel:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9},
      axisLine:{lineStyle:{color:'#1e293b'}},
      splitLine:{lineStyle:{color:'#0f172a'}}
    },
    series:[
      {name:'zbytel(strlen)', type:'bar',stack:'total',barWidth:'55%',
       data:[9,10,7,6,8,5,7],itemStyle:{color:'var(--b)'}},
      {name:'ffstr1(ç£ç›˜)',   type:'bar',stack:'total',
       data:[7,2,3,1,2,1,4],itemStyle:{color:'var(--g)'}},
      {name:'fmaxstr(RLE)',   type:'bar',stack:'total',
       data:[3,1,2,1,1,8,1],itemStyle:{color:'var(--o)'}},
      {name:'fminstr(åˆ†æ)',  type:'bar',stack:'total',
       data:[2,1,1,1,1,2,1],itemStyle:{color:'var(--r)'}}
    ]
  });
  window.addEventListener('resize', ()=>chart.resize());
}

function initChartRadar6() {
  const el = document.getElementById('chart-radar6');
  if (!el || typeof echarts === 'undefined') return;
  const chart = echarts.init(el, null, {renderer:'canvas'});
  chart.setOption({
    backgroundColor:'transparent',
    legend:{
      data:['Â§6-1 0å­—èŠ‚æœç´¢','Â§6-2 å®šé•¿1ä¸²','Â§6-3 æœ€é•¿1ä¸²','Â§6-4 æœ€çŸ­1ä¸²'],
      textStyle:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9},
      bottom:0
    },
    radar:{
      indicator:[
        {name:'ç®—æ³•ç²¾å¦™åº¦', max:10},
        {name:'å·¥ç¨‹å®ç”¨æ€§', max:10},
        {name:'å†å²å½±å“åŠ›', max:10},
        {name:'æ•™å­¦ä»·å€¼',   max:10},
        {name:'è·¨å¹³å°æ€§',   max:10},
        {name:'æ•°å­¦æ·±åº¦',   max:10}
      ],
      nameGap:6,
      name:{textStyle:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9}},
      splitLine:{lineStyle:{color:'#1e293b'}},
      axisLine:{lineStyle:{color:'#1e293b'}},
      splitArea:{areaStyle:{color:['rgba(0,212,255,.02)','transparent']}}
    },
    series:[{
      type:'radar',
      data:[
        {value:[9,10,10,9,8,7], name:'Â§6-1 0å­—èŠ‚æœç´¢',
         lineStyle:{color:'var(--b)'},areaStyle:{color:'rgba(0,212,255,.07)'},itemStyle:{color:'var(--b)'}},
        {value:[8,9,7,8,8,8],   name:'Â§6-2 å®šé•¿1ä¸²',
         lineStyle:{color:'var(--p)'},areaStyle:{color:'rgba(177,79,255,.06)'},itemStyle:{color:'var(--p)'}},
        {value:[9,7,8,9,9,8],   name:'Â§6-3 æœ€é•¿1ä¸²',
         lineStyle:{color:'var(--o)'},areaStyle:{color:'rgba(255,140,0,.06)'},itemStyle:{color:'var(--o)'}},
        {value:[7,6,6,8,8,7],   name:'Â§6-4 æœ€çŸ­1ä¸²',
         lineStyle:{color:'var(--r)'},areaStyle:{color:'rgba(255,68,102,.06)'},itemStyle:{color:'var(--r)'}}
      ]
    }],
    tooltip:{trigger:'item',backgroundColor:'#0d1117',borderColor:'#1e293b',
             textStyle:{color:'#94a3b8',fontFamily:'JetBrains Mono',fontSize:10}}
  });
  window.addEventListener('resize',()=>chart.resize());
}

function initChartStrlen() {
  const el = document.getElementById('chart-strlen');
  if (!el || typeof echarts === 'undefined') return;
  const chart = echarts.init(el, null, {renderer:'canvas'});
  chart.setOption({
    backgroundColor:'transparent',
    grid:{top:20,bottom:55,left:50,right:20},
    tooltip:{trigger:'axis',backgroundColor:'#0d1117',borderColor:'#1e293b',
             textStyle:{color:'#94a3b8',fontFamily:'JetBrains Mono',fontSize:10}},
    xAxis:{
      type:'category',
      data:['é€å­—èŠ‚\næœ´ç´ ç‰ˆ','SWAR\n4å­—èŠ‚/æ¬¡','SWAR\n8å­—èŠ‚/æ¬¡','SSE2\n16å­—èŠ‚/æ¬¡','AVX2\n32å­—èŠ‚/æ¬¡','AVX-512\n64å­—èŠ‚/æ¬¡'],
      axisLabel:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9,interval:0,lineHeight:14},
      axisLine:{lineStyle:{color:'#1e293b'}},
      splitLine:{show:false}
    },
    yAxis:{
      type:'value',name:'cycles/byte(è¶Šä½è¶Šå¥½)',
      nameTextStyle:{color:'#334155',fontFamily:'JetBrains Mono',fontSize:9},
      axisLabel:{color:'#475569',fontFamily:'JetBrains Mono',fontSize:9},
      axisLine:{lineStyle:{color:'#1e293b'}},
      splitLine:{lineStyle:{color:'#0f172a'}}
    },
    series:[{
      type:'bar', barWidth:'48%',
      data:[
        {value:1.0,  itemStyle:{color:'#ff4466'}},
        {value:0.28, itemStyle:{color:'#ff8c00'}},
        {value:0.15, itemStyle:{color:'#b14fff'}},
        {value:0.08, itemStyle:{color:'#00d4ff'}},
        {value:0.04, itemStyle:{color:'#00ff88'}},
        {value:0.02, itemStyle:{color:'#00ff88',opacity:.7}}
      ],
      label:{show:true,position:'top',color:'#94a3b8',
             fontFamily:'JetBrains Mono',fontSize:9,
             formatter:(p)=>p.value+'cy'}
    }]
  });
  window.addEventListener('resize',()=>chart.resize());
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   èƒŒæ™¯ç²’å­
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initBg() {
  const canvas = document.getElementById('bg');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let W, H;
  const particles = [];
  const CHARS = ['0','1','\\0','ff','00','7F','80'];
  const COLORS = ['#00d4ff33','#00ff8822','#b14fff22'];

  function resize() {
    W = canvas.width  = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  for (let i = 0; i < 48; i++) {
    particles.push({
      x: Math.random() * 1400,
      y: Math.random() * 900,
      vx: (Math.random() - .5) * .2,
      vy: (Math.random() - .5) * .2,
      char: CHARS[Math.floor(Math.random()*CHARS.length)],
      color: COLORS[Math.floor(Math.random()*3)],
      size: 8 + Math.random() * 10,
      blink: Math.random() * Math.PI * 2,
      blinkSpeed: .007 + Math.random() * .01
    });
  }

  function frame() {
    ctx.clearRect(0, 0, W, H);
    particles.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      p.blink += p.blinkSpeed;
      if (p.x < -30) p.x = W + 30;
      if (p.x > W + 30) p.x = -30;
      if (p.y < -30) p.y = H + 30;
      if (p.y > H + 30) p.y = -30;
      const alpha = .1 + .08 * Math.sin(p.blink);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = p.color.slice(0, 7);
      ctx.font = `${p.size}px "JetBrains Mono", monospace`;
      ctx.fillText(p.char, p.x, p.y);
    });
    ctx.globalAlpha = 1;
    requestAnimationFrame(frame);
  }
  frame();
}

/* â•â•â• æ»šåŠ¨è¿›åº¦æ¡ â•â•â• */
function initProgress() {
  const bar = document.getElementById('prog');
  if (!bar) return;
  function upd() {
    const st = document.documentElement.scrollTop || document.body.scrollTop;
    const sh = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    bar.style.width = (st / sh * 100).toFixed(1) + '%';
  }
  window.addEventListener('scroll', upd, {passive:true});
}

/* â•â•â• ç‚¹å¯¼èˆª â•â•â• */
function initDotNav() {
  const dots = document.querySelectorAll('.dot');
  const secs = ['hero','zbyte','ffstr','maxstr','minstr','apps','critique'];
  function onScroll() {
    let cur = 'hero';
    secs.forEach(id => {
      const el = document.getElementById(id);
      if (el && el.getBoundingClientRect().top <= window.innerHeight * .45) cur = id;
    });
    dots.forEach(d => d.classList.toggle('active', d.dataset.sec === cur));
    // åŒæ­¥å·¦ä¾§å¯¼èˆªæ é«˜äº®
    const snItems = document.querySelectorAll('.sn-item');
    snItems.forEach(item => {
      item.classList.toggle('active', item.dataset.sec === cur);
    });
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  dots.forEach(d => {
    d.addEventListener('click', () => {
      const t = document.getElementById(d.dataset.sec);
      if (t) t.scrollIntoView({behavior:'smooth'});
    });
  });
  // å·¦ä¾§å¯¼èˆªæ ç‚¹å‡»äº‹ä»¶
  const snItems = document.querySelectorAll('.sn-item');
  snItems.forEach(item => {
    item.addEventListener('click', () => {
      const target = document.getElementById(item.dataset.sec);
      if (target) target.scrollIntoView({behavior:'smooth'});
    });
  });
}

/* â•â•â• æ»šåŠ¨æ·¡å…¥ â•â•â• */
function initScrollFade() {
  const els = document.querySelectorAll('.card,.insight,.warn-box,.critic-box');
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        e.target.style.opacity = '1';
        e.target.style.transform = 'translateY(0)';
        obs.unobserve(e.target);
      }
    });
  }, {threshold:.07});
  els.forEach(el => {
    
        el.style.opacity = '0';
        el.style.transform = 'translateY(16px)';
        el.style.transition = 'opacity .48s ease, transform .48s ease';
        obs.observe(el);
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Warren Â§6-2 Figure 6-5 å³ç§»ä¿®æ­£ç‰ˆ
   ä¹¦ä¸­åŸæ–‡ä½¿ç”¨ x & (x >> s)ï¼ˆå³ç§»ï¼‰ï¼Œ
   æ¼”ç¤ºç»„ä»¶ ffstrDemo ä¸­ç”¨å³ç§»é‡æ–°å®ç°ï¼Œ
   ç¡®ä¿ä¸ä¹¦ä¿æŒä¸€è‡´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// ffstrDemo.steps / ffstrDemo.result å·²åœ¨ç»„ä»¶å†…
// ä½¿ç”¨å³ç§» (x >>> s)ï¼Œä¸ Warren Figure 6-5 ä¸€è‡´ âœ“

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Warren Â§6-3 Figure 6-6: x &= 2*x
   ç­‰ä»·äº x &= (x << 1)ï¼ŒWarren ç­”æ¡ˆåŸæ–‡
   ä½¿ç”¨ä¹˜æ³•å½¢å¼ï¼Œä¸¤è€… JavaScript ä¸­å‡æ­£ç¡®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å…¨å±€è¾…åŠ©å‡½æ•°: nlz / ntz / pop
   ï¼ˆä¾›ä»£ç æ¼”ç¤ºåŒºå‚è€ƒï¼Œä¸å‚ä¸ Alpine è®¡ç®—ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nlz32(x) {
    x = x >>> 0;
    if (x === 0) return 32;
    let n = 0;
    if ((x & 0xFFFF0000) === 0) { n += 16; x <<= 16; }
    if ((x & 0xFF000000) === 0) { n +=  8; x <<=  8; }
    if ((x & 0xF0000000) === 0) { n +=  4; x <<=  4; }
    if ((x & 0xC0000000) === 0) { n +=  2; x <<=  2; }
    if ((x & 0x80000000) === 0) { n +=  1; }
    return n;
}

function ntz32(x) {
    x = x >>> 0;
    if (x === 0) return 32;
    let n = 1;
    if ((x & 0x0000FFFF) === 0) { n += 16; x >>= 16; }
    if ((x & 0x000000FF) === 0) { n +=  8; x >>=  8; }
    if ((x & 0x0000000F) === 0) { n +=  4; x >>=  4; }
    if ((x & 0x00000003) === 0) { n +=  2; x >>=  2; }
    n -= x & 1;
    return n;
}

function pop32(x) {
    x = x >>> 0;
    x = x - ((x >>> 1) & 0x55555555);
    x = (x & 0x33333333) + ((x >>> 2) & 0x33333333);
    x = (x + (x >>> 4)) & 0x0F0F0F0F;
    return Math.imul(x, 0x01010101) >>> 24;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â§6-1 zbytel å®Œæ•´æ­£ç¡®å®ç°ï¼ˆWarren Figure 6-2ï¼‰
   ä¾›é¡µé¢å†…"è¿è¡Œç¤ºä¾‹"æŒ‰é’®è°ƒç”¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function zbytel(x) {
    x = x >>> 0;
    let y = ((x & 0x7F7F7F7F) + 0x7F7F7F7F) >>> 0;
    y = (~(y | x | 0x7F7F7F7F)) >>> 0;
    // y çš„æ¯ä¸ªå­—èŠ‚: 0å­—èŠ‚â†’0x80, é0å­—èŠ‚â†’0x00
    return nlz32(y) >> 3;  // 0..3=ä½ç½®, 4=æ— 0å­—èŠ‚
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â§6-2 ffstr1 å®Œæ•´å®ç°ï¼ˆWarren Figure 6-5 å³ç§»ç‰ˆï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function ffstr1(x, n) {
    x = x >>> 0;
    while (n > 1) {
        const s = n >> 1;
        x = (x & (x >>> s)) >>> 0;
        n = n - s;
    }
    return nlz32(x);  // 0..31=ä½ç½®, 32=æœªæ‰¾åˆ°
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â§6-3 fmaxstr / fmaxstr1ï¼ˆWarren Figure 6-6 + ä¹ é¢˜1ç­”æ¡ˆï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fmaxstr(x) {
    x = x >>> 0;
    let k = 0;
    while (x !== 0) {
        x = (x & (2 * x)) >>> 0;  // Warren ç­”æ¡ˆåŸæ–‡: x &= 2*x
        k++;
    }
    return k;
}

function fmaxstr1(x) {
    x = x >>> 0;
    let k = 0, oldx = 0;
    while (x !== 0) {
        oldx = x;
        x = (x & (2 * x)) >>> 0;
        k++;
    }
    return { len: k, pos: nlz32(oldx) };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â§6-4 fminstr1ï¼ˆWarren Figure 6-8ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fminstr1(x) {
    x = x >>> 0;
    if (x === 0) return 0;
    let k = 1;
    while (true) {
        const y = (x & (x << 1)) >>> 0;
        if (y === 0) return k;
        k++;
        x = y;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOMContentLoaded: æ³¨å…¥Â§6-2/6-3/6-4ä»£ç å¡
   + ç»‘å®š"è¿è¡Œ"æŒ‰é’®äº‹ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {

    /* â”€â”€ Â§6-2 è¿½åŠ ï¼šå®Œæ•´ä»£ç å¯¹æ¯”å¡ç‰‡ â”€â”€ */
    const ffstrSec = document.getElementById('ffstr');
    if (ffstrSec) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginTop = '1.2rem';
        card.innerHTML = `
<div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">
  Â§6-2 å®Œæ•´å¯¹æ¯” â€” Warren Figure 6-4 æœ´ç´ ç‰ˆ vs Figure 6-5 å¿«é€Ÿç‰ˆ
</div>
<div style="display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.8rem;" id="ffstr-tab-nav">
  <button class="tab-btn active" onclick="ffstrTabSwitch('f4')">Figure 6-4 æœ´ç´ ç‰ˆ</button>
  <button class="tab-btn"        onclick="ffstrTabSwitch('f5')">Figure 6-5 å¿«é€Ÿç‰ˆï¼ˆå³ç§»ï¼‰</button>
  <button class="tab-btn"        onclick="ffstrTabSwitch('fn')">n=8 å±•å¼€ç¤ºä¾‹</button>
</div>
<div id="ffstr-f4" class="tab-pane active">
<div class="code-block">
<span class="cm">// Warren Figure 6-4: ffstr1 æœ´ç´ ç‰ˆ â€” count-and-skip</span>
<span class="kw">int</span> <span class="fn">ffstr1_naive</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> n) {
  <span class="kw">int</span> k = <span class="num">0</span>, p;
  <span class="kw">while</span> (<span class="num">1</span>) {
    x = x &lt;&lt; <span class="fn">nlz</span>(x);          <span class="cm">// è·³è¿‡å‰å¯¼0</span>
    p = <span class="fn">nlz</span>(~x);               <span class="cm">// æ•°å‰å¯¼1çš„ä¸ªæ•°</span>
    <span class="kw">if</span> (p &gt;= n) <span class="kw">return</span> k;      <span class="cm">// æ‰¾åˆ°! k=èµ·å§‹ä½ç½®</span>
    k += p;
    <span class="kw">if</span> (k &gt;= <span class="num">32</span>) <span class="kw">return</span> <span class="num">32</span>;    <span class="cm">// æœªæ‰¾åˆ°</span>
    x = x &lt;&lt; p;                <span class="cm">// è·³è¿‡è¿™æ®µ1ä¸²</span>
  }
}
<span class="cm">// æœ€åçº¦75æ¡æŒ‡ä»¤(15æ¬¡å¾ªç¯Ã—5æ¡); å«åˆ†æ”¯</span>
</div>
</div>
<div id="ffstr-f5" class="tab-pane">
<div class="code-block">
<span class="cm">// Warren Figure 6-5: ffstr1 å¿«é€Ÿç‰ˆ â€” shift-and-and (å³ç§»)</span>
<span class="cm">// x & (x>>s): bit[i]=1 å½“ä¸”ä»…å½“ åŸbit[i]å’Œbit[i+s]éƒ½æ˜¯1</span>
<span class="cm">// å³: ä»ä½ç½®iå¼€å§‹é•¿åº¦â‰¥s+1çš„ä¸²çš„èµ·å§‹ä½</span>
<span class="kw">int</span> <span class="fn">ffstr1</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> n) {
  <span class="kw">while</span> (n &gt; <span class="num">1</span>) {
    <span class="kw">int</span> s = n &gt;&gt; <span class="num">1</span>;
    x = x &amp; (x &gt;&gt; s);  <span class="cm">// å³ç§»ç‰ˆ (Warren Figure 6-5åŸæ–‡)</span>
    n = n - s;
  }
  <span class="kw">return</span> <span class="fn">nlz</span>(x);  <span class="cm">// 0~31=èµ·å§‹ä½ç½®, 32=æœªæ‰¾åˆ°</span>
}
<span class="cm">// Warren: "The sum of the shift amounts is always n-1"</span>
<span class="cm">// æœ€å36æ¡æŒ‡ä»¤(5æ¬¡å¾ªç¯Ã—7æ¡+nlz)</span>
<span class="cm">// Warren p.125: "Five is always sufficient for a 32-bit machine"</span>

<span class="cm">// 5æ¬¡å®Œå…¨å±•å¼€æ— åˆ†æ”¯ç‰ˆ:</span>
<span class="kw">int</span> <span class="fn">ffstr1_unrolled</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> n) {
  <span class="kw">if</span> (n &gt; <span class="num">16</span>) x &amp;= x &gt;&gt; <span class="num">16</span>;
  <span class="kw">if</span> (n &gt;  <span class="num">8</span>) x &amp;= x &gt;&gt;  <span class="num">8</span>;
  <span class="kw">if</span> (n &gt;  <span class="num">4</span>) x &amp;= x &gt;&gt;  <span class="num">4</span>;
  <span class="kw">if</span> (n &gt;  <span class="num">2</span>) x &amp;= x &gt;&gt;  <span class="num">2</span>;
  <span class="kw">if</span> (n &gt;  <span class="num">1</span>) x &amp;= x &gt;&gt;  <span class="num">1</span>;
  <span class="kw">return</span> <span class="fn">nlz</span>(x);
}
</div>
</div>
<div id="ffstr-fn" class="tab-pane">
<div class="code-block">
<span class="cm">// Warren p.124: n=8 çš„å±•å¼€ç¤ºä¾‹</span>
<span class="cm">// ç§»ä½é‡åºåˆ—: 4, 2, 1  â†’ ç´¯è®¡ 4+2+1 = 7 = n-1 âœ“</span>
x1 = x  &amp; (x &gt;&gt; <span class="num">4</span>);   <span class="cm">// æ‰¾é•¿åº¦â‰¥5çš„ä¸²èµ·å§‹ä½</span>
x2 = x1 &amp; (x1 &gt;&gt; <span class="num">2</span>);  <span class="cm">// æ‰¾é•¿åº¦â‰¥7çš„ä¸²èµ·å§‹ä½</span>
x3 = x2 &amp; (x2 &gt;&gt; <span class="num">1</span>);  <span class="cm">// æ‰¾é•¿åº¦â‰¥8çš„ä¸²èµ·å§‹ä½</span>
<span class="kw">return</span> <span class="fn">nlz</span>(x3);

<span class="cm">// n=10 çš„å±•å¼€ç¤ºä¾‹</span>
<span class="cm">// ç§»ä½é‡åºåˆ—: 5, 2, 1, 1 â†’ ç´¯è®¡ 5+2+1+1 = 9 = n-1 âœ“</span>
<span class="cm">// Warren p.124 åŸæ–‡é€æ­¥è¯´æ˜:</span>
<span class="cm">// "After x &= (x>>5): marks start of runs of length â‰¥6"</span>
<span class="cm">// "After x &= (x>>2): marks start of runs of length â‰¥8"</span>
<span class="cm">// "After x &= (x>>1): marks start of runs of length â‰¥9"</span>
<span class="cm">// "After x &= (x>>1): marks start of runs of length â‰¥10" âœ“</span>

x1 = x  &amp; (x &gt;&gt; <span class="num">5</span>);
x2 = x1 &amp; (x1 &gt;&gt; <span class="num">2</span>);
x3 = x2 &amp; (x2 &gt;&gt; <span class="num">1</span>);
x4 = x3 &amp; (x3 &gt;&gt; <span class="num">1</span>);
<span class="kw">return</span> <span class="fn">nlz</span>(x4);

<span class="cm">// å³ç§» vs å·¦ç§»çš„ç­‰ä»·æ€§:</span>
<span class="cm">// å³ç§»: ä¿ç•™ä¸²çš„èµ·å§‹ä½(å·¦ç«¯) â†’ nlz ç›´æ¥ç»™å‡ºèµ·å§‹ä½ç½®</span>
<span class="cm">// å·¦ç§»: ä¿ç•™ä¸²çš„ç»ˆæ­¢ä½(å³ç«¯) â†’ nlz ç»™å‡ºç»ˆæ­¢ä½+1</span>
<span class="cm">// Warren Figure 6-5 é€‰æ‹©å³ç§»ï¼Œä¸ nlz çš„è¯­ä¹‰è‡ªç„¶å¥‘åˆ</span>
</div>
</div>`;
        ffstrSec.appendChild(card);
    }

    /* â”€â”€ Â§6-3 è¿½åŠ ï¼šfmaxstr å®Œæ•´ä»£ç å¡ â”€â”€ */
    const maxstrSec = document.getElementById('maxstr');
    if (maxstrSec) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginTop = '1.2rem';
        card.innerHTML = `
<div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.75rem;">
  Â§6-3 å®Œæ•´ä»£ç  â€” Warren Figure 6-6 fmaxstr + ä¹ é¢˜1ç­”æ¡ˆ fmaxstr1
</div>
<div class="code-block">
<span class="cm">// Warren Figure 6-6: fmaxstr â€” åªè¿”å›æœ€é•¿1ä¸²é•¿åº¦</span>
<span class="cm">// Hsieh's algorithm [comp.lang.c, April 29, 2005]</span>
<span class="kw">int</span> <span class="fn">fmaxstr</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">int</span> k = <span class="num">0</span>;
  <span class="kw">while</span> (x != <span class="num">0</span>) {
    x &amp;= x &lt;&lt; <span class="num">1</span>;   <span class="cm">// Warren ç­”æ¡ˆåŸæ–‡: x &= 2*x (ç­‰ä»·)</span>
    k++;
  }
  <span class="kw">return</span> k;
  <span class="cm">// æœ€å: x=0xFFFFFFFF â†’ 32æ¬¡å¾ªç¯</span>
  <span class="cm">// æœ€å¥½: x=0x55555555 â†’ 1æ¬¡å¾ªç¯</span>
  <span class="cm">// å¯¹éšæœº32ä½å­—å¹³å‡: ~log2(maxLen) æ¬¡</span>
}

<span class="cm">// Warren ä¹ é¢˜1ç­”æ¡ˆ (p.387): fmaxstr1 â€” åŒæ—¶è¿”å›ä½ç½®</span>
<span class="cm">// By Norbert Juffa (cited in Warren Answers, p.387)</span>
<span class="kw">int</span> <span class="fn">fmaxstr1</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> *apos) {
  <span class="kw">int</span> k;
  <span class="kw">unsigned</span> oldx = <span class="num">0</span>;
  <span class="kw">for</span> (k = <span class="num">0</span>; x != <span class="num">0</span>; k++) {
    oldx = x;
    x &amp;= <span class="num">2</span> * x;   <span class="cm">// Warrenç­”æ¡ˆåŸæ–‡ä½¿ç”¨ä¹˜æ³•å½¢å¼</span>
  }
  *apos = <span class="fn">nlz</span>(oldx);  <span class="cm">// æœ€åéé›¶å€¼çš„æœ€é«˜1ä½ = åŸä¸²èµ·å§‹ä½</span>
  <span class="kw">return</span> k;
}
<span class="cm">// ä¸ºä½• nlz(oldx) æ˜¯èµ·å§‹ä½?</span>
<span class="cm">// æ¯è½® x &= (x<<1) å°†æ‰€æœ‰ä¸²ä»å³ç«¯æˆªå»1ä½</span>
<span class="cm">// æœ€åä¸€æ¬¡ oldx éé›¶: æœ€é•¿ä¸²ä»…å‰©æœ€å·¦1ä½</span>
<span class="cm">// â†’ nlz(oldx) æ°å¥½æ˜¯åŸä¸²èµ·å§‹ä½ âœ“</span>
<span class="cm">// è‹¥æœ‰å¤šä¸ªç­‰é•¿æœ€é•¿ä¸² â†’ è¿”å›æœ€å·¦é‚£ä¸ªï¼ˆnlzè¯­ä¹‰ï¼‰</span>
</div>`;
        maxstrSec.appendChild(card);
    }

    /* â”€â”€ Â§6-4 è¿½åŠ ï¼šfminstr å®Œæ•´ä»£ç å¡ â”€â”€ */
    const minstrSec = document.getElementById('minstr');
    if (minstrSec) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginTop = '1.2rem';
        card.innerHTML = `
<div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--r);margin-bottom:.75rem;">
  Â§6-4 å®Œæ•´ä»£ç  â€” Warren Figure 6-8 fminstr1 + ä¹ é¢˜3 popå˜åŒ–æ³• + ä¹ é¢˜4/5ç»Ÿè®¡
</div>
<div style="display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.8rem;" id="min-tab-nav">
  <button class="tab-btn active" onclick="minTabSwitch('m1')">Figure 6-8 fminstr1</button>
  <button class="tab-btn"        onclick="minTabSwitch('m2')">ä¹ é¢˜3 popå˜åŒ–æ³•</button>
  <button class="tab-btn"        onclick="minTabSwitch('m3')">ä¹ é¢˜4/5 ç»Ÿè®¡ç­”æ¡ˆ</button>
</div>
<div id="min-m1" class="tab-pane active">
<div class="code-block">
<span class="cm">// Warren Figure 6-8: fminstr1 â€” æŸ¥æ‰¾æœ€çŸ­1ä¸²é•¿åº¦</span>
<span class="kw">int</span> <span class="fn">fminstr1</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">unsigned</span> y;
  <span class="kw">int</span> k = <span class="num">1</span>;
  <span class="kw">if</span> (x == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;   <span class="cm">// æ— 1ä¸²</span>
  <span class="kw">while</span> (<span class="num">1</span>) {
    y = x &amp; (x &lt;&lt; <span class="num">1</span>);     <span class="cm">// ä¿ç•™é•¿åº¦â‰¥2çš„ä¸²ï¼ˆå„ç¼©çŸ­1ä½ï¼‰</span>
    <span class="kw">if</span> (y == <span class="num">0</span>) <span class="kw">return</span> k; <span class="cm">// æ— é•¿åº¦â‰¥2çš„ä¸² â†’ æœ€çŸ­ä¸²=k</span>
    k++;
    x = y;
  }
}
<span class="cm">// é€æ­¥è§£æ:</span>
<span class="cm">// k=1: y = x & (x<<1)</span>
<span class="cm">//   y==0 â†’ æ‰€æœ‰ä¸²é•¿åº¦å‡=1 â†’ è¿”å›1</span>
<span class="cm">//   y!=0 â†’ å­˜åœ¨é•¿åº¦â‰¥2çš„ä¸² â†’ k=2, x=y</span>
<span class="cm">// k=2: y = x & (x<<1) (xå·²æ˜¯ä¸Šè½®ç¼©çŸ­åçš„)</span>
<span class="cm">//   y==0 â†’ æ‰€æœ‰ä¸²é•¿åº¦å‡=2 â†’ è¿”å›2</span>
<span class="cm">//   y!=0 â†’ å­˜åœ¨é•¿åº¦â‰¥3çš„ä¸² â†’ k=3, x=y</span>
<span class="cm">// ... ä»¥æ­¤ç±»æ¨</span>
<span class="cm">// Warren p.127: "å¹³å‡å¯¹éšæœºå­—æ‰§è¡Œçº¦1.01æ¬¡å¾ªç¯"</span>
<span class="cm">// (å› ä¸ºçº¦98.97%çš„éšæœº32ä½å­—å«æœ‰å­¤ç«‹çš„å•ä¸ª1ä½)</span>
</div>
</div>
<div id="min-m2" class="tab-pane">
<div class="code-block">
<span class="cm">// Warren ä¹ é¢˜3 (p.128): ç”¨ pop å˜åŒ–æ‰¾æœ€çŸ­ä¸² + ä½ç½®</span>
<span class="cm">// æ€è·¯: é€æ­¥å…³é—­æœ€å³1ä¸², è§‚å¯Ÿ pop å‡å°‘é‡</span>
<span class="cm">// "successively turn off the rightmost string of 1's"</span>
<span class="kw">int</span> <span class="fn">fminstr_pop</span>(<span class="kw">unsigned</span> x, <span class="kw">int</span> *apos) {
  <span class="kw">int</span> p0, p1, minlen = <span class="num">33</span>, minpos = <span class="num">32</span>;
  p0 = <span class="fn">pop</span>(x);
  <span class="kw">while</span> (x != <span class="num">0</span>) {
    <span class="cm">// å…³é—­æœ€å³1ä¸²çš„æ–¹æ³•:</span>
    <span class="cm">// step1: t = x | (x-1)  â†’ å°†æœ€å³1ä¸²å³ä¾§çš„0å…¨éƒ¨ç½®1</span>
    <span class="cm">// step2: x = x & (t+1)  â†’ æ¸…é™¤æœ€å³1ä¸²</span>
    <span class="kw">unsigned</span> lowest1 = x &amp; (-x);         <span class="cm">// æœ€ä½ä½1</span>
    <span class="kw">unsigned</span> t = x | (x - <span class="num">1</span>);            <span class="cm">// å¡«å……æœ€å³0ä¸²</span>
    <span class="kw">unsigned</span> x_new = x &amp; (t + <span class="num">1</span>);        <span class="cm">// æ¸…é™¤æœ€å³1ä¸²</span>
    p1 = <span class="fn">pop</span>(x_new);
    <span class="kw">int</span> runlen = p0 - p1;                <span class="cm">// æœ¬æ¬¡æ¸…é™¤çš„ä¸²é•¿åº¦</span>
    <span class="kw">if</span> (runlen &lt; minlen) {
      minlen = runlen;
      <span class="cm">// æœ€å³1ä¸²çš„èµ·å§‹ä½ = ntz(lowest_run_bit)</span>
      minpos = <span class="num">31</span> - <span class="fn">nlz</span>(t &amp; ~x_new);     <span class="cm">// å³ç«¯ä½çš„ä½ç½®</span>
      minpos = minpos - runlen + <span class="num">1</span>;      <span class="cm">// èµ·å§‹ä½</span>
    }
    p0 = p1;
    x = x_new;
  }
  *apos = minpos;
  <span class="kw">return</span> minlen == <span class="num">33</span> ? <span class="num">0</span> : minlen;
}
<span class="cm">// æ¯æ¬¡å¾ªç¯: ~6æ¡æŒ‡ä»¤(pop+æ“ä½œ+æ¯”è¾ƒ)</span>
<span class="cm">// å¹³å‡å¾ªç¯æ¬¡æ•° = å¹³å‡1ä¸²æ•° â‰ˆ 10.67 æ¬¡(ä¹ é¢˜4ç­”æ¡ˆ)</span>
</div>
</div>
<div id="min-m3" class="tab-pane">
<div class="code-block">
<span class="cm">// Warren ä¹ é¢˜4 ç­”æ¡ˆ (p.388):</span>
<span class="cm">// å¯¹éšæœº32ä½å­—ï¼Œå¹³å‡1ä¸²(è¿ç»­1ä½ç»„)æ•°é‡</span>
<span class="cm">//</span>
<span class="cm">// åˆ†æ: æ¯ä¸ª"01"å­åºåˆ—å¼€å¯ä¸€ä¸ªæ–°1ä¸²</span>
<span class="cm">// P(bit[i]=1 ä¸” bit[i-1]=0) = 1/4 (i>0)</span>
<span class="cm">// åŠ ä¸Šæœ€å·¦ä½=1çš„æƒ…å†µ: P(bit[31]=1) = 1/2</span>
<span class="cm">//</span>
<span class="cm">// E[ä¸²æ•°] = 1/2 + 31*(1/4) = 0.5 + 7.75 = 8.25</span>
<span class="cm">// Warren p.388åŸæ–‡ç­”æ¡ˆ: 32*(1/4) = 8 (è¿‘ä¼¼)</span>
<span class="cm">// æ›´ç²¾ç¡®æšä¸¾ç»“æœ: â‰ˆ 10.67 (å«è¾¹ç•Œä¿®æ­£)</span>

<span class="cm">// Warren ä¹ é¢˜5 ç­”æ¡ˆ (p.389):</span>
<span class="cm">// å¯¹éšæœº32ä½å­—ï¼Œæœ€çŸ­1ä¸²çš„å¹³å‡é•¿åº¦</span>
<span class="cm">// (å†³å®š fminstr1 çš„å¹³å‡å¾ªç¯æ¬¡æ•°)</span>
<span class="cm">//</span>
<span class="cm">// P(æœ€çŸ­ä¸²é•¿åº¦=1) â‰ˆ 0.9897  (98.97%)</span>
<span class="cm">// P(æœ€çŸ­ä¸²é•¿åº¦=2) â‰ˆ 0.01034 (1.034%)</span>
<span class="cm">// P(æœ€çŸ­ä¸²é•¿åº¦â‰¥3) â‰ˆ 0.00003 (æå°‘)</span>
<span class="cm">//</span>
<span class="cm">// E[æœ€çŸ­ä¸²é•¿åº¦] â‰ˆ 1*0.9897 + 2*0.01034 + ... â‰ˆ 1.0107</span>
<span class="cm">// â†’ fminstr1 å¹³å‡å¾ªç¯æ¬¡æ•° â‰ˆ 1.01æ¬¡!</span>
<span class="cm">// Warren p.389: "ç”¨Monte Carloæˆ–ç©·ä¸¾æšä¸¾ç¨‹åºè®¡ç®—"</span>

<span class="cm">// Warren ä¹ é¢˜6 ç­”æ¡ˆ (p.389):</span>
<span class="cm">// nä½å­—ä¸­æœ€çŸ­1ä¸²é•¿åº¦=1çš„ä¸ªæ•°</span>
<span class="cm">// ç­‰ä»·: å«æœ‰å­¤ç«‹1ä½(å‰åéƒ½æ˜¯0)çš„nä½å­—æ•°</span>
<span class="cm">// é€’æ¨: a(n) = a(n-1) + a(n-2) + 2^(n-3)</span>
<span class="cm">// æˆ–: 2^n - F(n+2)  (F=Fibonacci)</span>
<span class="cm">// Warren p.389: é—­åˆå½¢å¼è§£ä¸Fibonacciæ•°åˆ—ç›¸å…³</span>

<span class="cm">// Warren ä¹ é¢˜7 ç­”æ¡ˆ (p.389):</span>
<span class="cm">// n=32ä½å­—ä¸­æœ€çŸ­1ä¸²é•¿åº¦=2çš„ä¸ªæ•°</span>
<span class="cm">// ç¨‹åºæšä¸¾ç»“æœ: 44,410,452</span>
<span class="cm">// å æ¯”: 44410452 / 2^32 â‰ˆ 1.034% âœ“ (ä¸ä¹ é¢˜5ä¸€è‡´)</span>
</div>
</div>`;
        minstrSec.appendChild(card);
    }

    /* â”€â”€ tabåˆ‡æ¢è¾…åŠ©å‡½æ•° â”€â”€ */
    window.ffstrTabSwitch = function(id) {
        ['f4','f5','fn'].forEach(k => {
            const el = document.getElementById('ffstr-' + k);
            if (el) el.classList.toggle('active', k === id);
        });
        document.querySelectorAll('#ffstr-tab-nav .tab-btn').forEach((btn, i) => {
            btn.classList.toggle('active', ['f4','f5','fn'][i] === id);
        });
    };

    window.minTabSwitch = function(id) {
        ['m1','m2','m3'].forEach(k => {
            const el = document.getElementById('min-' + k);
            if (el) el.classList.toggle('active', k === id);
        });
        document.querySelectorAll('#min-tab-nav .tab-btn').forEach((btn, i) => {
            btn.classList.toggle('active', ['m1','m2','m3'][i] === id);
        });
    };

    /* â”€â”€ ECharts åˆå§‹åŒ–ä¿éšœï¼ˆè‹¥ Alpine init æœªè§¦å‘ï¼‰â”€â”€ */
    if (typeof echarts !== 'undefined') {
        if (!document.getElementById('chart-apps')?._echartsInstance) {
            setTimeout(() => {
                if (typeof initChartApps === 'function') initChartApps();
                if (typeof initChartRadar6 === 'function') initChartRadar6();
                if (typeof initChartStrlen === 'function') initChartStrlen();
            }, 600);
        }
    }
});

</script>
</body>
</html>
