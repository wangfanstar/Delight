
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ch.03 â€” 2çš„å¹‚è¾¹ç•Œ | Hacker's Delight</title>
<link rel="stylesheet" href="tailwind.css"/>
<script src="echarts.min.js"></script>
<script src="alpine.min.js" defer></script>
<style>
:root{
  --g:#00ff88;--b:#00d4ff;--p:#b14fff;--o:#ff8c00;--r:#ff4466;
  --dark:#050810;--card:#0d1117;--border:rgba(0,255,136,.18);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--dark);color:#e2e8f0;font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;font-size:17px;line-height:1.7;}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,136,.010) 2px,rgba(0,255,136,.010) 4px);pointer-events:none;z-index:0;}
canvas#bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
#app{position:relative;z-index:1;}

nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,8,16,.9);backdrop-filter:blur(14px);border-bottom:1px solid var(--border);padding:.7rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);text-decoration:none;}
.nav-links{display:flex;gap:1.4rem;}
.nav-links a{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;text-decoration:none;transition:color .2s;}
.nav-links a:hover{color:var(--g);}

#prog{position:fixed;top:0;left:0;height:2px;z-index:200;background:linear-gradient(90deg,var(--g),var(--b),var(--p));transition:width .12s;}

.dot-nav{position:fixed;right:1.4rem;top:50%;transform:translateY(-50%);z-index:50;display:flex;flex-direction:column;gap:.55rem;}
.dot{width:8px;height:8px;border-radius:50%;background:#1e293b;cursor:pointer;transition:all .2s;}
.dot.active{background:var(--g);transform:scale(1.45);box-shadow:0 0 6px var(--g);}
@media(max-width:768px){.dot-nav{display:none;}}

.hero{padding:7rem 2rem 3rem;text-align:center;max-width:900px;margin:0 auto;}
.chapter-badge{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);border:1px solid var(--g);padding:.28rem .95rem;border-radius:999px;letter-spacing:.15em;margin-bottom:1.5rem;animation:badge-pulse 2.5s ease-in-out infinite;}
@keyframes badge-pulse{0%,100%{box-shadow:0 0 6px rgba(0,255,136,.35);}50%{box-shadow:0 0 22px rgba(0,255,136,.75);}}
.hero-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:900;background:linear-gradient(135deg,#fff 0%,var(--g) 50%,var(--b) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15;margin-bottom:.5rem;}
.hero-sub{font-family:'JetBrains Mono',monospace;color:#475569;font-size:.88rem;margin-bottom:1.8rem;}
.hero-desc{color:#94a3b8;font-size:.98rem;line-height:1.88;max-width:720px;margin:0 auto 2rem;}

section{max-width:1100px;margin:0 auto;padding:0 1.5rem 4rem;}
.sec-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.75rem;}
.sec-num{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);background:rgba(0,255,136,.07);border:1px solid rgba(0,255,136,.18);padding:.22rem .55rem;border-radius:4px;white-space:nowrap;}
.sec-title{font-size:1.3rem;font-weight:700;color:#f1f5f9;}
.sec-divider{flex:1;height:1px;background:linear-gradient(90deg,rgba(0,255,136,.28),transparent);}

.card{background:var(--card);border:1px solid #1e293b;border-radius:.75rem;padding:1.4rem;transition:border-color .25s,box-shadow .25s;}
.card:hover{border-color:rgba(0,255,136,.22);box-shadow:0 4px 22px rgba(0,255,136,.06);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.2rem;}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.1rem;}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr;}}

.code-block{background:#010409;border:1px solid #1e293b;border-radius:.5rem;padding:1.1rem 1.4rem;font-family:'JetBrains Mono',monospace;font-size:.95rem;line-height:1.9;overflow-x:auto;color:#94a3b8;position:relative;white-space:pre-wrap;}
.code-block .kw{color:var(--p);}
.code-block .num{color:var(--o);}
.code-block .cm{color:#334155;font-style:italic;}
.code-block .fn{color:var(--g);}
.code-block .hi{color:#fff;background:rgba(0,255,136,.1);border-radius:2px;padding:0 3px;}
.code-block .warn{color:var(--r);}

.insight{background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.14);border-left:3px solid var(--g);border-radius:.5rem;padding:1.15rem 1.4rem;margin-bottom:1.2rem;font-size:.88rem;line-height:1.82;color:#94a3b8;}
.insight strong{color:var(--g);}
.insight .label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--g);letter-spacing:.1em;display:block;margin-bottom:.4rem;}

.warn-box{background:rgba(255,68,102,.04);border:1px solid rgba(255,68,102,.18);border-left:3px solid var(--r);border-radius:.5rem;padding:1.05rem 1.3rem;font-size:.84rem;line-height:1.78;color:#94a3b8;margin-bottom:1.1rem;}
.warn-box .label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--r);letter-spacing:.1em;display:block;margin-bottom:.35rem;}
.warn-box strong{color:var(--r);}

.tag{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.62rem;padding:.18rem .48rem;border-radius:3px;margin:.12rem;}
.tag-g{background:rgba(0,255,136,.09);color:var(--g);border:1px solid rgba(0,255,136,.18);}
.tag-b{background:rgba(0,212,255,.09);color:var(--b);border:1px solid rgba(0,212,255,.18);}
.tag-p{background:rgba(177,79,255,.09);color:var(--p);border:1px solid rgba(177,79,255,.18);}
.tag-o{background:rgba(255,140,0,.09);color:var(--o);border:1px solid rgba(255,140,0,.18);}
.tag-r{background:rgba(255,68,102,.09);color:var(--r);border:1px solid rgba(255,68,102,.18);}

.tab-nav{display:flex;gap:.4rem;margin-bottom:.9rem;flex-wrap:wrap;}
.tab-btn{font-family:'JetBrains Mono',monospace;font-size:.68rem;padding:.32rem .8rem;border-radius:4px;border:1px solid #1e293b;background:transparent;color:#475569;cursor:pointer;transition:all .2s;}
.tab-btn.active,.tab-btn:hover{border-color:var(--g);color:var(--g);background:rgba(0,255,136,.07);}
.tab-pane{display:none;}.tab-pane.active{display:block;}

/* å¯è§†åŒ–å·¥å…· */
.pow2-vis{display:grid;grid-template-columns:repeat(8,1fr);gap:3px;margin:.75rem 0;}
.pow2-cell{height:36px;display:flex;align-items:center;justify-content:center;border-radius:3px;font-family:'JetBrains Mono',monospace;font-size:.7rem;border:1px solid #1e293b;transition:all .2s;cursor:default;}
.pow2-cell.is-pow2{background:rgba(0,255,136,.15);border-color:rgba(0,255,136,.4);color:var(--g);font-weight:700;}
.pow2-cell.in-range{background:rgba(0,212,255,.08);border-color:rgba(0,212,255,.2);color:var(--b);}
.pow2-cell.zero{background:rgba(177,79,255,.08);border-color:rgba(177,79,255,.2);color:var(--p);}
.pow2-cell.normal{color:#334155;}

/* nlz æ­¥éª¤å¯è§†åŒ– */
.nlz-step{display:flex;align-items:center;gap:.5rem;margin:.3rem 0;font-family:'JetBrains Mono',monospace;font-size:.76rem;}
.nlz-bar{display:flex;gap:1px;flex-wrap:wrap;}
.nlz-bit{width:18px;height:18px;display:flex;align-items:center;justify-content:center;border-radius:2px;font-size:.65rem;transition:all .2s;}
.nlz-bit.one{background:rgba(0,255,136,.2);color:var(--g);border:1px solid rgba(0,255,136,.3);}
.nlz-bit.zero{background:#0d1117;color:#1e293b;border:1px solid #1e293b;}
.nlz-bit.filled{background:rgba(0,212,255,.15);color:var(--b);border:1px solid rgba(0,212,255,.25);}

/* trick card */
.trick-card{background:var(--card);border:1px solid #1e293b;border-radius:.7rem;padding:1.1rem;transition:all .22s;position:relative;overflow:hidden;}
.trick-card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;opacity:0;transition:opacity .22s;}
.trick-card:hover::before{opacity:1;}
.trick-card:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,255,136,.08);}
.trick-card.green::before{background:linear-gradient(180deg,var(--g),var(--b));}
.trick-card.blue::before{background:linear-gradient(180deg,var(--b),var(--p));}
.trick-card.orange::before{background:linear-gradient(180deg,var(--o),var(--r));}
.trick-card.purple::before{background:linear-gradient(180deg,var(--p),var(--g));}
.trick-num{font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#334155;margin-bottom:.35rem;}
.trick-title{font-size:.92rem;font-weight:700;color:#f1f5f9;margin-bottom:.45rem;}
.trick-formula{font-family:'JetBrains Mono',monospace;font-size:.88rem;color:var(--g);background:rgba(0,255,136,.06);border:1px solid rgba(0,255,136,.12);border-radius:.3rem;padding:.35rem .65rem;margin:.45rem 0;display:inline-block;}
.trick-desc{font-size:.8rem;color:#64748b;line-height:1.7;}
.trick-example{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#475569;margin-top:.45rem;padding:.35rem .55rem;background:#010409;border-radius:.3rem;}

/* critic */
.critic-box{background:linear-gradient(135deg,rgba(177,79,255,.05),rgba(0,212,255,.03));border:1px solid rgba(177,79,255,.22);border-radius:.75rem;padding:1.65rem;position:relative;overflow:hidden;}
.critic-box::before{content:'// æ·±åº¦ç‚¹è¯„';font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--p);letter-spacing:.1em;display:block;margin-bottom:.9rem;}
.critic-box h3{font-size:1rem;font-weight:700;color:#f1f5f9;margin-bottom:.7rem;}
.critic-item{margin-bottom:1rem;padding-left:.9rem;border-left:2px solid rgba(177,79,255,.28);}
.critic-item .ci-title{font-size:.81rem;font-weight:600;color:var(--p);margin-bottom:.28rem;}
.critic-item p{font-size:.8rem;line-height:1.74;color:#64748b;}

/* timeline */
.timeline{position:relative;padding-left:1.8rem;}
.timeline::before{content:'';position:absolute;left:.42rem;top:0;bottom:0;width:1px;background:linear-gradient(180deg,var(--g),var(--p),transparent);}
.tl-item{position:relative;margin-bottom:1.8rem;}
.tl-dot{position:absolute;left:-1.45rem;top:.32rem;width:9px;height:9px;border-radius:50%;background:var(--g);box-shadow:0 0 7px var(--g);}
.tl-year{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);margin-bottom:.18rem;}
.tl-title{font-size:.9rem;font-weight:600;color:#f1f5f9;margin-bottom:.25rem;}
.tl-desc{font-size:.8rem;color:#64748b;line-height:1.65;}

/* æ•°è½´å¯è§†åŒ– */
.number-line{position:relative;height:60px;margin:1rem 0;overflow:hidden;}
.nl-track{position:absolute;bottom:20px;left:10px;right:10px;height:2px;background:#1e293b;}
.nl-label{position:absolute;bottom:0;font-family:'JetBrains Mono',monospace;font-size:.58rem;color:#334155;transform:translateX(-50%);}
.nl-marker{position:absolute;bottom:14px;width:2px;background:var(--g);transform:translateX(-50%);transition:height .3s;}
.nl-marker.pow2{background:var(--g);height:14px;}
.nl-marker.clp2{background:var(--b);height:10px;}
.nl-marker.x{background:var(--r);height:18px;width:2px;}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.fade-up{opacity:0;animation:fadeUp .5s ease both;}

footer{text-align:center;padding:2.5rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#1e293b;border-top:1px solid #0f172a;}
footer a{color:var(--g);text-decoration:none;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:var(--dark);}
::-webkit-scrollbar-thumb{background:#1e293b;border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:rgba(0,255,136,.28);}

/* â•â•â• å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  â•â•â• */
.sidebar-nav{
  position:fixed;left:0;top:0;bottom:0;
  width:180px;z-index:90;
  background:rgba(5,8,16,.92);
  backdrop-filter:blur(10px);
  border-right:1px solid rgba(0,255,136,.12);
  padding:1rem .5rem;
  overflow-y:auto;
  overflow-x:hidden;
  transition:transform .25s ease;
  display:flex;
  flex-direction:column;
}
.sidebar-nav::-webkit-scrollbar{width:3px;}
.sidebar-nav::-webkit-scrollbar-thumb{background:#1e293b;border-radius:2px;}

.sidebar-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.62rem;color:var(--g);
  letter-spacing:.08em;
  padding:.4rem .6rem;
  border-bottom:1px solid rgba(0,255,136,.15);
  margin-bottom:.5rem;
  flex-shrink:0;
}

.sidebar-section{
  margin-bottom:.6rem;
  display:flex;
  flex-direction:column;
}
.sidebar-section-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.58rem;color:#475569;
  padding:.3rem .6rem;
  letter-spacing:.05em;
  flex-shrink:0;
}

.sidebar-link{
  display:block;
  width:100%;
  clear:both;
  font-family:'JetBrains Mono',monospace;
  font-size:.68rem;
  color:#64748b;
  text-decoration:none;
  padding:.25rem .6rem .25rem 1rem;
  border-radius:3px;
  transition:all .15s;
  position:relative;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.sidebar-link:hover{color:var(--g);background:rgba(0,255,136,.06);}
.sidebar-link.active{color:var(--g);background:rgba(0,255,136,.1);}
.sidebar-link.active::before{
  content:'';position:absolute;left:0;top:50%;
  transform:translateY(-50%);
  width:2px;height:14px;
  background:var(--g);border-radius:1px;
}

.sidebar-toggle{
  display:none;
  position:fixed;left:.5rem;top:.85rem;z-index:95;
  width:32px;height:32px;
  background:rgba(5,8,16,.9);
  border:1px solid rgba(0,255,136,.2);
  border-radius:4px;
  color:var(--g);
  font-size:1.1rem;
  cursor:pointer;
}

@media(max-width:1100px){
  .sidebar-nav{transform:translateX(-100%);}
  .sidebar-nav.open{transform:translateX(0);}
  .sidebar-toggle{display:flex;align-items:center;justify-content:center;}
  body{padding-left:0!important;}
}

@media(min-width:1101px){body{padding-left:180px;}}
</style>
</head>
<body>

<!-- å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  -->
<button class="sidebar-toggle" @click="sidebarOpen = !sidebarOpen" x-data="{sidebarOpen: false}">
  â˜°
</button>
<nav class="sidebar-nav" :class="sidebarOpen ? 'open' : ''" x-data="{sidebarOpen: false}" @click.away="sidebarOpen = false">
  <div class="sidebar-title">ğŸ“š HACKER'S DELIGHT</div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">æ­£æ–‡ç« èŠ‚</div>
    <a href="ch01.html" class="sidebar-link">Ch.01 å¥ å®šåŸºç¡€</a>
    <a href="ch02.html" class="sidebar-link">Ch.02 åŸºç¡€æ“ä½œ</a>
    <a href="ch03.html" class="sidebar-link active">Ch.03 2çš„å¹‚è¾¹ç•Œ</a>
    <a href="ch04.html" class="sidebar-link">Ch.04 ç®—æœ¯è¾¹ç•Œ</a>
    <a href="ch05.html" class="sidebar-link">Ch.05 æ•´æ•°é™¤æ³•</a>
    <a href="ch06.html" class="sidebar-link">Ch.06 ä½è®¡æ•°</a>
    <a href="ch07.html" class="sidebar-link">Ch.07 ä½ç¿»è½¬</a>
    <a href="ch08.html" class="sidebar-link">Ch.08 ä½ç½®æ¢</a>
    <a href="ch09.html" class="sidebar-link">Ch.09 å¾ªç¯å†—ä½™æ ¡éªŒ</a>
    <a href="ch10.html" class="sidebar-link">Ch.10 å¥‡å¶æ ¡éªŒ</a>
    <a href="ch11.html" class="sidebar-link">Ch.11 Grayç </a>
    <a href="ch12.html" class="sidebar-link">Ch.12 Hilbertæ›²çº¿</a>
    <a href="ch13.html" class="sidebar-link">Ch.13 æµ®ç‚¹æ•°</a>
    <a href="ch14.html" class="sidebar-link">Ch.14 å…¬å¼</a>
    <a href="ch15.html" class="sidebar-link">Ch.15 åŸºæ•°è½¬æ¢</a>
    <a href="ch16.html" class="sidebar-link">Ch.16 å¼€æ–¹</a>
    <a href="ch17.html" class="sidebar-link">Ch.17 æµ®ç‚¹å€’æ•°å¼€æ–¹</a>
    <a href="ch18.html" class="sidebar-link">Ch.18 å…¶å®ƒ</a>
  </div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">é™„å½•</div>
    <a href="appA.html" class="sidebar-link">App.A è¯æ±‡è¡¨</a>
    <a href="appB.html" class="sidebar-link">App.B æ‘˜è¦</a>
    <a href="appC.html" class="sidebar-link">App.C å‘å±•å²</a>
  </div>
</nav>

<canvas id="bg"></canvas>
<div id="prog"></div>

<div class="dot-nav" id="dotNav">
  <div class="dot active" data-sec="hero"     title="é¡¶éƒ¨"></div>
  <div class="dot"        data-sec="def"      title="å®šä¹‰ä¸æ€§è´¨"></div>
  <div class="dot"        data-sec="flp2"     title="flp2ä¸‹å–æ•´"></div>
  <div class="dot"        data-sec="clp2"     title="clp2ä¸Šå–æ•´"></div>
  <div class="dot"        data-sec="align"    title="å¯¹é½æ“ä½œ"></div>
  <div class="dot"        data-sec="nlz"      title="å‰å¯¼é›¶è®¡æ•°"></div>
  <div class="dot"        data-sec="history"  title="å†å²æ¼”å˜"></div>
  <div class="dot"        data-sec="critique" title="æ·±åº¦ç‚¹è¯„"></div>
</div>

<nav>
  <a class="nav-logo" href="index.html">â† HACKER'S DELIGHT</a>
  <div class="nav-links">
    <a href="#def">å®šä¹‰</a>
    <a href="#flp2">flp2</a>
    <a href="#clp2">clp2</a>
    <a href="#align">å¯¹é½</a>
    <a href="#nlz">nlz</a>
    <a href="#history">å†å²</a>
    <a href="#critique">ç‚¹è¯„</a>
  </div>
</nav>

<div id="app" x-data="app()" x-init="init()">

<!-- â•â•â• HERO â•â•â• -->
<div class="hero" id="hero">
  <div class="chapter-badge">CHAPTER 03 Â· POWER-OF-2 BOUNDARIES Â· 2çš„å¹‚è¾¹ç•Œ</div>
  <h1 class="hero-title fade-up" style="animation-delay:.1s">2 çš„å¹‚è¾¹ç•Œ</h1>
  <p class="hero-sub fade-up" style="animation-delay:.2s">// å‘ä¸‹/å‘ä¸Šå–æ•´åˆ°æœ€è¿‘çš„2çš„å¹‚ â€” æ¯ä¸ªå†…å­˜åˆ†é…å™¨çš„çµé­‚</p>
  <p class="hero-desc fade-up" style="animation-delay:.3s">
    è¿™ä¸€ç« åªåšä¸€ä»¶äº‹ï¼š<strong style="color:var(--g)">æ‰¾åˆ°æœ€è¿‘çš„2çš„å¹‚</strong>ã€‚
    å¬èµ·æ¥ç®€å•ï¼Œä½† Warren ç”¨è¿™ä»¶äº‹ä¸²èµ·äº†å‰å¯¼é›¶è®¡æ•°ï¼ˆnlzï¼‰ã€ä½ä¼ æ’­ï¼ˆsmearï¼‰ã€
    å†…å­˜å¯¹é½ã€å“ˆå¸Œè¡¨å®¹é‡ç­–ç•¥ã€SIMD æ•°æ®å¸ƒå±€â€¦â€¦
    æ¯ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€æ¯ä¸ªå†…å­˜åˆ†é…å™¨ã€æ¯ä¸ªå“ˆå¸Œè¡¨éƒ½åœ¨ç”¨è¿™ä¸€ç« çš„æŠ€æœ¯ï¼Œ
    åªæ˜¯å¤§å¤šæ•°ç¨‹åºå‘˜ä¸çŸ¥é“è‡ªå·±ç”¨çš„æ˜¯ä»€ä¹ˆã€‚
  </p>
  <div class="fade-up" style="animation-delay:.4s">
    <span class="tag tag-g">flp2 / clp2</span>
    <span class="tag tag-b">nlz å‰å¯¼é›¶</span>
    <span class="tag tag-p">smear ä¼ æ’­</span>
    <span class="tag tag-o">å†…å­˜å¯¹é½</span>
    <span class="tag tag-r">å“ˆå¸Œè¡¨æ‰©å®¹</span>
    <span class="tag tag-g">LZCNT / BSR</span>
    <span class="tag tag-b">buddy allocator</span>
  </div>
</div>

<!-- â•â•â• Â§3-1 å®šä¹‰ä¸åŸºæœ¬æ€§è´¨ â•â•â• -->
<section id="def">
  <div class="sec-header">
    <span class="sec-num">Â§3-1</span>
    <span class="sec-title">å®šä¹‰ä¸åŸºæœ¬æ€§è´¨ â€” Definitions & Properties</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// CORE DEFINITION</span>
    <strong>flp2(x)</strong> = ä¸è¶…è¿‡ x çš„æœ€å¤§2çš„å¹‚æ¬¡ = 2^âŒŠlogâ‚‚xâŒ‹ï¼ˆx > 0ï¼‰ï¼Œflp2(0) = 0ã€‚<br>
    <strong>clp2(x)</strong> = ä¸å°äº x çš„æœ€å°2çš„å¹‚æ¬¡ = 2^âŒˆlogâ‚‚xâŒ‰ï¼ˆx > 0ï¼‰ï¼Œclp2(0) = 0ã€‚<br>
    æ³¨æ„ï¼šclp2(x) å¯¹ x > 2Â³Â¹ çš„ç»“æœåœ¨32ä½æ— ç¬¦å·ä¸­æ˜¯ 0ï¼ˆæ¨¡2Â³Â²æ„ä¹‰ä¸‹ï¼‰ï¼Œ
    Warren æ˜ç¡®è¦æ±‚"æŒ‰æ¨¡2Â³Â²çš„ç®—æœ¯æ­£ç¡®å€¼"æ¥å®šä¹‰ã€‚è¿™ä¸ªç»†èŠ‚ç›´æ¥å½±å“å®ç°çš„æ­£ç¡®æ€§ã€‚
  </div>

  <!-- å‡½æ•°å€¼è¡¨æ ¼ -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.75rem;">
      ğŸ“‹ flp2 / clp2 å‡½æ•°å€¼å¯¹ç…§è¡¨ï¼ˆWarren Table 3-1ï¼‰
    </div>
    <div style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;font-size:.76rem;">
        <thead>
          <tr>
            <template x-for="h in ['x','flp2(x)','clp2(x)','flp2 = clp2?','å¤‡æ³¨']" :key="h">
              <th style="padding:.4rem .8rem;border:1px solid #1e293b;color:var(--g);font-weight:600;text-align:center;background:rgba(0,255,136,.04);" x-text="h"></th>
            </template>
          </tr>
        </thead>
        <tbody>
          <template x-for="row in tableData" :key="row.x">
            <tr style="border:1px solid #0f172a;">
              <td style="padding:.35rem .8rem;border:1px solid #1e293b;color:#f1f5f9;text-align:center;" x-text="row.x"></td>
              <td style="padding:.35rem .8rem;border:1px solid #1e293b;text-align:center;" :style="{color:'var(--g)'}" x-text="row.flp2"></td>
              <td style="padding:.35rem .8rem;border:1px solid #1e293b;text-align:center;" :style="{color:'var(--b)'}" x-text="row.clp2"></td>
              <td style="padding:.35rem .8rem;border:1px solid #1e293b;text-align:center;" :style="{color: row.eq ? 'var(--g)':'var(--r)'}" x-text="row.eq ? 'âœ“ æ˜¯2çš„å¹‚' : 'â€”'"></td>
              <td style="padding:.35rem .8rem;border:1px solid #1e293b;color:#475569;font-size:.7rem;" x-text="row.note"></td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>

  <!-- å…³é”®æ’ç­‰å¼ -->
  <div class="grid-2">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">æ ¸å¿ƒå…³ç³»æ’ç­‰å¼</div>
      <div class="code-block" style="font-size:.76rem;">
<span class="cm">// flp2 ä¸ clp2 çš„ç›¸äº’è½¬åŒ–å…³ç³»</span>
clp2(x) = flp2(x)   <span class="cm">// å½“ x æ˜¯ 2 çš„å¹‚æ—¶</span>
clp2(x) = flp2(x-1) * 2  <span class="cm">// å½“ x ä¸æ˜¯ 2 çš„å¹‚</span>

<span class="cm">// ç­‰ä»·å†™æ³•:</span>
clp2(x) = flp2(2x - 1)   <span class="cm">// x â‰¥ 1</span>
flp2(x) = clp2(x) / 2    <span class="cm">// å½“ x ä¸æ˜¯ 2 çš„å¹‚</span>

<span class="cm">// ä¸ nlz (å‰å¯¼é›¶è®¡æ•°) çš„å…³ç³»:</span>
flp2(x) = 1 &lt;&lt; (31 - nlz(x))   <span class="cm">// x > 0</span>
clp2(x) = 1 &lt;&lt; (32 - nlz(x-1)) <span class="cm">// x > 1</span>

<span class="cm">// ç§»ä½ç­‰ä»· (2^n ç¼©æ”¾):</span>
flp2(2â¿ Â· x) = 2â¿ Â· flp2(x)
clp2(1/x) = 1 / flp2(x)  <span class="cm">// x â‰  0</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">åˆ¤æ–­ 2 çš„å¹‚ â€” 5ç§æ–¹æ³•å¯¹æ¯”</div>
      <div class="code-block" style="font-size:.76rem;">
<span class="cm">// â˜… æ–¹æ³•1: Warrenç»å…¸ (æœ€å¿«,2æ¡æŒ‡ä»¤)</span>
<span class="kw">int</span> <span class="fn">is_pow2</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">return</span> x &amp;&amp; !(x &amp; (x - <span class="num">1</span>));
}

<span class="cm">// æ–¹æ³•2: popcount == 1 (éœ€POPCNTæŒ‡ä»¤)</span>
<span class="kw">return</span> __builtin_popcount(x) == <span class="num">1</span>;

<span class="cm">// æ–¹æ³•3: x == flp2(x) (éœ€è¦å…ˆè®¡ç®—flp2)</span>
<span class="kw">return</span> x == <span class="fn">flp2</span>(x);

<span class="cm">// æ–¹æ³•4: clp2(x) == x</span>
<span class="kw">return</span> x == <span class="fn">clp2</span>(x);

<span class="cm">// æ–¹æ³•5: C++20 std::has_single_bit</span>
<span class="kw">return</span> std::has_single_bit(x);

<span class="cm">// æ€§èƒ½: æ–¹æ³•1 â‰ˆ æ–¹æ³•2 >> æ–¹æ³•3/4</span>
<span class="cm">// æ­£ç¡®æ€§: æ‰€æœ‰æ–¹æ³•å¯¹ x=0 éœ€å•ç‹¬å¤„ç†</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§3-2 flp2 å‘ä¸‹å–æ•´ â•â•â• -->
<section id="flp2">
  <div class="sec-header">
    <span class="sec-num">Â§3-2</span>
    <span class="sec-title">flp2 â€” å‘ä¸‹å–æ•´åˆ°æœ€è¿‘2çš„å¹‚</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE SMEAR TECHNIQUE</span>
    flp2 çš„å®ç°åŸç†æä¸ºç²¾å¦™ï¼šå…ˆæŠŠ x æœ€é«˜ä½çš„ 1 å‘å³<strong>"ä¼ æ’­"ï¼ˆsmearï¼‰</strong>å¡«æ»¡æ‰€æœ‰ä½ä½ï¼Œ
    å¾—åˆ°ä¸€ä¸ªå½¢å¦‚ 0111...1 çš„æ•°ï¼Œç„¶åå†å³ç§»1ä½å¹¶åŠ 1â€¦â€¦ä¸å¯¹ï¼Œ
    Warren çš„æ–¹æ³•æ˜¯ï¼šæŠŠæœ€é«˜ä½1ä¼ æ’­åˆ°æ‰€æœ‰ä½ä½åï¼Œå†åš <code style="color:var(--o);">result - (result >> 1)</code>ã€‚
    ä½†æ›´ç®€æ´çš„æ–¹å¼æ˜¯ï¼šsmear ä¹‹åå†å³ç§»1ä½å†åŠ 1ï¼Œ
    æˆ–è€…ç›´æ¥ <code style="color:var(--o);">(smear >> 1) + 1</code>ã€‚
    è¿™ä¸ª"smear-then-halve"çš„æŠ€å·§æŠŠå¯¹æ•°è¿ç®—å˜æˆäº†çº¯ä½æ“ä½œï¼Œç†è§£å®ƒéœ€è¦çœ‹é€è¡¥ç çš„ä¼ æ’­æœ¬è´¨ã€‚
  </div>

  <!-- äº¤äº’å¯è§†åŒ– -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="flp2Demo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.9rem;">
      ğŸ”¬ flp2 Smear ä¼ æ’­å¯è§†åŒ– â€” æ‹–åŠ¨æ»‘å—æŸ¥çœ‹æ¯æ­¥å˜åŒ–
    </div>
    <div style="display:flex;gap:1rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">è¾“å…¥ x =</div>
        <input type="range" min="1" max="255" x-model.number="x" style="width:180px;accent-color:var(--g);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--g);margin-left:.5rem;font-size:.9rem;" x-text="x"></span>
        <span style="font-family:'JetBrains Mono',monospace;color:#334155;margin-left:.3rem;font-size:.72rem;" x-text="'(0b'+x.toString(2).padStart(8,'0')+')'"></span>
      </div>
    </div>

    <!-- 8æ­¥smearè¿‡ç¨‹ -->
    <div style="display:grid;gap:.35rem;">
      <template x-for="(step, i) in smearSteps" :key="i">
        <div class="nlz-step" :class="i === smearSteps.length-1 ? 'active':''">
          <div style="min-width:160px;font-size:.68rem;color:#475569;" x-text="step.label"></div>
          <div class="nlz-bar">
            <template x-for="(b, j) in step.bits" :key="j">
              <div class="nlz-bit"
                   :class="b===2?'filled':b===1?'one':'zero'"
                   x-text="b===2?'1':b"></div>
            </template>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;margin-left:.5rem;"
               :style="{color: i===smearSteps.length-1?'var(--g)':'#475569'}"
               x-text="step.val"></div>
        </div>
      </template>
    </div>

    <div style="margin-top:.75rem;font-family:'JetBrains Mono',monospace;font-size:.85rem;">
      <span style="color:#475569;">flp2(</span><span style="color:var(--o);" x-text="x"></span><span style="color:#475569;">) = </span>
      <span style="color:var(--g);font-size:1.1rem;" x-text="flp2Result"></span>
      <span style="color:#334155;font-size:.72rem;margin-left:.5rem;" x-text="'= 2^'+Math.floor(Math.log2(x))"></span>
    </div>
  </div>

  <!-- ä»£ç å®ç° -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tabFlp2='main'">æ ‡å‡†å®ç°</button>
      <button class="tab-btn" @click="tabFlp2='fast'">å¿«é€Ÿå®ç°(nlz)</button>
      <button class="tab-btn" @click="tabFlp2='asm'">æ±‡ç¼–å¯¹æ¯”</button>
    </div>
    <div class="tab-pane" :class="tabFlp2==='main'?'active':''">
      <div class="code-block">
<span class="cm">// flp2: å‘ä¸‹å–æ•´åˆ°æœ€è¿‘2çš„å¹‚ (Warren Â§3-2)</span>
<span class="cm">// æ–¹æ³•: OR-smear + å³ç§» (5æ¬¡ç§»ä½OR, 1æ¬¡å³ç§»å‡æ³•)</span>
<span class="kw">unsigned</span> <span class="fn">flp2</span>(<span class="kw">unsigned</span> x) {
  x = x | (x &gt;&gt; <span class="num">1</span>);  <span class="cm">// ä¼ æ’­æœ€é«˜ä½å¾€å³1ä½</span>
  x = x | (x &gt;&gt; <span class="num">2</span>);  <span class="cm">// å†ä¼ æ’­2ä½</span>
  x = x | (x &gt;&gt; <span class="num">4</span>);  <span class="cm">// å†ä¼ æ’­4ä½</span>
  x = x | (x &gt;&gt; <span class="num">8</span>);  <span class="cm">// å†ä¼ æ’­8ä½</span>
  x = x | (x &gt;&gt; <span class="num">16</span>); <span class="cm">// å†ä¼ æ’­16ä½ â†’ æœ€é«˜ä½1å·²è”“å»¶åˆ°æ‰€æœ‰ä½ä½</span>
  <span class="cm">// æ­¤æ—¶ x = 0...01111...1 (æœ€é«˜ä½1å³è¾¹å…¨æ˜¯1)</span>
  <span class="kw">return</span> x - (x &gt;&gt; <span class="num">1</span>); <span class="cm">// å»æ‰ä½ä½çš„1ï¼Œåªç•™æœ€é«˜ä½ âœ“</span>
}
<span class="cm">// æ€»è®¡: 10æ¡æŒ‡ä»¤ (5Ã—OR, 5Ã—SHR, 1Ã—SUB, 1Ã—SHR)</span>
<span class="cm">// x=0æ—¶è¿”å›0 âœ“ (æ— éœ€ç‰¹åˆ¤)</span>

<span class="cm">// 64ä½ç‰ˆæœ¬ (å†åŠ ä¸¤æ­¥å³å¯):</span>
<span class="kw">unsigned long long</span> <span class="fn">flp2_64</span>(<span class="kw">unsigned long long</span> x) {
  x |= (x &gt;&gt; <span class="num">1</span>);  x |= (x &gt;&gt; <span class="num">2</span>);
  x |= (x &gt;&gt; <span class="num">4</span>);  x |= (x &gt;&gt; <span class="num">8</span>);
  x |= (x &gt;&gt; <span class="num">16</span>); x |= (x &gt;&gt; <span class="num">32</span>);
  <span class="kw">return</span> x - (x &gt;&gt; <span class="num">1</span>);
}
      </div>
    </div>
    <div class="tab-pane" :class="tabFlp2==='fast'?'active':''">
      <div class="code-block">
<span class="cm">// æ–¹æ³•2: åˆ©ç”¨ nlz (å‰å¯¼é›¶è®¡æ•°) â€” åªéœ€2æ¡æŒ‡ä»¤!</span>
<span class="kw">unsigned</span> <span class="fn">flp2_fast</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">if</span> (x == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;
  <span class="kw">return</span> <span class="num">0x80000000u</span> &gt;&gt; __builtin_clz(x);
  <span class="cm">// __builtin_clz(x) = nlz(x) = å‰å¯¼é›¶ä¸ªæ•°</span>
  <span class="cm">// 0x80000000 >> nlz(x) = 2^(31-nlz(x)) = flp2(x)</span>
}

<span class="cm">// æ–¹æ³•3: ç”¨ BSR æŒ‡ä»¤ (x86 Bit Scan Reverse)</span>
<span class="cm">// BSR eax, x â†’ eax = 31 - nlz(x) = floor(log2(x))</span>
<span class="kw">unsigned</span> <span class="fn">flp2_bsr</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">if</span> (x == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;
  <span class="kw">int</span> pos;
  __asm__ (<span class="str">"bsrl %1, %0"</span> : <span class="str">"=r"</span>(pos) : <span class="str">"r"</span>(x));
  <span class="kw">return</span> <span class="num">1u</span> &lt;&lt; pos;
}

<span class="cm">// C++20 æœ€ç®€æ´å†™æ³•:</span>
<span class="kw">return</span> std::bit_floor(x); <span class="cm">// &lt;bit&gt; header</span>

<span class="cm">// æ€§èƒ½å¯¹æ¯” (cycles, Skylake):</span>
<span class="cm">// smearæ–¹æ³•:  ~5 cycles (no LZCNT)</span>
<span class="cm">// nlzæ–¹æ³•:    ~3 cycles (with LZCNT)</span>
<span class="cm">// bit_floor:  ~2 cycles (ç¼–è¯‘å™¨ä¼˜åŒ–å)</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabFlp2==='asm'?'active':''">
      <div class="code-block">
<span class="cm">; x86-64: GCC -O2 flp2(x) â†’ (æœ‰LZCNTæ—¶)</span>
<span class="fn">lzcnt</span>   ecx, edi          <span class="cm">; ecx = å‰å¯¼é›¶æ•°</span>
<span class="fn">mov</span>     eax, 1
<span class="fn">shl</span>     eax, cl           <span class="cm">; eax = 2^(31-nlz) = flp2... ä¸å¯¹</span>
<span class="cm">; å®é™…: 0x80000000u >> clz(x)</span>
<span class="fn">lzcnt</span>   ecx, edi
<span class="fn">mov</span>     eax, 0x80000000
<span class="fn">shr</span>     eax, cl           <span class="cm">; âœ“ 2æ¡æŒ‡ä»¤</span>

<span class="cm">; x86-64: æ— LZCNTæ—¶ (æ—§CPU) ç”¨BSR</span>
<span class="fn">bsr</span>     ecx, edi          <span class="cm">; ecx = 31 - nlz(x)</span>
<span class="fn">mov</span>     eax, 1
<span class="fn">shl</span>     eax, cl           <span class="cm">; âœ“ 3æ¡æŒ‡ä»¤</span>

<span class="cm">; ARM64: CLZ + LSL</span>
<span class="fn">clz</span>     w1, w0            <span class="cm">; w1 = nlz(x)</span>
<span class="fn">mov</span>     w2, #0x80000000
<span class="fn">lsr</span>     w0, w2, w1        <span class="cm">; âœ“ 3æ¡æŒ‡ä»¤</span>

<span class="cm">; RISC-V: éœ€è¦è½¯ä»¶smearæˆ–æ‰©å±•(Zbb: CLZ)</span>
<span class="fn">clz</span>     a1, a0            <span class="cm">; (Zbbæ‰©å±•)</span>
<span class="fn">li</span>      a2, 0x80000000
<span class="fn">srl</span>     a0, a2, a1        <span class="cm">; âœ“</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§3-3 clp2 å‘ä¸Šå–æ•´ â•â•â• -->
<section id="clp2">
  <div class="sec-header">
    <span class="sec-num">Â§3-3</span>
    <span class="sec-title">clp2 â€” å‘ä¸Šå–æ•´åˆ°æœ€è¿‘2çš„å¹‚</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE CLASSIC TRICK</span>
    clp2 æ˜¯ flp2 çš„"é•œåƒ"ï¼šå…ˆæŠŠ x-1 çš„æœ€é«˜ä½1å‘å³ä¼ æ’­åˆ°æ‰€æœ‰ä½ä½å¾—åˆ°å…¨1æ©ç ï¼Œ
    ç„¶ååŠ 1è¿›ä½å¾—åˆ°ä¸‹ä¸€ä¸ª2çš„å¹‚ã€‚è¿™æ˜¯<strong>å“ˆå¸Œè¡¨ã€å†…å­˜åˆ†é…å™¨ã€SIMD ç¼“å†²åŒºåˆ†é…</strong>ä¸­
    å‡ºç°é¢‘ç‡æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚Linux å†…æ ¸çš„ <code style="color:var(--o);">roundup_pow_of_two()</code>ã€
    jemalloc çš„ size class è®¡ç®—ã€Go runtime çš„ growslice éƒ½ç”¨äº†è¿™ä¸ªæŠ€æœ¯ã€‚
  </div>

  <!-- äº¤äº’æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="clp2Demo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.9rem;">
      ğŸ”¬ clp2 äº¤äº’æ¼”ç¤º â€” è¾“å…¥ä»»æ„æ•°å€¼
    </div>
    <div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin-bottom:1rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">è¾“å…¥ x =</div>
        <input type="range" min="1" max="255" x-model.number="x" style="width:180px;accent-color:var(--b);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--b);margin-left:.5rem;font-size:.9rem;" x-text="x"></span>
      </div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;">
        <span style="color:#475569;">clp2(</span><span style="color:var(--b);" x-text="x"></span><span style="color:#475569;">) = </span>
        <span style="color:var(--g);font-size:1.15rem;" x-text="clp2Result"></span>
        <span style="color:#334155;font-size:.7rem;margin-left:.4rem;" x-text="clp2Result === x ? '(å·²æ˜¯2çš„å¹‚)' : ''"></span>
      </div>
    </div>
    <div style="display:grid;gap:.32rem;">
      <template x-for="(step,i) in clp2Steps" :key="i">
        <div class="nlz-step">
          <div style="min-width:180px;font-size:.67rem;color:#475569;" x-text="step.label"></div>
          <div class="nlz-bar">
            <template x-for="(b,j) in step.bits" :key="j">
              <div class="nlz-bit"
                   :class="b===2?'filled':b===1?'one':'zero'"
                   x-text="b===2?'1':b"></div>
            </template>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;margin-left:.5rem;color:#475569;" x-text="step.val"></div>
        </div>
      </template>
    </div>
  </div>

  <!-- ä»£ç  -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tabClp2='main'">æ ‡å‡†å®ç°</button>
      <button class="tab-btn" @click="tabClp2='fast'">å¿«é€Ÿç‰ˆæœ¬</button>
      <button class="tab-btn" @click="tabClp2='apps'">å®æˆ˜åº”ç”¨</button>
    </div>
    <div class="tab-pane" :class="tabClp2==='main'?'active':''">
      <div class="code-block">
<span class="cm">// clp2: å‘ä¸Šå–æ•´åˆ°æœ€è¿‘2çš„å¹‚ (Warren Â§3-3)</span>
<span class="cm">// æ€è·¯: (x-1) smearå¡«æ»¡ä½ä½ â†’ åŠ 1 â†’ è¿›ä½å¾—åˆ°2çš„å¹‚</span>
<span class="kw">unsigned</span> <span class="fn">clp2</span>(<span class="kw">unsigned</span> x) {
  x = x - <span class="num">1</span>;           <span class="cm">// å…³é”®: å…ˆå‡1ï¼Œé¿å…xæœ¬èº«æ˜¯2çš„å¹‚æ—¶å¤šè¿›ä¸€ä½</span>
  x = x | (x &gt;&gt; <span class="num">1</span>);
  x = x | (x &gt;&gt; <span class="num">2</span>);
  x = x | (x &gt;&gt; <span class="num">4</span>);
  x = x | (x &gt;&gt; <span class="num">8</span>);
  x = x | (x &gt;&gt; <span class="num">16</span>);   <span class="cm">// smear â†’ 0...0111...1</span>
  <span class="kw">return</span> x + <span class="num">1</span>;          <span class="cm">// +1 â†’ è¿›ä½å¾—åˆ°ä¸‹ä¸€ä¸ª2çš„å¹‚</span>
}
<span class="cm">// æ€»è®¡: 12æ¡æŒ‡ä»¤ (1Ã—SUB, 5Ã—OR, 5Ã—SHR, 1Ã—ADD)</span>
<span class="cm">// ç‰¹æ®Šå€¼: clp2(0)=0 âœ“  clp2(2Â³Â¹+1)=0 (æ¨¡2Â³Â²æº¢å‡º)</span>
<span class="warn">// âš  å¯¹ x > 2Â³Â¹ ç»“æœæº¢å‡ºä¸º 0 (Warren æ˜ç¡®å®šä¹‰å¦‚æ­¤)</span>

<span class="cm">// Linux kernel ç­‰ä»·å®ç°:</span>
<span class="kw">static inline</span> <span class="kw">unsigned long</span> <span class="fn">roundup_pow_of_two</span>(<span class="kw">unsigned long</span> n){
  <span class="kw">return</span> <span class="num">1UL</span> &lt;&lt; <span class="fn">fls_long</span>(n - <span class="num">1</span>);
  <span class="cm">// fls_long = "find last set" = 31 - nlz</span>
}
      </div>
    </div>
    <div class="tab-pane" :class="tabClp2==='fast'?'active':''">
      <div class="code-block">
<span class="cm">// å¿«é€Ÿç‰ˆæœ¬: ç”¨ nlz åªéœ€ 3 æ¡æŒ‡ä»¤</span>
<span class="kw">unsigned</span> <span class="fn">clp2_fast</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">if</span> (x &lt;= <span class="num">1</span>) <span class="kw">return</span> <span class="num">1</span>;
  <span class="kw">return</span> <span class="num">1u</span> &lt;&lt; (<span class="num">32</span> - __builtin_clz(x - <span class="num">1</span>));
  <span class="cm">// 32 - nlz(x-1) = âŒˆlogâ‚‚xâŒ‰</span>
}

<span class="cm">// C++20 std::bit_ceil:</span>
<span class="kw">return</span> std::bit_ceil(x);  <span class="cm">// &lt;bit&gt; å¤´æ–‡ä»¶</span>

<span class="cm">// Python ç­‰ä»· (ä½æ“ä½œç‰ˆ):</span>
<span class="cm">// def clp2(x): return 1 if x==0 else 1 << (x-1).bit_length()</span>

<span class="cm">// Go ç­‰ä»· (bits.Len):</span>
<span class="cm">// func clp2(x uint) uint { return 1 << bits.Len(x-1) }</span>

<span class="cm">// æ€§èƒ½ (Skylake, å«ç‰¹åˆ¤):</span>
<span class="cm">// smearæ–¹æ³•:  ~6 cycles</span>
<span class="cm">// nlzæ–¹æ³•:    ~4 cycles (LZCNT available)</span>
<span class="cm">// bit_ceil:   ~2 cycles (ç¼–è¯‘å™¨æœ€ä¼˜åŒ–)</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabClp2==='apps'?'active':''">
      <div class="code-block">
<span class="cm">// â˜… åº”ç”¨1: å“ˆå¸Œè¡¨å®¹é‡ (HashMap åˆå§‹åŒ–)</span>
<span class="cm">// ä¿è¯å®¹é‡æ€»æ˜¯2çš„å¹‚ï¼Œä½¿å¾— h % cap == h &amp; (cap-1)</span>
<span class="kw">int</span> cap = <span class="fn">clp2</span>(requested_size * <span class="num">4</span> / <span class="num">3</span>); <span class="cm">// 75%è´Ÿè½½å› å­</span>
<span class="kw">int</span> idx = hash(key) &amp; (cap - <span class="num">1</span>);       <span class="cm">// æ¯” % å¿«å¾ˆå¤š</span>

<span class="cm">// â˜… åº”ç”¨2: Buddy Allocator (Linux å†…å­˜ç³»ç»Ÿ)</span>
<span class="kw">int</span> order = <span class="fn">ilog2</span>(<span class="fn">clp2</span>(size));         <span class="cm">// æ‰¾åˆ°éœ€è¦çš„é˜¶æ•°</span>
page_block = <span class="fn">alloc_pages</span>(GFP_KERNEL, order);

<span class="cm">// â˜… åº”ç”¨3: SIMD ç¼“å†²åŒºå¯¹é½åˆ†é…</span>
<span class="cm">// AVX-512éœ€è¦64å­—èŠ‚å¯¹é½ï¼Œç¡®ä¿å¤§å°ä¹Ÿæ˜¯64çš„å€æ•°</span>
<span class="kw">size_t</span> aligned_size = <span class="fn">clp2</span>(size);
<span class="kw">void</span>* buf = aligned_alloc(<span class="num">64</span>, aligned_size);

<span class="cm">// â˜… åº”ç”¨4: Go runtime slice æ‰©å®¹ (growslice)</span>
<span class="cm">// å½“ cap < 256 æ—¶ï¼Œç›´æ¥ clp2(cap)</span>
<span class="cm">// è¿™æ˜¯Go slice appendæ€§èƒ½çš„æ ¸å¿ƒ</span>

<span class="cm">// â˜… åº”ç”¨5: GPUçº¹ç†å°ºå¯¸ (OpenGL/Vulkan)</span>
<span class="cm">// ä¼ ç»ŸGPUè¦æ±‚çº¹ç†å®½é«˜å¿…é¡»æ˜¯2çš„å¹‚ (MipMapéœ€è¦)</span>
<span class="kw">int</span> tex_w = <span class="fn">clp2</span>(img_w), tex_h = <span class="fn">clp2</span>(img_h);
      </div>
    </div>
  </div>

  <!-- ECharts: flp2 vs clp2 å¯¹æ¯”å›¾ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
      ğŸ“Š flp2(x) vs clp2(x) vs x å‡½æ•°å›¾ (x âˆˆ [0, 128])
    </div>
    <div id="chart-pow2" style="width:100%;height:280px;"></div>
  </div>
</section>

<!-- â•â•â• Â§3 å¯¹é½æ“ä½œ â•â•â• -->
<section id="align">
  <div class="sec-header">
    <span class="sec-num">Â§3-4</span>
    <span class="sec-title">å¯¹é½æ“ä½œ â€” Alignment to Powers of 2</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// ALIGNMENT IS EVERYWHERE</span>
    å†…å­˜å¯¹é½åˆ°2çš„å¹‚æ¬¡æ˜¯ç³»ç»Ÿç¼–ç¨‹ä¸­æœ€é«˜é¢‘çš„æ“ä½œä¹‹ä¸€ï¼š
    struct å¯¹é½ã€DMA ç¼“å†²åŒºã€SIMD æ•°ç»„ã€ç¼“å­˜è¡Œã€é¡µè¡¨é¡¹â€¦â€¦å…¨éƒ¨éƒ½è¦å¯¹é½åˆ°æŸä¸ª2çš„å¹‚ã€‚
    æ ¸å¿ƒå…¬å¼åªæœ‰ä¸¤ä¸ªï¼š<strong>å‘ä¸‹å¯¹é½</strong> = <code style="color:var(--o);">x & ~(a-1)</code>ï¼Œ
    <strong>å‘ä¸Šå¯¹é½</strong> = <code style="color:var(--o);">(x + a-1) & ~(a-1)</code>ã€‚
    ç†è§£è¿™ä¸¤ä¸ªå…¬å¼ï¼Œå°±ç†è§£äº† C ç¼–è¯‘å™¨é‡Œ 99% çš„å¯¹é½ä»£ç ã€‚
  </div>

  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">å‘ä¸‹å¯¹é½ (Floor Align)</div>
      <div class="code-block" style="font-size:.76rem;">
<span class="cm">// å‘ä¸‹å¯¹é½åˆ° a çš„å€æ•° (aå¿…é¡»æ˜¯2çš„å¹‚)</span>
<span class="cm">// align_down(x, a) = a * âŒŠx/aâŒ‹</span>
<span class="kw">unsigned</span> <span class="fn">align_down</span>(<span class="kw">unsigned</span> x, <span class="kw">unsigned</span> a) {
  <span class="kw">return</span> x &amp; ~(a - <span class="num">1</span>); <span class="cm">// æ¸…é™¤ä½ logâ‚‚(a) ä½</span>
}
<span class="cm">// ç­‰ä»·: x - (x % a)  ä½†ä¸Šé¢æ›´å¿«</span>

<span class="cm">// ç¤ºä¾‹:</span>
align_down(<span class="num">0x1007</span>, <span class="num">16</span>) <span class="cm">// = 0x1000</span>
align_down(<span class="num">0x1000</span>, <span class="num">16</span>) <span class="cm">// = 0x1000 (å·²å¯¹é½)</span>
align_down(<span class="num">0x1FFF</span>, <span class="num">4096</span>) <span class="cm">// = 0x1000 (é¡µå¯¹é½)</span>

<span class="cm">// C11 å®å†™æ³• (GCCæ‰©å±• __typeof__):</span>
<span class="num">#define</span> <span class="fn">ALIGN_DOWN</span>(x, a) \
  ((x) &amp; ~((__typeof__(x))(a) - <span class="num">1</span>))
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">å‘ä¸Šå¯¹é½ (Ceiling Align)</div>
      <div class="code-block" style="font-size:.76rem;">
<span class="cm">// å‘ä¸Šå¯¹é½åˆ° a çš„å€æ•° (aå¿…é¡»æ˜¯2çš„å¹‚)</span>
<span class="cm">// align_up(x, a) = a * âŒˆx/aâŒ‰</span>
<span class="kw">unsigned</span> <span class="fn">align_up</span>(<span class="kw">unsigned</span> x, <span class="kw">unsigned</span> a) {
  <span class="kw">return</span> (x + a - <span class="num">1</span>) &amp; ~(a - <span class="num">1</span>);
  <span class="cm">// = (x + a-1) æ¸…é™¤ä½ä½</span>
}
<span class="cm">// ç­‰ä»·: (x + a-1) / a * a (ä½†æœ‰æº¢å‡ºé£é™©)</span>

<span class="cm">// ç¤ºä¾‹:</span>
align_up(<span class="num">0x1007</span>, <span class="num">16</span>)  <span class="cm">// = 0x1010</span>
align_up(<span class="num">0x1000</span>, <span class="num">16</span>)  <span class="cm">// = 0x1000 (å·²å¯¹é½)</span>
align_up(<span class="num">5</span>, <span class="num">8</span>)        <span class="cm">// = 8</span>

<span class="cm">// Linux å†…æ ¸æ ‡å‡†å®:</span>
<span class="num">#define</span> <span class="fn">ALIGN</span>(x, a)  \
  (((x) + (a) - <span class="num">1</span>) &amp; ~((a) - <span class="num">1</span>))
<span class="cm">// arch/x86/include/asm/page.h ç­‰å¤„ä½¿ç”¨</span>
      </div>
    </div>
  </div>

  <!-- å¯¹é½å¯è§†åŒ– -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="alignDemo()">
    <div style="
    font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.9rem;">
      ğŸ® å¯¹é½æ“ä½œäº¤äº’æ¼”ç¤º
    </div>
    <div style="display:flex;gap:1.2rem;flex-wrap:wrap;align-items:center;margin-bottom:1rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">åœ°å€ x =</div>
        <input type="range" min="0" max="255" x-model.number="addr" style="width:160px;accent-color:var(--o);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--o);margin-left:.5rem;" x-text="'0x'+addr.toString(16).toUpperCase().padStart(4,'0')"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">å¯¹é½ç²’åº¦ a =</div>
        <select x-model.number="align" style="background:#010409;border:1px solid #1e293b;color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:.3rem .5rem;border-radius:4px;">
          <option value="1">1 (æ— å¯¹é½)</option>
          <option value="2">2 (halfword)</option>
          <option value="4">4 (word)</option>
          <option value="8">8 (doubleword)</option>
          <option value="16">16 (SSE/NEON)</option>
          <option value="32">32 (AVX)</option>
          <option value="64">64 (cacheline/AVX-512)</option>
          <option value="4096">4096 (page)</option>
        </select>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:.6rem;">
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.7rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">x & ~(a-1) å‘ä¸‹å¯¹é½</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.92rem;color:var(--g);" x-text="'0x'+(addr & ~(align-1)).toString(16).toUpperCase().padStart(4,'0')"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#334155;margin-top:.2rem;" x-text="'= '+(addr & ~(align-1))"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.7rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">(x+a-1) & ~(a-1) å‘ä¸Šå¯¹é½</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.92rem;color:var(--b);" x-text="'0x'+((addr+align-1) & ~(align-1)).toString(16).toUpperCase().padStart(4,'0')"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#334155;margin-top:.2rem;" x-text="'= '+((addr+align-1) & ~(align-1))"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.7rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">x % a åç§»é‡ï¼ˆæµªè´¹å­—èŠ‚ï¼‰</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.92rem;color:var(--o);" x-text="addr & (align-1)"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#334155;margin-top:.2rem;" x-text="(addr & (align-1)) === 0 ? 'âœ“ å·²å¯¹é½' : 'éœ€è¦å¡«å……'"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.7rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.25rem;">å¡«å……å­—èŠ‚æ•°ï¼ˆpaddingï¼‰</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.92rem;color:var(--p);" x-text="(align - (addr & (align-1))) & (align-1)"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#334155;margin-top:.2rem;">bytes to next aligned addr</div>
      </div>
    </div>
  </div>

  <!-- å¯¹é½å®æˆ˜åœºæ™¯ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">å®æˆ˜åœºæ™¯ï¼šå„å¯¹é½ç²’åº¦çš„å·¥ä¸šç”¨é€”</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:.65rem;">
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--g);margin-bottom:.3rem;">align = 4 (32-bit word)</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">C struct é»˜è®¤å¯¹é½ã€‚ARM Cortex-M ç¡¬ä»¶è¦æ±‚ 32 ä½è®¿é—®å¿…é¡» 4 å­—èŠ‚å¯¹é½ï¼Œå¦åˆ™ HardFaultã€‚malloc() è¿”å›çš„æŒ‡é’ˆè‡³å°‘ 4 å­—èŠ‚å¯¹é½ã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--b);margin-bottom:.3rem;">align = 16 (SSE/NEON)</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">SSE2 çš„ _mm_load_si128 è¦æ±‚ 16 å­—èŠ‚å¯¹é½ï¼ˆ_mm_loadu ä¸è¦æ±‚ä½†æ…¢ ~2xï¼‰ã€‚posix_memalign(p,16,n) ä¿è¯æ­¤å¯¹é½ã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--o);margin-bottom:.3rem;">align = 64 (AVX-512/cacheline)</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">Intel x86 cacheline = 64 å­—èŠ‚ã€‚AVX-512 zmm å¯„å­˜å™¨ 512-bit éœ€è¦ 64 å­—èŠ‚å¯¹é½ã€‚jemalloc/tcmalloc å°å†…å­˜å—ä»¥ 64 å­—èŠ‚å¯¹é½åˆ†é…ã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--p);margin-bottom:.3rem;">align = 4096 (page)</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">mmap() è¿”å›é¡µå¯¹é½åœ°å€ã€‚DMA ç¼“å†²åŒºå¿…é¡»é¡µå¯¹é½ï¼ˆO_DIRECT I/Oï¼‰ã€‚Huge Page éœ€è¦ 2MB/1GB å¯¹é½ã€‚Linux vm_area_struct åŸºäºé¡µç²’åº¦ç®¡ç†ã€‚</div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§3 nlz å‰å¯¼é›¶è®¡æ•° â•â•â• -->
<section id="nlz">
  <div class="sec-header">
    <span class="sec-num">Â§3-5</span>
    <span class="sec-title">nlz â€” å‰å¯¼é›¶è®¡æ•°ä¸ ilog2</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// WHY nlz IS THE KEY PRIMITIVE</span>
    <strong>nlz(x) = å‰å¯¼é›¶çš„ä¸ªæ•°</strong>ï¼ˆNumber of Leading Zerosï¼‰ï¼Œç­‰ä»·äº <code style="color:var(--o);">31 - âŒŠlogâ‚‚xâŒ‹</code>ã€‚
    å®ƒæ˜¯ flp2ã€clp2ã€æ•´æ•°å¯¹æ•°ã€æ¯”è¾ƒè°“è¯çš„<strong>ç»Ÿä¸€å…¥å£</strong>ã€‚
    Warren ç”¨æ•´æ•´ä¸€èŠ‚æ¥è®¨è®ºå®ƒï¼Œå› ä¸ºåœ¨æ²¡æœ‰ CLZ/LZCNT ç¡¬ä»¶æŒ‡ä»¤çš„å¹´ä»£ï¼ˆ2002å¹´å‰çš„å¤§å¤šæ•° RISCï¼‰ï¼Œ
    ç”¨è½¯ä»¶å®ç° nlz æ˜¯æ•´ä¸ªç¬¬3ç« çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚
    ç†è§£è¿™äº›è½¯ä»¶å®ç°æ–¹å¼ï¼Œå°±ç†è§£äº†ä¸ºä»€ä¹ˆ BMI1 æŒ‡ä»¤é›†åœ¨2013å¹´å‡ºç°åä¼šè®©å¦‚æ­¤å¤šçš„ä»£ç å˜çŸ­ã€‚
  </div>

  <!-- nlz è½¯ä»¶å®ç°å¯è§†åŒ– -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="nlzDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.9rem;">
      ğŸ”¬ nlz äºŒåˆ†æœç´¢æ³•å¯è§†åŒ– â€” æ‹–åŠ¨æ»‘å—
    </div>
    <div style="display:flex;gap:1rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">è¾“å…¥ x =</div>
        <input type="range" min="1" max="65535" x-model.number="x" style="width:200px;accent-color:var(--g);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--g);margin-left:.5rem;" x-text="x"></span>
        <span style="font-family:'JetBrains Mono',monospace;color:#334155;font-size:.72rem;margin-left:.3rem;" x-text="'= 0x'+x.toString(16).toUpperCase()"></span>
      </div>
    </div>

    <!-- 32ä½ä½å›¾ -->
    <div style="margin-bottom:.75rem;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.3rem;">32ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼ˆé«˜ä½åœ¨å·¦ï¼‰:</div>
      <div class="nlz-bar">
        <template x-for="(b,i) in x32bits" :key="i">
          <div class="nlz-bit" :class="i < nlzCount ? 'zero' : (i === nlzCount ? 'one' : (b ? 'one' : 'zero'))" x-text="b"></div>
        </template>
      </div>
    </div>

    <!-- ç»“æœ -->
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.5rem;margin-bottom:.75rem;">
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.35rem;padding:.6rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.2rem;">nlz(x)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--g);" x-text="nlzCount"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.35rem;padding:.6rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.2rem;">âŒŠlogâ‚‚xâŒ‹</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--b);" x-text="31 - nlzCount"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.35rem;padding:.6rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.2rem;">flp2(x)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--o);" x-text="1 << (31 - nlzCount)"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.35rem;padding:.6rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#475569;margin-bottom:.2rem;">clp2(x)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--p);" x-text="x > 1 ? (1 << (32 - Math.clz32(x - 1))) : 1"></div>
      </div>
    </div>

    <!-- äºŒåˆ†æœç´¢æ­¥éª¤ -->
    <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#475569;margin-bottom:.3rem;">äºŒåˆ†æœç´¢æ³•æ±‚ nlz çš„æ¯æ­¥åˆ¤æ–­:</div>
    <div style="display:grid;gap:.25rem;">
      <template x-for="step in binarySearchSteps" :key="step.label">
        <div style="display:flex;align-items:center;gap:.5rem;font-family:'JetBrains Mono',monospace;font-size:.72rem;">
          <div style="min-width:220px;color:#475569;" x-text="step.label"></div>
          <div :style="{color: step.hit ? 'var(--g)' : '#334155'}" x-text="step.hit ? 'âœ“ æ— 16ä¸ªå‰å¯¼é›¶' : 'âœ— è·³è¿‡16ä½'"></div>
        </div>
      </template>
    </div>
  </div>

  <!-- nlz 4ç§å®ç°æ–¹æ³• -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tabNlz='binary'">äºŒåˆ†æœç´¢æ³•</button>
      <button class="tab-btn" @click="tabNlz='float'">æµ®ç‚¹æ³•</button>
      <button class="tab-btn" @click="tabNlz='lookup'">æŸ¥è¡¨æ³•</button>
      <button class="tab-btn" @click="tabNlz='hw'">ç¡¬ä»¶æŒ‡ä»¤</button>
    </div>
    <div class="tab-pane" :class="tabNlz==='binary'?'active':''">
      <div class="code-block">
<span class="cm">// æ–¹æ³•1: äºŒåˆ†æœç´¢æ³• (Warren Â§5-3, ç”¨äºæ— CLZæŒ‡ä»¤çš„å¹³å°)</span>
<span class="cm">// æ€»è®¡çº¦ ~20 æ¡åŸºç¡€RISCæŒ‡ä»¤ï¼Œæ— é™¤æ³•æ— å¾ªç¯</span>
<span class="kw">int</span> <span class="fn">nlz</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">int</span> n = <span class="num">0</span>;
  <span class="kw">if</span> (x == <span class="num">0</span>) <span class="kw">return</span> <span class="num">32</span>;
  <span class="kw">if</span> (x &lt;= <span class="num">0x0000FFFF</span>) { n += <span class="num">16</span>; x &lt;&lt;= <span class="num">16</span>; } <span class="cm">// é«˜16ä½å…¨0?</span>
  <span class="kw">if</span> (x &lt;= <span class="num">0x00FFFFFF</span>) { n +=  <span class="num">8</span>; x &lt;&lt;=  <span class="num">8</span>; } <span class="cm">// é«˜8ä½å…¨0?</span>
  <span class="kw">if</span> (x &lt;= <span class="num">0x0FFFFFFF</span>) { n +=  <span class="num">4</span>; x &lt;&lt;=  <span class="num">4</span>; } <span class="cm">// é«˜4ä½å…¨0?</span>
  <span class="kw">if</span> (x &lt;= <span class="num">0x3FFFFFFF</span>) { n +=  <span class="num">2</span>; x &lt;&lt;=  <span class="num">2</span>; } <span class="cm">// é«˜2ä½å…¨0?</span>
  <span class="kw">if</span> (x &lt;= <span class="num">0x7FFFFFFF</span>) { n +=  <span class="num">1</span>; }            <span class="cm">// é«˜1ä½å…¨0?</span>
  <span class="kw">return</span> n;
}
<span class="cm">// æ³¨: ä¹Ÿå¯å®Œå…¨æ— åˆ†æ”¯ (ç”¨å‡æ³•+ç®—æœ¯å³ç§»æ©ç ä»£æ›¿if)</span>
<span class="cm">// åˆ†æ”¯ç‰ˆæœ¬åœ¨é¢„æµ‹å‡†ç¡®æ—¶æ›´å¿«; æ— åˆ†æ”¯ç‰ˆæœ¬åœ¨SIMDä¸­æ›´å¥½</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabNlz==='float'?'active':''">
      <div class="code-block">
<span class="cm">// æ–¹æ³•2: åˆ©ç”¨ IEEE 754 æµ®ç‚¹æ ¼å¼æå–æŒ‡æ•° (GCCæ‰©å±•æŠ€å·§)</span>
<span class="cm">// åŸç†: float(x) çš„æŒ‡æ•°å­—æ®µç›´æ¥å°±æ˜¯ âŒŠlogâ‚‚xâŒ‹ + 127</span>
<span class="cm">// âš ï¸ ä¸¥æ ¼æ¥è¯´æ˜¯ UB (type punning), ä½†å‡ ä¹æ‰€æœ‰ç¼–è¯‘å™¨éƒ½æ”¯æŒ</span>
<span class="kw">int</span> <span class="fn">nlz_float</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">union</span> { <span class="kw">unsigned</span> u; <span class="kw">float</span> f; } t;
  t.f = (<span class="kw">float</span>)x;
  <span class="kw">return</span> <span class="num">158</span> - (t.u &gt;&gt; <span class="num">23</span>);
  <span class="cm">// 158 = 127(åç½®) + 31(ä½å®½-1)</span>
  <span class="cm">// t.u >> 23: æå–8ä½æŒ‡æ•°å­—æ®µ</span>
}
<span class="cm">// x=0 æ—¶è¿”å› 159-127=32 âœ“ (æµ®ç‚¹0çš„æŒ‡æ•°=0)</span>
<span class="cm">// é€Ÿåº¦: ä¾èµ–æ•´æ•°â†”æµ®ç‚¹è·¯å¾„å»¶è¿Ÿ (~4-6 cycles on Skylake)</span>
<span class="cm">// ç²¾åº¦: å½“ x è¶…è¿‡ float å°¾æ•°ç²¾åº¦(2^24)æ—¶å¯èƒ½ä¸å‡†ï¼</span>
<span class="cm">// â†’ Warren æ˜ç¡®è­¦å‘Š: ä»…å¯¹ x < 2^24 å¯é </span>

<span class="cm">// å®‰å…¨çš„ C99 ç‰ˆæœ¬ (memcpy ä¸æ˜¯UB):</span>
<span class="kw">int</span> <span class="fn">nlz_safe</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">float</span> fx = (<span class="kw">float</span>)x;
  <span class="kw">unsigned</span> u;
  memcpy(&amp;u, &amp;fx, <span class="kw">sizeof</span>(u));
  <span class="kw">return</span> <span class="num">158</span> - (u &gt;&gt; <span class="num">23</span>);
}
      </div>
    </div>
    <div class="tab-pane" :class="tabNlz==='lookup'?'active':''">
      <div class="code-block">
<span class="cm">// æ–¹æ³•3: 256é¡¹æŸ¥è¡¨æ³• (ç”¨ç©ºé—´æ¢æ—¶é—´)</span>
<span class="cm">// æŠŠ32ä½åˆ†æˆ4ä¸ªå­—èŠ‚ï¼Œæ¯å­—èŠ‚æŸ¥è¡¨å¾—åˆ°å‰å¯¼é›¶æ•°</span>
<span class="kw">static const</span> <span class="kw">char</span> nlz8[256] = {
  8,7,6,6,5,5,5,5, 4,4,4,4,4,4,4,4,
  3,3,3,3,3,3,3,3, 3,3,3,3,3,3,3,3,
  2,2,2,2,2,2,2,2, 2,2,2,2,2,2,2,2,
  2,2,2,2,2,2,2,2, 2,2,2,2,2,2,2,2,
  <span class="cm">/* ... å‰©ä½™192é¡¹å‡ä¸º1æˆ–0 ... */</span>
};
<span class="kw">int</span> <span class="fn">nlz_table</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">if</span> (x &gt;&gt; 24)       <span class="kw">return</span> nlz8[x &gt;&gt; 24];
  <span class="kw">if</span> (x &gt;&gt; 16)       <span class="kw">return</span> nlz8[x &gt;&gt; 16] + 8;
  <span class="kw">if</span> (x &gt;&gt; 8)        <span class="kw">return</span> nlz8[x &gt;&gt;  8] + 16;
  <span class="kw">return</span> nlz8[x] + 24;
}
<span class="cm">// ä¼˜ç‚¹: 4æ¬¡æ¯”è¾ƒ+1æ¬¡æŸ¥è¡¨+åŠ æ³•ï¼Œçº¦5æ¡æŒ‡ä»¤</span>
<span class="cm">// ç¼ºç‚¹: 256å­—èŠ‚æŸ¥è¡¨æ±¡æŸ“L1 cache (ç‰¹åˆ«æ˜¯åœ¨çƒ­å¾ªç¯ä¸­)</span>
<span class="cm">// é€‚åˆ: ä»£ç å¯†åº¦æ•æ„Ÿã€L1 cache å‹åŠ›å°çš„åœºæ™¯</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabNlz==='hw'?'active':''">
      <div class="code-block">
<span class="cm">// æ–¹æ³•4: ç›´æ¥ä½¿ç”¨ç¡¬ä»¶æŒ‡ä»¤ (ç°ä»£å¹³å°æœ€ä¼˜è§£)</span>

<span class="cm">// GCC/Clang å†…å»º (æœ€æ¨è, ç¼–è¯‘å™¨é€‰æœ€ä¼˜æŒ‡ä»¤):</span>
<span class="kw">int</span> nlz = __builtin_clz(x);   <span class="cm">// x â‰  0</span>
<span class="cm">// x=0 æ—¶è¡Œä¸ºæœªå®šä¹‰! éœ€æ‰‹åŠ¨å¤„ç†</span>
<span class="kw">int</span> nlz_safe = x ? __builtin_clz(x) : 32;

<span class="cm">// C++20 æ ‡å‡†åº“ &lt;bit&gt; (æœ€å¯ç§»æ¤):</span>
<span class="kw">int</span> nlz = std::countl_zero(x);  <span class="cm">// x=0 æ—¶è¿”å›32 âœ“</span>

<span class="cm">// x86-64 æ±‡ç¼– (ä¸¤ç§æŒ‡ä»¤):</span>
<span class="cm">// BSR (Bit Scan Reverse): ç»“æœ = 31-nlz, x=0æ—¶ZF=1ç»“æœä¸å®š</span>
<span class="fn">bsr</span>   eax, edi        <span class="cm">; eax = 31 - nlz(x)</span>
<span class="fn">xor</span>   eax, 31         <span class="cm">; eax = nlz(x)</span>

<span class="cm">// LZCNT (BMI1, 2013+): x=0æ—¶è¿”å›32 âœ“ æ›´å®‰å…¨</span>
<span class="fn">lzcnt</span> eax, edi        <span class="cm">; eax = nlz(x), 1 cycle latency</span>

<span class="cm">// ARM64: CLZ (å•æŒ‡ä»¤, 1-3 cycles)</span>
<span class="fn">clz</span>   w0, w0          <span class="cm">; âœ“ x=0æ—¶è¿”å›32</span>

<span class="cm">// RISC-V Zbb æ‰©å±•:</span>
<span class="fn">clz</span>   a0, a0          <span class="cm">; Zbb å¿…éœ€æ‰©å±•</span>

<span class="cm">// å†å²: åœ¨2013å¹´BMI1ä¹‹å‰, x86å”¯ä¸€çš„è¿‘ä¼¼æ˜¯BSR (ä¸å®‰å…¨)</span>
<span class="cm">// è¿™å°±æ˜¯ä¸ºä»€ä¹ˆWarrenè¦èŠ±æ•´èŠ‚è®²è½¯ä»¶å®ç°</span>
      </div>
    </div>
  </div>

  <!-- ECharts: nlz æ–¹æ³•æ€§èƒ½å¯¹æ¯” -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
      ğŸ“Š nlz å„å®ç°æ–¹æ³•ç»¼åˆè¯„åˆ†ï¼ˆSkylake, x86-64ï¼‰
    </div>
    <div id="chart-nlz" style="width:100%;height:260px;"></div>
  </div>
</section>

<!-- â•â•â• å†å²æ¼”å˜ â•â•â• -->
<section id="history">
  <div class="sec-header">
    <span class="sec-num">Â§HIST</span>
    <span class="sec-title">å†å²æ¼”å˜ â€” ä¸ºä»€ä¹ˆè¿™äº›æŠ€æœ¯ä»¥è¿™ç§æ–¹å¼å‡ºç°</span>
    <div class="sec-divider"></div>
  </div>

  <div class="grid-2">
    <div class="timeline">
      <div class="tl-item">
        <div class="tl-dot"></div>
        <div class="tl-year">1960å¹´ä»£ â€” IBM System/360</div>
        <div class="tl-title">ç¡¬ä»¶å¯¹é½å¼ºåˆ¶çº¦æŸå‚¬ç”Ÿè½¯ä»¶æŠ€å·§</div>
        <div class="tl-desc">
          S/360 çš„å†…å­˜è®¿é—®è¦æ±‚ halfword åœ¨2çš„å€æ•°åœ°å€ã€word åœ¨4çš„å€æ•°åœ°å€ï¼Œ
          å¦åˆ™è§¦å‘ Alignment Exceptionï¼ˆ0x06 ä¸­æ–­ï¼‰ã€‚
          è¿™æ˜¯"å‘ä¸Šå¯¹é½"å…¬å¼ <code style="color:var(--o);">(x+a-1)&~(a-1)</code>
          è¿›å…¥å·¥ä¸šä»£ç åº“çš„ç›´æ¥åŸå› â€”â€”ç¨‹åºå‘˜å¿…é¡»æ‰‹åŠ¨è®¡ç®—å¯¹é½åç§»ã€‚
          Warren åœ¨ IBM å·¥ä½œäº†æ•°åå¹´ï¼Œè¿™ä¸ªèƒŒæ™¯æ˜¯ä»–å¯¹å¯¹é½å¦‚æ­¤é‡è§†çš„æ ¹æºã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--b);box-shadow:0 0 8px var(--b);"></div>
        <div class="tl-year">1986 â€” RISC æµªæ½® & Power æ¶æ„</div>
        <div class="tl-title">æ²¡æœ‰ CLZ æŒ‡ä»¤ï¼Œè½¯ä»¶ nlz æˆä¸ºå¿…éœ€</div>
        <div class="tl-desc">
          RISC è®¾è®¡å“²å­¦è¿½æ±‚æŒ‡ä»¤é›†ç²¾ç®€ï¼ŒCLZï¼ˆCount Leading Zerosï¼‰è¢«è®¤ä¸ºæ˜¯"ä¸å¤Ÿé€šç”¨"çš„æ“ä½œï¼Œ
          å¤§å¤šæ•°æ—©æœŸ RISC ISAï¼ˆMIPS R2000ã€SPARC V7ï¼‰éƒ½æ²¡æœ‰å®ƒã€‚
          IBM POWER æ¶æ„çš„ <code style="color:var(--o);">cntlz</code> æŒ‡ä»¤æ˜¯å°‘æ•°ä¾‹å¤–ä¹‹ä¸€ï¼ˆ1990å¹´ï¼‰ã€‚
          Warren ä¹¦ä¸­çš„äºŒåˆ†æœç´¢æ³• nlz æ­£æ˜¯ä¸ºè¿™ä¸ªæ—¶ä»£å†™çš„â€”â€”åœ¨å½“æ—¶æ˜¯çœŸå®çš„å·¥ç¨‹éœ€æ±‚ï¼Œä¸æ˜¯å­¦æœ¯ç©å…·ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--p);box-shadow:0 0 8px var(--p);"></div>
        <div class="tl-year">1999 â€” MIPS32 / ARMv5</div>
        <div class="tl-title">CLZ æŒ‡ä»¤æ™®åŠåˆ°ä¸»æµ RISC</div>
        <div class="tl-desc">
          MIPS32/64 ISA åŠ å…¥ CLZ/CLO æŒ‡ä»¤ï¼ˆCount Leading Zeros/Onesï¼‰ï¼Œ
          ARMv5T åŠ å…¥ CLZ æŒ‡ä»¤ï¼ˆç”¨äºæ”¯æŒ TCP æ ¡éªŒå’ŒåŠ é€Ÿï¼‰ã€‚
          è‡³æ­¤ï¼Œä¸»æµåµŒå…¥å¼å’ŒæœåŠ¡å™¨ RISC éƒ½æœ‰äº†ç¡¬ä»¶ nlzã€‚
          ä½† x86 åœ¨ 2002 å¹´ï¼ˆPentium 4 æ—¶ä»£ï¼‰æ‰é€šè¿‡ BSR è¿‘ä¼¼æ”¯æŒï¼Œ
          çœŸæ­£çš„ LZCNT è¦ç­‰åˆ° 2013 å¹´ Haswell çš„ BMI1ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--o);box-shadow:0 0 8px var(--o);"></div>
        <div class="tl-year">2002 â€” ã€ŠHacker's Delightã€‹ç¬¬1ç‰ˆ</div>
        <div class="tl-title">Warren æŠŠ"æœ€è¿‘çš„2çš„å¹‚"ç³»ç»ŸåŒ–</div>
        <div class="tl-desc">
          ç¬¬1ç‰ˆå‡ºç‰ˆæ—¶ï¼ŒLinux å†…æ ¸çš„ <code style="color:var(--o);">roundup_pow_of_two()</code>
          å·²ç»å­˜åœ¨ä½†å®ç°å„æœ‰å·®å¼‚ã€‚Warren ç¬¬3ç« æŠŠ flp2/clp2 ä½œä¸ºæ­£å¼çš„æ•°å­¦å‡½æ•°å®šä¹‰ï¼Œ
          å¹¶ç»™å‡ºäº†å¤šç§å®ç°çš„æƒè¡¡åˆ†æã€‚è¿™ç§ç³»ç»ŸåŒ–çš„å¤„ç†æ–¹å¼æ·±åˆ»å½±å“äº†åæ¥
          GCC 4.x ä¸­ <code>__builtin_clz</code> çš„æ¨å¹¿å’Œä½¿ç”¨æ¨¡å¼ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--r);box-shadow:0 0 8px var(--r);"></div>
        <div class="tl-year">2013 â€” Intel BMI1 + C++20 &lt;bit&gt;</div>
        <div class="tl-title">è½¯ä»¶æŠ€å·§æˆä¸ºæ ‡å‡†åº“ï¼Œç¡¬ä»¶æ”¯æŒå®Œå¤‡</div>
        <div class="tl-desc">
          BMI1 çš„ LZCNT æŒ‡ä»¤è®© nlz åœ¨ x86 ä¸Šä¹Ÿå˜æˆå•æŒ‡ä»¤ã€‚
          C++20 æ ‡å‡†åº“ <code style="color:var(--o);">&lt;bit&gt;</code> å¤´æ–‡ä»¶å¼•å…¥
          <code>std::bit_floor</code>ï¼ˆå³ flp2ï¼‰ã€<code>std::bit_ceil</code>ï¼ˆå³ clp2ï¼‰ã€
          <code>std::countl_zero</code>ï¼ˆå³ nlzï¼‰â€”â€”æŠŠç¬¬3ç« æ‰€æœ‰æ ¸å¿ƒå‡½æ•°å˜æˆæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚
          Warren çš„ç¬¬3ç« å¯ä»¥è§†ä¸º C++ æ ‡å‡†å§”å‘˜ä¼šåœ¨2020å¹´"è®¤å¯"çš„å†å²é—äº§ã€‚
        </div>
      </div>
    </div>

    <div>
      <!-- ECharts: å„å¹³å° clp2 æŒ‡ä»¤æ•°æ¼”å˜ -->
      <div class="card" style="margin-bottom:1.2rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
          ğŸ“Š clp2(x) åœ¨å„å¹³å°çš„æŒ‡ä»¤æ•°æ¼”å˜
        </div>
        <div id="chart-evo" style="width:100%;height:220px;"></div>
      </div>

      <!-- ECharts: 2çš„å¹‚è¾¹ç•Œå‡½æ•°åº”ç”¨é¢†åŸŸåˆ†å¸ƒ -->
      <div class="card">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.5rem;">
          ğŸ“Š flp2/clp2 çš„å·¥ä¸šåº”ç”¨é¢†åŸŸåˆ†å¸ƒ
        </div>
        <div id="chart-domain" style="width:100%;height:240px;"></div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• æ·±åº¦ç‚¹è¯„ â•â•â• -->
<section id="critique">
  <div class="sec-header">
    <span class="sec-num">Â§CRITIQUE</span>
    <span class="sec-title">æ·±åº¦ç‚¹è¯„ â€” æŠ€æœ¯å“²å­¦ä¸æ‰¹åˆ¤æ€§åˆ†æ</span>
    <div class="sec-divider"></div>
  </div>

  <div class="critic-box">
    <h3>ç¬¬3ç« çš„æœ¬è´¨ï¼šæŠŠ"æ‰¾æœ€è¿‘çš„2çš„å¹‚"å˜æˆä¸€ç§æ€ç»´ä¹ æƒ¯</h3>

    <div class="critic-item">
      <div class="ci-title">ä¸ºä»€ä¹ˆé€‰æ‹©"smearåå‡åŠ"è€Œä¸æ˜¯ç›´æ¥ç”¨ logâ‚‚ï¼Ÿ</div>
      <p>
        è¿™ä¸ªé—®é¢˜è§¦åŠäº†æ•´æœ¬ä¹¦çš„æ ¸å¿ƒå“²å­¦ã€‚åœ¨æ•´æ•°è®¡ç®—ä¸­ï¼Œ<code style="color:var(--o);">logâ‚‚</code>
        æ˜¯æµ®ç‚¹æ“ä½œï¼Œæœ‰ç²¾åº¦æŸå¤±ï¼ˆWarren Â§5-3çš„æµ®ç‚¹æ³•å°±è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼Œå¤§æ•°ä¸å‡†ï¼‰ã€‚
        Smear æ–¹æ³•å®Œå…¨åœ¨æ•´æ•°åŸŸå†…ï¼Œæ²¡æœ‰èˆå…¥ï¼Œæ²¡æœ‰æµ®ç‚¹å•å…ƒä¾èµ–ï¼Œåœ¨ä»»ä½•å¹³å°éƒ½èƒ½æ­£ç¡®è¿è¡Œã€‚
        <strong style="color:#f1f5f9;">è¿™æ˜¯ä¸€ç§ç³»ç»Ÿç¨‹åºå‘˜çš„æœ¬èƒ½ï¼šä¼˜å…ˆå¯»æ‰¾æ•´æ•°åŸŸå†…çš„ç²¾ç¡®ç®—æ³•ï¼Œè€Œä¸æ˜¯å€Ÿç”¨æµ®ç‚¹çš„"è¿‘ä¼¼"ã€‚</strong>
        é‚£äº›ä¹ æƒ¯äº†é«˜å±‚è¯­è¨€çš„ç¨‹åºå‘˜å¾ˆéš¾ç†è§£è¿™ç§æœ¬èƒ½çš„ä»·å€¼ï¼Œç›´åˆ°æŸå¤©ä»–ä»¬è°ƒè¯•ä¸€ä¸ª
        å› ä¸ºæµ®ç‚¹ç²¾åº¦å¯¼è‡´å†…å­˜è¶Šç•Œçš„ bugï¼Œæ‰ä¼šæ˜ç™½ä¸ºä»€ä¹ˆ Warren è¦æŠŠ 12 æ¡æ•´æ•°æŒ‡ä»¤çš„æ–¹æ¡ˆ
        æ‘†åœ¨ 3 æ¡æµ®ç‚¹æŒ‡ä»¤çš„æ–¹æ¡ˆä¹‹å‰ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">å¯¹é½å…¬å¼çš„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸ç”¨ % è¿ç®—ç¬¦ï¼Ÿ</div>
      <p>
        <code style="color:var(--o);">(x + a - 1) / a * a</code> æ˜¯æ•°å­¦ä¸Šæ­£ç¡®çš„å‘ä¸Šå¯¹é½ï¼Œ
        ä½†å®ƒæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š1. å¯¹äºé2çš„å¹‚çš„ aï¼Œè¿™ä¸ªè¡¨è¾¾å¼æ¶‰åŠæ•´æ•°é™¤æ³•ï¼ˆ<strong style="color:#f1f5f9;">æ…¢</strong>ï¼Œ20-80 cyclesï¼‰ï¼›
        2. <code>x + a - 1</code> å¯èƒ½æº¢å‡ºï¼ˆå½“ x æ¥è¿‘ UINT_MAX æ—¶ï¼‰ã€‚
        è€Œ <code style="color:var(--o);">(x + a - 1) & ~(a - 1)</code> æŠŠé™¤æ³•å˜æˆä½è¿ç®—ï¼ˆ1 cycleï¼‰ï¼Œ
        ä¸”é™åˆ¶ a å¿…é¡»æ˜¯2çš„å¹‚è¿™ä¸ªçº¦æŸæ°å¥½ä¿è¯äº†ä½è¿ç®—çš„æ­£ç¡®æ€§ã€‚
        è¿™æ˜¯ä¸€ä¸ª"ä»¥çº¦æŸæ¢é€Ÿåº¦"çš„å…¸å‹æ¡ˆä¾‹â€”â€”å·¥ç¨‹ä¸Šä½ å¼ºåˆ¶è¦æ±‚å¯¹é½ç²’åº¦æ˜¯2çš„å¹‚ï¼Œå°±èƒ½è·å¾—10å€çš„é€Ÿåº¦ã€‚
        Linux å†…æ ¸ã€jemallocã€tcmalloc éƒ½éµå®ˆè¿™ä¸ªçº¦å®šã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">clp2 çš„æº¢å‡ºè®¾è®¡ï¼šä¸æ˜¯bugï¼Œæ˜¯æœ‰æ„ä¸ºä¹‹</div>
      <p>
        Warren æ˜ç¡®å®šä¹‰ <code style="color:var(--o);">clp2(x) = 0</code> å½“ x > 2Â³Â¹ï¼ˆ32ä½æ¨¡è¿ç®—æ„ä¹‰ä¸‹ï¼‰ã€‚
        å¾ˆå¤šäººç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªä¼šè§‰å¾—"è¿™ä¸æ˜¯bugå—"ã€‚ä½†è¿™ä¸ªè®¾è®¡æ˜¯<strong style="color:#f1f5f9;">åˆç†çš„å·¥ç¨‹å†³ç­–</strong>ï¼š
        åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œèƒ½åˆ†é…è¶…è¿‡2GBå†…å­˜çš„åœºæ™¯æœ¬æ¥å°±ä¸å­˜åœ¨ï¼›
        è€Œåœ¨64ä½ç³»ç»Ÿä¸­ä½ åº”è¯¥ç”¨ <code>uint64_t</code> ç‰ˆæœ¬ã€‚
        å¼ºè¡Œè¿”å›"æ­£ç¡®å€¼"ï¼ˆ2Â³Â²ï¼‰ä¼šè¦æ±‚ç”¨æ›´å¤§çš„è¿”å›ç±»å‹ï¼Œç ´åæ¥å£ä¸€è‡´æ€§ã€‚
        Rust çš„ <code>checked_next_power_of_two()</code> ç”¨ <code>Option&lt;u32&gt;</code>
        å¤„ç†è¿™ä¸ªè¾¹ç•Œâ€”â€”è¿™æ˜¯æ›´ç°ä»£çš„åšæ³•ï¼Œä½†ä»£ä»·æ˜¯è°ƒç”¨è€…å¿…é¡»å¤„ç† <code>None</code>ã€‚
        ä¸åŒçš„å·¥ç¨‹å“²å­¦ï¼Œå„æœ‰åˆ©å¼Šï¼Œæ²¡æœ‰ç»å¯¹çš„å¯¹é”™ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">è¿™äº›æŠ€å·§åœ¨ GPU/å¹¶è¡Œè®¡ç®—æ—¶ä»£è¿˜æœ‰ä»·å€¼å—ï¼Ÿ</div>
      <p>
        æœ‰ï¼Œè€Œä¸”æ›´æœ‰ã€‚CUDA/HIP çš„çº¿ç¨‹å—å¤§å°ï¼ˆblockDimï¼‰<strong style="color:#f1f5f9;">å¿…é¡»æ˜¯2çš„å¹‚</strong>ï¼Œ
        å…±äº«å†…å­˜çš„ bank conflict åˆ†æä¾èµ–2çš„å¹‚å¯¹é½ï¼Œwarp å¤§å°ï¼ˆ32ï¼‰æœ¬èº«å°±æ˜¯2çš„å¹‚ã€‚
        Metal/Vulkan çš„ buffer å¯¹é½è¦æ±‚åŒæ ·åŸºäº2çš„å¹‚ã€‚
        nlz åœ¨ GPU ä¸Šå¯¹åº” <code>__clz()</code>ï¼ˆCUDA å†…å»ºå‡½æ•°ï¼‰ï¼Œ
        åœ¨ warp çº§åˆ«çš„ ballot æ“ä½œä¸­è®¡ç®—æœ€é«˜æœ‰æ•ˆä½ä½ç½®æ—¶ä¹Ÿä¼šç”¨åˆ°ã€‚
        ç¬¬3ç« çš„æ‰€æœ‰æŠ€å·§åœ¨ GPU ç¼–ç¨‹ä¸­çš„ä½¿ç”¨é¢‘ç‡ï¼Œä¸äºšäºåœ¨ CPU ç³»ç»Ÿç¼–ç¨‹ä¸­çš„ä½¿ç”¨é¢‘ç‡ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">å¯ä»¥æ¨å¹¿åˆ°å“ªé‡Œï¼Ÿé‡å­è®¡ç®—çš„è§†è§’</div>
      <p>
        åœ¨é‡å­è®¡ç®—ä¸­ï¼Œqubit æ•°é‡ï¼ˆå³é‡å­å¯„å­˜å™¨å®½åº¦ï¼‰é€šå¸¸ä¹Ÿå–2çš„å¹‚æ¬¡ï¼Œ
        é‡å­ Fourier å˜æ¢ï¼ˆQFTï¼‰çš„ç”µè·¯æ·±åº¦æ˜¯ O(nÂ²)ï¼Œå…¶ä¸­ n = logâ‚‚(N)ï¼ŒN æ˜¯2çš„å¹‚æ¬¡ã€‚
        æ›´æœ‰æ„æ€çš„æ˜¯ï¼Œé‡å­çº é”™ç ï¼ˆå¦‚ surface codeï¼‰çš„é€»è¾‘é‡å­æ¯”ç‰¹æ•°é‡ä¹Ÿå¾€å¾€æ˜¯2çš„å¹‚æ¬¡å¯¹é½çš„ï¼Œ
        å› ä¸ºè¿™ä¸è§£ç ç”µè·¯çš„å¹¶è¡Œæ€§ç›´æ¥ç›¸å…³ã€‚
        ä» IBM S/360 çš„ç¡¬ä»¶å¯¹é½çº¦æŸï¼Œåˆ°é‡å­å¤„ç†å™¨çš„ç”µè·¯æ‹“æ‰‘çº¦æŸï¼Œ
        <strong style="color:#f1f5f9;">2çš„å¹‚çš„åå¥½æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€æ·±å±‚çš„ç»“æ„æ€§åå¥½ä¹‹ä¸€</strong>ï¼Œ
        æ ¹æ¤äºäºŒè¿›åˆ¶è¡¨ç¤ºå’Œ"åˆ†è€Œæ²»ä¹‹"çš„ç®—æ³•èŒƒå¼ã€‚
        Warren ç¬¬3ç« çš„æŠ€æœ¯ç»†èŠ‚ä¼šè¿‡æ—¶ï¼Œä½†å®ƒèƒŒåçš„æ•°å­¦ç»“æ„ä¼šä¸€ç›´åœ¨ã€‚
      </p>
    </div>
  </div>

  <!-- ç»ƒä¹ é¢˜ -->
  <div class="card" style="margin-top:1.2rem;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.75rem;">
      ğŸ“ Warren Â§3 è¯¾åç»ƒä¹ ç²¾é€‰ï¼ˆå…±6é¢˜ï¼‰
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:.7rem;font-size:.8rem;color:#64748b;line-height:1.7;">
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q1</div>
        è¯æ˜ <code style="color:var(--o);">clp2(x) = flp2(2x-1)</code>ï¼ˆx â‰¥ 1ï¼‰ã€‚
        æç¤ºï¼šå¯¹ x æ˜¯2çš„å¹‚å’Œä¸æ˜¯2çš„å¹‚ä¸¤ç§æƒ…å†µåˆ†åˆ«è®¨è®ºã€‚
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--b);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q2</div>
        ç»™å‡º flp2(x) çš„ä¸€ä¸ªå®Œå…¨æ— åˆ†æ”¯å®ç°ï¼ˆä¸ä½¿ç”¨ nlz æŒ‡ä»¤ï¼‰ï¼Œåˆ†ææŒ‡ä»¤æ•°ã€‚
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--p);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q3</div>
        Warren ä¹¦ä¸­ clp2 å®ç°åœ¨ x = 0 æ—¶è¿”å› 0ï¼Œåœ¨ x = 1 æ—¶è¿”å› 1ã€‚
        è‹¥è¦æ±‚ clp2(0) = 1ï¼ˆå³è‡³å°‘è¿”å›1ï¼‰ï¼Œå¦‚ä½•ç”¨æœ€å°‘æŒ‡ä»¤ä¿®æ”¹å®ç°ï¼Ÿ
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--o);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q4</div>
        è¯æ˜ <code style="color:var(--o);">pop(flp2(x) - 1) = 31 - nlz(x)</code>ï¼ˆx > 0ï¼‰ï¼Œ
        å…¶ä¸­ pop æ˜¯ popcountï¼ˆ1ä½è®¡æ•°ï¼‰ã€‚
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--r);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q5</div>
        ç»™å®š nï¼ˆå·²çŸ¥æ˜¯2çš„å¹‚ï¼‰ï¼Œç”¨ä½è¿ç®—æ£€æµ‹ x æ˜¯å¦æ˜¯ n çš„æ•´æ•°å€ï¼ˆä¸ä½¿ç”¨é™¤æ³•ï¼‰ã€‚
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.68rem;">Q6</div>
        64ä½ç‰ˆçš„ nlz äºŒåˆ†æœç´¢æ³•éœ€è¦å‡ æ­¥ï¼Ÿä¸32ä½ç‰ˆçš„ä»£ç æœ‰ä½•è§„å¾‹ï¼Ÿ
        æ¨å¹¿åˆ°128ä½æ—¶å¦‚ä½•æ‰©å±•ï¼Ÿ
      </div>
    </div>
  </div>
</section>

<footer>
  <p>
    <a href="ch02.html">â† Chapter 2: Basics</a>
    &nbsp;Â·&nbsp; Chapter 3 of 18
    &nbsp;Â·&nbsp; <a href="ch04.html">Chapter 4: Arithmetic Bounds â†’</a>
  </p>
  <p style="margin-top:.5rem;">Hacker's Delight 2nd Ed. Â· Henry S. Warren, Jr. Â· Addison-Wesley 2013</p>
</footer>

</div><!-- #app -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Alpine.js ä¸» App
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function app() {
  return {
    tabFlp2: 'main',
    tabClp2: 'main',
    tabNlz:  'binary',

    /* flp2/clp2 è¡¨æ ¼æ•°æ® */
    tableData: [
      { x: 0,           flp2: 0,          clp2: 0,          eq: true,  note: 'ç‰¹æ®Šæƒ…å†µï¼Œä¸¤è€…å‡ä¸º0' },
      { x: 1,           flp2: 1,          clp2: 1,          eq: true,  note: '1 = 2â°ï¼Œæ˜¯2çš„å¹‚' },
      { x: 2,           flp2: 2,          clp2: 2,          eq: true,  note: '2 = 2Â¹' },
      { x: 3,           flp2: 2,          clp2: 4,          eq: false, note: 'å¤¹åœ¨2å’Œ4ä¹‹é—´' },
      { x: 4,           flp2: 4,          clp2: 4,          eq: true,  note: '4 = 2Â²' },
      { x: 5,           flp2: 4,          clp2: 8,          eq: false, note: 'flp2å–ä¸‹ï¼Œclp2å–ä¸Š' },
      { x: 127,         flp2: 64,         clp2: 128,        eq: false, note: '2â·-1ï¼Œä¸¤ä¾§éƒ½æ˜¯2çš„å¹‚' },
      { x: 128,         flp2: 128,        clp2: 128,        eq: true,  note: '2â·ï¼Œå®Œç¾2çš„å¹‚' },
      { x: 2147483647,  flp2: 1073741824, clp2: 2147483648, eq: false, note: '2Â³Â¹-1ï¼Œæœ€å¤§æœ‰ç¬¦å·æ­£æ•°' },
      { x: 2147483648,  flp2: 2147483648, clp2: 2147483648, eq: true,  note: '2Â³Â¹ï¼Œæ— ç¬¦å·æœ€é«˜å¹‚' },
      { x: 2147483649,  flp2: 2147483648, clp2: 0,          eq: false, note: 'clp2æº¢å‡ºâ†’0ï¼ˆæ¨¡2Â³Â²å®šä¹‰ï¼‰' },
      { x: 4294967295,  flp2: 2147483648, clp2: 0,          eq: false, note: 'UINT_MAXï¼Œclp2=0ï¼ˆæº¢å‡ºï¼‰' },
    ],

    init() {
      this.initBg();
      this.initProgress();
      this.initScrollSpy();
      this.$nextTick(() => {
        this.initChartPow2();
        this.initChartNlz();
        this.initChartEvo();
        this.initChartDomain();
      });
    },

    initProgress() {
      window.addEventListener('scroll', () => {
        const s = document.documentElement.scrollTop;
        const h = document.documentElement.scrollHeight - window.innerHeight;
        document.getElementById('prog').style.width = (h > 0 ? (s / h * 100) : 0) + '%';
      });
    },

    initScrollSpy() {
      const secs = ['hero','def','flp2','clp2','align','nlz','history','critique'];
      const dots = document.querySelectorAll('.dot');
      window.addEventListener('scroll', () => {
        let cur = 0;
        secs.forEach((id, i) => {
          const el = document.getElementById(id);
          if (el && el.getBoundingClientRect().top < window.innerHeight * 0.45) cur = i;
        });
        dots.forEach((d, i) => d.classList.toggle('active', i === cur));
      });
      dots.forEach((d, i) => {
        d.addEventListener('click', () => {
          document.getElementById(secs[i])?.scrollIntoView({ behavior: 'smooth' });
        });
      });
    },

    initBg() {
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      let W, H;
      const resize = () => { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; };
      resize();
      window.addEventListener('resize', resize);
      const powers = ['1','2','4','8','16','32','64','128','256','512','1K','2K','4K'];
      const particles = Array.from({ length: 45 }, () => ({
        x: Math.random() * 1920, y: Math.random() * 1080,
        vy: 0.15 + Math.random() * 0.4,
        ch: powers[Math.floor(Math.random() * powers.length)],
        alpha: 0.025 + Math.random() * 0.08,
        size: 10 + Math.random() * 6
      }));
      const draw = () => {
        ctx.clearRect(0, 0, W, H);
        particles.forEach(p => {
          ctx.fillStyle = `rgba(0,255,136,${p.alpha})`;
          ctx.font = `${p.size}px monospace`;
          ctx.fillText(p.ch, p.x % W, p.y % H);
          p.y += p.vy;
          if (p.y > H) { p.y = -20; p.x = Math.random() * W; }
          if (Math.random() < 0.008) p.ch = powers[Math.floor(Math.random() * powers.length)];
        });
        requestAnimationFrame(draw);
      };
      draw();
    },

    /* â”€â”€ flp2 vs clp2 æŠ˜çº¿å›¾ â”€â”€ */
    initChartPow2() {
      const el = document.getElementById('chart-pow2');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      const xs = Array.from({ length: 129 }, (_, i) => i);
      const flp2 = xs.map(x => x === 0 ? 0 : Math.pow(2, Math.floor(Math.log2(x))));
      const clp2 = xs.map(x => {
        if (x <= 1) return x;
        let n = x - 1;
        n |= n >> 1; n |= n >> 2; n |= n >> 4; n |= n >> 8; n |= n >> 16;
        return n + 1;
      });
      chart.setOption({
        backgroundColor: 'transparent',
        grid: { left: '5%', right: '3%', top: '15%', bottom: '12%' },
        tooltip: {
          trigger: 'axis',
          backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)',
          textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 },
          formatter: p => `x = ${p[0].dataIndex}<br/>
            <span style="color:var(--g,#0f0)">flp2 = ${flp2[p[0].dataIndex]}</span><br/>
            <span style="color:#00d4ff">clp2 = ${clp2[p[0].dataIndex]}</span><br/>
            <span style="color:#ff8c00">x = ${p[0].dataIndex}</span>`
        },
        legend: { data: ['x (åŸå§‹å€¼)', 'flp2(x)', 'clp2(x)'], textStyle: { color: '#475569', fontSize: 10 } },
        xAxis: { data: xs, axisLabel: { color: '#475569', fontSize: 9 }, axisLine: { lineStyle: { color: '#1e293b' } } },
        yAxis: { axisLabel: { color: '#475569' }, splitLine: { lineStyle: { color: 'rgba(30,41,59,.5)' } }, axisLine: { lineStyle: { color: '#1e293b' } } },
        series: [
          { name: 'x (åŸå§‹å€¼)', type: 'line', data: xs, lineStyle: { color: 'rgba(255,140,0,.5)', width: 1, type: 'dashed' }, symbol: 'none', smooth: false },
          { name: 'flp2(x)', type: 'line', data: flp2, lineStyle: { color: 'var(--g,#00ff88)', width: 2 }, symbol: 'none', smooth: false, areaStyle: { color: 'rgba(0,255,136,.05)' } },
          { name: 'clp2(x)', type: 'line', data: clp2, lineStyle: { color: '#00d4ff', width: 2 }, symbol: 'none', smooth: false, areaStyle: { color: 'rgba(0,212,255,.04)' } }
        ]
      });
      window.addEventListener('resize', () => chart.resize());
    },

    /* â”€â”€ nlz æ–¹æ³•è¯„åˆ†é›·è¾¾å›¾ â”€â”€ */
    initChartNlz() {
      const el = document.getElementById('chart-nlz');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        tooltip: { backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)', textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 } },
        legend: { bottom: 0, textStyle: { color: '#475569', fontSize: 10 } },
        radar: {
          indicator: [
            { name: 'é€Ÿåº¦', max: 10 }, { name: 'ç§»æ¤æ€§', max: 10 },
            { name: 'æ­£ç¡®æ€§', max: 10 }, { name: 'ä»£ç å¯†åº¦', max: 10 },
            { name: 'Cacheå‹å¥½', max: 10 }
          ],
          shape: 'polygon',
          splitArea: { areaStyle: { color: ['rgba(30,41,59,.3)', 'transparent'] } },
          axisLine: { lineStyle: { color: '#1e293b' } },
          splitLine: { lineStyle: { color: '#1e293b' } },
          name: { textStyle: { color: '#475569', fontSize: 10 } }
        },
        series: [{
          type: 'radar',
          data: [
            { name: 'äºŒåˆ†æœç´¢æ³•',    value: [6, 9, 9, 7, 9], lineStyle: { color: 'rgba(0,255,136,.8)' },  areaStyle: { color: 'rgba(0,255,136,.1)' } },
            { name: 'æµ®ç‚¹æ³•',       value: [7, 7, 6, 8, 9], lineStyle: { color: 'rgba(0,212,255,.8)' },  areaStyle: { color: 'rgba(0,212,255,.08)' } },
            { name: 'æŸ¥è¡¨æ³•',       value: [7, 8, 9, 6, 5], lineStyle: { color: 'rgba(255,140,0,.8)' },  areaStyle: { color: 'rgba(255,140,0,.08)' } },
            { name: 'LZCNT/CLZ',   value: [10,9, 9,10,10], lineStyle: { color: 'rgba(177,79,255,.8)' }, areaStyle: { color: 'rgba(177,79,255,.08)' } }
          ]
        }]
      });
      window.addEventListener('resize', () => chart.resize());
    },

    /* â”€â”€ clp2 æŒ‡ä»¤æ•°æ¼”å˜æ—¶é—´è½´æŸ±å›¾ â”€â”€ */
    initChartEvo() {
      const el = document.getElementById('chart-evo');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        grid: { left: '3%', right: '3%', top: '18%', bottom: '22%', containLabel: true },
        tooltip: { backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)', textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 } },
        legend: { data: ['x86','ARM64','RISC-V'], textStyle: { color: '#475569', fontSize: 10 } },
        xAxis: {
          data: ['1990s\n(æ— CLZ)', '2000s\n(BSR)', '2013\n(LZCNT)', '2020\nC++20'],
          axisLabel: { color: '#475569', fontSize: 9 }, axisLine: { lineStyle: { color: '#1e293b' } }
        },
        yAxis: { name: 'æŒ‡ä»¤æ•°', nameTextStyle: { color: '#475569', fontSize: 10 }, axisLabel: { color: '#475569' }, splitLine: { lineStyle: { color: 'rgba(30,41,59,.5)' } }, axisLine: { lineStyle: { color: '#1e293b' } } },
        series: [
          { name: 'x86',   type: 'bar', data: [12, 8, 3, 1], barMaxWidth: 22, itemStyle: { color: 'rgba(0,255,136,.65)',  borderRadius: 3 } },
          { name: 'ARM64', type: 'bar', data: [12, 3, 3, 1], barMaxWidth: 22, itemStyle: { color: 'rgba(0,212,255,.55)',  borderRadius: 3 } },
          { name: 'RISC-V',type: 'bar', data: [12,12, 3, 1], barMaxWidth: 22, itemStyle: { color: 'rgba(177,79,255,.55)', borderRadius: 3 } }
        ]
      });
      window.addEventListener('resize', () => chart.resize());
    },

    /* â”€â”€ åº”ç”¨é¢†åŸŸé¥¼å›¾ â”€â”€ */
    initChartDomain() {
      const el = document.getElementById('chart-domain');
      if (!el || !window.echarts) return;
            const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        tooltip: { backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)', textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 } },
        legend: { bottom: 0, textStyle: { color: '#475569', fontSize: 10 } },
        series: [{
          type: 'pie',
          radius: ['38%','70%'],
          center: ['50%','46%'],
          label: { color: '#94a3b8', fontFamily: 'JetBrains Mono', fontSize: 10 },
          labelLine: { lineStyle: { color: '#1e293b' } },
          data: [
            { value: 30, name: 'å†…å­˜åˆ†é…/å¯¹é½', itemStyle: { color: 'rgba(0,255,136,.65)' } },
            { value: 20, name: 'å“ˆå¸Œè¡¨/å­—å…¸',   itemStyle: { color: 'rgba(0,212,255,.65)' } },
            { value: 15, name: 'SIMD/å‘é‡åŒ–',   itemStyle: { color: 'rgba(177,79,255,.65)' } },
            { value: 12, name: 'æ–‡ä»¶/å—è®¾å¤‡I/O', itemStyle: { color: 'rgba(255,140,0,.65)' } },
            { value: 10, name: 'GPU/å›¾å½¢çº¹ç†',  itemStyle: { color: 'rgba(255,68,102,.6)' } },
            { value: 13, name: 'å…¶ä»–(åè®®/å‹ç¼©/ç®—æ³•)', itemStyle: { color: 'rgba(148,163,184,.35)' } }
          ]
        }]
      });
      window.addEventListener('resize', () => chart.resize());
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å­ç»„ä»¶: flp2 demo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function flp2Demo(){
  return {
    x: 77,
    get smearSteps(){
      const toBits = (v) => v.toString(2).padStart(8,'0').split('').map(c => +c);
      let s0 = this.x & 0xFF;
      let s1 = s0 | (s0 >> 1);
      let s2 = s1 | (s1 >> 2);
      let s3 = s2 | (s2 >> 4);
      let s4 = s3; // 8-bitæ¼”ç¤ºä¸éœ€è¦>>8 >>16
      // bits: 2 è¡¨ç¤ºâ€œä¼ æ’­å¡«å……â€çš„1(é«˜äº®)
      const markFill = (prev, cur) => {
        const pb = toBits(prev), cb = toBits(cur);
        return cb.map((b,i)=> (b===1 && pb[i]===0) ? 2 : b);
      };
      return [
        { label: 'åŸå§‹ x',                 bits: toBits(s0),                val: '0b'+toBits(s0).join('') },
        { label: 'x |= x>>1',              bits: markFill(s0,s1),            val: '0b'+toBits(s1).join('') },
        { label: 'x |= x>>2',              bits: markFill(s1,s2),            val: '0b'+toBits(s2).join('') },
        { label: 'x |= x>>4',              bits: markFill(s2,s3),            val: '0b'+toBits(s3).join('') },
        { label: 'smear å®Œæˆ (011..1)',    bits: markFill(s2,s3),            val: '0b'+toBits(s3).join('') }
      ];
    },
    get flp2Result(){
      let v = this.x;
      v |= v >> 1; v |= v >> 2; v |= v >> 4;
      return (v - (v >> 1)) & 0xFF;
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å­ç»„ä»¶: clp2 demo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clp2Demo(){
  return {
    x: 77,
    get clp2Steps(){
      const toBits = (v) => (v&0xFF).toString(2).padStart(8,'0').split('').map(c => +c);
      const markFill = (prev, cur) => {
        const pb = toBits(prev), cb = toBits(cur);
        return cb.map((b,i)=> (b===1 && pb[i]===0) ? 2 : b);
      };
      let s0 = this.x & 0xFF;
      let s1 = (s0 - 1) & 0xFF;
      let s2 = s1 | (s1 >> 1);
      let s3 = s2 | (s2 >> 2);
      let s4 = s3 | (s3 >> 4);
      let s5 = (s4 + 1) & 0xFF;
      return [
        { label:'åŸå§‹ x',        bits: toBits(s0), val:'0b'+toBits(s0).join('') },
        { label:'x-1',           bits: toBits(s1), val:'0b'+toBits(s1).join('') },
        { label:'(x-1)|>>1',     bits: markFill(s1,s2), val:'0b'+toBits(s2).join('') },
        { label:'...|>>2',       bits: markFill(s2,s3), val:'0b'+toBits(s3).join('') },
        { label:'...|>>4 (smear)',bits: markFill(s3,s4), val:'0b'+toBits(s4).join('') },
        { label:'+1 è¿›ä½',       bits: toBits(s5), val:'0b'+toBits(s5).join('') }
      ];
    },
    get clp2Result(){
      let v = (this.x - 1) >>> 0;
      v |= v >> 1; v |= v >> 2; v |= v >> 4; v |= v >> 8; v |= v >> 16;
      return (v + 1) >>> 0;
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å­ç»„ä»¶: alignment demo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function alignDemo(){
  return {
    addr: 0x47,
    align: 16
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å­ç»„ä»¶: nlz demo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nlzDemo(){
  return {
    x: 0x1234,
    get nlzCount(){
      // ç”¨ JS 32ä½ clz
      return Math.clz32(this.x >>> 0);
    },
    get x32bits(){
      const s = (this.x >>> 0).toString(2).padStart(32,'0');
      return s.split('').map(c=>+c);
    },
    get binarySearchSteps(){
      // ä»…æ¼”ç¤ºæ€è·¯ï¼šç”¨åˆ†æ®µåˆ¤æ–­æ¨¡æ‹Ÿ
      const x = this.x >>> 0;
      const steps = [];
      steps.push({ label:'if (x <= 0x0000FFFF) n+=16, x<<=16', hit: (x > 0x0000FFFF) });
      const x1 = (x > 0x0000FFFF) ? x : (x << 16) >>> 0;
      steps.push({ label:'if (x <= 0x00FFFFFF) n+=8, x<<=8',  hit: (x1 > 0x00FFFFFF) });
      const x2 = (x1 > 0x00FFFFFF) ? x1 : (x1 << 8) >>> 0;
      steps.push({ label:'if (x <= 0x0FFFFFFF) n+=4, x<<=4',   hit: (x2 > 0x0FFFFFFF) });
      const x3 = (x2 > 0x0FFFFFFF) ? x2 : (x2 << 4) >>> 0;
      steps.push({ label:'if (x <= 0x3FFFFFFF) n+=2, x<<=2',   hit: (x3 > 0x3FFFFFFF) });
      const x4 = (x3 > 0x3FFFFFFF) ? x3 : (x3 << 2) >>> 0;
      steps.push({ label:'if (x <= 0x7FFFFFFF) n+=1',          hit: (x4 > 0x7FFFFFFF) });
      return steps;
    }
  };
}
</script>

</body>
</html>