
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ch.02 â€” åŸºç¡€æŠ€å·§ Basics | Hacker's Delight</title>
<link rel="stylesheet" href="tailwind.css"/>
<script src="echarts.min.js"></script>
<script src="alpine.min.js" defer></script>
<style>
:root{
  --g:#00ff88;--b:#00d4ff;--p:#b14fff;--o:#ff8c00;--r:#ff4466;
  --dark:#050810;--card:#0d1117;--border:rgba(0,255,136,.18);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--dark);color:#e2e8f0;font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;font-size:17px;line-height:1.7;}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,136,.012) 2px,rgba(0,255,136,.012) 4px);pointer-events:none;z-index:0;}
canvas#bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
#app{position:relative;z-index:1;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,8,16,.88);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:.7rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);text-decoration:none;}
.nav-links{display:flex;gap:1.5rem;}
.nav-links a{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#475569;text-decoration:none;transition:color .2s;}
.nav-links a:hover{color:var(--g);}

/* PROGRESS */
#prog{position:fixed;top:0;left:0;height:2px;z-index:200;background:linear-gradient(90deg,var(--g),var(--b));transition:width .1s;}

/* DOT NAV */
.dot-nav{position:fixed;right:1.5rem;top:50%;transform:translateY(-50%);z-index:50;display:flex;flex-direction:column;gap:.6rem;}
.dot{width:8px;height:8px;border-radius:50%;background:#1e293b;cursor:pointer;transition:all .2s;}
.dot.active{background:var(--g);transform:scale(1.4);}
@media(max-width:768px){.dot-nav{display:none;}}

/* HERO */
.hero{padding:7rem 2rem 3rem;text-align:center;max-width:900px;margin:0 auto;}
.chapter-badge{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--g);border:1px solid var(--g);padding:.3rem 1rem;border-radius:999px;letter-spacing:.15em;margin-bottom:1.5rem;animation:badge-pulse 2.5s ease-in-out infinite;}
@keyframes badge-pulse{0%,100%{box-shadow:0 0 6px rgba(0,255,136,.4);}50%{box-shadow:0 0 20px rgba(0,255,136,.8);}}
.hero-title{font-size:clamp(2rem,5vw,3.6rem);font-weight:900;background:linear-gradient(135deg,#fff 0%,var(--g) 55%,var(--b) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15;margin-bottom:.5rem;}
.hero-sub{font-family:'JetBrains Mono',monospace;color:#475569;font-size:.9rem;margin-bottom:2rem;}
.hero-desc{color:#94a3b8;font-size:1rem;line-height:1.85;max-width:720px;margin:0 auto 2rem;}

/* SECTION */
section{max-width:1100px;margin:0 auto;padding:0 1.5rem 4rem;}
.sec-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.75rem;}
.sec-num{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--g);background:rgba(0,255,136,.08);border:1px solid rgba(0,255,136,.2);padding:.25rem .6rem;border-radius:4px;white-space:nowrap;}
.sec-title{font-size:1.35rem;font-weight:700;color:#f1f5f9;}
.sec-divider{flex:1;height:1px;background:linear-gradient(90deg,rgba(0,255,136,.3),transparent);}

/* CARD */
.card{background:var(--card);border:1px solid #1e293b;border-radius:.75rem;padding:1.5rem;transition:border-color .25s,box-shadow .25s;}
.card:hover{border-color:rgba(0,255,136,.25);box-shadow:0 4px 24px rgba(0,255,136,.07);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.25rem;}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr;}}

/* CODE */
.code-block{background:#010409;border:1px solid #1e293b;border-radius:.5rem;padding:1.2rem 1.5rem;font-family:'JetBrains Mono',monospace;font-size:.8rem;line-height:1.8;overflow-x:auto;color:#94a3b8;position:relative;white-space:pre-wrap;}
.code-block .kw{color:var(--p);}
.code-block .num{color:var(--o);}
.code-block .cm{color:#334155;font-style:italic;}
.code-block .fn{color:var(--g);}
.code-block .str{color:var(--b);}
.code-block .hi{color:#fff;background:rgba(0,255,136,.1);border-radius:2px;padding:0 2px;}
.copy-btn{position:absolute;top:.6rem;right:.6rem;font-family:'JetBrains Mono',monospace;font-size:.62rem;color:#334155;border:1px solid #1e293b;background:transparent;padding:.2rem .5rem;border-radius:3px;cursor:pointer;transition:all .2s;}
.copy-btn:hover{color:var(--g);border-color:rgba(0,255,136,.3);}

/* INSIGHT */
.insight{background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15);border-left:3px solid var(--g);border-radius:.5rem;padding:1.2rem 1.5rem;margin-bottom:1.25rem;font-size:.9rem;line-height:1.8;color:#94a3b8;}
.insight strong{color:var(--g);}
.insight .label{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--g);letter-spacing:.1em;display:block;margin-bottom:.4rem;}

/* TRICK CARD */
.trick-card{background:var(--card);border:1px solid #1e293b;border-radius:.75rem;padding:1.25rem;cursor:default;transition:all .25s;position:relative;overflow:hidden;}
.trick-card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;opacity:0;transition:opacity .25s;}
.trick-card:hover::before{opacity:1;}
.trick-card:hover{transform:translateY(-3px);box-shadow:0 8px 28px rgba(0,255,136,.1);}
.trick-card.green::before{background:linear-gradient(180deg,var(--g),var(--b));}
.trick-card.blue::before{background:linear-gradient(180deg,var(--b),var(--p));}
.trick-card.orange::before{background:linear-gradient(180deg,var(--o),var(--r));}
.trick-card.purple::before{background:linear-gradient(180deg,var(--p),var(--g));}
.trick-num{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#334155;margin-bottom:.4rem;}
.trick-title{font-size:.95rem;font-weight:700;color:#f1f5f9;margin-bottom:.5rem;}
.trick-formula{font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--g);background:rgba(0,255,136,.06);border:1px solid rgba(0,255,136,.12);border-radius:.3rem;padding:.4rem .75rem;margin:.5rem 0;display:inline-block;}
.trick-desc{font-size:.82rem;color:#64748b;line-height:1.7;}
.trick-example{font-family:'JetBrains Mono',monospace;font-size:.72rem;color:#475569;margin-top:.5rem;padding:.4rem .6rem;background:#010409;border-radius:.3rem;}

/* INTERACTIVE BIT */
.bit-row{display:flex;gap:2px;flex-wrap:wrap;font-family:'JetBrains Mono',monospace;}
.bit-cell{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:3px;border:1px solid #1e293b;cursor:pointer;transition:all .15s;font-size:.8rem;user-select:none;}
.bit-cell.one{background:rgba(0,255,136,.15);color:var(--g);border-color:rgba(0,255,136,.3);}
.bit-cell.zero{background:#0d1117;color:#334155;}
.bit-cell:hover{border-color:var(--g);transform:scale(1.1);}
.bit-result-row{display:flex;gap:2px;flex-wrap:wrap;margin-top:6px;}
.bit-result-cell{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:3px;font-size:.8rem;font-family:'JetBrains Mono',monospace;}

/* CHART */
.chart-wrap{width:100%;height:300px;}

/* TAGS */
.tag{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.63rem;padding:.2rem .5rem;border-radius:3px;margin:.15rem;}
.tag-g{background:rgba(0,255,136,.1);color:var(--g);border:1px solid rgba(0,255,136,.2);}
.tag-b{background:rgba(0,212,255,.1);color:var(--b);border:1px solid rgba(0,212,255,.2);}
.tag-p{background:rgba(177,79,255,.1);color:var(--p);border:1px solid rgba(177,79,255,.2);}
.tag-o{background:rgba(255,140,0,.1);color:var(--o);border:1px solid rgba(255,140,0,.2);}
.tag-r{background:rgba(255,68,102,.1);color:var(--r);border:1px solid rgba(255,68,102,.2);}

/* TABS */
.tab-nav{display:flex;gap:.4rem;margin-bottom:1rem;flex-wrap:wrap;}
.tab-btn{font-family:'JetBrains Mono',monospace;font-size:.7rem;padding:.35rem .85rem;border-radius:4px;border:1px solid #1e293b;background:transparent;color:#475569;cursor:pointer;transition:all .2s;}
.tab-btn.active,.tab-btn:hover{border-color:var(--g);color:var(--g);background:rgba(0,255,136,.08);}
.tab-pane{display:none;}.tab-pane.active{display:block;}

/* TIMELINE */
.timeline{position:relative;padding-left:2rem;}
.timeline::before{content:'';position:absolute;left:.5rem;top:0;bottom:0;width:1px;background:linear-gradient(180deg,var(--g),var(--p),transparent);}
.tl-item{position:relative;margin-bottom:2rem;}
.tl-dot{position:absolute;left:-1.6rem;top:.35rem;width:10px;height:10px;border-radius:50%;background:var(--g);box-shadow:0 0 8px var(--g);}
.tl-year{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--g);margin-bottom:.2rem;}
.tl-title{font-size:.95rem;font-weight:600;color:#f1f5f9;margin-bottom:.3rem;}
.tl-desc{font-size:.83rem;color:#64748b;line-height:1.65;}

/* CRITIC */
.critic-box{background:linear-gradient(135deg,rgba(177,79,255,.06),rgba(0,212,255,.04));border:1px solid rgba(177,79,255,.25);border-radius:.75rem;padding:1.75rem;position:relative;overflow:hidden;}
.critic-box::before{content:'ğŸ§ æ·±åº¦ç‚¹è¯„';font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--p);letter-spacing:.1em;display:block;margin-bottom:1rem;}
.critic-box h3{font-size:1.05rem;font-weight:700;color:#f1f5f9;margin-bottom:.75rem;}
.critic-item{margin-bottom:1.1rem;padding-left:1rem;border-left:2px solid rgba(177,79,255,.3);}
.critic-item .ci-title{font-size:.83rem;font-weight:600;color:var(--p);margin-bottom:.3rem;}
.critic-item p{font-size:.82rem;line-height:1.72;color:#64748b;}

/* WARN */
.warn-box{background:rgba(255,68,102,.04);border:1px solid rgba(255,68,102,.2);border-left:3px solid var(--r);border-radius:.5rem;padding:1.1rem 1.4rem;font-size:.85rem;line-height:1.75;color:#94a3b8;}
.warn-box .label{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--r);letter-spacing:.1em;display:block;margin-bottom:.4rem;}
.warn-box strong{color:var(--r);}

/* ANIM */
@keyframes fadeUp{from{opacity:0;transform:translateY(22px);}to{opacity:1;transform:translateY(0);}}
.fade-up{opacity:0;animation:fadeUp .5s ease both;}

/* FOOTER */
footer{text-align:center;padding:2.5rem;font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#1e293b;border-top:1px solid #0f172a;}
footer a{color:var(--g);text-decoration:none;}

/* GOSPER ANIM */
.gosper-step{font-family:'JetBrains Mono',monospace;font-size:.85rem;padding:.5rem;border-radius:.3rem;transition:background .3s;}
.gosper-step.active{background:rgba(0,255,136,.12);color:var(--g);}

/* MUX VIZ */
.mux-row{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin:.3rem 0;font-family:'JetBrains Mono',monospace;font-size:.82rem;}
.mux-label{color:#475569;font-size:.72rem;min-width:60px;}
.mux-val{color:var(--g);}
.mux-val.blue{color:var(--b);}
.mux-val.orange{color:var(--o);}
.mux-val.red{color:var(--r);}

/* SCROLLBAR */
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--dark);}
::-webkit-scrollbar-thumb{background:#1e293b;border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:rgba(0,255,136,.3);}

/* â•â•â• å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  â•â•â• */
.sidebar-nav{
  position:fixed;left:0;top:0;bottom:0;
  width:180px;z-index:90;
  background:rgba(5,8,16,.92);
  backdrop-filter:blur(10px);
  border-right:1px solid rgba(0,255,136,.12);
  padding:1rem .5rem;
  overflow-y:auto;
  overflow-x:hidden;
  transition:transform .25s ease;
  display:flex;
  flex-direction:column;
}
.sidebar-nav::-webkit-scrollbar{width:3px;}
.sidebar-nav::-webkit-scrollbar-thumb{background:#1e293b;border-radius:2px;}

.sidebar-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.62rem;color:var(--g);
  letter-spacing:.08em;
  padding:.4rem .6rem;
  border-bottom:1px solid rgba(0,255,136,.15);
  margin-bottom:.5rem;
  flex-shrink:0;
}

.sidebar-section{
  margin-bottom:.6rem;
  display:flex;
  flex-direction:column;
}
.sidebar-section-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.58rem;color:#475569;
  padding:.3rem .6rem;
  letter-spacing:.05em;
  flex-shrink:0;
}

.sidebar-link{
  display:block;
  width:100%;
  clear:both;
  font-family:'JetBrains Mono',monospace;
  font-size:.68rem;
  color:#64748b;
  text-decoration:none;
  padding:.25rem .6rem .25rem 1rem;
  border-radius:3px;
  transition:all .15s;
  position:relative;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.sidebar-link:hover{color:var(--g);background:rgba(0,255,136,.06);}
.sidebar-link.active{color:var(--g);background:rgba(0,255,136,.1);}
.sidebar-link.active::before{
  content:'';position:absolute;left:0;top:50%;
  transform:translateY(-50%);
  width:2px;height:14px;
  background:var(--g);border-radius:1px;
}

.sidebar-toggle{
  display:none;
  position:fixed;left:.5rem;top:.85rem;z-index:95;
  width:32px;height:32px;
  background:rgba(5,8,16,.9);
  border:1px solid rgba(0,255,136,.2);
  border-radius:4px;
  color:var(--g);
  font-size:1.1rem;
  cursor:pointer;
}

@media(max-width:1100px){
  .sidebar-nav{transform:translateX(-100%);}
  .sidebar-nav.open{transform:translateX(0);}
  .sidebar-toggle{display:flex;align-items:center;justify-content:center;}
  body{padding-left:0!important;}
}

@media(min-width:1101px){body{padding-left:180px;}}
</style>
</head>
<body>

<!-- å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  -->
<button class="sidebar-toggle" @click="sidebarOpen = !sidebarOpen" x-data="{sidebarOpen: false}">
  â˜°
</button>
<nav class="sidebar-nav" :class="sidebarOpen ? 'open' : ''" x-data="{sidebarOpen: false}" @click.away="sidebarOpen = false">
  <div class="sidebar-title">ğŸ“š HACKER'S DELIGHT</div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">æ­£æ–‡ç« èŠ‚</div>
    <a href="ch01.html" class="sidebar-link">Ch.01 å¥ å®šåŸºç¡€</a>
    <a href="ch02.html" class="sidebar-link active">Ch.02 åŸºç¡€æ“ä½œ</a>
    <a href="ch03.html" class="sidebar-link">Ch.03 2çš„å¹‚è¾¹ç•Œ</a>
    <a href="ch04.html" class="sidebar-link">Ch.04 ç®—æœ¯è¾¹ç•Œ</a>
    <a href="ch05.html" class="sidebar-link">Ch.05 æ•´æ•°é™¤æ³•</a>
    <a href="ch06.html" class="sidebar-link">Ch.06 ä½è®¡æ•°</a>
    <a href="ch07.html" class="sidebar-link">Ch.07 ä½ç¿»è½¬</a>
    <a href="ch08.html" class="sidebar-link">Ch.08 ä½ç½®æ¢</a>
    <a href="ch09.html" class="sidebar-link">Ch.09 å¾ªç¯å†—ä½™æ ¡éªŒ</a>
    <a href="ch10.html" class="sidebar-link">Ch.10 å¥‡å¶æ ¡éªŒ</a>
    <a href="ch11.html" class="sidebar-link">Ch.11 Grayç </a>
    <a href="ch12.html" class="sidebar-link">Ch.12 Hilbertæ›²çº¿</a>
    <a href="ch13.html" class="sidebar-link">Ch.13 æµ®ç‚¹æ•°</a>
    <a href="ch14.html" class="sidebar-link">Ch.14 å…¬å¼</a>
    <a href="ch15.html" class="sidebar-link">Ch.15 åŸºæ•°è½¬æ¢</a>
    <a href="ch16.html" class="sidebar-link">Ch.16 å¼€æ–¹</a>
    <a href="ch17.html" class="sidebar-link">Ch.17 æµ®ç‚¹å€’æ•°å¼€æ–¹</a>
    <a href="ch18.html" class="sidebar-link">Ch.18 å…¶å®ƒ</a>
  </div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">é™„å½•</div>
    <a href="appA.html" class="sidebar-link">App.A è¯æ±‡è¡¨</a>
    <a href="appB.html" class="sidebar-link">App.B æ‘˜è¦</a>
    <a href="appC.html" class="sidebar-link">App.C å‘å±•å²</a>
  </div>
</nav>

<canvas id="bg"></canvas>
<div id="prog"></div>

<div class="dot-nav" id="dotNav">
  <div class="dot active" data-sec="hero"    title="é¡¶éƒ¨"></div>
  <div class="dot"        data-sec="rightmost" title="æœ€å³ä½æ“ä½œ"></div>
  <div class="dot"        data-sec="addsub"  title="åŠ å‡å…³ç³»"></div>
  <div class="dot"        data-sec="abs"     title="ç»å¯¹å€¼/æ¯”è¾ƒ"></div>
  <div class="dot"        data-sec="special" title="ç‰¹æ®ŠæŠ€å·§"></div>
  <div class="dot"        data-sec="gosper"  title="Gosperç®—æ³•"></div>
  <div class="dot"        data-sec="history" title="å†å²ç‚¹è¯„"></div>
  <div class="dot"        data-sec="critique" title="æ·±åº¦åˆ†æ"></div>
</div>

<nav>
  <a class="nav-logo" href="index.html">â† HACKER'S DELIGHT</a>
  <div class="nav-links">
    <a href="#rightmost">æœ€å³ä½</a>
    <a href="#addsub">åŠ å‡</a>
    <a href="#abs">ç»å¯¹å€¼</a>
    <a href="#special">ç‰¹æ®Š</a>
    <a href="#gosper">Gosper</a>
    <a href="#history">å†å²</a>
    <a href="#critique">ç‚¹è¯„</a>
  </div>
</nav>

<div id="app" x-data="app()" x-init="init()">

<!-- â•â•â• HERO â•â•â• -->
<div class="hero" id="hero">
  <div class="chapter-badge">CHAPTER 02 Â· BASICS Â· åŸºç¡€æŠ€å·§</div>
  <h1 class="hero-title fade-up" style="animation-delay:.1s">åŸºç¡€æŠ€å·§</h1>
  <p class="hero-sub fade-up" style="animation-delay:.2s">// Basics â€” ä½æ“ä½œé­”æ³•ç®±é‡Œæœ€å¸¸ç”¨çš„äºŒåæŠŠé’¥åŒ™</p>
  <p class="hero-desc fade-up" style="animation-delay:.3s">
    è¿™ä¸€ç« æ˜¯æ•´æœ¬ä¹¦çš„<strong style="color:var(--g)">æ ¸æ­¦å™¨åº“</strong>ã€‚Warren æŠŠå‡ åå¹´åœ¨ IBM ç§¯ç´¯çš„ä½è¿ç®—ç»æŠ€æ•´æ•´é½é½ç åœ¨è¿™é‡Œï¼š
    æœ€å³ä½æ“çºµã€åŠ å‡æ³•æ’ç­‰å¼ã€æ— åˆ†æ”¯ç»å¯¹å€¼ã€æ•´æ•°å¹³å‡ã€ç¬¦å·æ¯”è¾ƒã€MUX æ“ä½œã€ä½åŸŸä¼ æ’­â€¦â€¦
    æ¯ä¸€ä¸ªæŠ€å·§èƒŒåéƒ½æ˜¯ä¸€ä¸ªæ€ç»´æ–¹å¼çš„å‡åã€‚çœ‹å®Œä¹‹åä½ ä¼šå‘ç°ï¼Œ
    è¿‡å»å†™çš„å¾ˆå¤š"èªæ˜ä»£ç "å…¶å®è¿˜å·®ç€å¥½å‡ ä¸ªæ•°é‡çº§ã€‚
  </p>
  <div class="fade-up" style="animation-delay:.4s">
    <span class="tag tag-g">rightmost-bit</span>
    <span class="tag tag-b">branch-free</span>
    <span class="tag tag-p">abs/min/max</span>
    <span class="tag tag-o">MUX</span>
    <span class="tag tag-r">overflow-safe</span>
    <span class="tag tag-g">Gosper's trick</span>
    <span class="tag tag-b">Dietz average</span>
  </div>
</div>

<!-- â•â•â• Â§2-1 æœ€å³ä½æ“çºµ â•â•â• -->
<section id="rightmost">
  <div class="sec-header">
    <span class="sec-num">Â§2-1</span>
    <span class="sec-title">æœ€å³ä½æ“çºµ â€” Manipulating Rightmost Bits</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// CORE INSIGHT</span>
    è¡¥ç çš„ç¥å¥‡æ€§è´¨ï¼š<strong>x - 1</strong> ä¼šæŠŠæœ€ä½ä½çš„1æ¸…é›¶å¹¶æŠŠå…¶å³è¾¹æ‰€æœ‰0å˜æˆ1ï¼›
    <strong>x + 1</strong> ä¼šæŠŠæœ€ä½ä½çš„0ç½®1å¹¶æŠŠå…¶å³è¾¹æ‰€æœ‰1å˜æˆ0ã€‚
    åˆ©ç”¨è¿™ä¸¤ä¸ª"çº§è”ç¿»è½¬"æ€§è´¨ï¼Œå¯ä»¥åœ¨ä¸ç”¨æ¡ä»¶è·³è½¬çš„æƒ…å†µä¸‹ç²¾ç¡®æ“çºµä»»æ„ä¸€ä½ã€‚
    è¿™æ˜¯æ•´ä¸ªç¬¬äºŒç« æ‰€æœ‰æŠ€å·§çš„ç‰©ç†åŸºç¡€ã€‚
  </div>

  <!-- äº¤äº’æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.25rem;" x-data="rightmostDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:1rem;">
      ğŸ”¬ äº¤äº’æ¼”ç¤º â€” ç‚¹å‡»æ¯”ç‰¹ä½ï¼Œè§‚å¯Ÿå„å…¬å¼ç»“æœå®æ—¶å˜åŒ–
    </div>
    <div style="margin-bottom:.75rem;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#475569;margin-bottom:.3rem;">è¾“å…¥ xï¼ˆç‚¹å‡»ç¿»è½¬ï¼‰:</div>
      <div class="bit-row">
        <template x-for="(b,i) in bits" :key="i">
          <div class="bit-cell" :class="b?'one':'zero'" @click="toggle(i)" x-text="b"></div>
        </template>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem 1rem;margin-top:.5rem;">
      <template x-for="r in results" :key="r.name">
        <div style="padding:.5rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
          <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--o);margin-bottom:.2rem;" x-text="r.name"></div>
          <div class="bit-result-row">
            <template x-for="(b,j) in r.bits" :key="j">
              <div class="bit-result-cell" :style="{background: b ? 'rgba(0,255,136,.12)' : 'rgba(0,0,0,.3)', color: b ? 'var(--g)' : '#1e293b', border: '1px solid ' + (b?'rgba(0,255,136,.25)':'#1e293b')}" x-text="b"></div>
            </template>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#334155;margin-top:.3rem;" x-text="r.desc"></div>
        </div>
      </template>
    </div>
  </div>

  <!-- å…¬å¼ç½‘æ ¼ -->
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;margin-bottom:1.25rem;">

    <div class="trick-card green">
      <div class="trick-num">TRICK 01</div>
      <div class="trick-title">æ¸…é™¤æœ€å³è¾¹çš„1</div>
      <div class="trick-formula">x &amp; (x - 1)</div>
      <div class="trick-desc">å°†æœ€ä½ä½çš„1å˜ä¸º0ï¼Œå…¶ä½™ä¸å˜ã€‚ç»“æœä¸º0åˆ™xæ˜¯2çš„å¹‚ï¼ˆæˆ–0ï¼‰ã€‚</div>
      <div class="trick-example">01011000 â†’ 01010000</div>
    </div>

    <div class="trick-card blue">
      <div class="trick-num">TRICK 02</div>
      <div class="trick-title">ç½®ä½æœ€å³è¾¹çš„0</div>
      <div class="trick-formula">x | (x + 1)</div>
      <div class="trick-desc">å°†æœ€ä½ä½çš„0å˜ä¸º1ï¼Œå…¶ä½™ä¸å˜ã€‚å…¨1æ—¶äº§ç”Ÿå…¨1ï¼ˆæ— å˜åŒ–ï¼‰ã€‚</div>
      <div class="trick-example">10100111 â†’ 10101111</div>
    </div>

    <div class="trick-card orange">
      <div class="trick-num">TRICK 03</div>
      <div class="trick-title">æ¸…é™¤å°¾éƒ¨è¿ç»­çš„1</div>
      <div class="trick-formula">x &amp; (x + 1)</div>
      <div class="trick-desc">å°†æœ«å°¾è¿ç»­çš„1å…¨éƒ¨æ¸…é›¶ã€‚ç”¨äºæ£€æµ‹xæ˜¯å¦ä¸º2â¿âˆ’1å½¢å¼ã€‚</div>
      <div class="trick-example">10100111 â†’ 10100000</div>
    </div>

    <div class="trick-card purple">
      <div class="trick-num">TRICK 04</div>
      <div class="trick-title">ç½®ä½å°¾éƒ¨è¿ç»­çš„0</div>
      <div class="trick-formula">x | (x - 1)</div>
      <div class="trick-desc">å°†æœ«å°¾è¿ç»­çš„0å…¨éƒ¨ç½®1ï¼Œå½¢æˆ"å°¾å·´"å¡«å……æ•ˆæœã€‚</div>
      <div class="trick-example">10101000 â†’ 10101111</div>
    </div>

    <div class="trick-card green">
      <div class="trick-num">TRICK 05</div>
      <div class="trick-title">æå–æœ€å³è¾¹çš„0ä½æ©ç </div>
      <div class="trick-formula">~x &amp; (x + 1)</div>
      <div class="trick-desc">åœ¨æœ€ä½ä½0å¤„äº§ç”Ÿå•ä¸ª1ï¼Œå…¶ä½™ä¸º0ã€‚å…¨1æ—¶ç»“æœä¸º0ã€‚</div>
      <div class="trick-example">10100111 â†’ 00001000</div>
    </div>

    <div class="trick-card blue">
      <div class="trick-num">TRICK 06</div>
      <div class="trick-title">æå–æœ€å³è¾¹çš„1ä½æ©ç </div>
      <div class="trick-formula">x &amp; (-x)</div>
      <div class="trick-desc">åªä¿ç•™æœ€ä½ä½çš„1ï¼Œå…¶ä½™æ¸…é›¶ã€‚ç­‰ä»·äº x &amp; (~x+1)ã€‚</div>
      <div class="trick-example">01011000 â†’ 00001000</div>
    </div>

    <div class="trick-card orange">
      <div class="trick-num">TRICK 07</div>
      <div class="trick-title">å°¾éƒ¨0çš„è¿ç»­æ©ç </div>
      <div class="trick-formula">~x &amp; (x - 1)</div>
      <div class="trick-desc">åœ¨æ‰€æœ‰å°¾éƒ¨0çš„ä½ç½®äº§ç”Ÿ1ï¼Œå…¶ä½™ä¸º0ã€‚ä¹Ÿå¯ç”¨ (x&amp;-x)-1ã€‚</div>
      <div class="trick-example">01011000 â†’ 00000111</div>
    </div>

    <div class="trick-card purple">
      <div class="trick-num">TRICK 08</div>
      <div class="trick-title">å°¾éƒ¨1çš„ä¼ æ’­ï¼ˆå³å¯¹é½ï¼‰</div>
      <div class="trick-formula">x | (x - 1)</div>
      <div class="trick-desc">å³å¯¹é½æœ€ä½ç¾¤ç»„çš„1ä¸²ï¼Œç”¨äºå­é›†æšä¸¾ã€å†…å­˜å¯¹é½ç­‰ã€‚</div>
      <div class="trick-example">00101100 â†’ 00101111</div>
    </div>

  </div>

  <!-- ä»£ç å®ç° -->
  <div class="card">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tab1='c'">C å®ç°</button>
      <button class="tab-btn" @click="tab1='usage'">å®æˆ˜ç”¨é€”</button>
      <button class="tab-btn" @click="tab1='asm'">æ±‡ç¼–å¯¹æ¯”</button>
    </div>
    <div class="tab-pane" :class="tab1==='c'?'active':''">
      <div class="code-block">
<span class="cm">// 2-1 æœ€å³ä½æ“ä½œå…¨é›† (Warren Â§2-1)</span>
<span class="kw">unsigned</span> x = <span class="num">0x5C</span>; <span class="cm">// 01011100</span>

<span class="cm">// 1. æ¸…é™¤æœ€å³1 â†’ åˆ¤æ–­2çš„å¹‚</span>
<span class="kw">int</span> <span class="fn">is_pow2</span>(x) { <span class="kw">return</span> (x &amp; (x-<span class="num">1</span>)) == <span class="num">0</span>; }

<span class="cm">// 2. æå–æœ€å³1ä½ï¼ˆlowest set bit = LSB trickï¼‰</span>
<span class="kw">unsigned</span> lsb = x &amp; (-x);         <span class="cm">// 00000100</span>

<span class="cm">// 3. æ¸…é™¤æœ€å³ç¾¤è¿ç»­1 (trailing ones)</span>
<span class="kw">unsigned</span> no_trail1 = x &amp; (x+<span class="num">1</span>);  <span class="cm">// 01011000</span>

<span class="cm">// 4. å°¾éƒ¨0æ©ç  (åˆ›å»ºå°¾éƒ¨0çš„mask)</span>
<span class="kw">unsigned</span> trail0_mask = ~x &amp; (x-<span class="num">1</span>); <span class="cm">// 00000011</span>

<span class="cm">// 5. åˆ¤æ–­ x æ˜¯å¦ä¸º 2â¿-1 å½¢å¼</span>
<span class="kw">int</span> <span class="fn">is_2n_minus1</span>(x) { <span class="kw">return</span> (x &amp; (x+<span class="num">1</span>)) == <span class="num">0</span>; }

<span class="cm">// 6. å³ä¼ æ’­æœ€å³1ä½ (smear to the right)</span>
<span class="kw">unsigned</span> smear = x | (x-<span class="num">1</span>);      <span class="cm">// 01011111</span>
      </div>
    </div>
    <div class="tab-pane" :class="tab1==='usage'?'active':''">
      <div class="code-block">
<span class="cm">// â˜… å®æˆ˜1: éå†é›†åˆä¸­æ‰€æœ‰1ä½ (Kernighanæ³•)</span>
<span class="kw">while</span> (x) {
  <span class="fn">process_bit</span>(x &amp; -x);   <span class="cm">// å¤„ç†æœ€ä½ä½1</span>
  x &amp;= x - <span class="num">1</span>;            <span class="cm">// æ¸…é™¤å®ƒ</span>
}  <span class="cm">// popcount(x) æ¬¡è¿­ä»£ï¼Œä¸æ˜¯ 32 æ¬¡</span>

<span class="cm">// â˜… å®æˆ˜2: å†…å­˜åˆ†é…å™¨å¯¹é½ (tcmalloc/jemallocå¸¸è§)</span>
<span class="kw">size_t</span> <span class="fn">round_up_pow2</span>(size_t n) {
  <span class="kw">if</span> ((n &amp; (n-<span class="num">1</span>)) == <span class="num">0</span>) <span class="kw">return</span> n; <span class="cm">// å·²æ˜¯2çš„å¹‚</span>
  <span class="cm">// å¦åˆ™æ‰¾ä¸‹ä¸€ä¸ª2çš„å¹‚ (è§ ch03)</span>
}

<span class="cm">// â˜… å®æˆ˜3: ä½æ£‹ç›˜ (Chess engine bitboard)</span>
<span class="cm">// æå–æœ€ä½ä½æ£‹å­ä½ç½® (LSB = lowest set bit)</span>
<span class="kw">int</span> <span class="fn">lsb_pos</span>(<span class="kw">uint64_t</span> bb) {
  <span class="kw">return</span> __builtin_ctzll(bb);  <span class="cm">// ç­‰ä»· log2(bb &amp; -bb)</span>
}

<span class="cm">// â˜… å®æˆ˜4: å¸ƒéš†è¿‡æ»¤å™¨å“ˆå¸Œæ¢é’ˆ</span>
<span class="kw">uint64_t</span> probe = x &amp; (-x);   <span class="cm">// å•bitæ¢é’ˆï¼Œé˜²æ­¢ç¢°æ’</span>
      </div>
    </div>
    <div class="tab-pane" :class="tab1==='asm'?'active':''">
      <div class="code-block">
<span class="cm">; x86-64: x & (x-1) â†’ 1æ¡æŒ‡ä»¤ BLSR (BMI1)</span>
<span class="fn">blsr</span>   eax, edi      <span class="cm">; eax = edi & (edi-1)</span>

<span class="cm">; x86-64: x & (-x) â†’ 1æ¡æŒ‡ä»¤ BLSI (BMI1)</span>
<span class="fn">blsi</span>   eax, edi      <span class="cm">; æå–æœ€ä½ä½1</span>

<span class="cm">; ARM64: éœ€è¦2æ¡ (no single blsr equiv)</span>
<span class="fn">sub</span>    x1, x0, #1
<span class="fn">and</span>    x0, x0, x1

<span class="cm">; RISC-V: åŒæ ·2æ¡</span>
<span class="fn">addi</span>   t0, a0, -1
<span class="fn">and</span>    a0, a0, t0

<span class="cm">; ç»“è®º: åœ¨BMI1ä¹‹å‰(2013å¹´å‰)æ‰€æœ‰å¹³å°éƒ½è¦2+æ¡</span>
<span class="cm">; Warrenä¹¦ä¸­è¿™äº›æŠ€å·§æ˜¯BMI1çš„"å‰ä½“"</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§2-2 åŠ å‡æ³•æ’ç­‰å¼ â•â•â• -->
<section id="addsub">
  <div class="sec-header">
    <span class="sec-num">Â§2-2</span>
    <span class="sec-title">åŠ å‡æ³•æ’ç­‰å¼ â€” Addition & Subtraction Identities</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE BEAUTIFUL IDENTITIES</span>
    åŠ æ³•å¯ä»¥åˆ†è§£ä¸º"ä¸è¿›ä½æ±‚å’Œ"ï¼ˆXORï¼‰å’Œ"è¿›ä½ä¼ æ’­"ï¼ˆANDï¼‰ä¸¤éƒ¨åˆ†ï¼Œ
    è¿™ä¸ä»…ä»…æ˜¯æ•°å­¦æ¸¸æˆâ€”â€”å®ƒæ­ç¤ºäº†<strong>åŠ æ³•å™¨çš„ç‰©ç†ç»“æ„</strong>ï¼Œ
    ä¹Ÿæ˜¯å¹¶è¡Œå‰ç¼€åŠ æ³•ã€æ— è¿›ä½ä¹˜æ³•ï¼ˆCLMULï¼‰ã€å¯†ç å­¦ä¸­æ— æº¢å‡ºè¿ç®—çš„ç†è®ºåŸºç¡€ã€‚
    Warren åœ¨æ­¤ç»™å‡ºçº¦ 22 ä¸ªæ’ç­‰å¼ï¼Œæ˜¯ä½è¿ç®—å·¥å…·ç®±ä¸­æœ€"æ­£äº¤"çš„ä¸€ç»„ã€‚
  </div>

  <div class="grid-2" style="margin-bottom:1.25rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:1rem;">æ ¸å¿ƒæ’ç­‰å¼ç»„ (åŠ æ³•)</div>
      <div class="code-block">
<span class="cm">// (a) åŠ æ³• = XOR + ANDè¿›ä½</span>
x + y  == (x ^ y) + ((x &amp; y) &lt;&lt; 1)

<span class="cm">// (b) åŠ æ³• = OR + ANDè¿›ä½ (ç­‰ä»·å½¢å¼)</span>
x + y  == (x | y) + (x &amp; y)

<span class="cm">// (c) XOR = åŠ æ³• - è¿›ä½*2</span>
x ^ y  == (x + y) - ((x &amp; y) &lt;&lt; 1)

<span class="cm">// (d) OR = åŠ æ³• - XORçš„åŠ</span>
x | y  == (x + y) - (x &amp; y)

<span class="cm">// (e) AND = OR - XOR (é‡è¦!)</span>
x &amp; y  == (x | y) - (x ^ y)

<span class="cm">// (f) æ— æº¢å‡ºå¹³å‡ (Dietzå…¬å¼)</span>
avg    == (x &amp; y) + ((x ^ y) &gt;&gt; 1)
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--b);margin-bottom:1rem;">æ ¸å¿ƒæ’ç­‰å¼ç»„ (å‡æ³• / XOR)</div>
      <div class="code-block">
<span class="cm">// (g) å‡æ³• = XOR - å€Ÿä½ä¼ æ’­</span>
x - y  == (x ^ y) - ((~x &amp; y) &lt;&lt; 1)

<span class="cm">// (h) XOR ç”¨ 3 æ¡åŸºç¡€æŒ‡ä»¤å®ç°</span>
x ^ y  == (x | y) - (x &amp; y)
<span class="cm">// æˆ–: x ^ y == (x + y) - 2*(x&amp;y)</span>

<span class="cm">// (i) AND ç”¨ OR/NOT å®ç°</span>
x &amp; y  == ~(~x | ~y)    <span class="cm">// DeMorgan</span>

<span class="cm">// (j) OR ç”¨ AND/NOT å®ç°</span>
x | y  == ~(~x &amp; ~y)

<span class="cm">// (k) XOR åªç”¨ AND/OR/NOT (4æ¡)</span>
x ^ y  == (x | y) &amp; ~(x &amp; y)

<span class="cm">// (l) åŠ æ³•å€Ÿä½ä¼ æ’­æ¦‚ç‡ â‰ˆ 0.5</span>
<span class="cm">// é¢„å¤„ç†åé™ä¸º â‰ˆ 0.25 (ç†è®ºä¼˜åŒ–)</span>
      </div>
    </div>
  </div>

  <!-- ECharts 16ç§å¸ƒå°”è¿ç®— -->
  <div class="card" style="margin-bottom:1.25rem;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:.5rem;">
      ğŸ“Š 16ç§äºŒå…ƒå¸ƒå°”è¿ç®—çš„å…¨çœŸå€¼è¡¨åˆ†å¸ƒï¼ˆWarren Table 2-1ï¼‰
    </div>
    <div id="chart-bool" class="chart-wrap" style="height:260px;"></div>
  </div>

  <!-- ä¸ç­‰å¼å…³ç³» -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--b);margin-bottom:.75rem;">Â§2-3 é€»è¾‘ä¸ç®—æœ¯ä¸ç­‰å¼</div>
    <div class="code-block">
<span class="cm">// é€»è¾‘ä¸ç­‰å¼ï¼ˆæŒ‰æ— ç¬¦å·æ•´æ•°è§£é‡Šï¼‰</span>
(x &amp; y) &lt;= x                   <span class="cm">// æ’æˆç«‹</span>
(x &amp; y) &lt;= y                   <span class="cm">// æ’æˆç«‹</span>
x &lt;= (x | y)                   <span class="cm">// æ’æˆç«‹</span>
y &lt;= (x | y)                   <span class="cm">// æ’æˆç«‹</span>
(x ^ y) &lt;= (x | y)             <span class="cm">// æ’æˆç«‹</span>

<span class="cm">// æ··åˆä¸ç­‰å¼ï¼ˆå…³é”®ï¼ï¼‰</span>
|x - y| &lt;= (x ^ y)             <span class="cm">// ç»å¯¹å·® â‰¤ å¼‚æˆ–å€¼</span>
(x | y) - (x ^ y) == (x &amp; y)   <span class="cm">// æ’ç­‰å¼</span>

<span class="cm">// æ³¨æ„: åŠ æ³•ä¸ç­‰å¼ä¸å¯æ›¿æ¢ä¸º OR</span>
<span class="cm">// x+yâ‰¤a && zâ‰¤x â†’ z+yâ‰¤a  âœ“ (arithmetic)</span>
<span class="cm">// x|yâ‰¤a && zâ‰¤x â†’ z|yâ‰¤a  âœ— (logical!) åä¾‹!</span>
    </div>
  </div>
</section>

<!-- â•â•â• Â§2-4/5 ç»å¯¹å€¼/å¹³å‡/æ¯”è¾ƒ â•â•â• -->
<section id="abs">
  <div class="sec-header">
    <span class="sec-num">Â§2-4 ~ Â§2-8</span>
    <span class="sec-title">ç»å¯¹å€¼ / å¹³å‡ / ç¬¦å· / æ¯”è¾ƒ / MUX</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// BRANCH-FREE PHILOSOPHY</span>
    è¿™ä¸€ç»„æŠ€å·§çš„<strong>å…±åŒä¸»é¢˜</strong>æ˜¯ï¼šæŠŠæ‰€æœ‰çš„æ¡ä»¶åˆ¤æ–­ï¼ˆif/elseï¼‰è½¬åŒ–ä¸º
    çº¯ä½æ“ä½œåºåˆ—ï¼Œå½»åº•æ¶ˆç­åˆ†æ”¯ã€‚æ ¸å¿ƒå·¥å…·æ˜¯
    <strong>ç¬¦å·æ©ç  mask = x &gt;&gt; 31</strong>â€”â€”å®ƒå¯¹æ­£æ•°æ˜¯å…¨0ï¼Œå¯¹è´Ÿæ•°æ˜¯å…¨1ï¼Œ
    å¯ä»¥åƒå¼€å…³ä¸€æ ·é€‰æ‹©ä¸¤ç§è®¡ç®—è·¯å¾„ã€‚è¿™ä¸ªæ€æƒ³ç›´æ¥å‚¬ç”Ÿäº† SIMD ä¸­çš„ blendv æŒ‡ä»¤ã€‚
  </div>

  <!-- äº¤äº’å¼ abs/min/max æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.25rem;" x-data="absDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:1rem;">
      ğŸ® branch-free ç»å¯¹å€¼ / min / max æ¼”ç¤º
    </div>
    <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-end;margin-bottom:1rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">x =</div>
        <input type="range" min="-100" max="100" x-model.number="x" style="width:160px;accent-color:var(--g);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--g);margin-left:.5rem;" x-text="x"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">y =</div>
        <input type="range" min="-100" max="100" x-model.number="y" style="width:160px;accent-color:var(--b);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--b);margin-left:.5rem;" x-text="y"></span>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:.6rem;">
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">mask = x >> 31</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;" :style="{color: mask===0?'var(--g)':'var(--r)'}" x-text="mask===0 ? '0x00000000 (xâ‰¥0)' : '0xFFFFFFFF (x<0)'"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">abs(x) = (x+mask)^mask</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--g);" x-text="absX"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">min(x,y) branch-free</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--b);" x-text="minXY"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">max(x,y) branch-free</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--o);" x-text="maxXY"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">avg(x,y) no-overflow</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--p);" x-text="avgXY"></div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">sign(x)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.9rem;" :style="{color: signX>0?'var(--g)': signX<0?'var(--r)':'#475569'}" x-text="signX===1?'+1 (æ­£æ•°)':signX===-1?'-1 (è´Ÿæ•°)':'0 (é›¶)'"></div>
      </div>
    </div>
    <div class="code-block" style="margin-top:.75rem;font-size:.75rem;">
<span class="cm">// æ ¸å¿ƒå®ç° (3~4æ¡æŒ‡ä»¤ï¼Œæ— åˆ†æ”¯)</span>
<span class="kw">int</span> mask = x &gt;&gt; 31;                    <span class="cm">// ç¬¦å·æ©ç </span>
<span class="kw">int</span> abs_x = (x + mask) ^ mask;          <span class="cm">// abs(x)</span>
<span class="kw">int</span> min_xy = y + ((x-y) &amp; ((x-y)&gt;&gt;31)); <span class="cm">// min(x,y)</span>
<span class="kw">int</span> max_xy = x - ((x-y) &amp; ((x-y)&gt;&gt;31)); <span class="cm">// max(x,y)</span>
<span class="kw">int</span> avg_xy = (x &amp; y) + ((x ^ y) &gt;&gt; 1); <span class="cm">// Dietzå¹³å‡</span>
    </div>
  </div>

  <!-- MUX / æ¡ä»¶ç§»åŠ¨ -->
  <div class="grid-2">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--p);margin-bottom:.75rem;">Â§2-9 MUX å¤šè·¯é€‰æ‹©å™¨</div>
      <div class="code-block" style="font-size:.78rem;">
<span class="cm">// MUX(x,y,mask): mask=1 é€‰ x, mask=0 é€‰ y</span>
<span class="cm">// ç­‰ä»·äº: mask ? x : y</span>
mux(x,y,m) = (x &amp; m) | (y &amp; ~m)

<span class="cm">// ä¼˜åŒ–ç‰ˆ (æœ‰ ANDC æŒ‡ä»¤æ—¶ 3æ¡)</span>
mux(x,y,m) = ((x ^ y) &amp; m) ^ y

<span class="cm">// å…¸å‹ç”¨é€”: æ— åˆ†æ”¯ abs</span>
t = x &gt;&gt; 31;       <span class="cm">// å…¨0æˆ–å…¨1</span>
abs = mux(-x, x, t); <span class="cm">// t=1é€‰-x, t=0é€‰x</span>

<span class="cm">// SIMD ç­‰ä»·: SSE4.1 _mm_blendv_epi8</span>
<span class="cm">// ARM NEON: vbslq_u32</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--o);margin-bottom:.75rem;">Â§2-10/11 ç¬¦å·æ¯”è¾ƒä¸æ— ç¬¦å·æ¯”è¾ƒ</div>
      <div class="code-block" style="font-size:.78rem;">
<span class="cm">// æœ‰ç¬¦å· â†’ æ— ç¬¦å·è½¬æ¢ (åç§»2Â³Â¹)</span>
x &lt;_s y  â‰¡  (x ^ 0x80000000) &lt;_u (y ^ 0x80000000)

<span class="cm">// ä»æ— ç¬¦å·æ¯”è¾ƒå¾—åˆ°æœ‰ç¬¦å·æ¯”è¾ƒ</span>
<span class="cm">// åªéœ€ç¿»è½¬ä¸¤ä¸ªæ“ä½œæ•°çš„ç¬¦å·ä½</span>

<span class="cm">// 7æ¡æŒ‡ä»¤å®ç°æœ‰ç¬¦å· xâ‰¤y (åŸºç¡€RISC)</span>
t1 = x - y;         <span class="cm">// å·®å€¼</span>
t2 = x ^ y;         <span class="cm">// XORæ£€æµ‹ç¬¦å·å·®å¼‚</span>
t3 = t1 ^ t2;       <span class="cm">// ä¿®æ­£æº¢å‡º</span>
<span class="cm">// t3çš„ç¬¦å·ä½å³ä¸º xâ‰¤y çš„ç»“æœ</span>

<span class="cm">// Javaå®ç”¨æŠ€å·§ (Javaæ— unsigned):</span>
x &lt;_u y  â‰¡  (x + 0x80000000) &lt;_s (y + 0x80000000)
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§2-12~2-20 ç‰¹æ®ŠæŠ€å·§åˆé›† â•â•â• -->
<section id="special">
  <div class="sec-header">
    <span class="sec-num">Â§2-12 ~ Â§2-20</span>
    <span class="sec-title">ç‰¹æ®ŠæŠ€å·§åˆé›† â€” æº¢å‡ºæ£€æµ‹ / é¥±å’Œè¿ç®— / Horner / ä½åŸŸ</span>
    <div class="sec-divider"></div>
  </div>

  <div class="grid-3" style="margin-bottom:1.25rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.6rem;">Â§2-12 æº¢å‡ºæ£€æµ‹</div>
      <div class="code-block" style="font-size:.75rem;">
<span class="cm">// æœ‰ç¬¦å·åŠ æ³•æº¢å‡ºæ£€æµ‹</span>
<span class="cm">// ç»å…¸é”™æ³• (UB in C!):</span>
<span class="cm">// if (x + y &lt; x) // â† UB</span>

<span class="cm">// âœ… æ­£ç¡®: ç¬¦å·ä½æ£€æµ‹</span>
<span class="kw">int</span> sum = x + y;
<span class="kw">int</span> ov = ((x ^ sum) &amp;
           (y ^ sum)) &gt;&gt; 31;
<span class="cm">// ov=-1 æº¢å‡º, ov=0 ä¸æº¢å‡º</span>

<span class="cm">// æˆ–ç”¨ __builtin_add_overflow()</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.6rem;">Â§2-13 é¥±å’Œè¿ç®— (Saturating)</div>
      <div class="code-block" style="font-size:.75rem;">
<span class="cm">// é¥±å’ŒåŠ æ³•: æº¢å‡ºæ—¶é’³åˆ¶åˆ°MAX/MIN</span>
<span class="cm">// ç”¨é€”: éŸ³é¢‘/å›¾åƒå¤„ç†é˜²æˆªæ–­</span>
<span class="kw">int</span> <span class="fn">sat_add</span>(<span class="kw">int</span> x, <span class="kw">int</span> y) {
  <span class="kw">int</span> r = x + y;
  <span class="cm">// æ£€æµ‹æº¢å‡º</span>
  <span class="kw">int</span> ov = ((x ^ r) &amp; (y ^ r)) &gt;&gt; 31;
  <span class="cm">// ov=0: r; ov=-1: MAXæˆ–MIN</span>
  <span class="kw">int</span> sat = (r &gt;&gt; 31) ^ INT_MAX;
  <span class="kw">return</span> ov ? sat : r;
}
<span class="cm">// ARM: QADD  x86: _mm_adds_epi16</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.6rem;">Â§2-14/15 ä½åŸŸæ“ä½œ</div>
      <div class="code-block" style="font-size:.75rem;">
<span class="cm">// ç¬¦å·æ‰©å±• nä½ â†’ 32ä½</span>
<span class="kw">int</span> <span class="fn">sign_ext</span>(x, n) {
  <span class="kw">int</span> shift = 32 - n;
  <span class="kw">return</span> (x &lt;&lt; shift) &gt;&gt; shift;
}

<span class="cm">// æ’å…¥/æå–ä½åŸŸ</span>
<span class="cm">// ä»ä½ç½®på–nä½:</span>
field = (x &gt;&gt; p) &amp; ((1&lt;&lt;n)-1);

<span class="cm">// åœ¨ä½ç½®pæ’å…¥nä½å€¼v:</span>
mask = ((1&lt;&lt;n)-1) &lt;&lt; p;
x = (x &amp; ~mask) | ((v&lt;&lt;p) &amp; mask);
      </div>
    </div>
  </div>

  <div class="grid-2" style="margin-bottom:1.25rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.6rem;">Â§2-16 Hornerè§„åˆ™ â€” å¤šé¡¹å¼æ±‚å€¼</div>
      <div class="code-block" style="font-size:.78rem;">
<span class="cm">// Horner è§„åˆ™: axÂ³+bxÂ²+cx+d</span>
<span class="cm">// = ((ax+b)x+c)x+d</span>
<span class="cm">// å‡å°‘ä¹˜æ³•æ¬¡æ•°: næ¬¡ä¹˜, næ¬¡åŠ </span>

<span class="cm">// ç»å…¸ç”¨æ³•: å“ˆå¸Œå‡½æ•°</span>
<span class="kw">uint32_t</span> hash = <span class="num">0</span>;
<span class="kw">for</span> (<span class="kw">int</span> i = 0; s[i]; i++)
  hash = hash * <span class="num">31</span> + s[i]; <span class="cm">// Horner</span>

<span class="cm">// ä¹˜ä»¥31: 5æ¡æŒ‡ä»¤(ç§»ä½+å‡æ³•)</span>
hash * 31 == (hash &lt;&lt; 5) - hash

<span class="cm">// Java String.hashCode() å°±æ˜¯è¿™ä¸ª</span>
<span class="cm">// Reed-Mulleråˆ†è§£çš„ä»£æ•°åŸºç¡€</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.6rem;">Â§2-17/18 åŒå­—ç§»ä½ / å¤šå­—èŠ‚SIMD</div>
      <div class="code-block" style="font-size:.78rem;">
<span class="cm">// 64ä½å·¦ç§» (ç”¨ä¸¤ä¸ª32ä½å¯„å­˜å™¨)</span>
<span class="cm">// shld r, s, n: ç­‰æ•ˆ (r,s) &lt;&lt; n</span>
<span class="kw">unsigned</span> hi, lo; <span class="cm">// 64ä½æ•°</span>
hi = (hi &lt;&lt; n) | (lo &gt;&gt; (32-n));
lo = lo &lt;&lt; n;
<span class="cm">// æ³¨æ„: n=0æˆ–32éœ€ç‰¹æ®Šå¤„ç†</span>

<span class="cm">// SIMDå¤šå­—èŠ‚åŠ æ³• (4Ã—byte packed)</span>
<span class="cm">// Step1: å±è”½é«˜ä½é˜²æ­¢è¿›ä½ç©¿é€</span>
lo  = (x &amp; 0x7F7F7F7F) + (y &amp; 0x7F7F7F7F);
<span class="cm">// Step2: ä¿®å¤æ¯å­—èŠ‚çš„æœ€é«˜ä½</span>
hi  = (x ^ y) &amp; 0x80808080;
sum = lo ^ hi;
      </div>
    </div>
  </div>

  <!-- å¸ƒå°”å‡½æ•°åˆ†è§£å®šç† -->
  <div class="card">
    <div style="
      font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:.75rem;">
      Â§2-20 å¸ƒå°”å‡½æ•°åˆ†è§£å®šç† (Reed-Muller / æ­£Davioåˆ†è§£)
    </div>
    <div class="insight" style="margin-bottom:.75rem;">
      <span class="label">// THE DECOMPOSITION THEOREM</span>
      ä»»æ„ n å…ƒå¸ƒå°”å‡½æ•°éƒ½å¯ä»¥ç”¨<strong>1æ¡ XOR + 2ä¸ª (n-1) å…ƒå¸ƒå°”å‡½æ•°</strong>é€’å½’è¡¨ç¤ºï¼š
      <code style="color:var(--o);">f(x,y,z) = g(x,y) âŠ• zÂ·h(x,y)</code>ã€‚
      è¿™ä¸ªå®šç†ä¿è¯äº†ä»»æ„å¸ƒå°”å‡½æ•°éƒ½å¯ä»¥ç”¨ AND/OR/XOR/NOT çš„æœ‰é™ç»„åˆå®ç°ï¼Œ
      æ˜¯ç¼–è¯‘å™¨å¸ƒå°”ä¼˜åŒ–å’Œç¡¬ä»¶ç»¼åˆçš„ç†è®ºåŸºç¡€ï¼ˆä¹Ÿç§°"æ­£Davioåˆ†è§£"æˆ–"ä¿„ç½—æ–¯åˆ†è§£"ï¼‰ã€‚
    </div>
    <div class="code-block">
<span class="cm">// å®šç†: f(x,y,z) = g(x,y) XOR (z AND h(x,y))</span>
<span class="cm">// å…¶ä¸­ g(x,y) = f(x,y,0),  h(x,y) = f(x,y,0) XOR f(x,y,1)</span>
<span class="cm">// é€’å½’å±•å¼€åˆ°1å˜é‡: f(x) = f(0) XOR (x AND (f(0) XOR f(1)))</span>

<span class="cm">// å®ç°ä»»æ„3å˜é‡å¸ƒå°”å‡½æ•°æ‰€éœ€æœ€å°‘æŒ‡ä»¤æ•°:</span>
<span class="cm">// 1æ¡: NOT, å¸¸æ•°0/1</span>
<span class="cm">// 2æ¡: å¤§å¤šæ•°æ ‡å‡†é—¨(AND/OR/XOR/NAND/NOR)</span>
<span class="cm">// 3æ¡: å¤§å¤šæ•°3å˜é‡å‡½æ•°(224/256ç§)</span>
<span class="cm">// 4æ¡: å‰©ä½™32ç§è¾ƒå¤æ‚å‡½æ•°(å«å¤šæ•°è¡¨å†³å‡½æ•°ç­‰)</span>

<span class="cm">// æ¨è®º: Horneræ±‚å€¼ â€” æŠŠå¤šé¡¹å¼å˜æˆåµŒå¥—ä¹˜åŠ </span>
<span class="cm">// axÂ³+bxÂ²+cx+d = ((ax+b)x+c)x+d</span>
<span class="cm">// â†’ næ¬¡ä¹˜ + næ¬¡åŠ ï¼Œæœ€ä¼˜æŒ‡ä»¤æ•°</span>
<span class="kw">int</span> <span class="fn">horner3</span>(<span class="kw">int</span> x, <span class="kw">int</span> a,<span class="kw">int</span> b,<span class="kw">int</span> c,<span class="kw">int</span> d){
  <span class="kw">return</span> (((a*x + b)*x + c)*x + d);
}
    </div>
  </div>
</section>

<!-- â•â•â• Â§2 GOSPER ç®—æ³• â•â•â• -->
<section id="gosper">
  <div class="sec-header">
    <span class="sec-num">Â§2-GOSPER</span>
    <span class="sec-title">Gosper's Hack â€” æšä¸¾æ‰€æœ‰å« k ä¸ª1çš„ n ä½æ•°</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE CROWN JEWEL OF CHAPTER 2</span>
    è¿™æ˜¯ç¬¬äºŒç« æœ€ä»¤äººå‡»èŠ‚å«ç»çš„ç®—æ³•ã€‚ç»™å®šä¸€ä¸ªå« k ä¸ª1çš„ n ä½æ•´æ•° xï¼Œ
    æ±‚<strong>ä¸‹ä¸€ä¸ªå«åŒæ ·å¤š1çš„æœ€å°æ•´æ•°</strong>ã€‚
    æ¥è‡ª 1972 å¹´ MIT HAKMEMï¼ˆBill Gosperï¼‰ï¼Œ5è¡Œä»£ç ï¼Œ0ä¸ªåˆ†æ”¯ï¼Œçº¯ä½è¿ç®—ã€‚
    å®ƒæ˜¯æ£‹ç›˜å¼•æ“å­é›†æšä¸¾ã€ç»„åˆæ•°å­¦æœç´¢ã€ç¥ç»ç½‘ç»œå‰ªææ©ç æšä¸¾çš„æ ¸å¿ƒå¼•æ“ã€‚
  </div>

  <!-- Gosper äº¤äº’æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.25rem;" x-data="gosperDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:1rem;">
      ğŸŒŸ Gosper's Hack é€æ­¥å¯è§†åŒ– â€” ç‚¹å‡» NEXT æšä¸¾ä¸‹ä¸€ä¸ª
    </div>
    <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center;margin-bottom:1rem;">
      <div>
        <span style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#475569;">å½“å‰å€¼ x = </span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--g);" x-text="'0x'+cur.toString(16).toUpperCase().padStart(8,'0')"></span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:#475569;margin-left:.5rem;" x-text="'(å«'+popcount(cur)+'ä¸ª1)'"></span>
      </div>
      <button @click="next()" class="tab-btn active" style="font-size:.75rem;padding:.4rem 1rem;">NEXT â†’</button>
      <button @click="reset()" class="tab-btn" style="font-size:.75rem;padding:.4rem 1rem;">RESET</button>
    </div>

    <!-- å½“å‰xçš„ä½å›¾ -->
    <div style="margin-bottom:.75rem;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">x (å½“å‰):</div>
      <div class="bit-row">
        <template x-for="(b,i) in toBits(cur)" :key="i">
          <div class="bit-cell" :class="b?'one':'zero'" x-text="b"></div>
        </template>
      </div>
    </div>

    <!-- åˆ†è§£æ­¥éª¤ -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:.75rem;">
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.6rem .75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--o);margin-bottom:.2rem;">Step 1: c = x &amp; -xï¼ˆæœ€ä½ä½1ï¼‰</div>
        <div class="bit-row" style="gap:2px;">
          <template x-for="(b,i) in toBits(steps.c)" :key="i">
            <div class="bit-result-cell" :style="{width:'22px',height:'22px',fontSize:'.7rem',borderRadius:'2px',background:b?'rgba(255,140,0,.15)':'rgba(0,0,0,.3)',color:b?'var(--o)':'#1e293b',border:'1px solid '+(b?'rgba(255,140,0,.3)':'#1e293b')}" x-text="b"></div>
          </template>
        </div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.6rem .75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--b);margin-bottom:.2rem;">Step 2: r = x + cï¼ˆè¿›ä½ä¼ æ’­ï¼‰</div>
        <div class="bit-row" style="gap:2px;">
          <template x-for="(b,i) in toBits(steps.r)" :key="i">
            <div class="bit-result-cell" :style="{width:'22px',height:'22px',fontSize:'.7rem',borderRadius:'2px',background:b?'rgba(0,212,255,.15)':'rgba(0,0,0,.3)',color:b?'var(--b)':'#1e293b',border:'1px solid '+(b?'rgba(0,212,255,.3)':'#1e293b')}" x-text="b"></div>
          </template>
        </div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.6rem .75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--p);margin-bottom:.2rem;">Step 3: ones = (((r^x)/c)>>2)+1ï¼ˆè¡¥å……ä½ä½1ï¼‰</div>
        <div class="bit-row" style="gap:2px;">
          <template x-for="(b,i) in toBits(steps.ones)" :key="i">
            <div class="bit-result-cell" :style="{width:'22px',height:'22px',fontSize:'.7rem',borderRadius:'2px',background:b?'rgba(177,79,255,.15)':'rgba(0,0,0,.3)',color:b?'var(--p)':'#1e293b',border:'1px solid '+(b?'rgba(177,79,255,.3)':'#1e293b')}" x-text="b"></div>
          </template>
        </div>
      </div>
      <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.6rem .75rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);margin-bottom:.2rem;">Result: next = r | ones</div>
        <div class="bit-row" style="gap:2px;">
          <template x-for="(b,i) in toBits(steps.next)" :key="i">
            <div class="bit-result-cell" :style="{width:'22px',height:'22px',fontSize:'.7rem',borderRadius:'2px',background:b?'rgba(0,255,136,.15)':'rgba(0,0,0,.3)',color:b?'var(--g)':'#1e293b',border:'1px solid '+(b?'rgba(0,255,136,.3)':'#1e293b')}" x-text="b"></div>
          </template>
        </div>
      </div>
    </div>

    <!-- å†å²åºåˆ— -->
    <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#334155;margin-bottom:.5rem;">æšä¸¾åºåˆ—ï¼ˆæœ€å¤šæ˜¾ç¤º12ä¸ªï¼‰:</div>
    <div style="display:flex;flex-wrap:wrap;gap:.4rem;">
      <template x-for="(v,i) in history.slice(-12)" :key="i">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;padding:.2rem .5rem;border-radius:3px;"
             :style="{background: i===history.slice(-12).length-1?'rgba(0,255,136,.15)':'rgba(30,41,59,.5)',color:i===history.slice(-12).length-1?'var(--g)':'#475569',border:'1px solid '+(i===history.slice(-12).length-1?'rgba(0,255,136,.3)':'#1e293b')}"
             x-text="'0x'+v.toString(16).toUpperCase()">
        </div>
      </template>
    </div>
  </div>

  <!-- Gosper ä»£ç  -->
  <div class="card">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tabGosper='c'">C å®ç°</button>
      <button class="tab-btn" @click="tabGosper='explain'">åŸç†è§£æ</button>
      <button class="tab-btn" @click="tabGosper='apps'">å®æˆ˜ç”¨é€”</button>
    </div>
    <div class="tab-pane" :class="tabGosper==='c'?'active':''">
      <div class="code-block">
<span class="cm">// Gosper's Hack â€” æ±‚å«ç›¸åŒæ•°é‡1ä½çš„ä¸‹ä¸€ä¸ªæ›´å¤§æ•´æ•°</span>
<span class="cm">// æ¥æº: HAKMEM AIM-239, MIT 1972, Bill Gosper</span>
<span class="kw">unsigned</span> <span class="fn">next_perm</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">unsigned</span> c = x &amp; -x;         <span class="cm">// Step1: æœ€ä½ä½çš„1 (lowest set bit)</span>
  <span class="kw">unsigned</span> r = x + c;           <span class="cm">// Step2: è¿›ä½ä¼ æ’­ï¼Œæ¸…é™¤æœ€ä½è¿ç»­1ä¸²å¹¶è¿›ä½</span>
  <span class="cm">// Step3: è®¡ç®—éœ€è¦è¡¥åˆ°ä½ä½çš„1çš„ä¸ªæ•°</span>
  <span class="kw">unsigned</span> ones = (((r ^ x) / c) &gt;&gt; 2) + <span class="num">1</span>;
  <span class="kw">return</span> r | ones;              <span class="cm">// Step4: åˆå¹¶é«˜ä½å’Œä½ä½</span>
}

<span class="cm">// æ›´å¿«çš„ç‰ˆæœ¬ (é¿å…é™¤æ³•ï¼Œç”¨ nlz æŒ‡ä»¤):</span>
<span class="kw">unsigned</span> <span class="fn">next_perm_fast</span>(<span class="kw">unsigned</span> x) {
  <span class="kw">unsigned</span> t = x | (x - <span class="num">1</span>);     <span class="cm">// å°¾éƒ¨0å…¨éƒ¨å¡«1</span>
  <span class="kw">return</span> (t + <span class="num">1</span>) | (((~t &amp; -~t) - <span class="num">1</span>) &gt;&gt; (__builtin_ctz(x) + <span class="num">1</span>));
}

<span class="cm">// æšä¸¾æ‰€æœ‰8ä½ä¸­å«3ä¸ª1çš„é›†åˆ:</span>
<span class="kw">unsigned</span> x = <span class="num">0b00000111</span>;  <span class="cm">// èµ·å§‹: æœ€å°çš„å«3ä¸ª1çš„æ•°</span>
<span class="kw">do</span> {
  <span class="fn">process</span>(x);
  x = <span class="fn">next_perm</span>(x);
} <span class="kw">while</span> (x &lt; (1u &lt;&lt; 8));    <span class="cm">// C(8,3) = 56æ¬¡è¿­ä»£</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabGosper==='explain'?'active':''">
      <div class="code-block">
<span class="cm">// ä»¥ x = 0b00101100 (å«3ä¸ª1) ä¸ºä¾‹é€æ­¥è¿½è¸ª:</span>

x    = 0b <span class="hi">00101100</span>   <span class="cm">// åŸå§‹å€¼</span>
c    = x &amp; -x
     = 0b 00000100   <span class="cm">// æœ€ä½ä½1 = bit2</span>

r    = x + c
     = 0b 00110000   <span class="cm">// æœ€ä½è¿ç»­1ä¸²(bits2-3)è¢«æ¸…é›¶å¹¶è¿›ä½åˆ°bit4</span>
                     <span class="cm">// æ³¨æ„: rçš„popcountæ¯”xå°‘äº†é‚£ä¸²1çš„ä¸ªæ•°-1</span>

r^x  = 0b 00011100   <span class="cm">// å˜åŒ–çš„ä½ (è¢«æ¸…é›¶çš„è¿ç»­1 + æ–°ç½®ä½çš„é«˜ä½)</span>

(r^x)/c              <span class="cm">// å³å¯¹é½: æŠŠå˜åŒ–æ©ç é™¤ä»¥æœ€ä½ä½1</span>
     = 0b 00000111   <span class="cm">// å¾—åˆ° 2^(ç¾¤é•¿åº¦+1) - 1</span>

&gt;&gt;2  = 0b 00000001   <span class="cm">// å»æ‰é«˜ä½çš„è¿›ä½ä½å’ŒåŸæœ€ä½ä½1</span>
+1   = 0b 00000001   <span class="cm">// è¡¥è¶³ä½ä½éœ€è¦è¡¥çš„1çš„æ•°é‡(æ­¤å¤„1ä¸ª)</span>

r|ones= 0b 00110001  <span class="cm">// âœ… å«3ä¸ª1çš„ä¸‹ä¸€ä¸ªæ›´å¤§æ•´æ•°</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabGosper==='apps'?'active':''">
      <div class="code-block">
<span class="cm">// â˜… ç”¨é€”1: å›½é™…è±¡æ£‹å¼•æ“ bitboard (Stockfish/Leela)
// æšä¸¾æ‰€æœ‰"è½¦èƒ½æ”»å‡»çš„æ ¼å­ç»„åˆ"</span>
<span class="kw">uint64_t</span> subset = <span class="num">0</span>;
<span class="kw">do</span> {
  eval_rook_attacks(subset);
  subset = <span class="fn">next_perm</span>(subset) &amp; attack_mask;
} <span class="kw">while</span> (subset);

<span class="cm">// â˜… ç”¨é€”2: ç»„åˆå­¦ â€” æšä¸¾ C(n,k) æ‰€æœ‰å­é›†</span>
<span class="cm">// æ¯”é€’å½’æšä¸¾å¿« ~10xï¼Œå› ä¸ºå®Œå…¨æ— åˆ†æ”¯ã€æ— é€’å½’æ ˆ</span>
<span class="kw">for</span> (<span class="kw">unsigned</span> s=(1&lt;&lt;k)-1; s&lt;(1u&lt;&lt;n); s=<span class="fn">next_perm</span>(s))
  <span class="fn">process_subset</span>(s, n);

<span class="cm">// â˜… ç”¨é€”3: ç¥ç»ç½‘ç»œç¨€ç–åŒ–æ©ç æœç´¢
// åœ¨ç›¸åŒç¨€ç–åº¦çº¦æŸä¸‹æœç´¢æœ€ä¼˜æƒé‡æ©ç </span>

<span class="cm">// â˜… ç”¨é€”4: èƒŒåŒ…é—®é¢˜ç²¾ç¡®ç®—æ³•çš„ä½å‰ªæ
// åœ¨å›ºå®šé¢„ç®—ä¸‹æšä¸¾æ‰€æœ‰"æ°å¥½é€‰kä»¶å•†å“"çš„æ–¹æ¡ˆ</span>

<span class="cm">// æ•°é‡: C(32,k) æœ€å¤§çº¦ 6äº¿ (k=16)
// å®é™…åº”ç”¨ä¸€èˆ¬ nâ‰¤20ï¼ŒC(20,10)â‰ˆ18ä¸‡ï¼Œæ¯«ç§’çº§</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• å†å²æ¼”å˜ â•â•â• -->
<section id="history">
  <div class="sec-header">
    <span class="sec-num">Â§HIST</span>
    <span class="sec-title">å†å²æ¼”å˜ â€” è¿™äº›æŠ€å·§ä»å“ªé‡Œæ¥</span>
    <div class="sec-divider"></div>
  </div>

  <div class="grid-2">
    <div class="timeline">
      <div class="tl-item">
        <div class="tl-dot"></div>
        <div class="tl-year">1961 â€” Christopher Strachey</div>
        <div class="tl-title">ã€ŠBitwise Operationsã€‹CACMè®ºæ–‡</div>
        <div class="tl-desc">
          æœ€æ—©æ­£å¼å‘è¡¨ä½æ“ä½œç†è®ºçš„æ–‡ç« ï¼Œå‘è¡¨äº Communications of the ACM 4(3)ã€‚
          Strachey æ˜¯ CPL è¯­è¨€çš„å‘æ˜äººï¼Œä¹Ÿæ˜¯æŒ‡ç§°è¯­ä¹‰å­¦ï¼ˆdenotational semanticsï¼‰çš„å¥ åŸºè€…ã€‚
          ä»–åœ¨è¿™ç¯‡3é¡µå°æ–‡ä¸­å°±ç»™å‡ºäº†ç”¨ XOR å®ç°åŠ æ³•çš„æ€è·¯ï¼Œæ¯”ä¹¦ä¸­æ’ç­‰å¼æ—©äº†40å¹´ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--b);box-shadow:0 0 8px var(--b);"></div>
        <div class="tl-year">1972 â€” Bill Gosper, HAKMEM</div>
        <div class="tl-title">MIT AI Lab AIM-239ï¼Œä½æ“ä½œåœ£ç»</div>
        <div class="tl-desc">
          Gosperã€Beelerã€Schroeppel åœ¨ PDP-10 ä¸Šç§¯ç´¯çš„æŠ€å·§ï¼ŒåŒ…æ‹¬æœ¬ç« çš„ Gosper's Hackã€
          äººå£è®¡æ•°ï¼ˆpopcountï¼‰ç®—æ³•ã€å¾ªç¯æ£€æµ‹ç­‰ã€‚Warren ç¬¬2ç« æœ€äº®çœ¼çš„å‡ ä¸ªæŠ€å·§éƒ½æºè‡ªæ­¤å¤‡å¿˜å½•ã€‚
          Gosper åæ¥æŠŠ Gosper's Hack ç”¨äº Scheme çš„å°¾é€’å½’ä¼˜åŒ–ï¼Œä»¤äººå«ç»ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--p);box-shadow:0 0 8px var(--p);"></div>
        <div class="tl-year">1986 â€” Henry Dietz</div>
        <div class="tl-title">æ— æº¢å‡ºå¹³å‡å€¼å…¬å¼</div>
        <div class="tl-desc">
          Dietz åœ¨ aggregate.org/MAGIC/ å‘å¸ƒäº†å¤§é‡ä½è¿ç®—é­”æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬è‘—åçš„
          <code style="color:var(--o);">(x&y)+((x^y)>>1)</code>
          æ— æº¢å‡ºæ•´æ•°å¹³å‡å…¬å¼ã€‚è¿™ä¸ªå…¬å¼çœ‹èµ·æ¥å¹³æ·¡ï¼Œä½†å®ƒæ­£ç¡®åœ°å¤„ç†äº†ä¸¤ä¸ªå¤§æ­£æ•´æ•°ç›¸åŠ è¶…è¿‡
          INT_MAX çš„æƒ…å†µï¼Œæ˜¯æ‰€æœ‰ SIMD åº“çš„åŸºç¡€ç»„ä»¶ä¹‹ä¸€ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--o);box-shadow:0 0 8px var(--o);"></div>
        <div class="tl-year">1992 â€” GCC / GNU Superoptimizer</div>
        <div class="tl-title">ç¼–è¯‘å™¨å¼€å§‹è‡ªåŠ¨å‘ç°ä½æ“ä½œæŠ€å·§</div>
        <div class="tl-desc">
          Granlund å’Œ Kenner åœ¨ PLDI 1992 å‘è¡¨è®ºæ–‡ï¼Œæè¿°å¦‚ä½•ç”¨è¶…çº§ä¼˜åŒ–å™¨ï¼ˆGNU Superoptimizerï¼‰
          è‡ªåŠ¨æ‰¾åˆ°ç­‰ä»·ä½†æ›´çŸ­çš„æŒ‡ä»¤åºåˆ—ã€‚GCC ä¸º RS/6000 ç”Ÿæˆçš„éƒ¨åˆ†ä»£ç å·²ç»åŒ…å«äº†
          æœ¬ç« ä¸­ abs/min/max çš„ branch-free å½¢å¼â€”â€”æœºå™¨æ¯”äººå…ˆæŒæ¡äº†è¿™äº›æŠ€å·§ã€‚
        </div>
      </div>
      <div class="tl-item">
        <div class="tl-dot" style="background:var(--g);box-shadow:0 0 8px var(--g);"></div>
        <div class="tl-year">2013 â€” x86 BMI1/BMI2 æŒ‡ä»¤é›†</div>
        <div class="tl-title">è½¯ä»¶æŠ€å·§çƒ§è¿›ç¡¬ä»¶</div>
        <div class="tl-desc">
          Intel Haswell å¼•å…¥ BMI1ï¼ˆBLSR, BLSI, BLSMSK, TZCNTï¼‰å’Œ BMI2ï¼ˆPEXT, PDEPï¼‰ï¼Œ
          ç›´æ¥æŠŠç¬¬2ç« çš„æœ€å³ä½æ“ä½œå˜æˆå•æ¡æŒ‡ä»¤ã€‚Warren è¿™äº›"5æ¡æŒ‡ä»¤æŠ€å·§"ä¸€å¤œä¹‹é—´å˜æˆ"1æ¡æŒ‡ä»¤"ã€‚
          AMD çš„ ABM æ‰©å±•ï¼ˆLZCNT, POPCNTï¼‰åŒæ ·å¦‚æ­¤ã€‚è¿™ç§"å…ˆè½¯ä»¶å†ç¡¬ä»¶"çš„è½¨è¿¹ï¼Œ
          åœ¨è®¡ç®—æœºä½“ç³»ç»“æ„å²ä¸Šåå¤ä¸Šæ¼”ã€‚
        </div>
      </div>
    </div>

    <div>
      <!-- ECharts: æŠ€å·§æ¥æºåˆ†å¸ƒ -->
      <div class="card" style="margin-bottom:1.25rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--g);margin-bottom:.5rem;">
          ğŸ“Š ç¬¬2ç« æŠ€å·§æ¥æºåˆ†å¸ƒ
        </div>
        <div id="chart-src" style="width:100%;height:220px;"></div>
      </div>

      <!-- ECharts: æŒ‡ä»¤æ•°å¯¹æ¯” -->
      <div class="card">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--b);margin-bottom:.5rem;">
          ğŸ“Š å„æŠ€å·§åœ¨ä¸åŒå¹³å°çš„æŒ‡ä»¤æ•°å¯¹æ¯”
        </div>
        <div id="chart-instr" style="width:100%;height:240px;"></div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• æ·±åº¦ç‚¹è¯„ â•â•â• -->
<section id="critique">
  <div class="sec-header">
    <span class="sec-num">Â§CRITIQUE</span>
    <span class="sec-title">æ·±åº¦ç‚¹è¯„ â€” æŠ€æœ¯å“²å­¦ä¸æ‰¹åˆ¤æ€§åˆ†æ</span>
    <div class="sec-divider"></div>
  </div>

  <div class="critic-box">
    <h3>ä¸ºä»€ä¹ˆè¿™äº›"é›•è™«å°æŠ€"å€¼å¾—è®¤çœŸå¯¹å¾…ï¼Ÿ</h3>

    <div class="critic-item">
      <div class="ci-title">branch-free çš„æœ¬è´¨ï¼šæŠŠæ§åˆ¶æµå˜æˆæ•°æ®æµ</div>
      <p>
        Warren å¯¹"æ— åˆ†æ”¯ä»£ç "çš„åçˆ±ä¸æ˜¯ç™–å¥½ï¼Œè€Œæ˜¯ä¸€ç§<strong style="color:#f1f5f9;">ç¼–ç¨‹èŒƒå¼çš„è½¬æ¢</strong>ã€‚
        åˆ†æ”¯æ„å‘³ç€"æ ¹æ®æ•°æ®çš„å€¼ï¼Œèµ°ä¸åŒçš„è·¯å¾„"ï¼›è€Œæ— åˆ†æ”¯ä»£ç æŠŠè¿™ä¸ªé€‰æ‹©æœ¬èº«ä¹Ÿå˜æˆäº†æ•°æ®â€”â€”
        ç”¨ç¬¦å·æ©ç  <code style="color:var(--o);">mask = x >> 31</code> è®©æ•°æ®è‡ªå·±å†³å®šç»“æœã€‚
        è¿™æ­£æ˜¯ GPU/SIMD ç¼–ç¨‹çš„å“²å­¦ï¼šåœ¨å‘é‡åŒ–ç¯å¢ƒä¸­æ²¡æœ‰"åˆ†æ”¯"ï¼Œåªæœ‰"æ©ç é€‰æ‹©"ã€‚
        SSE4.1 çš„ <code>_mm_blendv_epi8</code>ã€AVX512 çš„è°“è¯æ©ç å¯„å­˜å™¨ï¼Œéƒ½æ˜¯è¿™ä¸ªæ€æƒ³çš„ç¡¬ä»¶åŒ–ã€‚
        Warren åœ¨2002å¹´å°±ç”¨çº¯è½¯ä»¶é¢„æ¼”äº†æ•´ä¸ª SIMD æ—¶ä»£çš„æ ¸å¿ƒç¼–ç¨‹æ¨¡å‹ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">Dietz å¹³å‡å…¬å¼ï¼šä¸€ä¸ªè¢«ä½ä¼°çš„å®‰å…¨è¡¥ä¸</div>
      <p>
        <code style="color:var(--o);">(lo + hi) / 2</code> æ˜¯äºŒåˆ†æœç´¢çš„ç»å…¸å†™æ³•ï¼Œä¹Ÿæ˜¯ Java æ ‡å‡†åº“é‡Œ
        æ›¾ç»å­˜åœ¨çš„ä¸€ä¸ª bugï¼ˆJoshua Bloch åœ¨2006å¹´åšå®¢ä¸­æŠ«éœ²ï¼ŒJDK çš„
        <code>Arrays.binarySearch</code> åœ¨æ•°ç»„æå¤§æ—¶ä¼šæ•´æ•°æº¢å‡ºï¼Œ
        æ½œä¼äº†å°†è¿‘10å¹´ï¼‰ã€‚<strong style="color:#f1f5f9;">æ­£ç¡®å†™æ³•æ˜¯ Dietz å…¬å¼</strong>ï¼š
        <code style="color:var(--o);">(lo & hi) + ((lo ^ hi) >> 1)</code>ï¼Œ
        æ— è®ºè¾“å…¥å¤šå¤§éƒ½ä¸æº¢å‡ºã€‚è¿™ä¸æ˜¯å­¦æœ¯æ¸¸æˆâ€”â€”å®ƒæ˜¯ä¸€ä¸ªæ¯å¹´éƒ½åœ¨çœŸå®ç³»ç»Ÿä¸­è¢«é‡æ–°"å‘ç°"çš„å®‰å…¨é™·é˜±ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">Gosper's Hackï¼šç»„åˆçˆ†ç‚¸çš„"ä½é…"è§£æ³•</div>
      <p>
        Gosper's Hack ä¹‹æ‰€ä»¥ä¼Ÿå¤§ï¼Œæ˜¯å› ä¸ºå®ƒæŠŠ"æšä¸¾å« k ä¸ª1çš„ n ä½ä¸²"è¿™ä¸ª NP ç›¸å…³é—®é¢˜çš„
        <strong style="color:#f1f5f9;">å†…å±‚å¾ªç¯æ¨è¿›æˆäº† O(1)</strong>ï¼Œæ²¡æœ‰ä»»ä½•æ¡ä»¶åˆ†æ”¯ï¼Œ
        ä¹Ÿæ²¡æœ‰æ˜¾å¼çš„è®¡æ•°å™¨æˆ–ä½ä½ç½®è¿½è¸ªã€‚æ¯æ¬¡è°ƒç”¨åªéœ€4æ¡æŒ‡ä»¤ï¼ˆåŸºç¡€RISCï¼‰ã€‚
        åœ¨æ£‹ç›˜å¼•æ“ä¸­ï¼Œè¿™æ„å‘³ç€æ¯ç§’å¯ä»¥æšä¸¾è¶…è¿‡ 3 äº¿ä¸ªå­é›†ï¼Œè€Œé€’å½’å®ç°åªèƒ½è¾¾åˆ° 3000ä¸‡ã€‚
        10å€çš„å·®è·ï¼Œæ¥è‡ª5è¡Œä»£ç é‡Œè—ç€çš„æ•°å­¦æ´è§ã€‚
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">æœ‰æ²¡æœ‰å±€é™æ€§ï¼Ÿç°ä»£è¯­è¨€æ€ä¹ˆçœ‹è¿™äº›æŠ€å·§ï¼Ÿ</div>
      <p>
        æœ‰ã€‚åœ¨ <strong style="color:#f1f5f9;">Rust</strong> ä¸­ï¼Œæœ‰ç¬¦å·æ•´æ•°çš„å³ç§»è¡Œä¸ºï¼ˆç®—æœ¯vsé€»è¾‘ï¼‰
        æ˜¯æ˜ç¡®åˆ†å¼€çš„ï¼ˆ<code style="color:var(--o);">>></code> æ˜¯ç®—æœ¯ç§»ä½ï¼‰ï¼Œä½†æº¢å‡ºåœ¨ debug
        æ¨¡å¼ä¼š panicâ€”â€”Warren çš„å¾ˆå¤šæŠ€å·§ä¾èµ–"ç»•è¿‡æº¢å‡º"çš„æ— ç¬¦å·è¡Œä¸ºï¼Œ
        éœ€è¦æ˜¾å¼ç”¨ <code style="color:var(--o);">wrapping_add</code>ã€‚
        åœ¨ <strong style="color:#f1f5f9;">C23</strong> æ ‡å‡†ä¸­ï¼Œæœ‰ç¬¦å·æ•´æ•°æº¢å‡ºä¸å†æ˜¯ UB è€Œæ˜¯
        well-defined wrap-aroundâ€”â€”è¿™ç»ˆäºè®© C ç¨‹åºå‘˜èƒ½å®‰å…¨åœ°ä½¿ç”¨è¿™äº›æŠ€å·§ã€‚
        åœ¨ <strong style="color:#f1f5f9;">Java</strong> é‡Œåˆ™å®Œå…¨æ²¡é—®é¢˜ï¼ˆæ—  UB è¯­ä¹‰ï¼‰ï¼Œä½†æ²¡æœ‰æ— ç¬¦å·æ•´æ•°ï¼Œ
        æŸäº›æŠ€å·§è¦æ‰‹åŠ¨åç§» <code>0x80000000</code>ã€‚
        <strong style="color:var(--r);">ç»“è®ºï¼šè¿™äº›æŠ€å·§çš„æ€æƒ³æ˜¯è·¨å¹³å°çš„ï¼Œä½†å®ç°ç»†èŠ‚éœ€è¦æŒ‰è¯­è¨€æ ¡å¯¹ä¸€éã€‚</strong>
      </p>
    </div>

    <div class="critic-item">
      <div class="ci-title">å¯æ¨å¹¿åˆ°å“ªé‡Œï¼Ÿ</div>
      <p>
        <strong style="color:#f1f5f9;">1. SIMD/GPU</strong>ï¼šæœ¬ç« æ‰€æœ‰ branch-free æŠ€å·§éƒ½å¯ä»¥é€å­—ç¿»è¯‘åˆ°
        AVX2/NEON intrinsicsï¼Œæ€§èƒ½ä¹˜ä»¥å‘é‡å®½åº¦ï¼ˆ8x/16xï¼‰ã€‚
        <strong style="color:#f1f5f9;">2. å¯†ç å­¦</strong>ï¼šConstant-time ç¼–ç¨‹ï¼ˆé˜² timing ä¾§ä¿¡é“æ”»å‡»ï¼‰
        çš„æ ¸å¿ƒå°±æ˜¯"æŠŠæ‰€æœ‰åˆ†æ”¯å˜æˆæ©ç é€‰æ‹©"ï¼Œå³æœ¬ç«  MUX æŠ€æœ¯ã€‚
        <strong style="color:#f1f5f9;">3. ç¡¬ä»¶è®¾è®¡</strong>ï¼šVerilog/VHDL ç»¼åˆå™¨å°†è¿™äº›ä½æ“ä½œç›´æ¥æ˜ å°„åˆ° LUTï¼Œ
        ç†è§£è¿™äº›å…¬å¼èƒ½è®©ä½ å†™å‡ºæ›´å°é¢ç§¯çš„ RTLã€‚
        <strong style="color:#f1f5f9;">4. é‡å­è®¡ç®—ï¼ˆæœ‰é™åº¦ï¼‰</strong>ï¼šå¯é€†è®¡ç®—è¦æ±‚æ‰€æœ‰æ“ä½œå¯é€†ï¼Œ
        XOR é—¨å¤©ç„¶å¯é€†ï¼Œæœ¬ç« æ’ç­‰å¼åœ¨é‡å­ç”µè·¯ç»¼åˆä¸­æœ‰ç›´æ¥åº”ç”¨ã€‚
      </p>
    </div>
  </div>

  <!-- ç»ƒä¹ é¢˜å¿«è§ˆ -->
  <div class="card" style="margin-top:1.25rem;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--o);margin-bottom:.75rem;">
      ğŸ“ Warren Â§2 è¯¾åç»ƒä¹ ç²¾é€‰ï¼ˆå…±12é¢˜ï¼‰
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:.75rem;font-size:.82rem;color:#64748b;line-height:1.7;">
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q3</span>
        æ¨å¯¼ Dietz æ— æº¢å‡ºå¹³å‡å€¼å…¬å¼
        <code style="color:var(--o);font-size:.75rem;display:block;margin-top:.2rem;">(x&y)+((x^y)>>1)</code>
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--b);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q8</span>
        è¯æ˜ MUX å¯ä»¥ç”¨3æ¡åŸºç¡€RISCæŒ‡ä»¤å®ç°
        <code style="color:var(--o);font-size:.75rem;display:block;margin-top:.2rem;">((x^y)&m)^y</code>
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--p);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q10</span>
        ç»™å®š x å’Œä¸¤ä¸ªä½ç½® iã€jï¼ŒæŠŠ x åœ¨ä½ i çš„å€¼å¤åˆ¶åˆ°ä½ j
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--o);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q11</span>
        é€’å½’åˆ†è§£å®šç†ï¼šå®ç°ä»»æ„ n å…ƒå¸ƒå°”å‡½æ•°æœ€å°‘éœ€è¦å‡ æ¡äºŒå…ƒæŒ‡ä»¤ï¼Ÿ
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--r);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q5</span>
        è‹¥å·²çŸ¥ yâ‚ƒâ‚=0ï¼Œä¸ƒæŒ‡ä»¤æœ‰ç¬¦å·æ¯”è¾ƒå¯ä»¥ç®€åŒ–ä¸ºå‡ æ¡ï¼Ÿ
      </div>
      <div style="padding:.6rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <span style="color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.7rem;">Q4</span>
        ç»™å‡ºå››ä¸ªæ— ç¬¦å·æ•´æ•° (a+b+c+d)/4 çš„æ— æº¢å‡ºè®¡ç®—æ–¹æ³•
      </div>
    </div>
  </div>
</section>

<footer>
  <p>
    <a href="ch01.html">â† Chapter 1: Laying the Groundwork</a>
    &nbsp;Â·&nbsp; Chapter 2 of 18
    &nbsp;Â·&nbsp; <a href="ch03.html">Chapter 3: Power-of-2 Boundaries â†’</a>
  </p>
  <p style="margin-top:.5rem;">Hacker's Delight 2nd Ed. Â· Henry S. Warren, Jr. Â· Addison-Wesley 2013</p>
</footer>

</div><!-- #app -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Alpine.js ä¸» App
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function app() {
  return {
    tab1: 'c',
    tabGosper: 'c',
    init() {
      this.initBg();
      this.initProgress();
      this.initScrollSpy();
      this.$nextTick(() => {
        this.initChartBool();
        this.initChartSrc();
        this.initChartInstr();
      });
    },

    initProgress() {
      window.addEventListener('scroll', () => {
        const s = document.documentElement.scrollTop;
        const h = document.documentElement.scrollHeight - window.innerHeight;
        document.getElementById('prog').style.width = (h > 0 ? s / h * 100 : 0) + '%';
      });
    },

    initScrollSpy() {
      const secs = ['hero','rightmost','addsub','abs','special','gosper','history','critique'];
      const dots = document.querySelectorAll('.dot');
      window.addEventListener('scroll', () => {
        let cur = 0;
        secs.forEach((id, i) => {
          const el = document.getElementById(id);
          if (el && el.getBoundingClientRect().top < window.innerHeight * 0.5) cur = i;
        });
        dots.forEach((d, i) => d.classList.toggle('active', i === cur));
      });
      dots.forEach((d, i) => {
        d.addEventListener('click', () => {
          document.getElementById(secs[i])?.scrollIntoView({ behavior: 'smooth' });
        });
      });
    },

    /* â”€â”€ ç²’å­èƒŒæ™¯ â”€â”€ */
    initBg() {
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      let W, H;
      const resize = () => { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; };
      resize();
      window.addEventListener('resize', resize);
      const chars = ['0','1','&','|','^','~','<','>','+','-'];
      const particles = Array.from({ length: 55 }, () => ({
        x: Math.random() * 1920, y: Math.random() * 1080,
        vy: 0.18 + Math.random() * 0.45,
        ch: chars[Math.floor(Math.random() * chars.length)],
        alpha: 0.03 + Math.random() * 0.1,
        size: 10 + Math.random() * 7
      }));
      const draw = () => {
        ctx.clearRect(0, 0, W, H);
        particles.forEach(p => {
          ctx.fillStyle = `rgba(0,255,136,${p.alpha})`;
          ctx.font = `${p.size}px monospace`;
          ctx.fillText(p.ch, p.x % W, p.y % H);
          p.y += p.vy;
          if (p.y > H) { p.y = -20; p.x = Math.random() * W; }
          if (Math.random() < 0.01) p.ch = chars[Math.floor(Math.random() * chars.length)];
        });
        requestAnimationFrame(draw);
      };
      draw();
    },

    /* â”€â”€ 16ç§å¸ƒå°”è¿ç®—å›¾ â”€â”€ */
    initChartBool() {
      const el = document.getElementById('chart-bool');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      const ops = ['0','AND','Aâˆ§Â¬B','A','Â¬Aâˆ§B','B','XOR','OR','NOR','XNOR','Â¬B','Aâˆ¨Â¬B','Â¬A','Â¬Aâˆ¨B','NAND','1'];
      const counts = [0,1,1,2,1,2,2,3,1,2,1,3,1,3,2,4];
      const colors = counts.map(c => ['#1e293b','rgba(0,255,136,.7)','rgba(0,212,255,.7)','rgba(177,79,255,.7)','rgba(255,140,0,.7)'][Math.min(c,4)]);
      chart.setOption({
        backgroundColor: 'transparent',
        grid: { left: '3%', right: '3%', top: '15%', bottom: '22%' },
        tooltip: {
          trigger: 'axis',
          backgroundColor: '#0d1117',
          borderColor: 'rgba(0,255,136,.3)',
          textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 },
          formatter: p => `${ops[p[0].dataIndex]}<br/>çœŸå€¼è¡¨ä¸­1çš„ä¸ªæ•°: ${counts[p[0].dataIndex]}`
        },
        xAxis: {
          data: ops,
          axisLabel: { color: '#334155', fontSize: 9, rotate: 35 },
          axisLine: { lineStyle: { color: '#1e293b' } }
        },
        yAxis: {
          name: 'çœŸå€¼è¡¨ä¸­1çš„æ•°é‡',
          nameTextStyle: { color: '#475569', fontSize: 10 },
          max: 4, min: 0,
          axisLabel: { color: '#475569' },
          splitLine: { lineStyle: { color: 'rgba(30,41,59,.5)' } },
          axisLine: { lineStyle: { color: '#1e293b' } }
        },
        series: [{
          type: 'bar', data: counts.map((v, i) => ({ value: v, itemStyle: { color: colors[i], borderRadius: 3 } })),
          barMaxWidth: 28,
          label: { show: true, position: 'top', color: '#475569', fontSize: 9, fontFamily: 'JetBrains Mono' }
        }]
      });
      window.addEventListener('resize', () => chart.resize());
    },

    /* â”€â”€ æŠ€å·§æ¥æºé¥¼å›¾ â”€â”€ */
    initChartSrc() {
      const el = document.getElementById('chart-src');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        tooltip: {
          backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)',
          textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 }
        },
        legend: { bottom: 0, textStyle: { color: '#475569', fontSize: 10 } },
        series: [{
          type: 'pie', radius: ['35%', '60%'], center: ['50%', '44%'],
          data: [
            { value: 8, name: 'HAKMEM 1972', itemStyle: { color: 'rgba(0,255,136,.7)' } },
            { value: 5, name: 'IBM å†…éƒ¨ç§¯ç´¯', itemStyle: { color: 'rgba(0,212,255,.7)' } },
            { value: 4, name: 'GCC/è¶…çº§ä¼˜åŒ–å™¨', itemStyle: { color: 'rgba(177,79,255,.7)' } },
            { value: 3, name: 'Dietzé­”æ³•é¡µ', itemStyle: { color: 'rgba(255,140,0,.7)' } },
            { value: 3, name: 'ç¼–è¯‘å™¨ç¤¾åŒº', itemStyle: { color: 'rgba(255,68,102,.7)' } }
          ],
          label: { color: '#475569', fontSize: 10 },
          itemStyle: { borderRadius: 4, borderColor: '#050810', borderWidth: 2 }
        }]
      });
      window.addEventListener('resize', () => chart.resize());
    },

    /* â”€â”€ æŒ‡ä»¤æ•°å¯¹æ¯”æŸ±å›¾ â”€â”€ */
    initChartInstr() {
      const el = document.getElementById('chart-instr');
      if (!el || !window.echarts) return;
      const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        grid: { left: '2%', right: '2%', top: '20%', bottom: '20%', containLabel: true },
        tooltip: {
          trigger: 'axis', axisPointer: { type: 'shadow' },
          backgroundColor: '#0d1117', borderColor: 'rgba(0,255,136,.3)',
          textStyle: { color: '#e2e8f0', fontFamily: 'JetBrains Mono', fontSize: 11 }
        },
        legend: { data: ['åŸºç¡€RISC','x86(æ— BMI)','x86+BMI1','ARM64'], textStyle: { color: '#475569', fontSize: 10 } },
        xAxis: {
          data: ['x&(x-1)', 'abs(x)', 'min(x,y)', 'avg(x,y)', 'Gosper'],
          axisLabel: { color: '#475569', fontSize: 10, fontFamily: 'JetBrains Mono' },
          axisLine: { lineStyle: { color: '#1e293b' } }
        },
        yAxis: {
          name: 'æŒ‡ä»¤æ•°',
          nameTextStyle: { color: '#475569', fontSize: 10 },
          axisLabel: { color: '#475569' },
          splitLine: { lineStyle: { color: 'rgba(30,41,59,.5)' } },
          axisLine: { lineStyle: { color: '#1e293b' } }
        },
        series: [
          { name: 'åŸºç¡€RISC',    type: 'bar', data: [2,4,5,3,5], barMaxWidth:18, itemStyle:{color:'rgba(0,255,136,.65)',borderRadius:2} },
          { name: 'x86(æ— BMI)', type: 'bar', data: [2,3,4,3,5], barMaxWidth:18, itemStyle:{color:'rgba(0,212,255,.55)',borderRadius:2} },
          { name: 'x86+BMI1',   type: 'bar', data: [1,2,3,3,4], barMaxWidth:18, itemStyle:{color:'rgba(177,79,255,.65)',borderRadius:2} },
          { name: 'ARM64',      type: 'bar', data: [2,3,4,3,5], barMaxWidth:18, itemStyle:{color:'rgba(255,140,0,.55)',borderRadius:2} }
        ]
      });
      window.addEventListener('resize', () => chart.resize());
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   æœ€å³ä½äº¤äº’æ¼”ç¤º
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function rightmostDemo() {
  return {
    bits: [0,0,1,0,1,1,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    toggle(i) { this.bits[i] = this.bits[i] ? 0 : 1; },
    get x32() {
      let v = 0;
      for (let i = 0; i < 32; i++) v = (v * 2 + this.bits[i]) >>> 0;
      return v;
    },
    toBits32(n) {
      n = n >>> 0;
      return Array.from({ length: 32 }, (_, i) => (n >> (31 - i)) & 1);
    },
    get results() {
      const x = this.x32;
      return [
        { name: 'x & (x-1)  æ¸…é™¤æœ€å³1', bits: this.toBits32(x & (x - 1)), desc: x === 0 ? '0 â†’ ç»“æœ=0' : ((x & (x-1)) === 0 ? 'âœ“ xæ˜¯2çš„å¹‚' : '') },
        { name: 'x | (x+1)  ç½®ä½æœ€å³0', bits: this.toBits32(x | (x + 1)), desc: '' },
        { name: 'x & (x+1)  æ¸…é™¤å°¾éƒ¨1', bits: this.toBits32(x & (x + 1)), desc: ((x & (x+1)) === 0 && x !== 0) ? 'âœ“ xæ˜¯2â¿-1' : '' },
        { name: 'x | (x-1)  å¡«å……å°¾éƒ¨0', bits: this.toBits32(x | (x - 1)), desc: '' },
        { name: 'x & (-x)   æå–æœ€å³1', bits: this.toBits32(x & (-x >>> 0)), desc: x === 0 ? 'å…¨0æ— æœ€å³1' : 'å•bitæ©ç ' },
        { name: '~x & (x+1) æå–æœ€å³0', bits: this.toBits32(~x & (x + 1)), desc: '' },
        { name: '~x & (x-1) å°¾0æ©ç ',  bits: this.toBits32((~x) & (x - 1)), desc: '' },
        { name: '(x&-x)-1   å°¾0å…¨1',   bits: this.toBits32(((x & (-x >>> 0)) - 1) >>> 0), desc: '' }
      ];
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   abs/min/max æ¼”ç¤º
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function absDemo() {
  return {
    x: -37, y: 25,
    get mask() { return (this.x >> 31); },
    get absX() { const m = this.x >> 31; return (this.x + m) ^ m; },
    get minXY() { const d = this.x - this.y; return this.y + (d & (d >> 31)); },
    get maxXY() { const d = this.x - this.y; return this.x - (d & (d >> 31)); },
    get avgXY() { return (this.x & this.y) + ((this.x ^ this.y) >> 1); },
    get signX() {
      if (this.x > 0) return 1;
      if (this.x < 0) return -1;
      return 0;
    }
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Gosper's Hack æ¼”ç¤º
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gosperDemo() {
  return {
    cur: 0b00000111,  // 8ä½ä¸­å«3ä¸ª1ï¼Œä»æœ€å°å¼€å§‹
    history: [0b00000111],
    tabGosper: 'c',
    popcount(n) {
      n = n >>> 0;
      n = n - ((n >> 1) & 0x55555555);
      n = (n & 0x33333333) + ((n >> 2) & 0x33333333);
      n = (n + (n >> 4)) & 0x0f0f0f0f;
      return ((n * 0x01010101) >>> 24);
    },
    toBits(n) {
      n = (n >>> 0) & 0xFF; // åªæ˜¾ç¤ºä½8ä½
      return Array.from({ length: 8 }, (_, i) => (n >> (7 - i)) & 1);
    },
    get steps() {
      const x = this.cur >>> 0;
      const c = (x & (-x >>> 0)) >>> 0;
      const r = (x + c) >>> 0;
      const xorval = (r ^ x) >>> 0;
      const ones = c > 0 ? (((xorval / c) >>> 2) + 1) >>> 0 : 0;
      const next = (r | ones) >>> 0;
      return { c, r, ones, next };
    },
    next() {
      const { next } = this.steps;
      if (next > 0xFF || next === 0) {
        // å¾ªç¯é‡ç½®
        this.cur = 0b00000111;
        this.history = [this.cur];
        return;
      }
      this.cur = next;
      this.history.push(this.cur);
    },
    reset() {
      this.cur = 0b00000111;
      this.history = [this.cur];
    }
  };
}
</script>
</body>
</html>
