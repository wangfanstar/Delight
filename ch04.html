
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ch.04 â€” ç®—æœ¯è¾¹ç•Œ | Hacker's Delight</title>
<link rel="stylesheet" href="tailwind.css"/>
<script src="echarts.min.js"></script>
<script src="alpine.min.js" defer></script>
<style>
:root{
  --g:#00ff88;--b:#00d4ff;--p:#b14fff;--o:#ff8c00;--r:#ff4466;
  --dark:#050810;--card:#0d1117;--border:rgba(0,255,136,.18);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--dark);color:#e2e8f0;font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;font-size:17px;line-height:1.7;}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,136,.010) 2px,rgba(0,255,136,.010) 4px);pointer-events:none;z-index:0;}
canvas#bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
#app{position:relative;z-index:1;}

nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,8,16,.9);backdrop-filter:blur(14px);border-bottom:1px solid var(--border);padding:.7rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);text-decoration:none;}
.nav-links{display:flex;gap:1.4rem;}
.nav-links a{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;text-decoration:none;transition:color .2s;}
.nav-links a:hover{color:var(--g);}

#prog{position:fixed;top:0;left:0;height:2px;z-index:200;background:linear-gradient(90deg,var(--g),var(--b),var(--p));transition:width .12s;}

.dot-nav{position:fixed;right:1.4rem;top:50%;transform:translateY(-50%);z-index:50;display:flex;flex-direction:column;gap:.55rem;}
.dot{width:8px;height:8px;border-radius:50%;background:#1e293b;cursor:pointer;transition:all .2s;}
.dot.active{background:var(--g);transform:scale(1.45);box-shadow:0 0 6px var(--g);}
@media(max-width:768px){.dot-nav{display:none;}}

.hero{padding:7rem 2rem 3rem;text-align:center;max-width:900px;margin:0 auto;}
.chapter-badge{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);border:1px solid var(--g);padding:.28rem .95rem;border-radius:999px;letter-spacing:.15em;margin-bottom:1.5rem;animation:badge-pulse 2.5s ease-in-out infinite;}
@keyframes badge-pulse{0%,100%{box-shadow:0 0 6px rgba(0,255,136,.35);}50%{box-shadow:0 0 22px rgba(0,255,136,.75);}}
.hero-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:900;background:linear-gradient(135deg,#fff 0%,var(--g) 50%,var(--b) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15;margin-bottom:.5rem;}
.hero-sub{font-family:'JetBrains Mono',monospace;color:#475569;font-size:.88rem;margin-bottom:1.8rem;}
.hero-desc{color:#94a3b8;font-size:.98rem;line-height:1.88;max-width:720px;margin:0 auto 2rem;}

section{max-width:1100px;margin:0 auto;padding:0 1.5rem 4rem;}
.sec-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.75rem;}
.sec-num{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);background:rgba(0,255,136,.07);border:1px solid rgba(0,255,136,.18);padding:.22rem .55rem;border-radius:4px;white-space:nowrap;}
.sec-title{font-size:1.3rem;font-weight:700;color:#f1f5f9;}
.sec-divider{flex:1;height:1px;background:linear-gradient(90deg,rgba(0,255,136,.28),transparent);}

.card{background:var(--card);border:1px solid #1e293b;border-radius:.75rem;padding:1.4rem;transition:border-color .25s,box-shadow .25s;}
.card:hover{border-color:rgba(0,255,136,.22);box-shadow:0 4px 22px rgba(0,255,136,.06);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.2rem;}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.1rem;}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr;}}

.code-block{background:#010409;border:1px solid #1e293b;border-radius:.5rem;padding:1.1rem 1.4rem;font-family:'JetBrains Mono',monospace;font-size:.95rem;line-height:1.9;overflow-x:auto;color:#94a3b8;position:relative;white-space:pre-wrap;}
.code-block .kw{color:var(--p);}
.code-block .num{color:var(--o);}
.code-block .cm{color:#334155;font-style:italic;}
.code-block .fn{color:var(--g);}
.code-block .hi{color:#fff;background:rgba(0,255,136,.1);border-radius:2px;padding:0 3px;}
.code-block .warn{color:var(--r);}
.code-block .str{color:var(--b);}

.insight{background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.14);border-left:3px solid var(--g);border-radius:.5rem;padding:1.15rem 1.4rem;margin-bottom:1.2rem;font-size:.88rem;line-height:1.82;color:#94a3b8;}
.insight strong{color:var(--g);}
.insight .label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--g);letter-spacing:.1em;display:block;margin-bottom:.4rem;}

.warn-box{background:rgba(255,68,102,.04);border:1px solid rgba(255,68,102,.18);border-left:3px solid var(--r);border-radius:.5rem;padding:1.05rem 1.3rem;font-size:.84rem;line-height:1.78;color:#94a3b8;margin-bottom:1.1rem;}
.warn-box .label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--r);letter-spacing:.1em;display:block;margin-bottom:.35rem;}
.warn-box strong{color:var(--r);}

.tag{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:.62rem;padding:.18rem .48rem;border-radius:3px;margin:.12rem;}
.tag-g{background:rgba(0,255,136,.09);color:var(--g);border:1px solid rgba(0,255,136,.18);}
.tag-b{background:rgba(0,212,255,.09);color:var(--b);border:1px solid rgba(0,212,255,.18);}
.tag-p{background:rgba(177,79,255,.09);color:var(--p);border:1px solid rgba(177,79,255,.18);}
.tag-o{background:rgba(255,140,0,.09);color:var(--o);border:1px solid rgba(255,140,0,.18);}
.tag-r{background:rgba(255,68,102,.09);color:var(--r);border:1px solid rgba(255,68,102,.18);}

.tab-nav{display:flex;gap:.4rem;margin-bottom:.9rem;flex-wrap:wrap;}
.tab-btn{font-family:'JetBrains Mono',monospace;font-size:.68rem;padding:.32rem .8rem;border-radius:4px;border:1px solid #1e293b;background:transparent;color:#475569;cursor:pointer;transition:all .2s;}
.tab-btn.active,.tab-btn:hover{border-color:var(--g);color:var(--g);background:rgba(0,255,136,.07);}
.tab-pane{display:none;}.tab-pane.active{display:block;}

/* æ•°è½´å¯è§†åŒ– */
.range-vis{position:relative;height:72px;margin:1rem 0;}
.rv-track{position:absolute;bottom:28px;left:0;right:0;height:2px;background:#1e293b;}
.rv-range{position:absolute;bottom:24px;height:10px;border-radius:3px;}
.rv-label{position:absolute;bottom:0;font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#475569;transform:translateX(-50%);}
.rv-tick{position:absolute;bottom:22px;width:1px;height:14px;}
.rv-marker{position:absolute;bottom:18px;width:3px;height:22px;border-radius:2px;transform:translateX(-50%);}

/* bit-box */
.bit-row{display:flex;gap:2px;flex-wrap:wrap;margin:.3rem 0;}
.bit-cell{width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:2px;font-family:'JetBrains Mono',monospace;font-size:.65rem;border:1px solid #1e293b;transition:all .2s;}
.bit-cell.one{background:rgba(0,255,136,.18);color:var(--g);border-color:rgba(0,255,136,.3);}
.bit-cell.zero{background:#010409;color:#1e293b;}
.bit-cell.hi{background:rgba(0,212,255,.18);color:var(--b);border-color:rgba(0,212,255,.3);}
.bit-cell.warn{background:rgba(255,68,102,.18);color:var(--r);border-color:rgba(255,68,102,.3);}

/* critic */
.critic-box{background:linear-gradient(135deg,rgba(177,79,255,.05),rgba(0,212,255,.03));border:1px solid rgba(177,79,255,.22);border-radius:.75rem;padding:1.65rem;position:relative;overflow:hidden;}
.critic-box::before{content:'// æ·±åº¦ç‚¹è¯„';font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--p);letter-spacing:.1em;display:block;margin-bottom:.9rem;}
.critic-box h3{font-size:1rem;font-weight:700;color:#f1f5f9;margin-bottom:.7rem;}
.critic-item{margin-bottom:1rem;padding-left:.9rem;border-left:2px solid rgba(177,79,255,.28);}
.critic-item .ci-title{font-size:.81rem;font-weight:600;color:var(--p);margin-bottom:.28rem;}
.critic-item p{font-size:.8rem;line-height:1.74;color:#64748b;}

/* overflow demo */
.ov-cell{padding:.55rem .75rem;border-radius:.3rem;font-family:'JetBrains Mono',monospace;font-size:.75rem;border:1px solid #1e293b;text-align:center;transition:all .2s;}
.ov-cell.ok{background:rgba(0,255,136,.07);border-color:rgba(0,255,136,.22);color:var(--g);}
.ov-cell.bad{background:rgba(255,68,102,.07);border-color:rgba(255,68,102,.22);color:var(--r);}
.ov-cell.neutral{color:#64748b;}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.fade-up{opacity:0;animation:fadeUp .5s ease both;}

footer{text-align:center;padding:2.5rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#1e293b;border-top:1px solid #0f172a;}
footer a{color:var(--g);text-decoration:none;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:var(--dark);}
::-webkit-scrollbar-thumb{background:#1e293b;border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:rgba(0,255,136,.28);}

/* â•â•â• å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  â•â•â• */
.sidebar-nav{
  position:fixed;left:0;top:0;bottom:0;
  width:180px;z-index:90;
  background:rgba(5,8,16,.92);
  backdrop-filter:blur(10px);
  border-right:1px solid rgba(0,255,136,.12);
  padding:1rem .5rem;
  overflow-y:auto;
  overflow-x:hidden;
  transition:transform .25s ease;
  display:flex;
  flex-direction:column;
}
.sidebar-nav::-webkit-scrollbar{width:3px;}
.sidebar-nav::-webkit-scrollbar-thumb{background:#1e293b;border-radius:2px;}

.sidebar-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.62rem;color:var(--g);
  letter-spacing:.08em;
  padding:.4rem .6rem;
  border-bottom:1px solid rgba(0,255,136,.15);
  margin-bottom:.5rem;
  flex-shrink:0;
}

.sidebar-section{
  margin-bottom:.6rem;
  display:flex;
  flex-direction:column;
}
.sidebar-section-title{
  font-family:'JetBrains Mono',monospace;
  font-size:.58rem;color:#475569;
  padding:.3rem .6rem;
  letter-spacing:.05em;
  flex-shrink:0;
}

.sidebar-link{
  display:block;
  width:100%;
  clear:both;
  font-family:'JetBrains Mono',monospace;
  font-size:.68rem;
  color:#64748b;
  text-decoration:none;
  padding:.25rem .6rem .25rem 1rem;
  border-radius:3px;
  transition:all .15s;
  position:relative;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.sidebar-link:hover{color:var(--g);background:rgba(0,255,136,.06);}
.sidebar-link.active{color:var(--g);background:rgba(0,255,136,.1);}
.sidebar-link.active::before{
  content:'';position:absolute;left:0;top:50%;
  transform:translateY(-50%);
  width:2px;height:14px;
  background:var(--g);border-radius:1px;
}

.sidebar-toggle{
  display:none;
  position:fixed;left:.5rem;top:.85rem;z-index:95;
  width:32px;height:32px;
  background:rgba(5,8,16,.9);
  border:1px solid rgba(0,255,136,.2);
  border-radius:4px;
  color:var(--g);
  font-size:1.1rem;
  cursor:pointer;
}

@media(max-width:1100px){
  .sidebar-nav{transform:translateX(-100%);}
  .sidebar-nav.open{transform:translateX(0);}
  .sidebar-toggle{display:flex;align-items:center;justify-content:center;}
  body{padding-left:0!important;}
}

@media(min-width:1101px){body{padding-left:180px;}}
</style>
</head>
<body>

<!-- å·¦ä¾§ç« èŠ‚å¯¼èˆªæ  -->
<button class="sidebar-toggle" @click="sidebarOpen = !sidebarOpen" x-data="{sidebarOpen: false}">
  â˜°
</button>
<nav class="sidebar-nav" :class="sidebarOpen ? 'open' : ''" x-data="{sidebarOpen: false}" @click.away="sidebarOpen = false">
  <div class="sidebar-title">ğŸ“š HACKER'S DELIGHT</div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">æ­£æ–‡ç« èŠ‚</div>
    <a href="ch01.html" class="sidebar-link">Ch.01 å¥ å®šåŸºç¡€</a>
    <a href="ch02.html" class="sidebar-link">Ch.02 åŸºç¡€æ“ä½œ</a>
    <a href="ch03.html" class="sidebar-link">Ch.03 2çš„å¹‚è¾¹ç•Œ</a>
    <a href="ch04.html" class="sidebar-link active">Ch.04 ç®—æœ¯è¾¹ç•Œ</a>
    <a href="ch05.html" class="sidebar-link">Ch.05 æ•´æ•°é™¤æ³•</a>
    <a href="ch06.html" class="sidebar-link">Ch.06 ä½è®¡æ•°</a>
    <a href="ch07.html" class="sidebar-link">Ch.07 ä½ç¿»è½¬</a>
    <a href="ch08.html" class="sidebar-link">Ch.08 ä½ç½®æ¢</a>
    <a href="ch09.html" class="sidebar-link">Ch.09 å¾ªç¯å†—ä½™æ ¡éªŒ</a>
    <a href="ch10.html" class="sidebar-link">Ch.10 å¥‡å¶æ ¡éªŒ</a>
    <a href="ch11.html" class="sidebar-link">Ch.11 Grayç </a>
    <a href="ch12.html" class="sidebar-link">Ch.12 Hilbertæ›²çº¿</a>
    <a href="ch13.html" class="sidebar-link">Ch.13 æµ®ç‚¹æ•°</a>
    <a href="ch14.html" class="sidebar-link">Ch.14 å…¬å¼</a>
    <a href="ch15.html" class="sidebar-link">Ch.15 åŸºæ•°è½¬æ¢</a>
    <a href="ch16.html" class="sidebar-link">Ch.16 å¼€æ–¹</a>
    <a href="ch17.html" class="sidebar-link">Ch.17 æµ®ç‚¹å€’æ•°å¼€æ–¹</a>
    <a href="ch18.html" class="sidebar-link">Ch.18 å…¶å®ƒ</a>
  </div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">é™„å½•</div>
    <a href="appA.html" class="sidebar-link">App.A è¯æ±‡è¡¨</a>
    <a href="appB.html" class="sidebar-link">App.B æ‘˜è¦</a>
    <a href="appC.html" class="sidebar-link">App.C å‘å±•å²</a>
  </div>
</nav>

<canvas id="bg"></canvas>
<div id="prog"></div>

<div class="dot-nav" id="dotNav">
  <div class="dot active"  data-sec="hero"     title="é¡¶éƒ¨"></div>
  <div class="dot"         data-sec="bounds"   title="è¾¹ç•Œæ£€æŸ¥"></div>
  <div class="dot"         data-sec="addprop"  title="åŠ å‡ä¼ æ’­"></div>
  <div class="dot"         data-sec="logprop"  title="é€»è¾‘ä¼ æ’­"></div>
  <div class="dot"         data-sec="overflow" title="æº¢å‡ºæ£€æµ‹"></div>
  <div class="dot"         data-sec="history"  title="å†å²èƒŒæ™¯"></div>
  <div class="dot"         data-sec="critique" title="æ·±åº¦ç‚¹è¯„"></div>
</div>

<nav>
  <a class="nav-logo" href="index.html">â† HACKER'S DELIGHT</a>
  <div class="nav-links">
    <a href="#bounds">è¾¹ç•Œæ£€æŸ¥</a>
    <a href="#addprop">åŠ å‡ä¼ æ’­</a>
    <a href="#logprop">é€»è¾‘ä¼ æ’­</a>
    <a href="#overflow">æº¢å‡ºæ£€æµ‹</a>
    <a href="#history">å†å²</a>
    <a href="#critique">ç‚¹è¯„</a>
  </div>
</nav>

<div id="app" x-data="app()" x-init="init()">

<!-- â•â•â• HERO â•â•â• -->
<div class="hero" id="hero">
  <div class="chapter-badge">CHAPTER 04 Â· ARITHMETIC BOUNDS Â· ç®—æœ¯è¾¹ç•Œ</div>
  <h1 class="hero-title fade-up" style="animation-delay:.1s">ç®—æœ¯è¾¹ç•Œ</h1>
  <p class="hero-sub fade-up" style="animation-delay:.2s">// è¾¹ç•Œæ£€æŸ¥ Â· åŠ å‡ä¼ æ’­ Â· é€»è¾‘æ“ä½œå¯¹èŒƒå›´çš„å½±å“</p>
  <p class="hero-desc fade-up" style="animation-delay:.3s">
    ç¬¬4ç« æ˜¯å…¨ä¹¦ä¸­æœ€å…·æ•°å­¦å‘³é“çš„ä¸€ç« ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«ä½ä¼°çš„ä¸€ç« ã€‚
    Warren åœ¨è¿™é‡Œå›ç­”äº†ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong style="color:var(--g)">å½“ä½ å¯¹ä¸€ä¸ªæœ‰ç•Œçš„æ•´æ•°åšè¿ç®—ï¼Œ
    ç»“æœçš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿ</strong>
    è¿™å¬èµ·æ¥åƒæ˜¯ç®€å•çš„ç®—æœ¯ï¼Œä½†åœ¨æœ‰ç¬¦å·/æ— ç¬¦å·çš„è¾¹ç•Œåˆ‡æ¢ã€æº¢å‡ºã€ä½è¿ç®—æ··ç”¨çš„ç¯å¢ƒä¸‹ï¼Œ
    ç­”æ¡ˆå‡ºäººæ„æ–™åœ°å¾®å¦™ã€‚ç¼–è¯‘å™¨çš„å€¼èŒƒå›´åˆ†æï¼ˆValue Range Propagationï¼‰ã€
    å®‰å…¨æ£€æŸ¥çš„è¾¹ç•Œæ¨å¯¼ã€æ•´å‹æå‡è§„åˆ™â€”â€”éƒ½å»ºç«‹åœ¨è¿™ä¸€ç« çš„æ•°å­¦åŸºç¡€ä¸Šã€‚
  </p>
  <div class="fade-up" style="animation-delay:.4s">
    <span class="tag tag-g">bounds checking</span>
    <span class="tag tag-b">range propagation</span>
    <span class="tag tag-p">overflow detection</span>
    <span class="tag tag-o">signed / unsigned</span>
    <span class="tag tag-r">array index safety</span>
    <span class="tag tag-g">compiler VRP</span>
    <span class="tag tag-b">saturating arithmetic</span>
  </div>
</div>

<!-- â•â•â• Â§4-1 è¾¹ç•Œæ£€æŸ¥ â•â•â• -->
<section id="bounds">
  <div class="sec-header">
    <span class="sec-num">Â§4-1</span>
    <span class="sec-title">æ•´æ•°è¾¹ç•Œæ£€æŸ¥ â€” Checking Bounds of Integers</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE CLASSIC TRICK: ä¸¤æ¬¡æ¯”è¾ƒ â†’ ä¸€æ¬¡æ¯”è¾ƒ</span>
    åˆ¤æ–­ <code style="color:var(--o)">a â‰¤ x â‰¤ b</code> é€šå¸¸éœ€è¦ä¸¤æ¬¡æ¯”è¾ƒï¼ˆä¸¤æ¬¡åˆ†æ”¯ï¼‰ã€‚
    Warren ç»™å‡ºäº†ä¸€ç§å°†å…¶åˆå¹¶ä¸º<strong>ä¸€æ¬¡æ— ç¬¦å·æ¯”è¾ƒ</strong>çš„æŠ€å·§ï¼š
    <code style="color:var(--o)">(unsigned)(x - a) â‰¤ (unsigned)(b - a)</code>ã€‚
    è¿™åœ¨æ•°ç»„è¾¹ç•Œæ£€æŸ¥ä¸­æä¸ºå¸¸ç”¨â€”â€”Java JVM å’Œç°ä»£ C ç¼–è¯‘å™¨çš„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ï¼ˆBCEï¼‰
    éƒ½ä¾èµ–ç±»ä¼¼çš„å˜æ¢ï¼Œå®ƒæŠŠä¸¤æ¬¡æœ‰ç¬¦å·æ¯”è¾ƒå‹ç¼©æˆä¸€æ¬¡æ— ç¬¦å·æ¯”è¾ƒï¼Œå‡å°‘äº†ä¸€æ¬¡åˆ†æ”¯é¢„æµ‹çš„ä»£ä»·ã€‚
  </div>

  <!-- äº¤äº’æ¼”ç¤º -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="boundsDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.9rem;">
      ğŸ”¬ è¾¹ç•Œæ£€æŸ¥ä¼˜åŒ–æ¼”ç¤º â€” è°ƒæ•´ aã€xã€b è§‚å¯Ÿä¸¤ç§æ–¹æ³•çš„ç­‰ä»·æ€§
    </div>
    <div style="display:flex;gap:1.2rem;flex-wrap:wrap;margin-bottom:1rem;align-items:flex-end;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">ä¸‹ç•Œ a =</div>
        <input type="range" min="-20" max="20" x-model.number="a" style="width:120px;accent-color:var(--g);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--g);margin-left:.4rem;" x-text="a"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">æµ‹è¯•å€¼ x =</div>
        <input type="range" min="-30" max="30" x-model.number="x" style="width:140px;accent-color:var(--b);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--b);margin-left:.4rem;" x-text="x"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">ä¸Šç•Œ b =</div>
        <input type="range" min="-20" max="30" x-model.number="b" style="width:120px;accent-color:var(--o);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--o);margin-left:.4rem;" x-text="b"></span>
      </div>
    </div>

    <!-- æ•°è½´å¯è§†åŒ– -->
    <div style="position:relative;height:56px;margin-bottom:1rem;background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:0 1.5rem;">
      <div style="position:absolute;bottom:22px;left:1.5rem;right:1.5rem;height:2px;background:#1e293b;"></div>
      <!-- èŒƒå›´é«˜äº® -->
      <div :style="{
        position:'absolute', bottom:'18px', height:'10px', borderRadius:'3px',
        background:'rgba(0,255,136,.25)',
        left: 'calc(1.5rem + '+Math.max(0,(a+30)/60*100)+'%)',
        width: Math.max(0,(b-a)/60*100)+'%'
      }"></div>
      <!-- a marker -->
      <div :style="{position:'absolute',bottom:'14px',left:'calc(1.5rem + '+((a+30)/60*100)+'%)',width:'2px',height:'18px',background:'var(--g)',borderRadius:'1px',transform:'translateX(-50%)'}"></div>
      <div :style="{position:'absolute',bottom:'2px',left:'calc(1.5rem + '+((a+30)/60*100)+'%)',fontFamily:'JetBrains Mono',fontSize:'.55rem',color:'var(--g)',transform:'translateX(-50%)'}" x-text="'a='+a"></div>
      <!-- b marker -->
      <div :style="{position:'absolute',bottom:'14px',left:'calc(1.5rem + '+((b+30)/60*100)+'%)',width:'2px',height:'18px',background:'var(--o)',borderRadius:'1px',transform:'translateX(-50%)'}"></div>
      <div :style="{position:'absolute',bottom:'2px',left:'calc(1.5rem + '+((b+30)/60*100)+'%)',fontFamily:'JetBrains Mono',fontSize:'.55rem',color:'var(--o)',transform:'translateX(-50%)'}" x-text="'b='+b"></div>
      <!-- x marker -->
      <div :style="{position:'absolute',bottom:'10px',left:'calc(1.5rem + '+((x+30)/60*100)+'%)',width:'3px',height:'26px',background: inBounds ? 'var(--b)' : 'var(--r)',borderRadius:'2px',transform:'translateX(-50%)',transition:'background .2s'}"></div>
      <div :style="{position:'absolute',top:'4px',left:'calc(1.5rem + '+((x+30)/60*100)+'%)',fontFamily:'JetBrains Mono',fontSize:'.55rem',color: inBounds ? 'var(--b)' : 'var(--r)',transform:'translateX(-50%)'}" x-text="'x='+x"></div>
    </div>

    <!-- ä¸¤ç§æ–¹æ³•å¯¹æ¯” -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.7rem;">
      <div :class="'ov-cell '+(inBounds?'ok':'bad')">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.3rem;">ä¼ ç»ŸåŒé‡æ¯”è¾ƒ</div>
        <div style="font-size:.78rem;" x-text="'a â‰¤ x â‰¤ b  â†’  '+a+' â‰¤ '+x+' â‰¤ '+b"></div>
        <div style="font-size:.85rem;font-weight:700;margin-top:.2rem;" x-text="inBounds ? 'âœ“ åœ¨èŒƒå›´å†…' : 'âœ— è¶Šç•Œ'"></div>
      </div>
      <div :class="'ov-cell '+(inBounds?'ok':'bad')">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.3rem;">å•æ¬¡æ— ç¬¦å·æ¯”è¾ƒï¼ˆWarrenä¼˜åŒ–ï¼‰</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.76rem;" x-text="'(uint)(x-a) â‰¤ (uint)(b-a)'"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:#475569;margin-top:.2rem;" x-text="'= '+(x-a)+'u â‰¤ '+(b-a)+'u â†’ '+(uBoundsOk?'true':'false')"></div>
        <div style="font-size:.85rem;font-weight:700;margin-top:.1rem;" x-text="uBoundsOk ? 'âœ“ åœ¨èŒƒå›´å†…' : 'âœ— è¶Šç•Œ'"></div>
      </div>
    </div>

    <div class="insight" style="margin-top:.75rem;margin-bottom:0;">
      <span class="label">// åŸç†</span>
      å°† x å¹³ç§»ä½¿ a æˆä¸ºåŸç‚¹ï¼šä»¤ <code style="color:var(--o)">x' = x - a</code>ï¼Œ
      åˆ™ <code style="color:var(--o)">a â‰¤ x â‰¤ b</code> ç­‰ä»·äº <code style="color:var(--o)">0 â‰¤ x' â‰¤ b-a</code>ã€‚
      å°† x' è§£é‡Šä¸º<strong>æ— ç¬¦å·æ•°</strong>ï¼Œè´Ÿæ•°å˜æˆå¾ˆå¤§çš„æ­£æ•°ï¼ˆ>b-aï¼‰ï¼Œè‡ªç„¶å°±è¶Šç•Œäº†ã€‚
      å› æ­¤ä¸€æ¬¡æ— ç¬¦å·æ¯”è¾ƒå³å¯å®ŒæˆåŒé‡åˆ¤æ–­ã€‚å‰æï¼š<code style="color:var(--o)">b â‰¥ a</code>ï¼ˆåˆæ³•åŒºé—´ï¼‰ã€‚
    </div>
  </div>

  <!-- ä»£ç å®ç° -->
  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">C å®ç°ï¼šæœ‰ç¬¦å·è¾¹ç•Œæ£€æŸ¥</div>
      <div class="code-block">
<span class="cm">// Â§4-1 è¾¹ç•Œæ£€æŸ¥: a â‰¤ x â‰¤ b (æœ‰ç¬¦å·æ•´æ•°)</span>
<span class="cm">// ä¼ ç»Ÿæ–¹æ³•: 2æ¬¡æ¯”è¾ƒ 2æ¬¡åˆ†æ”¯</span>
<span class="kw">int</span> <span class="fn">in_range_naive</span>(<span class="kw">int</span> x, <span class="kw">int</span> a, <span class="kw">int</span> b) {
  <span class="kw">return</span> (x &gt;= a) &amp;&amp; (x &lt;= b);
}

<span class="cm">// Warren ä¼˜åŒ–: 1æ¬¡æ— ç¬¦å·æ¯”è¾ƒ</span>
<span class="kw">int</span> <span class="fn">in_range</span>(<span class="kw">int</span> x, <span class="kw">int</span> a, <span class="kw">int</span> b) {
  <span class="kw">return</span> (<span class="kw">unsigned</span>)(x - a) &lt;= (<span class="kw">unsigned</span>)(b - a);
}
<span class="cm">// æ³¨æ„: è¦æ±‚ b >= a (åˆæ³•åŒºé—´)</span>
<span class="cm">// x < a æ—¶: x-a æ˜¯è´Ÿæ•° â†’ æ— ç¬¦å·å¾ˆå¤§ â†’ > b-a âœ“</span>
<span class="cm">// x > b æ—¶: x-a > b-a â†’ è¶Šç•Œ âœ“</span>
<span class="cm">// a â‰¤ x â‰¤ b: 0 â‰¤ x-a â‰¤ b-a âœ“</span>

<span class="cm">// æ•°ç»„ä¸‹æ ‡æ£€æŸ¥ (Java JVM å¸¸ç”¨æ–¹å¼):</span>
<span class="cm">// if ((unsigned)index >= (unsigned)length) throw AIOOBE</span>
<span class="cm">// â†’ åŒæ—¶æ£€æµ‹äº† index<0 å’Œ index>=length</span>
<span class="cm">// â†’ å‡å°‘ä¸€æ¬¡åˆ†æ”¯, å¯¹åˆ†æ”¯é¢„æµ‹å™¨æ›´å‹å¥½</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">æ±‡ç¼–å¯¹æ¯” (x86-64, GCC -O2)</div>
      <div class="code-block">
<span class="cm">; ä¼ ç»Ÿæ–¹æ³•: in_range_naive(x, a, b)</span>
<span class="cm">; edi=x, esi=a, edx=b</span>
<span class="fn">cmp</span>   edi, esi        <span class="cm">; x >= a ?</span>
<span class="fn">jl</span>    .out_of_range   <span class="cm">; åˆ†æ”¯1</span>
<span class="fn">cmp</span>   edi, edx        <span class="cm">; x <= b ?</span>
<span class="fn">jg</span>    .out_of_range   <span class="cm">; åˆ†æ”¯2</span>
<span class="cm">; â†’ 2æ¬¡è·³è½¬, 2æ¬¡åˆ†æ”¯é¢„æµ‹</span>

<span class="cm">; Warren ä¼˜åŒ–: in_range(x, a, b)</span>
<span class="fn">sub</span>   edi, esi        <span class="cm">; x - a (æœ‰ç¬¦å·å‡)</span>
<span class="fn">sub</span>   edx, esi        <span class="cm">; b - a</span>
<span class="fn">cmp</span>   edi, edx        <span class="cm">; æ— ç¬¦å·æ¯”è¾ƒ</span>
<span class="fn">ja</span>    .out_of_range   <span class="cm">; åˆ†æ”¯1 (jnbe/ja = unsigned >)</span>
<span class="cm">; â†’ 1æ¬¡è·³è½¬, 1æ¬¡åˆ†æ”¯é¢„æµ‹</span>
<span class="cm">; èŠ‚çœ: 1æ¬¡CMP + 1æ¬¡Jcc â‰ˆ 2 cycles on Skylake</span>

<span class="cm">; å®Œå…¨æ— åˆ†æ”¯ç‰ˆæœ¬ (SIMD-friendly):</span>
<span class="fn">sub</span>   edi, esi        <span class="cm">; x - a</span>
<span class="fn">sub</span>   edx, esi        <span class="cm">; b - a</span>
<span class="fn">xor</span>   eax, eax
<span class="fn">cmp</span>   edi, edx
<span class="fn">setbe</span> al              <span class="cm">; al = (x-a â‰¤ b-a) ? 1 : 0</span>
      </div>
    </div>
  </div>

  <!-- åº”ç”¨åœºæ™¯è¡¨ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">Â§4-1 è¾¹ç•Œæ£€æŸ¥çš„å·¥ä¸šçº§åº”ç”¨åœºæ™¯</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:.65rem;">
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--g);margin-bottom:.3rem;">Java JVM â€” æ•°ç»„è®¿é—®</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">æ¯æ¬¡ <code style="color:var(--o)">array[i]</code> è®¿é—®éƒ½æ’å…¥ <code style="color:var(--o)">(unsigned)i >= length</code> æ£€æŸ¥ã€‚JIT é€šè¿‡å¾ªç¯ä¸å˜é‡åˆ†ææ¶ˆé™¤å†—ä½™æ£€æŸ¥ï¼ˆBounds Check Elimination, BCEï¼‰ï¼Œä½†åº•å±‚æ£€æŸ¥æ­£æ˜¯ Warren çš„å•æ¬¡æ— ç¬¦å·æ¯”è¾ƒã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--b);margin-bottom:.3rem;">Rust â€” åˆ‡ç‰‡è¾¹ç•Œ</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">Rust åˆ‡ç‰‡çš„ <code style="color:var(--o)">index()</code å®ç°ä¸­, <code style="color:var(--o)">SliceIndex::index</code> ä½¿ç”¨ç­‰ä»·äº <code style="color:var(--o)">index >= len</code> çš„æ— ç¬¦å·æ¯”è¾ƒ panicï¼Œé¿å…äº†æœ‰ç¬¦å·æº¢å‡º UBã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--o);margin-bottom:.3rem;">GCC/LLVM â€” å€¼èŒƒå›´åˆ†æ</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;">ç¼–è¯‘å™¨çš„ VRPï¼ˆValue Range Propagationï¼‰Pass åœ¨ SSA å½¢å¼ä¸Šè¿½è¸ªæ¯ä¸ªå˜é‡çš„èŒƒå›´åŒºé—´ï¼Œåˆ©ç”¨ Â§4-1 çš„æ•°å­¦æ¶ˆé™¤ä¸å¯è¾¾çš„è¾¹ç•Œæ£€æŸ¥ï¼Œå‡å°‘ä»£ç ä½“ç§¯å’Œåˆ†æ”¯æ•°é‡ã€‚</div>
      </div>
      <div style="padding:.65rem;background:#010409;border:1px solid #1e293b;border-radius:.35rem;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--p);margin-bottom:.3rem;">Linux å†…æ ¸ â€” ç”¨æˆ·ç©ºé—´æŒ‡é’ˆ</div>
        <div style="font-size:.78rem;color:#64748b;line-height:1.65;"><code style="color:var(--o)">access_ok(addr, size)</code> æ£€æŸ¥ç”¨æˆ·ç©ºé—´åœ°å€æ˜¯å¦åˆæ³•ï¼Œå†…éƒ¨ç”¨ <code style="color:var(--o)">(unsigned long)(addr + size) > TASK_SIZE</code>ï¼Œä¸ Warren Â§4-1 åŒæ„ï¼ŒåŒæ—¶æ£€æŸ¥äº†åœ°å€æº¢å‡ºå’Œè¶Šç•Œã€‚</div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• Â§4-2 åŠ å‡æ³•çš„èŒƒå›´ä¼ æ’­ â•â•â• -->
<section id="addprop">
  <div class="sec-header">
    <span class="sec-num">Â§4-2</span>
    <span class="sec-title">åŠ å‡æ³•çš„èŒƒå›´ä¼ æ’­ â€” Propagating Bounds through Add/Subtract</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// RANGE PROPAGATION: ç»“æœçš„èŒƒå›´å–å†³äºæ“ä½œæ•°çš„èŒƒå›´</span>
    å¦‚æœå·²çŸ¥ <code style="color:var(--o)">a â‰¤ x â‰¤ b</code> ä¸” <code style="color:var(--o)">c â‰¤ y â‰¤ d</code>ï¼Œ
    é‚£ä¹ˆ <code style="color:var(--o)">x + y</code> çš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿç›´è§‰å‘Šè¯‰æˆ‘ä»¬æ˜¯ <code style="color:var(--o)">[a+c, b+d]</code>ï¼Œ
    è¿™å¯¹å®æ•°æ˜¯æ­£ç¡®çš„ï¼Œä½†å¯¹æœ‰ç•Œæ•´æ•°æœ‰<strong>æº¢å‡ºçš„é™·é˜±</strong>ã€‚
    Warren Â§4-2 ç³»ç»Ÿåœ°ç»™å‡ºäº†æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•´æ•°åœ¨åŠ æ³•å’Œå‡æ³•ä¸‹çš„èŒƒå›´ä¼ æ’­è§„åˆ™ï¼Œ
    ä»¥åŠå¦‚ä½•æ£€æµ‹ä¼ æ’­è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿäº†æº¢å‡ºâ€”â€”è¿™æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–å’Œé™æ€åˆ†æå·¥å…·çš„ç†è®ºåŸºç¡€ã€‚
  </div>

  <!-- äº¤äº’ï¼šèŒƒå›´ä¼ æ’­è®¡ç®—å™¨ -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="rangeCalc()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.9rem;">
      ğŸ”¬ èŒƒå›´ä¼ æ’­è®¡ç®—å™¨ â€” è¾“å…¥ x å’Œ y çš„èŒƒå›´ï¼Œè®¡ç®— x+y å’Œ x-y çš„ç»“æœèŒƒå›´
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--g);margin-bottom:.5rem;">x çš„èŒƒå›´ [a, b]</div>
        <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;">
          <div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#475569;">a =</div>
            <input type="number" x-model.number="xa" style="width:70px;background:#010409;border:1px solid #1e293b;color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:.25rem .4rem;border-radius:3px;">
          </div>
          <span style="color:#334155;font-family:'JetBrains Mono',monospace;">~</span>
          <div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#475569;">b =</div>
            <input type="number" x-model.number="xb" style="width:70px;background:#010409;border:1px solid #1e293b;color:var(--g);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:.25rem .4rem;border-radius:3px;">
          </div>
        </div>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--b);margin-bottom:.5rem;">y çš„èŒƒå›´ [c, d]</div>
        <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;">
          <div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#475569;">c =</div>
            <input type="number" x-model.number="yc" style="width:70px;background:#010409;border:1px solid #1e293b;color:var(--b);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:.25rem .4rem;border-radius:3px;">
          </div>
          <span style="color:#334155;font-family:'JetBrains Mono',monospace;">~</span>
          <div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#475569;">d =</div>
            <input type="number" x-model.number="yd" style="width:70px;background:#010409;border:1px solid #1e293b;color:var(--b);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:.25rem .4rem;border-radius:3px;">
          </div>
        </div>
      </div>
    </div>
    <!-- ç»“æœ -->
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.6rem;">
      <div class="ov-cell" :class="addOverflow?'bad':'ok'">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">x + y çš„èŒƒå›´</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.82rem;" x-text="'[' + (xa+yc) + ', ' + (xb+yd) + ']'"></div>
        <div style="font-size:.7rem;margin-top:.2rem;" :style="{color: addOverflow?'var(--r)':'var(--g)'}" x-text="addOverflow ? 'âš  å¯èƒ½æº¢å‡º (è¶…è¿‡INT_MAX/MIN)' : 'âœ“ å®‰å…¨èŒƒå›´å†…'"></div>
      </div>
      <div class="ov-cell" :class="subOverflow?'bad':'ok'">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">x - y çš„èŒƒå›´</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.82rem;" x-text="'[' + (xa-yd) + ', ' + (xb-yc) + ']'"></div>
        <div style="font-size:.7rem;margin-top:.2rem;" :style="{color: subOverflow?'var(--r)':'var(--g)'}" x-text="subOverflow ? 'âš  å¯èƒ½æº¢å‡º' : 'âœ“ å®‰å…¨èŒƒå›´å†…'"></div>
      </div>
      <div class="ov-cell neutral">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">32ä½æœ‰ç¬¦å· INT èŒƒå›´</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:#475569;">[-2147483648, 2147483647]</div>
        <div style="font-size:.7rem;margin-top:.2rem;color:#334155;">= [-2Â³Â¹, 2Â³Â¹-1]</div>
      </div>
    </div>
  </div>

  <!-- è§„åˆ™ä»£ç  -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div class="tab-nav">
      <button class="tab-btn active" @click="tabAdd='signed'">æœ‰ç¬¦å·è§„åˆ™</button>
      <button class="tab-btn" @click="tabAdd='unsigned'">æ— ç¬¦å·è§„åˆ™</button>
      <button class="tab-btn" @click="tabAdd='overflow'">æº¢å‡ºæ£€æµ‹</button>
    </div>
    <div class="tab-pane" :class="tabAdd==='signed'?'active':''">
      <div class="code-block">
<span class="cm">// Â§4-2 æœ‰ç¬¦å·æ•´æ•°åŠ å‡æ³•çš„èŒƒå›´ä¼ æ’­</span>
<span class="cm">// è®¾ x âˆˆ [a,b], y âˆˆ [c,d], å…¨ä¸ºæœ‰ç¬¦å·32ä½æ•´æ•°</span>

<span class="cm">// â˜… åŠ æ³•: x + y âˆˆ [a+c, b+d]</span>
<span class="cm">// å‰æ: ä¸å‘ç”Ÿæº¢å‡º!</span>
<span class="cm">// æº¢å‡ºæ¡ä»¶: a+c < INT_MIN æˆ– b+d > INT_MAX</span>
<span class="cm">// æ£€æµ‹æ–¹æ³• (Warren):</span>
<span class="kw">int</span> add_lo = a + c;
<span class="kw">int</span> add_hi = b + d;
<span class="kw">bool</span> add_overflow =
    (c &lt; <span class="num">0</span> &amp;&amp; add_lo &gt; a) ||    <span class="cm">// ä¸‹ç•Œè´Ÿæº¢å‡º</span>
    (d &gt; <span class="num">0</span> &amp;&amp; add_hi &lt; b);     <span class="cm">// ä¸Šç•Œæ­£æº¢å‡º</span>
<span class="cm">// è‹¥æº¢å‡º: ç»“æœèŒƒå›´é€€åŒ–ä¸º [INT_MIN, INT_MAX] (æœ€ä¿å®ˆä¼°è®¡)</span>

<span class="cm">// â˜… å‡æ³•: x - y âˆˆ [a-d, b-c]</span>
<span class="cm">// (å‡å»y, yè¶Šå¤§ç»“æœè¶Šå°, yè¶Šå°ç»“æœè¶Šå¤§)</span>
<span class="kw">int</span> sub_lo = a - d;
<span class="kw">int</span> sub_hi = b - c;
<span class="kw">bool</span> sub_overflow =
    (d &gt; <span class="num">0</span> &amp;&amp; sub_lo &gt; a) ||    <span class="cm">// ä¸‹ç•Œè´Ÿæº¢å‡º</span>
    (c &lt; <span class="num">0</span> &amp;&amp; sub_hi &lt; b);     <span class="cm">// ä¸Šç•Œæ­£æº¢å‡º</span>

<span class="cm">// é‡è¦æ¨è®º: è‹¥ x âˆˆ [a,b] ä¸” a,b â‰¥ 0ï¼Œåˆ™:</span>
<span class="cm">//   x+y â‰¥ 0 å½“ y â‰¥ -a (å³ y â‰¥ -(MIN_OF_X))</span>
<span class="cm">//   è¿™æ˜¯ç¼–è¯‘å™¨æ¶ˆé™¤æº¢å‡ºæ£€æŸ¥çš„å…³é”®ä¾æ®</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabAdd==='unsigned'?'active':''">
      <div class="code-block">
<span class="cm">// Â§4-2 æ— ç¬¦å·æ•´æ•°åŠ å‡æ³•çš„èŒƒå›´ä¼ æ’­</span>
<span class="cm">// è®¾ x âˆˆ [a,b], y âˆˆ [c,d], å…¨ä¸ºæ— ç¬¦å·32ä½æ•´æ•°</span>

<span class="cm">// â˜… åŠ æ³•: x + y âˆˆ [a+c, b+d] (æ¨¡2Â³Â²)</span>
<span class="cm">// æ— ç¬¦å·æº¢å‡ºæ£€æµ‹ (Warren Â§4-2):</span>
<span class="kw">unsigned</span> add_lo = a + c;
<span class="kw">unsigned</span> add_hi = b + d;
<span class="kw">bool</span> lo_wrapped = add_lo &lt; a;   <span class="cm">// è¿›ä½ â†’ æ¨¡2Â³Â²å›ç»•</span>
<span class="kw">bool</span> hi_wrapped = add_hi &lt; b;   <span class="cm">// è¿›ä½ â†’ æ¨¡2Â³Â²å›ç»•</span>

<span class="cm">// è‹¥ lo å›ç»•ä½† hi æœªå›ç»•: èŒƒå›´è·¨è¶Š UINT_MAX</span>
<span class="cm">// â†’ ä¿å®ˆä¼°è®¡ä¸º [0, UINT_MAX] (å…¨èŒƒå›´)</span>
<span class="cm">// è‹¥ä¸¤è€…éƒ½å›ç»•: ç»“æœä»ç„¶æ˜¯è¿ç»­åŒºé—´ [a+c, b+d] (å‡wrap)</span>
<span class="cm">// è‹¥ä¸¤è€…éƒ½ä¸å›ç»•: æ­£å¸¸ [a+c, b+d]</span>

<span class="cm">// â˜… å‡æ³•: x - y âˆˆ [a-d, b-c] (æ¨¡2Â³Â²)</span>
<span class="cm">// æ— ç¬¦å·å€Ÿä½æ£€æµ‹:</span>
<span class="kw">unsigned</span> sub_lo = a - d;
<span class="kw">unsigned</span> sub_hi = b - c;
<span class="kw">bool</span> sub_wrapped = (a &lt; d) || (b &lt; c);
<span class="cm">// è‹¥ a < d: a-d å€Ÿä½ â†’ æ¨¡2Â³Â² å¾ˆå¤§</span>
<span class="cm">// è¿™åœ¨ Linux å†…æ ¸çš„æŒ‡é’ˆå·®å€¼è®¡ç®—ä¸­å¿…é¡»å°å¿ƒ!</span>

<span class="cm">// å…³é”®åº”ç”¨: è¯æ˜ (x & mask) ä¸æº¢å‡º</span>
<span class="cm">// å› ä¸º AND æ°¸è¿œä¸å¢å¤§æ“ä½œæ•° â†’ AND ç»“æœæ°¸è¿œ â‰¤ ä¸¤ä¸ªæ“ä½œæ•°</span>
<span class="cm">// â†’ æ— ç¬¦å·åŠ æ³• (x&m) + (y&n) â‰¤ m + n</span>
      </div>
    </div>
    <div class="tab-pane" :class="tabAdd==='overflow'?'active':''">
      <div class="code-block">
<span class="cm">// Â§4-2 æº¢å‡ºæ£€æµ‹: ç¡®ä¿èŒƒå›´ä¼ æ’­åç»“æœä»æœ‰æ„ä¹‰</span>
<span class="cm">// è¿™äº›æ–¹æ³•åŒæ—¶ä¹Ÿæ˜¯ Â§2-13 Overflow Detection çš„å»¶ä¼¸</span>

<span class="cm">// â˜… æœ‰ç¬¦å·åŠ æ³•æº¢å‡ºæ£€æµ‹ (3ç§ç­‰ä»·æ–¹æ³•):</span>

<span class="cm">// æ–¹æ³•1: æ£€æŸ¥ç»“æœç¬¦å· (Warren Â§2-13, æœ€ç»å…¸)</span>
<span class="kw">int</span> s = a + b;
<span class="kw">bool</span> ov1 = (~(a ^ b) &amp; (a ^ s)) &lt; <span class="num">0</span>;
<span class="cm">// åŸç†: åªæœ‰å½“ a,b åŒå·ä¸”ç»“æœå¼‚å·æ—¶æ‰æº¢å‡º</span>
<span class="cm">// ~(a^b): a,b åŒå·æ—¶æœ€é«˜ä½ä¸º1</span>
<span class="cm">// (a^s):  a,ç»“æœå¼‚å·æ—¶æœ€é«˜ä½ä¸º1</span>
<span class="cm">// AND åæœ€é«˜ä½ = ä¸¤è€…éƒ½æ»¡è¶³ = æº¢å‡º</span>

<span class="cm">// æ–¹æ³•2: C++20 æ ‡å‡†åº“ (æœ€æ¨è)</span>
<span class="kw">bool</span> ov2 = __builtin_add_overflow(a, b, &amp;s);

<span class="cm">// æ–¹æ³•3: æ‰©å±•åˆ°64ä½è®¡ç®—åæ£€æŸ¥</span>
<span class="kw">long long</span> s64 = (<span class="kw">long long</span>)a + (<span class="kw">long long</span>)b;
<span class="kw">bool</span> ov3 = s64 &gt; INT_MAX || s64 &lt; INT_MIN;

<span class="cm">// æ–¹æ³•4: åˆ©ç”¨ LLVM/GCC äº§ç”Ÿçš„ ADDO æŒ‡ä»¤</span>
<span class="cm">// x86: ADD + INTO/JO (overflow flag)</span>
<span class="cm">// ARM: ADDS + BVS (V flag)</span>

<span class="cm">// â˜… æ— ç¬¦å·åŠ æ³•æº¢å‡º (è¿›ä½æ£€æµ‹):</span>
<span class="kw">unsigned</span> u = a + b;
<span class="kw">bool</span> uov = u &lt; a;  <span class="cm">// è‹¥è¿›ä½åˆ™ u < a âœ“ (1æ¡æŒ‡ä»¤)</span>

<span class="cm">// â˜… Rust: checked_add / saturating_add / wrapping_add</span>
<span class="cm">// â†’ æŠŠæº¢å‡ºè¡Œä¸ºæ˜¾å¼åŒ–, å½»åº•æ¶ˆé™¤ UB</span>
      </div>
    </div>
  </div>

  <!-- èŒƒå›´ä¼ æ’­å›¾ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
      ğŸ“Š æœ‰ç¬¦å·æ•´æ•°åŠ æ³•èŒƒå›´ä¼ æ’­ç¤ºæ„ï¼ˆx âˆˆ [-10,20], y èŒƒå›´å˜åŒ–ï¼‰
    </div>
    <div id="chart-range" style="width:100%;height:260px;"></div>
  </div>
</section>

<!-- â•â•â• Â§4-3 é€»è¾‘æ“ä½œçš„èŒƒå›´ä¼ æ’­ â•â•â• -->
<section id="logprop">
  <div class="sec-header">
    <span class="sec-num">Â§4-3</span>
    <span class="sec-title">é€»è¾‘æ“ä½œçš„èŒƒå›´ä¼ æ’­ â€” Propagating Bounds through Logical Ops</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// THE HARDER PROBLEM: ä½è¿ç®—ä¸ä¿æŒçº¿æ€§ç»“æ„</span>
    åŠ æ³•çš„èŒƒå›´ä¼ æ’­æ˜¯çº¿æ€§çš„ï¼ˆåŒºé—´åŠ åŒºé—´è¿˜æ˜¯åŒºé—´ï¼‰ï¼Œä½† AND/OR/XOR çš„èŒƒå›´ä¼ æ’­
    <strong>ä¸éµå®ˆçº¿æ€§è§„åˆ™</strong>ã€‚ä¾‹å¦‚ï¼šx âˆˆ [3, 5]ï¼ˆå³ 011 ~ 101ï¼‰ï¼Œ
    y âˆˆ [0, 15]ï¼ˆå³ 0000 ~ 1111ï¼‰ï¼Œåˆ™ x & y çš„ä¸Šç•Œæ˜¯å¤šå°‘ï¼Ÿ
    ç›´è§‰è¯´æ˜¯ min(5,15) = 5ï¼Œä½†å®é™…ä¸Šéœ€è¦é€ä½åˆ†æã€‚
    Warren Â§4-3 ç»™å‡ºäº†åŸºäº"ä½æ©ç "çš„ä¸Šä¸‹ç•Œè®¡ç®—æ–¹æ³•â€”â€”è¿™æ˜¯ç¼–è¯‘å™¨åš
    <strong>ä½è¿ç®—ç»“æœèŒƒå›´æ¨æ–­</strong>çš„ç†è®ºæ ¹åŸºï¼Œä¹Ÿæ˜¯ eBPF éªŒè¯å™¨çš„æ ¸å¿ƒç®—æ³•ä¹‹ä¸€ã€‚
  </div>

  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">AND çš„èŒƒå›´ä¼ æ’­</div>
      <div class="code-block">
<span class="cm">// Â§4-3 AND æ“ä½œ: z = x & y</span>
<span class="cm">// x âˆˆ [a,b], y âˆˆ [c,d] (æ— ç¬¦å·)</span>

<span class="cm">// ä¸Šç•Œ: z_max = min(b, d)</span>
<span class="cm">// AND æ°¸è¿œä¸å¢å¤§æ“ä½œæ•°ï¼Œæ‰€ä»¥ç»“æœ â‰¤ ä¸¤è€…ä¸­çš„è¾ƒå°è€…</span>
<span class="kw">unsigned</span> z_max = <span class="fn">min</span>(b, d);

<span class="cm">// ä¸‹ç•Œ: æ›´å¤æ‚ï¼ŒWarren ç»™å‡ºä»¥ä¸‹æ–¹æ³•:</span>
<span class="cm">// å¯¹äºæ— ç¬¦å·: z_min = 0 (ä¿å®ˆä¼°è®¡ï¼Œæ€»æ˜¯æ­£ç¡®çš„)</span>
<span class="cm">// ç²¾ç¡®ä¸‹ç•Œéœ€è¦é€ä½åˆ†æ (è§ Â§4-3 è¯¦ç»†æ¨å¯¼)</span>
<span class="kw">unsigned</span> z_min_conservative = <span class="num">0</span>;

<span class="cm">// Warren ç²¾ç¡®ç®—æ³• (åŸºäºåŒºé—´çš„ä½ä¼ æ’­):</span>
<span class="cm">// ä»¤ m = ~(b & d): æ‰¾å‡º b å’Œ d ä¸­æœ€é«˜çš„ä¸åŒä½</span>
<span class="kw">unsigned</span> m = ~(b &amp; d);
<span class="cm">// m çš„æœ€é«˜ä½æ ‡è¯†äº†éœ€è¦"é€€ä¸€æ­¥"çš„ä½ç½®</span>
<span class="cm">// è¿™ä¸ªç®—æ³•çš„å®Œæ•´ç‰ˆè§WarrenåŸä¹¦å›¾4-2</span>

<span class="cm">// å…³é”®æ€§è´¨:</span>
<span class="cm">// (x & C) âˆˆ [0, C]  â€” AND å¸¸æ•°æ—¶ä¸Šç•Œå°±æ˜¯å¸¸æ•°</span>
<span class="cm">// (x & x) = x       â€” å¹³å‡¡æƒ…å†µ</span>
<span class="cm">// (x & 0) = 0       â€” ANDé›¶å¾—é›¶</span>

<span class="cm">// eBPF éªŒè¯å™¨ (Linux 5.x) çš„ AND èŒƒå›´æ¨æ–­:</span>
<span class="cm">// dst_reg.umax_value = min(dst_reg.umax, src_reg.umax)</span>
<span class="cm">// dst_reg.umin_value = 0 (ä¿å®ˆ)</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">OR / XOR çš„èŒƒå›´ä¼ æ’­</div>
      <div class="code-block">
<span class="cm">// Â§4-3 OR æ“ä½œ: z = x | y</span>
<span class="cm">// x âˆˆ [a,b], y âˆˆ [c,d] (æ— ç¬¦å·)</span>

<span class="cm">// ä¸‹ç•Œ: z_min = max(b, d) (ORåªä¼šç½®ä½, ä¸æ¸…ä½)</span>
<span class="cm">// æ›´ç²¾ç¡®: z_min = max(a, c) (ä½† max(b,d) ä¸å¯¹!)</span>
<span class="cm">// å®é™…: z_min = a | c  (ä¸¤è€…çš„"å·²çŸ¥1ä½"éƒ½ä¿ç•™)</span>
<span class="kw">unsigned</span> or_min = a | c;   <span class="cm">// ä¸‹ç•Œ: ä¸¤è€…éƒ½æ˜¯1çš„ä½å¿…ç„¶æ˜¯1</span>

<span class="cm">// ä¸Šç•Œ: Warren Â§4-3 ç²¾ç¡®ç®—æ³•</span>
<span class="cm">// ä»¤ m = æ‰¾åˆ° b|d ä¸­ä½¿åŒºé—´"å‘ä¸Šæ‰©å±•"çš„æœ€é«˜ä½</span>
<span class="kw">unsigned</span> m_or = b | d;
<span class="cm">// ä¿å®ˆä¸Šç•Œ: ä¸¤è€…å¯ç½®ä½çš„æ‰€æœ‰ä½éƒ½ç½®1</span>
<span class="kw">unsigned</span> or_max = b | d;   <span class="cm">// ç®€å•ä¿å®ˆä¼°è®¡</span>

<span class="cm">// XOR æ“ä½œ: z = x ^ y</span>
<span class="cm">// XOR çš„èŒƒå›´ä¼ æ’­æœ€éš¾ç²¾ç¡®, é€šå¸¸ç”¨ä¿å®ˆä¼°è®¡:</span>
<span class="cm">// z_min = 0  (ä¸¤è€…ç›¸åŒæ—¶XOR=0)</span>
<span class="cm">// z_max = b | d  (æ‰€æœ‰å¯èƒ½ç½®ä½çš„ä½)</span>
<span class="kw">unsigned</span> xor_min = <span class="num">0</span>;
<span class="kw">unsigned</span> xor_max = b | d;

<span class="cm">// å…³é”®æ€§è´¨:</span>
<span class="cm">// (x | C) âˆˆ [C, C | UINT_MAX] â€” OR å¸¸æ•°æ—¶ä¸‹ç•Œæ˜¯å¸¸æ•°</span>
<span class="cm">// (x | 0) = x   â€” ORé›¶ä¸å˜</span>
<span class="cm">// (x ^ x) = 0   â€” XORè‡ªèº«å¾—é›¶</span>
<span class="cm">// (x ^ ~x) = UINT_MAX</span>

<span class="cm">// LLVM ConstantRange::binaryOr / binaryAnd</span>
<span class="cm">// å®ç°äº† Warren Â§4-3 çš„å®Œæ•´ç®—æ³•</span>
      </div>
    </div>
  </div>
  <!-- eBPF éªŒè¯å™¨ -->
  <div class="card" style="margin-bottom:1.2rem;">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.75rem;">ğŸ“¦ çœŸå®æ¡ˆä¾‹ï¼šeBPF éªŒè¯å™¨çš„ä½èŒƒå›´åˆ†æ</div>
    <div class="insight" style="margin-bottom:.7rem;">
      <span class="label">// LINUX KERNEL eBPF VERIFIER â€” kernel/bpf/verifier.c</span>
      Linux eBPF ç¨‹åºåœ¨åŠ è½½æ—¶å¿…é¡»é€šè¿‡å†…æ ¸éªŒè¯å™¨çš„<strong>é™æ€åˆ†æ</strong>ï¼Œ
      ç¡®ä¿æ¯æ¡æŒ‡ä»¤ä¸ä¼šäº§ç”Ÿè¶Šç•Œå†…å­˜è®¿é—®ã€éæ³•æŒ‡é’ˆè¿ç®—ç­‰å±é™©æ“ä½œã€‚
      éªŒè¯å™¨å¯¹æ¯ä¸ªå¯„å­˜å™¨ç»´æŠ¤ä¸€ä¸ª"å€¼èŒƒå›´"ç»“æ„ä½“ï¼ˆ<code style="color:var(--o)">struct bpf_reg_state</code>ï¼‰ï¼Œ
      åŒ…å« <code style="color:var(--o)">smin/smax</code>ï¼ˆæœ‰ç¬¦å·ï¼‰å’Œ <code style="color:var(--o)">umin/umax</code>ï¼ˆæ— ç¬¦å·ï¼‰å››ä¸ªè¾¹ç•Œï¼Œ
      åœ¨æ¯æ¡ AND/OR/ADD/SUB æŒ‡ä»¤åç”¨ Â§4-2/Â§4-3 çš„ç®—æ³•æ›´æ–°è¿™äº›è¾¹ç•Œã€‚
      å¦‚æœéªŒè¯å™¨æ— æ³•è¯æ˜æŸæ¬¡å†…å­˜è®¿é—®æ˜¯å®‰å…¨çš„ï¼Œç¨‹åºåŠ è½½å¤±è´¥ã€‚
    </div>
    <div class="code-block">
<span class="cm">// ç®€åŒ–ç‰ˆ eBPF å¯„å­˜å™¨çŠ¶æ€ (å‚è€ƒ linux/bpf.h)</span>
<span class="kw">struct</span> bpf_reg_state {
    <span class="kw">s64</span> smin_value;   <span class="cm">// æœ‰ç¬¦å·ä¸‹ç•Œ</span>
    <span class="kw">s64</span> smax_value;   <span class="cm">// æœ‰ç¬¦å·ä¸Šç•Œ</span>
    <span class="kw">u64</span> umin_value;   <span class="cm">// æ— ç¬¦å·ä¸‹ç•Œ</span>
    <span class="kw">u64</span> umax_value;   <span class="cm">// æ— ç¬¦å·ä¸Šç•Œ</span>
    <span class="kw">u64</span> var_off.mask; <span class="cm">// æœªçŸ¥ä½çš„æ©ç  (tnum)</span>
    <span class="kw">u64</span> var_off.value;<span class="cm">// å·²çŸ¥ä½çš„å€¼  (tnum)</span>
};

<span class="cm">// AND æŒ‡ä»¤åæ›´æ–° (scalar_min_max_and):</span>
<span class="kw">void</span> <span class="fn">scalar_min_max_and</span>(reg1, reg2, dst) {
    dst.umax_value = <span class="fn">min</span>(reg1.umax_value, reg2.umax_value); <span class="cm">// Warren Â§4-3</span>
    dst.umin_value = <span class="num">0</span>;   <span class="cm">// ä¿å®ˆä¸‹ç•Œ</span>
    <span class="cm">// è‹¥ä¸¤è€…éƒ½éè´Ÿ: æœ‰ç¬¦å·è¾¹ç•ŒåŒæ— ç¬¦å·</span>
    <span class="kw">if</span> (reg1.smin_value &gt;= <span class="num">0</span> &amp;&amp; reg2.smin_value &gt;= <span class="num">0</span>) {
        dst.smax_value = dst.umax_value;
        dst.smin_value = <span class="num">0</span>;
    }
}

<span class="cm">// å…¸å‹éªŒè¯åœºæ™¯:</span>
<span class="cm">// r1 = map_value_ptr (å·²çŸ¥æŒ‡å‘åˆæ³•å†…å­˜)</span>
<span class="cm">// r2 = user_input    (æœªçŸ¥, smin=-âˆ, smax=+âˆ)</span>
<span class="cm">// r2 &= 0xFF         â†’ éªŒè¯å™¨æ›´æ–°: r2 âˆˆ [0, 255] (Â§4-3 ANDå¸¸æ•°)</span>
<span class="cm">// r1 += r2           â†’ éªŒè¯å™¨æ›´æ–°: r1åç§» âˆˆ [0, 255] (Â§4-2 åŠ æ³•ä¼ æ’­)</span>
<span class="cm">// è¯» [r1]            â†’ åç§»å·²è¯æ˜åœ¨ç•Œå†…, å…è®¸! âœ“</span>
    </div>
  </div>

  <!-- é€»è¾‘ä¼ æ’­äº¤äº’æ¼”ç¤º -->
  <div class="card" x-data="bitwiseRangeDemo()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--p);margin-bottom:.9rem;">
      ğŸ”¬ ä½è¿ç®—èŒƒå›´ä¼ æ’­æ¼”ç¤º â€” 8ä½æ— ç¬¦å·æ•°
    </div>
    <div style="display:flex;gap:1.2rem;flex-wrap:wrap;margin-bottom:.9rem;align-items:flex-end;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">x çš„ä¸Šç•Œ b (8bit)</div>
        <input type="range" min="0" max="255" x-model.number="xb" style="width:130px;accent-color:var(--g);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--g);margin-left:.4rem;" x-text="xb+' (0b'+xb.toString(2).padStart(8,'0')+')'"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">y çš„ä¸Šç•Œ d (8bit)</div>
        <input type="range" min="0" max="255" x-model.number="yd" style="width:130px;accent-color:var(--b);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--b);margin-left:.4rem;" x-text="yd+' (0b'+yd.toString(2).padStart(8,'0')+')'"></span>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem;">
      <div class="ov-cell ok">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">x AND y ä¸Šç•Œ</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;" x-text="Math.min(xb,yd)"></div>
        <div style="font-size:.68rem;color:#475569;margin-top:.2rem;" x-text="'= min('+xb+','+yd+')'"></div>
      </div>
      <div class="ov-cell" style="border-color:rgba(0,212,255,.22);background:rgba(0,212,255,.06);">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">x OR y ä¸Šç•Œ</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;color:var(--b);" x-text="(xb|yd)"></div>
        <div style="font-size:.68rem;color:#475569;margin-top:.2rem;" x-text="'= '+xb+'|'+yd+' = 0b'+(xb|yd).toString(2).padStart(8,'0')"></div>
      </div>
      <div class="ov-cell" style="border-color:rgba(177,79,255,.22);background:rgba(177,79,255,.06);">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.25rem;">x XOR y ä¸Šç•Œ</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;color:var(--p);" x-text="(xb|yd)"></div>
        <div style="font-size:.68rem;color:#475569;margin-top:.2rem;" x-text="'(ä¿å®ˆ: '+xb+'|'+yd+')'"></div>
      </div>
    </div>
    <div class="insight" style="margin-top:.75rem;margin-bottom:0;font-size:.78rem;">
      <span class="label">// ä½è§†å›¾</span>
      <div style="display:flex;gap:.35rem;flex-direction:column;margin-top:.3rem;">
        <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
          <span style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--g);width:60px;">b (xä¸Šç•Œ)</span>
          <div class="bit-row" style="margin:0;">
            <template x-for="(bit,i) in xb.toString(2).padStart(8,'0').split('')" :key="i">
              <div class="bit-cell" :class="bit==='1'?'one':'zero'" x-text="bit"></div>
            </template>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
          <span style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--b);width:60px;">d (yä¸Šç•Œ)</span>
          <div class="bit-row" style="margin:0;">
            <template x-for="(bit,i) in yd.toString(2).padStart(8,'0').split('')" :key="i">
              <div class="bit-cell" :class="bit==='1'?'hi':'zero'" x-text="bit"></div>
            </template>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
          <span style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--o);width:60px;">b|d (ORä¸Šç•Œ)</span>
          <div class="bit-row" style="margin:0;">
            <template x-for="(bit,i) in (xb|yd).toString(2).padStart(8,'0').split('')" :key="i">
              <div class="bit-cell" :class="bit==='1'?'warn':'zero'" x-text="bit"></div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- â•â•â• Â§4-4 æº¢å‡ºæ£€æµ‹ä¸é¥±å’Œç®—æœ¯ â•â•â• -->
<section id="overflow">
  <div class="sec-header">
    <span class="sec-num">Â§4-4</span>
    <span class="sec-title">æº¢å‡ºæ£€æµ‹ä¸é¥±å’Œç®—æœ¯ â€” Overflow Detection & Saturating Arithmetic</span>
    <div class="sec-divider"></div>
  </div>

  <div class="insight">
    <span class="label">// OVERFLOW: THE ROOT OF ALL EVIL IN INTEGER ARITHMETIC</span>
    Â§4-2 çš„èŒƒå›´ä¼ æ’­å‘Šè¯‰æˆ‘ä»¬ç»“æœèŒƒå›´ï¼Œä½†å½“å®é™…è®¡ç®—å‘ç”Ÿæ—¶ï¼Œæº¢å‡ºå¯èƒ½å·²ç»é€ æˆäº†ç ´åã€‚
    Warren Â§4-4 åœ¨ä¼ æ’­ç†è®ºä¹‹ä¸Šç»™å‡ºäº†<strong>è¿è¡Œæ—¶æº¢å‡ºæ£€æµ‹</strong>çš„é«˜æ•ˆå®ç°ï¼Œ
    ä»¥åŠä¸€ç§ä¼˜é›…çš„æ›¿ä»£ï¼š<strong>é¥±å’Œç®—æœ¯ï¼ˆSaturating Arithmeticï¼‰</strong>â€”â€”
    æº¢å‡ºæ—¶æŠŠç»“æœå¤¹åœ¨ [INT_MIN, INT_MAX]ï¼Œè€Œä¸æ˜¯å›ç»•ã€‚
    è¿™åœ¨å›¾åƒ/éŸ³é¢‘/DSPå¤„ç†ä¸­æä¸ºé‡è¦ï¼ˆåƒç´ å€¼æº¢å‡ºä¸åº”è¯¥ä» 255 å›ç»•åˆ° 0ï¼‰ã€‚
  </div>

  <!-- æº¢å‡ºå¯è§†åŒ– -->
  <div class="card" style="margin-bottom:1.2rem;" x-data="overflowVis()">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--r);margin-bottom:.9rem;">
      ğŸ”¬ æº¢å‡º vs é¥±å’Œ å¯¹æ¯”æ¼”ç¤º â€” 8ä½æœ‰ç¬¦å·æ•´æ•° [-128, 127]
    </div>

    <div style="display:flex;gap:1.2rem;flex-wrap:wrap;margin-bottom:.9rem;align-items:flex-end;">
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">æ“ä½œæ•° a =</div>
        <input type="range" min="-128" max="127" x-model.number="a"
               style="width:140px;accent-color:var(--r);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--r);margin-left:.4rem;"
              x-text="a"></span>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#475569;margin-bottom:.3rem;">æ“ä½œæ•° b =</div>
        <input type="range" min="-128" max="127" x-model.number="b"
               style="width:140px;accent-color:var(--o);">
        <span style="font-family:'JetBrains Mono',monospace;color:var(--o);margin-left:.4rem;"
              x-text="b"></span>
      </div>
    </div>

    <!-- å››æ ¼ç»“æœ -->
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.6rem;margin-bottom:.8rem;">
      <div class="ov-cell" :class="(a+b)<-128||(a+b)>127 ? 'bad':'ok'">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.2rem;">å›ç»•åŠ æ³• (C é»˜è®¤)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;" x-text="wrappedAdd"></div>
        <div style="font-size:.7rem;margin-top:.15rem;"
             x-text="((a+b)<-128||(a+b)>127) ? 'âš  æº¢å‡ºå›ç»•!' : 'âœ“ æ­£å¸¸'"></div>
      </div>
      <div class="ov-cell ok">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.2rem;">é¥±å’ŒåŠ æ³• (clamp)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;color:var(--g);"
             x-text="saturatedAdd"></div>
        <div style="font-size:.7rem;color:var(--g);margin-top:.15rem;">âœ“ å¤¹åœ¨ [-128, 127]</div>
      </div>
      <div class="ov-cell" :class="(a-b)<-128||(a-b)>127 ? 'bad':'ok'">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.2rem;">å›ç»•å‡æ³•</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;" x-text="wrappedSub"></div>
        <div style="font-size:.7rem;margin-top:.15rem;"
             x-text="((a-b)<-128||(a-b)>127) ? 'âš  æº¢å‡ºå›ç»•!' : 'âœ“ æ­£å¸¸'"></div>
      </div>
      <div class="ov-cell ok">
        <div style="font-size:.65rem;color:#475569;margin-bottom:.2rem;">é¥±å’Œå‡æ³• (clamp)</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;color:var(--b);"
             x-text="saturatedSub"></div>
        <div style="font-size:.7rem;color:var(--b);margin-top:.15rem;">âœ“ å¤¹åœ¨ [-128, 127]</div>
      </div>
    </div>

    <!-- æ•°è½´å¯è§†åŒ– -->
    <div style="background:#010409;border:1px solid #1e293b;border-radius:.4rem;padding:.75rem 1.2rem;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#334155;margin-bottom:.5rem;">
        8ä½æœ‰ç¬¦å·æ•°è½´ [-128 ... 0 ... 127]
      </div>
      <div style="position:relative;height:48px;">
        <!-- è½¨é“ -->
        <div style="position:absolute;top:18px;left:0;right:0;height:2px;background:#1e293b;"></div>
        <!-- INT_MIN åˆ»åº¦ -->
        <div style="position:absolute;top:11px;left:0;width:1px;height:14px;background:var(--r);"></div>
        <div style="position:absolute;bottom:2px;left:0;
                    font-family:'JetBrains Mono',monospace;font-size:.55rem;color:var(--r);">-128</div>
        <!-- 0 åˆ»åº¦ -->
        <div style="position:absolute;top:13px;left:50%;width:1px;height:10px;background:#334155;"></div>
        <div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);
                    font-family:'JetBrains Mono',monospace;font-size:.55rem;color:#334155;">0</div>
        <!-- INT_MAX åˆ»åº¦ -->
        <div style="position:absolute;top:11px;right:0;width:1px;height:14px;background:var(--r);"></div>
        <div style="position:absolute;bottom:2px;right:0;
                    font-family:'JetBrains Mono',monospace;font-size:.55rem;color:var(--r);">127</div>

        <!-- å›ç»•ç»“æœæŒ‡é’ˆï¼ˆä»…åœ¨æœªè¶Šç•Œæ—¶æ˜¾ç¤ºï¼‰ -->
        <div :style="{
               position:'absolute', top:'8px',
               left:'calc('+(((wrappedAdd+128)/255)*100)+'%)',
               width:'3px', height:'20px',
               background:'var(--r)', borderRadius:'2px',
               transform:'translateX(-50%)',
               opacity: ((a+b)<-128||(a+b)>127) ? 0 : 1,
               transition:'left .15s'
             }"></div>
        <!-- å›ç»•ç»“æœæ ‡ç­¾ -->
        <div :style="{
               position:'absolute', top:'0px',
               left:'calc('+(((wrappedAdd+128)/255)*100)+'%)',
               fontFamily:'JetBrains Mono', fontSize:'.52rem',
               color:'var(--r)', transform:'translateX(-50%)',
               opacity: ((a+b)<-128||(a+b)>127) ? 0 : 1
             }" x-text="'w:'+wrappedAdd"></div>

        <!-- é¥±å’Œç»“æœæŒ‡é’ˆ -->
        <div :style="{
               position:'absolute', top:'6px',
               left:'calc('+(((saturatedAdd+128)/255)*100)+'%)',
               width:'3px', height:'24px',
               background:'var(--g)', borderRadius:'2px',
               transform:'translateX(-50%)',
               transition:'left .15s'
             }"></div>
        <!-- é¥±å’Œç»“æœæ ‡ç­¾ -->
        <div :style="{
               position:'absolute', top:'-1px',
               left:'calc('+(((saturatedAdd+128)/255)*100)+'%)',
               fontFamily:'JetBrains Mono', fontSize:'.52rem',
               color:'var(--g)', transform:'translateX(-50%)'
             }" x-text="'s:'+saturatedAdd"></div>
      </div>
    </div>

    <div class="insight" style="margin-top:.75rem;margin-bottom:0;">
      <span class="label">// å…³é”®å·®å¼‚</span>
      å½“ <code style="color:var(--o)">a + b</code> è¶…å‡º <code style="color:var(--o)">[-128, 127]</code> æ—¶ï¼š
      <strong>å›ç»•</strong>ï¼ˆçº¢è‰²æŒ‡é’ˆï¼‰ä¼šæ¶ˆå¤±â€”â€”ç»“æœè¶Šç•Œæ— æ„ä¹‰ï¼›
      <strong>é¥±å’Œ</strong>ï¼ˆç»¿è‰²æŒ‡é’ˆï¼‰ä¼šåœåœ¨è¾¹ç•Œ Â±127ï¼Œå§‹ç»ˆæ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„å€¼ã€‚
      è°ƒæ•´æ»‘å—ä»¤ <code style="color:var(--o)">a = 100, b = 100</code> å¯ç›´è§‚çœ‹åˆ°å·®å¼‚ã€‚
    </div>
  </div><!-- /card overflowVis -->

  <!-- é¥±å’Œç®—æœ¯ä»£ç  -->
  <div class="grid-2" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.7rem;">
        é¥±å’ŒåŠ æ³•å®ç° (å¤šç§æ–¹æ³•)
      </div>
      <div class="code-block">
<span class="cm">// Â§4-4 é¥±å’ŒåŠ æ³•: æº¢å‡ºæ—¶å¤¹åˆ°è¾¹ç•Œ</span>

<span class="cm">// æ–¹æ³•1: æœ´ç´ æ–¹æ³• (æœ‰åˆ†æ”¯, æœ€æ…¢)</span>
<span class="kw">int</span> <span class="fn">sadd_naive</span>(<span class="kw">int</span> a, <span class="kw">int</span> b) {
  <span class="kw">long long</span> r = (<span class="kw">long long</span>)a + b;
  <span class="kw">if</span> (r &gt; INT_MAX) <span class="kw">return</span> INT_MAX;
  <span class="kw">if</span> (r &lt; INT_MIN) <span class="kw">return</span> INT_MIN;
  <span class="kw">return</span> (<span class="kw">int</span>)r;
}

<span class="cm">// æ–¹æ³•2: Warren Â§4-4 æ— åˆ†æ”¯ (ä½æ“ä½œ)</span>
<span class="kw">int</span> <span class="fn">sadd_branchless</span>(<span class="kw">int</span> a, <span class="kw">int</span> b) {
  <span class="kw">unsigned</span> ua = a, ub = b;
  <span class="kw">unsigned</span> s  = ua + ub;
  <span class="cm">// æº¢å‡ºæ£€æµ‹: åŒå·ç›¸åŠ ä¸”ç»“æœå¼‚å·</span>
  <span class="kw">unsigned</span> ov = (~(ua ^ ub) &amp; (ua ^ s)) &gt;&gt; <span class="num">31</span>;
  <span class="cm">// ov=1 â†’ æº¢å‡º;  ov=0 â†’ æ­£å¸¸</span>
  <span class="cm">// æ„é€ é¥±å’Œè¾¹ç•Œå€¼:</span>
  <span class="cm">// a<0  â†’ sat = INT_MIN = 0x80000000</span>
  <span class="cm">// a>=0 â†’ sat = INT_MAX = 0x7FFFFFFF</span>
  <span class="kw">unsigned</span> sat = (ua &gt;&gt; <span class="num">31</span>) + (<span class="kw">unsigned</span>)INT_MAX;
  <span class="kw">return</span> (<span class="kw">int</span>)(ov ? sat : s);
  <span class="cm">// å®Œå…¨æ— åˆ†æ”¯: SELECT(ov, sat, s)</span>
  <span class="cm">// ç¼–è¯‘å™¨ä¼šç”Ÿæˆ CMOV (æ¡ä»¶ç§»åŠ¨) æŒ‡ä»¤</span>
}

<span class="cm">// æ–¹æ³•3: GCC/Clang å†…å»º (æ¨è)</span>
<span class="kw">int</span> <span class="fn">sadd_builtin</span>(<span class="kw">int</span> a, <span class="kw">int</span> b) {
  <span class="kw">int</span> s;
  <span class="kw">if</span> (__builtin_add_overflow(a, b, &s))
    <span class="kw">return</span> a > <span class="num">0</span> ? INT_MAX : INT_MIN;
  <span class="kw">return</span> s;
}

<span class="cm">// æ–¹æ³•4: x86 SIMD é¥±å’ŒåŠ æ³• (æœ€å¿«)</span>
<span class="cm">// _mm_adds_epi16 â€” SSE2 é¥±å’ŒåŠ æ³• (8ä¸ª16ä½)</span>
<span class="cm">// _mm_adds_epu8  â€” SSE2 æ— ç¬¦å·é¥±å’ŒåŠ æ³• (16ä¸ª8ä½)</span>
<span class="cm">// â†’ éŸ³é¢‘/å›¾åƒå¤„ç†çš„æ ‡å‡†é€‰æ‹©</span>
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.7rem;">é¥±å’Œå‡æ³• / æ— ç¬¦å·é¥±å’Œç®—æœ¯</div>
      <div class="code-block">
<span class="cm">// Â§4-4 æ— ç¬¦å·é¥±å’ŒåŠ æ³•</span>
<span class="kw">unsigned</span> <span class="fn">usadd</span>(<span class="kw">unsigned</span> a, <span class="kw">unsigned</span> b) {
  <span class="kw">unsigned</span> s = a + b;
  <span class="cm">// æ— ç¬¦å·åŠ æ³•æº¢å‡ºæ£€æµ‹: s < a (è¿›ä½)</span>
  <span class="kw">return</span> s | -(s &lt; a);
  <span class="cm">// s < a æ—¶: -(1) = 0xFFFFFFFF â†’ s|0xFFFF = UINT_MAX</span>
  <span class="cm">// s >= a æ—¶: -(0) = 0        â†’ s|0     = s</span>
  <span class="cm">// å·§å¦™: 1æ¡å‡æ³•+1æ¡OR, å®Œå…¨æ— åˆ†æ”¯!</span>
}

<span class="cm">// æ— ç¬¦å·é¥±å’Œå‡æ³• (ä¸‹ç•Œä¸º0)</span>
<span class="kw">unsigned</span> <span class="fn">ussub</span>(<span class="kw">unsigned</span> a, <span class="kw">unsigned</span> b) {
  <span class="kw">unsigned</span> d = a - b;
  <span class="cm">// a < b æ—¶: då€Ÿä½ â†’ å¾ˆå¤§, åº”è¿”å›0</span>
  <span class="kw">return</span> d &amp; -(a &gt;= b);
  <span class="cm">// a >= b: -(1) = 0xFFFF â†’ d & 0xFFFF = d âœ“</span>
  <span class="cm">// a <  b: -(0) = 0      â†’ d & 0     = 0 âœ“</span>
}

<span class="cm">// ARM æ¶æ„åŸç”Ÿæ”¯æŒ:</span>
<span class="cm">// QADD  â€” æœ‰ç¬¦å·é¥±å’ŒåŠ  (Q flag)</span>
<span class="cm">// QSUB  â€” æœ‰ç¬¦å·é¥±å’Œå‡</span>
<span class="cm">// UQADD â€” æ— ç¬¦å·é¥±å’ŒåŠ </span>
<span class="cm">// UQSUB â€” æ— ç¬¦å·é¥±å’Œå‡</span>
<span class="cm">// â†’ DSP/éŸ³é¢‘å¤„ç†å™¨æ ‡é…, 1å‘¨æœŸå®Œæˆ</span>

<span class="cm">// åº”ç”¨: éŸ³é¢‘æ··éŸ³ (16ä½æ ·æœ¬)</span>
<span class="cm">// mixed = sadd16(track1, track2)</span>
<span class="cm">// é¿å…: 255+255=510 å›ç»•åˆ° 254 (çˆ†éŸ³!)</span>
<span class="cm">// é¥±å’Œ: 255+255=255 (æ­£ç¡®æˆªå¹…)</span>
      </div>
    </div>
  </div>

  <!-- å›¾è¡¨: é¥±å’Œ vs å›ç»• -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--o);margin-bottom:.5rem;">
      ğŸ“Š é¥±å’Œç®—æœ¯ vs å›ç»•ç®—æœ¯ â€” åŠ æ³•ç»“æœå¯¹æ¯”ï¼ˆa å›ºå®šä¸º 100ï¼Œb ä» -128 åˆ° 127ï¼‰
    </div>
    <div id="chart-sat" style="width:100%;height:260px;"></div>
  </div>
</section>

<!-- â•â•â• Â§4-5 å†å²ä¸èƒŒæ™¯ â•â•â• -->
<section id="history">
  <div class="sec-header">
    <span class="sec-num">Â§4-5</span>
    <span class="sec-title">å†å²èƒŒæ™¯ä¸è·¨è¯­è¨€å¯¹æ¯”</span>
    <div class="sec-divider"></div>
  </div>

  <div class="grid-3" style="margin-bottom:1.2rem;">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--g);margin-bottom:.55rem;">ğŸ•° Ada (1983)</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        Ada æ˜¯æœ€æ—©å°†<strong style="color:#94a3b8">æ•´æ•°å­èŒƒå›´ç±»å‹</strong>å†…ç½®åˆ°è¯­è¨€è§„èŒƒçš„è¯­è¨€ã€‚
        <code style="color:var(--o)">subtype Index is Integer range 0..99;</code>
        ç¼–è¯‘å™¨è‡ªåŠ¨åœ¨è¾¹ç•Œå¤„æ’å…¥æ£€æŸ¥ï¼Œè¶Šç•ŒæŠ›å‡º
        <code style="color:var(--r)">Constraint_Error</code>ã€‚
        Warren Â§4-1 çš„"å•æ¬¡æ— ç¬¦å·æ¯”è¾ƒ"æ­£æ˜¯æ­¤ç±»è¿è¡Œæ—¶æ£€æŸ¥çš„é«˜æ•ˆå®ç°ã€‚
        Ada è‡³ä»Šä»æ˜¯èˆªç©ºèˆªå¤©è½¯ä»¶ï¼ˆDO-178Cï¼‰çš„é¦–é€‰è¯­è¨€ï¼Œå…¶æ•´æ•°è¯­ä¹‰è¢«ç²¾ç¡®å®šä¹‰åˆ°æ¯”ç‰¹çº§åˆ«ã€‚
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--b);margin-bottom:.55rem;">ğŸ¦€ Rust (2015)</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        Rust çš„æ•´æ•°ç±»å‹åœ¨ <strong style="color:#94a3b8">debug æ¨¡å¼</strong>ä¸‹é»˜è®¤æ£€æµ‹æº¢å‡ºï¼ˆpanicï¼‰ï¼Œ
        release æ¨¡å¼ä¸‹å›ç»•ï¼ˆä¸ C æ— ç¬¦å·è¡Œä¸ºä¸€è‡´ï¼‰ã€‚
        æ ‡å‡†åº“æä¾›å››æ—æ–¹æ³•ï¼š
        <code style="color:var(--o)">checked_add</code>ï¼ˆè¿”å› Optionï¼‰ï¼Œ
        <code style="color:var(--o)">saturating_add</code>ï¼ˆÂ§4-4 é¥±å’Œè¯­ä¹‰ï¼‰ï¼Œ
        <code style="color:var(--o)">wrapping_add</code>ï¼ˆæ˜¾å¼å›ç»•ï¼‰ï¼Œ
        <code style="color:var(--o)">overflowing_add</code>ï¼ˆè¿”å› (ç»“æœ, æ˜¯å¦æº¢å‡º)ï¼‰ã€‚
        å½»åº•æ¶ˆé™¤äº† C/C++ ä¸­æœ‰ç¬¦å·æº¢å‡º UB çš„å®‰å…¨éšæ‚£ã€‚
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--p);margin-bottom:.55rem;">â˜• Java (1995)</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        Java æ•´æ•°<strong style="color:#94a3b8">å§‹ç»ˆå›ç»•</strong>ï¼ˆä¸¤ç§è¡¥ç ï¼Œæ—  UBï¼‰ï¼Œ
        ä½†æ•°ç»„è¶Šç•ŒæŠ› <code style="color:var(--r)">ArrayIndexOutOfBoundsException</code>ã€‚
        JVM çš„ JITï¼ˆHotSpot C2ï¼‰ç”¨ Warren Â§4-1 çš„æ— ç¬¦å·å•æ¬¡æ¯”è¾ƒå®ç°æ•°ç»„è¶Šç•Œæ£€æŸ¥ï¼Œ
        å¹¶é€šè¿‡<strong style="color:#94a3b8">å¾ªç¯æ— å…³é‡æå‡ï¼ˆLoop Invariant Code Motionï¼‰</strong>å’Œ
        <strong style="color:#94a3b8">è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ï¼ˆBCEï¼‰</strong>å°†çƒ­å¾ªç¯ä¸­çš„æ£€æŸ¥ä» O(n) é™åˆ° O(1)ã€‚
        JDK 16+ åŠ å…¥äº† <code style="color:var(--o)">Math.clamp()</code> å®ç°é¥±å’Œè¯­ä¹‰ã€‚
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--o);margin-bottom:.55rem;">ğŸ›¡ C (UB åœ°é›·åŒº)</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        C æ ‡å‡†è§„å®š<strong style="color:#94a3b8">æœ‰ç¬¦å·æ•´æ•°æº¢å‡ºæ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰</strong>ï¼Œ
        è¿™å…è®¸ç¼–è¯‘å™¨åœ¨ -O2 ä¸‹åˆ é™¤æº¢å‡ºæ£€æŸ¥ä»£ç ï¼ˆè®¤ä¸ºæº¢å‡ºä¸ä¼šå‘ç”Ÿï¼‰ã€‚
        è‘—åæ¡ˆä¾‹ï¼šLinux å†…æ ¸æ›¾å›  <code style="color:var(--r)">i+1 &lt; i</code> æ£€æŸ¥è¢« GCC ä¼˜åŒ–åˆ é™¤
        å¯¼è‡´å®‰å…¨æ¼æ´ï¼ˆCVE-2009-1897ï¼‰ã€‚
        <code style="color:var(--o)">-fsanitize=undefined</code>ï¼ˆUBSanï¼‰å¯åœ¨è¿è¡Œæ—¶æ£€æµ‹ï¼Œ
        ä½†ç”Ÿäº§ç¯å¢ƒå¼€é”€è¾ƒå¤§ã€‚Warren Â§4-4 çš„æ— åˆ†æ”¯ä½æ“ä½œæ–¹æ¡ˆæ˜¯åœ¨ C ä¸­å®‰å…¨å¤„ç†æº¢å‡ºçš„æœ€ä¼˜è§£ã€‚
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--r);margin-bottom:.55rem;">ğŸ”¥ Swift (2014)</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        Swift é»˜è®¤å¯¹æ‰€æœ‰æ•´æ•°è¿ç®—è¿›è¡Œæº¢å‡ºæ£€æŸ¥ï¼Œæº¢å‡ºæ—¶ <strong style="color:#94a3b8">trapï¼ˆå´©æºƒï¼‰</strong>è€Œé UBã€‚
        æä¾›æº¢å‡ºæ“ä½œç¬¦ <code style="color:var(--o)">&+</code>ã€<code style="color:var(--o)">&-</code>ã€<code style="color:var(--o)">&*</code>
        ç”¨äºæ˜¾å¼å…è®¸å›ç»•ï¼ˆæ€§èƒ½æ•æ„Ÿè·¯å¾„ï¼‰ã€‚
        Swift çš„æ•´æ•°æº¢å‡ºè¯­ä¹‰ç»è¿‡ ABI ç¨³å®šåŒ–ï¼ˆSwift 5ï¼‰ï¼Œ
        åº•å±‚å®ç°å®Œå…¨ä¾èµ– LLVM çš„ <code style="color:var(--o)">@llvm.sadd.with.overflow</code> å†…å»ºå‡½æ•°ï¼Œ
        å¯¹åº” x86 çš„ <code style="color:var(--o)">ADD + JO</code> åŒæŒ‡ä»¤ï¼Œæ€§èƒ½æ¥è¿‘æ— æ£€æŸ¥ç‰ˆæœ¬ã€‚
      </div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--g);margin-bottom:.55rem;">ğŸ”§ DSP / åµŒå…¥å¼</div>
      <div style="font-size:.8rem;line-height:1.72;color:#64748b;">
        æ•°å­—ä¿¡å·å¤„ç†å™¨ï¼ˆDSPï¼‰å°†<strong style="color:#94a3b8">é¥±å’Œç®—æœ¯</strong>ä½œä¸ºç¡¬ä»¶åŸç”Ÿç‰¹æ€§ã€‚
        TI C55xã€Qualcomm Hexagonã€ARM Cortex-M çš„ DSP æ‰©å±•
        å‡æä¾›å•å‘¨æœŸé¥±å’ŒåŠ å‡ä¹˜æŒ‡ä»¤ã€‚
        éŸ³é¢‘ç¼–è§£ç ï¼ˆMP3/AAC/Opusï¼‰ã€å›¾åƒæ»¤æ³¢ï¼ˆå·ç§¯æ ¸è¿ç®—ï¼‰å’Œ
        ç¥ç»ç½‘ç»œé‡åŒ–ï¼ˆINT8 æ¨ç†ï¼‰å¤§é‡ä¾èµ–é¥±å’Œè¯­ä¹‰ï¼Œ
        é¿å…å›ç»•å¯¼è‡´çš„ä¿¡å·å¤±çœŸå’Œæ¨¡å‹ç²¾åº¦æŸå¤±ã€‚
      </div>
    </div>
  </div>

  <!-- æ—¶é—´çº¿ -->
  <div class="card">
    <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:1rem;">ğŸ“… æ•´æ•°ç®—æœ¯å®‰å…¨çš„æ¼”è¿›æ—¶é—´çº¿</div>
    <div style="position:relative;padding-left:1.5rem;">
      <div style="position:absolute;left:.65rem;top:0;bottom:0;width:1px;background:linear-gradient(180deg,var(--g),var(--b),var(--p));opacity:.35;"></div>
      <template x-for="(ev, i) in timeline" :key="i">
        <div style="position:relative;margin-bottom:1rem;padding-left:.5rem;">
          <div style="position:absolute;left:-1.2rem;top:.3rem;width:8px;height:8px;border-radius:50%;background:var(--g);box-shadow:0 0 6px var(--g);"></div>
          <div style="display:flex;align-items:baseline;gap:.5rem;flex-wrap:wrap;">
            <span style="font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--g);" x-text="ev.year"></span>
            <span style="font-size:.82rem;font-weight:600;color:#e2e8f0;" x-text="ev.title"></span>
          </div>
          <div style="font-size:.78rem;color:#64748b;line-height:1.65;margin-top:.2rem;" x-text="ev.desc"></div>
        </div>
      </template>
    </div>
  </div>
</section>

<!-- â•â•â• æ·±åº¦ç‚¹è¯„ â•â•â• -->
<section id="critique">
  <div class="sec-header">
    <span class="sec-num">Â§CRIT</span>
    <span class="sec-title">æ·±åº¦ç‚¹è¯„ â€” ç¬¬4ç« çš„ä»·å€¼ä¸å±€é™</span>
    <div class="sec-divider"></div>
  </div>

  <div class="critic-box" style="margin-bottom:1.2rem;">
    <h3>ç¬¬4ç« ï¼šè¢«ä½ä¼°çš„ç†è®ºåŸºçŸ³</h3>
    <div class="critic-item">
      <div class="ci-title">âœ¦ æ•°å­¦ä¸¥è°¨æ€§è¿œè¶…åŒç±»ä¹¦ç±</div>
      <p>Warren åœ¨æœ¬ç« ç»™å‡ºäº†å®Œæ•´çš„<strong>åŒºé—´ç®—æœ¯ï¼ˆInterval Arithmeticï¼‰</strong>æ¡†æ¶ï¼Œ
      åŒºåˆ«äºä¸€èˆ¬çš„"ç»éªŒæŠ€å·§"ï¼Œè¿™æ˜¯æœ‰æ•°å­¦è¯æ˜æ”¯æ’‘çš„ç³»ç»Ÿæ€§ç†è®ºã€‚
      æ¯ä¸€ä¸ªä¼ æ’­è§„åˆ™éƒ½é™„æœ‰æº¢å‡ºæ¡ä»¶çš„ç²¾ç¡®æè¿°ï¼Œè¿™åœ¨åŒç±»ä½æ“ä½œä¹¦ç±ä¸­æä¸ºç½•è§ã€‚
      LLVM çš„ <code>ConstantRange</code> ç±»ï¼ˆçº¦ 3000 è¡Œ C++ï¼‰å’Œ GCC çš„ VRP Pass
      æœ¬è´¨ä¸Šå°±æ˜¯å¯¹è¿™ä¸€æ¡†æ¶çš„å·¥ç¨‹å®ç°ã€‚</p>
    </div>
    <div class="critic-item">
      <div class="ci-title">âœ¦ Â§4-1 çš„"å•æ¬¡æ— ç¬¦å·æ¯”è¾ƒ"å½±å“æ·±è¿œ</div>
      <p>è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„æŠ€å·§æ¸—é€åˆ°äº† JVM å­—èŠ‚ç éªŒè¯å™¨ã€eBPF å®‰å…¨æ£€æŸ¥ã€
      Rust åˆ‡ç‰‡ç´¢å¼•ã€WebAssembly çº¿æ€§å†…å­˜è®¿é—®ç­‰å‡ ä¹æ‰€æœ‰ç°ä»£è¿è¡Œæ—¶çš„å®‰å…¨åŸºç¡€è®¾æ–½ä¸­ã€‚
      æœ¬è´¨æ˜¯å°†"æœ‰ç•Œæ€§åˆ¤æ–­"ä»ä»£æ•°åŸŸè½¬æ¢åˆ°æ¨¡ç®—æœ¯åŸŸï¼Œ
      åˆ©ç”¨æ— ç¬¦å·æ•´æ•°çš„"è´Ÿæ•°å³å¤§æ•°"ç‰¹æ€§ä¸€æ¬¡å®ŒæˆåŒé‡æ£€æŸ¥ã€‚</p>
    </div>
    <div class="critic-item">
      <div class="ci-title">âœ¦ é€»è¾‘æ“ä½œä¼ æ’­çš„ç²¾ç¡®æ€§æœ‰æ‰€ä¿å®ˆ</div>
      <p>Â§4-3 å¯¹ XOR çš„å¤„ç†é‡‡ç”¨äº†ä¿å®ˆä¼°è®¡ï¼ˆä¸‹ç•Œä¸º0ï¼Œä¸Šç•Œä¸º b|dï¼‰ï¼Œ
      è¿™åœ¨ç¼–è¯‘å™¨ä¼˜åŒ–ä¸­ä¼šå¯¼è‡´ç²¾åº¦æŸå¤±ã€‚ç°ä»£ç¼–è¯‘å™¨ï¼ˆLLVM 14+ï¼‰å·²å¼•å…¥
      <strong>tnumï¼ˆtristate numberï¼‰</strong>è¡¨ç¤ºï¼Œç”¨ä¸‰æ€ä½ï¼ˆ0/1/unknownï¼‰
      è¿½è¸ªæ¯ä¸€ä½çš„å·²çŸ¥çŠ¶æ€ï¼Œç²¾åº¦è¿œè¶…åŒºé—´æ–¹æ³•ã€‚
      Warren çš„åŒºé—´æ–¹æ³•æ›´é€‚åˆç†è§£åŸç†ï¼Œtnum æ›´é€‚åˆå·¥ç¨‹å®è·µã€‚</p>
    </div>
    <div class="critic-item">
      <div class="ci-title">âœ¦ é¥±å’Œç®—æœ¯ä¸€èŠ‚æ˜¯ DSP å·¥ç¨‹å¸ˆçš„å¿…è¯»å†…å®¹</div>
      <p>Â§4-4 çš„æ— åˆ†æ”¯é¥±å’ŒåŠ æ³• <code>s | -(s &lt; a)</code> æ˜¯æ•™ç§‘ä¹¦çº§åˆ«çš„æŠ€å·§â€”â€”
      åˆ©ç”¨æ— ç¬¦å·æº¢å‡ºæ£€æµ‹ï¼ˆs&lt;aï¼‰ç”Ÿæˆå…¨1æˆ–å…¨0æ©ç ï¼Œä¸ç»“æœ OR å®ç°é¥±å’Œã€‚
      æ•´ä¸ªæ“ä½œåœ¨ç°ä»£ CPU ä¸Šåªéœ€ 2-3 æ¡æŒ‡ä»¤ï¼Œæ¯” if-else åˆ†æ”¯å¿«çº¦ 3 å€ã€‚
      è¿™å¯¹å®æ—¶éŸ³é¢‘ï¼ˆ44.1kHz Ã— 32å£°é“çš„æ··éŸ³å¼•æ“ï¼‰çš„æ€§èƒ½è‡³å…³é‡è¦ã€‚</p>
    </div>
    <div class="critic-item">
      <div class="ci-title">âš  æ—¶ä»£å±€é™ï¼šæœªè¦†ç›– C/C++ UB è¯­ä¹‰</div>
      <p>ç¬¬ä¸€ç‰ˆå†™äº 2002 å¹´ï¼Œå½¼æ—¶ç¼–è¯‘å™¨å¯¹æœ‰ç¬¦å·æº¢å‡º UB çš„æ¿€è¿›ä¼˜åŒ–å°šä¸æ™®éã€‚
      ç°ä»£ GCC/Clang åœ¨ -O2 ä¸‹å¯èƒ½åˆ é™¤åŸºäºæº¢å‡ºå‡è®¾çš„ä»£ç ï¼Œ
      ä½¿éƒ¨åˆ†ç¤ºä¾‹åœ¨å®é™…ç¼–è¯‘æ—¶è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸã€‚
      å»ºè®®é…åˆ <code>-fwrapv</code>ï¼ˆGCCï¼‰æˆ– <code>-fsanitize=undefined</code> ä½¿ç”¨ï¼Œ
      æˆ–æ”¹å†™ä¸ºæ— ç¬¦å·æ“ä½œï¼ˆUB-freeï¼‰ã€‚è¿™æ˜¯æœ¬ç« æœ€å¤§çš„å·¥ç¨‹é™·é˜±ã€‚</p>
    </div>
  </div>

  <!-- é›·è¾¾å›¾ -->
  <div class="grid-2">
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--g);margin-bottom:.5rem;">
        ğŸ“Š ç¬¬4ç« å„å°èŠ‚å®ç”¨ä»·å€¼è¯„ä¼°
      </div>
      <div id="chart-radar" style="width:100%;height:280px;"></div>
    </div>
    <div class="card">
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--b);margin-bottom:.5rem;">
        ğŸ“Š Â§4-2 åŠ æ³•èŒƒå›´ä¼ æ’­ï¼šç»“æœåŒºé—´éš y ä¸Šç•Œå˜åŒ–
      </div>
      <div id="chart-range" style="width:100%;height:280px;"></div>
    </div>
  </div>
</section>

<!-- â•â•â• ç« èŠ‚å¯¼èˆª â•â•â• -->
<div style="max-width:1100px;margin:0 auto;padding:0 1.5rem 3rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
  <a href="ch03.html" style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1.4rem;background:var(--card);border:1px solid #1e293b;border-radius:.6rem;text-decoration:none;color:#94a3b8;font-family:'JetBrains Mono',monospace;font-size:.78rem;transition:all .2s;" onmouseover="this.style.borderColor='rgba(0,255,136,.35)';this.style.color='var(--g)'" onmouseout="this.style.borderColor='#1e293b';this.style.color='#94a3b8'">
    â† Ch.03 Â· èƒ½åŠ›è®¡æ•°
  </a>
  <div style="font-family:'JetBrains Mono',monospace;font-size:.65rem;color:#1e293b;">Chapter 04 / Hacker's Delight</div>
  <a href="ch05.html" style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1.4rem;background:var(--card);border:1px solid #1e293b;border-radius:.6rem;text-decoration:none;color:#94a3b8;font-family:'JetBrains Mono',monospace;font-size:.78rem;transition:all .2s;" onmouseover="this.style.borderColor='rgba(0,255,136,.35)';this.style.color='var(--g)'" onmouseout="this.style.borderColor='#1e293b';this.style.color='#94a3b8'">
    Ch.05 Â· æ•´æ•°é™¤æ³• â†’
  </a>
</div>

<footer>
  <div>// HACKER'S DELIGHT â€” Chapter 04 Â· Arithmetic Bounds</div>
  <div style="margin-top:.4rem;">Interactive Study Notes Â· Built with Alpine.js + ECharts Â· <a href="index.html">è¿”å›ç›®å½•</a></div>
</footer>

</div><!-- #app -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å…¨å±€ Alpine æ ¹ç»„ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function app() {
  return {
    tabAdd: 'signed',
    timeline: [
      { year: '1957', title: 'FORTRAN â€” æ•´æ•°æº¢å‡ºé™é»˜å›ç»•', desc: 'IBM 704 ä¸Š FORTRAN I çš„æ•´æ•°è¿ç®—å‘ç”Ÿæº¢å‡ºæ—¶ç»“æœå›ç»•ï¼Œæ— ä»»ä½•æ£€æµ‹æœºåˆ¶ã€‚è¿™ä¸€"ä¼ ç»Ÿ"æ²¿ç”¨è‡³ä»Šæˆä¸º C æ— ç¬¦å·è¯­ä¹‰çš„æ ¹åŸºã€‚' },
      { year: '1983', title: 'Ada â€” èŒƒå›´å­ç±»å‹ä¸è¿è¡Œæ—¶æ£€æŸ¥', desc: 'Ada 83 å¼•å…¥ subtype rangeï¼Œç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥è¾¹ç•Œæ£€æŸ¥ï¼Œæº¢å‡ºæŠ› Constraint_Errorã€‚æ˜¯æœ€æ—©ç³»ç»ŸåŒ–å¤„ç†æ•´æ•°è¾¹ç•Œçš„ä¸»æµè¯­è¨€ã€‚' },
      { year: '1990', title: 'GNU C â€” -ftrapv æ——æ ‡', desc: 'GCC å¼•å…¥ -ftrapvï¼Œä½¿æœ‰ç¬¦å·æ•´æ•°æº¢å‡ºäº§ç”Ÿ SIGABRT è€Œé UBã€‚ä½†æ€§èƒ½å¼€é”€ä½¿å…¶å‡ ä¹ä¸ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚' },
      { year: '2002', title: "Hacker's Delight ç¬¬ä¸€ç‰ˆ", desc: 'Warren ç³»ç»Ÿæ•´ç†è¾¹ç•Œæ£€æŸ¥ã€èŒƒå›´ä¼ æ’­ã€æº¢å‡ºæ£€æµ‹å’Œé¥±å’Œç®—æœ¯çš„ä½æŠ€å·§ï¼Œå¥ å®šäº†åæ¥ç¼–è¯‘å™¨ä¼˜åŒ–å’Œè¿è¡Œæ—¶å®‰å…¨æ£€æŸ¥çš„ç†è®ºåŸºç¡€ã€‚' },
      { year: '2009', title: 'CVE-2009-1897 â€” GCC ä¼˜åŒ–åˆ é™¤æº¢å‡ºæ£€æŸ¥', desc: 'Linux å†…æ ¸å› æœ‰ç¬¦å·æº¢å‡º UB è¢« GCC -O2 åˆ é™¤è¾¹ç•Œæ£€æŸ¥ä»£ç ï¼Œå¼•å‘æœ¬åœ°ææƒæ¼æ´ã€‚æ­£å¼æ•²å“ C æ•´æ•° UB å®‰å…¨çš„è­¦é’Ÿã€‚' },
      { year: '2012', title: 'LLVM ConstantRange æˆç†Ÿ', desc: 'LLVM çš„ ConstantRange ç±»å®ç°å®Œæ•´çš„ Â§4-2/4-3 åŒºé—´ç®—æœ¯ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤ã€AND/OR/XOR çš„ç²¾ç¡®èŒƒå›´ä¼ æ’­ï¼Œæˆä¸ºç°ä»£ç¼–è¯‘å™¨ VRP çš„åŸºç¡€è®¾æ–½ã€‚' },
      { year: '2015', title: 'Rust 1.0 â€” checked/saturating/wrapping ä¸‰æ— API', desc: 'Rust å°†æº¢å‡ºè¡Œä¸ºæ˜¾å¼åŒ–ä¸ºå››ç§ APIï¼Œå½»åº•æ¶ˆé™¤æœ‰ç¬¦å·æ•´æ•° UBã€‚debug æ¨¡å¼ panic, release æ¨¡å¼ wrappingï¼Œå¯æ˜¾å¼é€‰æ‹© saturatingã€‚' },
      { year: '2020', title: 'C++20 â€” std::bit_cast, __builtin_add_overflow æ ‡å‡†åŒ–', desc: 'C++20 æä¾› std::bit_cast å®‰å…¨ç±»å‹åŒå…³ï¼ŒGCC/Clang çš„ __builtin_*_overflow è¢«å¹¿æ³›é‡‡ç”¨ä¸ºè·¨å¹³å°æº¢å‡ºæ£€æµ‹æ ‡å‡†æ–¹æ¡ˆã€‚' },
      { year: '2022', title: 'eBPF éªŒè¯å™¨ â€” åŸºäº Â§4-3 çš„ tnum ä½åˆ†æ', desc: 'Linux eBPF éªŒè¯å™¨æ•´åˆ tristate number (tnum) å’ŒåŒºé—´èŒƒå›´åŒè½¨è¿½è¸ªï¼Œç²¾ç¡®æ¨æ–­æ¯æ¡ AND/OR æŒ‡ä»¤åçš„å¯„å­˜å™¨å€¼åŸŸï¼Œä¿è¯å†…æ ¸å®‰å…¨ã€‚' },
    ],
    init() {
      this.$nextTick(() => {
        this.initBg();
        this.initProgress();
        this.initDotNav();
        this.initScrollFade();
        this.initCharts();
      });
    },
    initBg() {
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      let W, H, particles = [], mouse = {x:0, y:0};
      const resize = () => {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      };
      resize();
      window.addEventListener('resize', resize);
      for (let i = 0; i < 55; i++) {
        particles.push({
          x: Math.random()*2000, y: Math.random()*1200,
          vx: (Math.random()-.5)*.28, vy: (Math.random()-.5)*.28,
          r: Math.random()*1.5+.3,
          c: ['rgba(0,255,136,', 'rgba(0,212,255,', 'rgba(177,79,255,'][Math.floor(Math.random()*3)],
          a: Math.random()*.35+.06
        });
      }
      const draw = () => {
        ctx.clearRect(0,0,W,H);
        particles.forEach(p => {
          p.x += p.vx; p.y += p.vy;
          if (p.x<0) p.x=W; if (p.x>W) p.x=0;
          if (p.y<0) p.y=H; if (p.y>H) p.y=0;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fillStyle = p.c + p.a + ')';
          ctx.fill();
        });
        particles.forEach((p,i) => {
          particles.slice(i+1).forEach(q => {
            const dx=p.x-q.x, dy=p.y-q.y, d=Math.sqrt(dx*dx+dy*dy);
            if (d<130) {
              ctx.beginPath();
              ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y);
              ctx.strokeStyle=p.c+((.12*(1-d/130)))+')';
              ctx.lineWidth=.5; ctx.stroke();
            }
          });
        });
        requestAnimationFrame(draw);
      };
      draw();
    },
    initProgress() {
      const bar = document.getElementById('prog');
      window.addEventListener('scroll', () => {
        const pct = window.scrollY / (document.body.scrollHeight - window.innerHeight) * 100;
        bar.style.width = pct + '%';
      });
    },
    initDotNav() {
      const dots = document.querySelectorAll('.dot');
      const secs = ['hero','bounds','addprop','logprop','overflow','history','critique'];
      const obs = new IntersectionObserver(entries => {
        entries.forEach(en => {
          if (en.isIntersecting) {
            const idx = secs.indexOf(en.target.id);
            if (idx>=0) {
              dots.forEach(d=>d.classList.remove('active'));
              dots[idx]?.classList.add('active');
            }
          }
        });
      }, { threshold: 0.3 });
      secs.forEach(id => { const el=document.getElementById(id); if(el) obs.observe(el); });
      dots.forEach((d,i) => {
        d.addEventListener('click', () => {
          const el = document.getElementById(secs[i]);
          if(el) el.scrollIntoView({behavior:'smooth'});
        });
      });
    },
    initScrollFade() {
      const obs = new IntersectionObserver(entries => {
        entries.forEach(en => {
          if (en.isIntersecting) {
            en.target.style.opacity='1';
            en.target.style.transform='translateY(0)';
            obs.unobserve(en.target);
          }
        });
      }, {threshold:.1});
      document.querySelectorAll('.card,.insight,.warn-box,.critic-box').forEach(el=>{
        el.style.transition='opacity .45s ease, transform .45s ease';
        el.style.opacity='0'; el.style.transform='translateY(16px)';
        obs.observe(el);
      });
    },
    initCharts() {
      this.$nextTick(() => {
        this.initRadarChart();
        this.initRangeChart();
        this.initSatChart();
      });
    },
    initRadarChart() {
      const el = document.getElementById('chart-radar');
      if (!el || typeof echarts === 'undefined') return;
      const chart = echarts.init(el, 'dark');
      chart.setOption({
        backgroundColor: 'transparent',
        tooltip: { backgroundColor:'#0d1117', borderColor:'rgba(0,255,136,.3)', textStyle:{color:'#e2e8f0',fontFamily:'JetBrains Mono',fontSize:11} },
        radar: {
          indicator: [
            {name:'å®ç”¨æ€§', max:10}, {name:'æ•°å­¦ä¸¥è°¨æ€§', max:10},
            {name:'å·¥ç¨‹å½±å“åŠ›', max:10}, {name:'å¯è¯»æ€§', max:10},
            {name:'ç°ä»£ç›¸å…³æ€§', max:10}, {name:'ç‹¬ç‰¹æ€§', max:10}
          ],
          axisLine: {lineStyle:{color:'rgba(0,255,136,.15)'}},
          splitLine: {lineStyle:{color:'rgba(0,255,136,.08)'}},
          splitArea: {areaStyle:{color:['rgba(0,255,136,.03)','rgba(0,212,255,.02)']}},
          nameTextStyle: {color:'#64748b', fontFamily:'JetBrains Mono', fontSize:11}
        },
        series: [{
          type: 'radar',
          data: [
            { value:[9,9,10,7,9,8], name:'Â§4-1 è¾¹ç•Œæ£€æŸ¥',
              areaStyle:{color:'rgba(0,255,136,.1)'}, lineStyle:{color:'rgba(0,255,136,.8)'}, itemStyle:{color:'rgba(0,255,136,1)'} },
            { value:[8,9,8,7,9,7], name:'Â§4-2 åŠ å‡ä¼ æ’­',
              areaStyle:{color:'rgba(0,212,255,.08)'}, lineStyle:{color:'rgba(0,212,255,.7)'}, itemStyle:{color:'rgba(0,212,255,1)'} },
            { value:[7,9,9,6,9,9], name:'Â§4-3 é€»è¾‘ä¼ æ’­',
              areaStyle:{color:'rgba(177,79,255,.08)'}, lineStyle:{color:'rgba(177,79,255,.7)'}, itemStyle:{color:'rgba(177,79,255,1)'} },
            { value:[9,8,9,8,10,8], name:'Â§4-4 é¥±å’Œç®—æœ¯',
              areaStyle:{color:'rgba(255,140,0,.08)'}, lineStyle:{color:'rgba(255,140,0,.7)'}, itemStyle:{color:'rgba(255,140,0,1)'} }
          ]
        }],
        legend: { bottom:0, textStyle:{color:'#475569',fontSize:10,fontFamily:'JetBrains Mono'} }
      });
      window.addEventListener('resize', ()=>chart.resize());
    },
    initRangeChart() {
      const el = document.getElementById('chart-range');
      if (!el || typeof echarts === 'undefined') return;
      const chart = echarts.init(el, 'dark');
      const yVals = Array.from({length:41}, (_,i) => i-20);
      const loVals = yVals.map(y => -10 + y);
      const hiVals = yVals.map(y =>  20 + y);
      chart.setOption({
        backgroundColor:'transparent',
        tooltip:{trigger:'axis', backgroundColor:'#0d1117', borderColor:'rgba(0,255,136,.3)', textStyle:{color:'#e2e8f0',fontFamily:'JetBrains Mono',fontSize:11}},
        grid:{left:'12%',right:'5%',top:'12%',bottom:'14%'},
        xAxis:{type:'category', data:yVals, axisLine:{lineStyle:{color:'#1e293b'}}, axisLabel:{color:'#334155',fontFamily:'JetBrains Mono',fontSize:10}, name:'y çš„ä¸‹ç•Œ c (xâˆˆ[-10,20])', nameTextStyle:{color:'#334155',fontSize:10}},
        yAxis:{axisLine:{lineStyle:{color:'#1e293b'}}, splitLine:{lineStyle:{color:'#0f172a'}}, axisLabel:{color:'#334155',fontFamily:'JetBrains Mono',fontSize:10}, name:'x+y èŒƒå›´', nameTextStyle:{color:'#334155',fontSize:10}},
        series:[
          {name:'x+y ä¸‹ç•Œ', type:'line', data:loVals, smooth:true, lineStyle:{color:'rgba(0,255,136,.8)',width:2}, areaStyle:{color:'rgba(0,255,136,.06)'}, symbol:'none'},
          {name:'x+y ä¸Šç•Œ', type:'line', data:hiVals, smooth:true, lineStyle:{color:'rgba(0,212,255,.8)',width:2}, areaStyle:{color:'rgba(0,212,255,.06)'}, symbol:'none'},
          {name:'INT_MAX', type:'line', data:yVals.map(()=>2147483647), lineStyle:{color:'rgba(255,68,102,.4)',width:1,type:'dashed'}, symbol:'none'},
          {name:'INT_MIN', type:'line', data:yVals.map(()=>-2147483648), lineStyle:{color:'rgba(255,68,102,.4)',width:1,type:'dashed'}, symbol:'none'}
        ],
        legend:{bottom:0, textStyle:{color:'#475569',fontSize:10,fontFamily:'JetBrains Mono'}}
      });
      window.addEventListener('resize', ()=>chart.resize());
    },
    initSatChart() {
      const el = document.getElementById('chart-sat');
      if (!el || typeof echarts === 'undefined') return;
      const chart = echarts.init(el, 'dark');
      const bVals = Array.from({length:256},(_,i)=>i-128);
      const a = 100;
      const wrapped = bVals.map(b => {
        let r = a + b;
        if (r > 127) r -= 256;
        if (r < -128) r += 256;
        return r;
      });
      const saturated = bVals.map(b => Math.max(-128, Math.min(127, a + b)));
      chart.setOption({
        backgroundColor:'transparent',
        tooltip:{trigger:'axis', backgroundColor:'#0d1117', borderColor:'rgba(0,255,136,.3)', textStyle:{color:'#e2e8f0',fontFamily:'JetBrains Mono',fontSize:11}},
        grid:{left:'12%',right:'5%',top:'12%',bottom:'14%'},
        xAxis:{type:'category', data:bVals.filter((_,i)=>i%16===0), axisLine:{lineStyle:{color:'#1e293b'}}, axisLabel:{color:'#334155',fontFamily:'JetBrains Mono',fontSize:10}, name:'b çš„å€¼', nameTextStyle:{color:'#334155',fontSize:10}},
        yAxis:{min:-128,max:127, axisLine:{lineStyle:{color:'#1e293b'}}, splitLine:{lineStyle:{color:'#0f172a'}}, axisLabel:{color:'#334155',fontFamily:'JetBrains Mono',fontSize:10}, name:'a+b ç»“æœ (a=100)', nameTextStyle:{color:'#334155',fontSize:10}},
        series:[
          {name:'å›ç»•åŠ æ³•', type:'line', data:wrapped, smooth:false, lineStyle:{color:'rgba(255,68,102,.75)',width:1.5}, symbol:'none'},
          {name:'é¥±å’ŒåŠ æ³•', type:'line', data:saturated, smooth:false, lineStyle:{color:'rgba(0,255,136,.85)',width:2}, symbol:'none'}
        ],
        legend:{bottom:0, textStyle:{color:'#475569',fontSize:10,fontFamily:'JetBrains Mono'}}
      });
      window.addEventListener('resize', ()=>chart.resize());
    }
  };
}

/* â•â•â• å­ç»„ä»¶ â•â•â• */
function boundsDemo() {
  return {
    a: -5, x: 3, b: 10,
    get inBounds() { return this.x >= this.a && this.x <= this.b; },
    get uBoundsOk() {
      const xu = (this.x - this.a) >>> 0;
      const bu = (this.b - this.a) >>> 0;
      return xu <= bu;
    }
  };
}

function rangeCalc() {
  return {
    xa: -10, xb: 20, yc: -5, yd: 15,
    get addOverflow() {
      const lo = this.xa + this.yc, hi = this.xb + this.yd;
      return lo < -2147483648 || hi > 2147483647;
    },
    get subOverflow() {
      const lo = this.xa - this.yd, hi = this.xb - this.yc;
      return lo < -2147483648 || hi > 2147483647;
    }
  };
}

function bitwiseRangeDemo() {
  return { xb: 93, yd: 154 };
}

function overflowVis() {
  return {
    a: 100, b: 50,
    get wrappedAdd() {
      let r = this.a + this.b;
      if (r > 127) r -= 256;
      if (r < -128) r += 256;
      return r;
    },
    get saturatedAdd() { return Math.max(-128, Math.min(127, this.a + this.b)); },
    get wrappedSub() {
      let r = this.a - this.b;
      if (r > 127) r -= 256;
      if (r < -128) r += 256;
      return r;
    },
    get saturatedSub() { return Math.max(-128, Math.min(127, this.a - this.b)); }
  };
}
</script>
</body>
</html>
